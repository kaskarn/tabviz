---
title: "forest_plot()"
---

```{r}
#| include: false
library(tabviz)
library(dplyr)
```

::: {.callout-warning}
## Deprecation Notice

`forest_plot()` is being deprecated in favor of `tabviz()`. While `forest_plot()` continues to work, we recommend using `tabviz()` with `col_forest()` for new code. The `tabviz()` function provides a more consistent API and full control over all column types.

```r
# Instead of:
forest_plot(data, point = "hr", lower = "lo", upper = "hi", label = "study")

# Use:
tabviz(data, label = "study", columns = list(
  col_forest(point = "hr", lower = "lo", upper = "hi")
))
```
:::

## Overview

`forest_plot()` is a convenience wrapper around `tabviz()` that automatically creates a forest plot column from `point`, `lower`, and `upper` arguments. Use it when you want a quick forest plot without explicitly defining `col_forest()`.

::: {.callout-tip}
## When to Use Which Function

| Function | Use Case |
|----------|----------|
| `tabviz()` | **Full control** - Define all columns explicitly, any table type |
| `forest_plot()` | **Quick forest plots** - Just specify point/lower/upper |

```r
# These are equivalent:
forest_plot(data, point = "hr", lower = "lo", upper = "hi", label = "study",
            scale = "log", null_value = 1)

tabviz(data, label = "study", columns = list(
  col_forest(point = "hr", lower = "lo", upper = "hi",
             scale = "log", null_value = 1)
))
```
:::

## Quick Example

```{r}
data <- data.frame(
  study = c("Smith 2020", "Jones 2021", "Lee 2022", "Chen 2023"),
  hr = c(0.72, 0.85, 0.91, 0.68),
  lower = c(0.55, 0.70, 0.75, 0.52),
  upper = c(0.95, 1.03, 1.10, 0.89)
)

forest_plot(data,
  point = "hr",
  lower = "lower",
  upper = "upper",
  label = "study",
  null_value = 1,
  scale = "log"
)
```

## Usage

```r
forest_plot(
  x,
  point = NULL,
  lower = NULL,
  upper = NULL,
  effects = NULL,
  label = NULL,
  group = NULL,
  columns = NULL,
  scale = NULL,
  null_value = NULL,
  axis_label = NULL,
  theme = NULL,
  ...,
  split_by = NULL,
  shared_axis = FALSE,
  width = NULL,
  height = NULL,
  elementId = NULL
)
```

---

## Arguments

### Core Arguments

| Argument | Description |
|----------|-------------|
| `x` | A data frame (or `WebSpec` object) |
| `point` | Column name for point estimates |
| `lower` | Column name for lower confidence bounds |
| `upper` | Column name for upper confidence bounds |
| `label` | Column name for row labels |

::: {.callout-important}
## The Three Forest Mappings

When using `forest_plot()`, you must provide `point`, `lower`, and `upper`. These define what values to plot in the automatically-created forest column.

```r
forest_plot(data, point = "hr", lower = "ci_low", upper = "ci_high")
```

If you don't need a forest column, use `tabviz()` directly with your desired columns.
:::

### Scale and Reference

| Argument | Description |
|----------|-------------|
| `scale` | `"linear"` or `"log"` |
| `null_value` | Reference line value (e.g., 1 for ratios, 0 for differences) |
| `axis_label` | X-axis label text |

::: {.callout-tip}
## Scale Selection

- **Log scale** (`scale = "log"`, `null_value = 1`): For ratios (OR, HR, RR)
- **Linear scale** (`scale = "linear"`, `null_value = 0`): For differences (MD, RD, SMD)
:::

### Additional Columns

| Argument | Description |
|----------|-------------|
| `columns` | List of additional column specifications using `col_*()` functions |

```{r}
#| eval: false
forest_plot(data, point = "hr", lower = "lo", upper = "hi", label = "study",
  columns = list(
    col_n("n"),
    col_events("events", "n"),
    col_interval(point = "hr", lower = "lo", upper = "hi", header = "HR (95% CI)"),
    col_pvalue("pval")
  ),
  scale = "log", null_value = 1
)
```

Note: The forest column is created automatically. The `columns` argument adds *additional* columns alongside it.

### Grouping

| Argument | Description |
|----------|-------------|
| `group` | Column name(s) for grouping rows into collapsible sections |

```r
# Single-level grouping
forest_plot(data, ..., group = "category")

# Hierarchical grouping
forest_plot(data, ..., group = c("region", "country"))
```

### Multi-Effect Plots

| Argument | Description |
|----------|-------------|
| `effects` | List of `web_effect()` objects for multiple intervals per row |

```{r}
#| eval: false
forest_plot(data, label = "study",
  effects = list(
    web_effect("itt_hr", "itt_lo", "itt_hi", label = "ITT", color = "#2563eb"),
    web_effect("pp_hr", "pp_lo", "pp_hi", label = "Per-Protocol", color = "#16a34a")
  ),
  scale = "log", null_value = 1
)
```

When `effects` is provided, `point`, `lower`, and `upper` are ignored.

### Split Plots

| Argument | Description |
|----------|-------------|
| `split_by` | Column name(s) to split data into separate plots with sidebar navigation |
| `shared_axis` | `TRUE` to use same axis range across all split plots |

```{r}
#| eval: false
forest_plot(data,
  point = "hr", lower = "lower", upper = "upper", label = "study",
  split_by = "region",
  shared_axis = TRUE,
  scale = "log", null_value = 1
)
```

### All Other Arguments

`forest_plot()` passes all additional arguments (`...`) to `tabviz()`. See [`tabviz()`](tabviz.qmd) for the complete list including:

- Row styling: `row_bold`, `row_italic`, `row_color`, `row_type`, etc.
- Marker styling: `marker_color`, `marker_shape`, `marker_opacity`, etc.
- Display options: `title`, `subtitle`, `caption`, `footnote`
- Rendering: `axis_range`, `axis_ticks`, `zoom`, `auto_fit`, etc.
- Theme & interaction settings

---

## Row Styling

Style rows based on column values. Each argument accepts **column names** or **formula expressions**:

```{r}
#| eval: false
forest_plot(data, ...,
  row_bold = ~ pval < 0.05,
  row_color = ~ ifelse(hr < 1, "#16a34a", "#dc2626")
)
```

See [`tabviz()` Row Styling](tabviz.qmd#row-styling-arguments) for all options.

---

## Marker Styling

Control interval marker appearance:

```{r}
direction_data <- data.frame(
  study = c("Trial A", "Trial B", "Trial C", "Trial D"),
  hr = c(0.72, 0.95, 0.68, 1.15),
  lower = c(0.55, 0.78, 0.52, 0.90),
  upper = c(0.94, 1.15, 0.89, 1.47)
) |>
  mutate(
    marker_color = case_when(
      upper < 1 ~ "#16a34a",
      lower > 1 ~ "#dc2626",
      TRUE ~ "#64748b"
    )
  )

forest_plot(direction_data,
  point = "hr", lower = "lower", upper = "upper", label = "study",
  marker_color = "marker_color",
  null_value = 1, scale = "log"
)
```

---

## Themes

```{r}
#| layout-ncol: 2
#| fig-height: 3
small_data <- data.frame(
  study = c("Trial A", "Trial B", "Trial C"),
  hr = c(0.72, 0.85, 0.68),
  lower = c(0.55, 0.70, 0.52),
  upper = c(0.95, 1.03, 0.89)
)

forest_plot(small_data,
  point = "hr", lower = "lower", upper = "upper", label = "study",
  null_value = 1, scale = "log",
  theme = web_theme_jama(), title = "JAMA"
)

forest_plot(small_data,
  point = "hr", lower = "lower", upper = "upper", label = "study",
  null_value = 1, scale = "log",
  theme = web_theme_lancet(), title = "Lancet"
)
```

See [Themes Reference](themes.qmd) for customization options.

---

## Return Value

Returns an `htmlwidget` object that:

- Renders in RStudio Viewer, R Markdown, Quarto, and Shiny
- Can be saved with `save_plot()` to SVG, PNG, or PDF
- Can be piped to `set_*()` functions for additional styling

---

## See Also

- [`tabviz()`](tabviz.qmd) - Main entry point with full control
- [Columns](columns.qmd) - All `col_*()` column types
- [Styling Functions](styling.qmd) - Fluent API styling
- [Themes](themes.qmd) - Theme presets and customization
- [Export](export.qmd) - Saving to files
