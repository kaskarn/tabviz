---
title: "Examples Gallery"
---

Interactive examples showcasing webforest features. Click group headers to collapse, hover for tooltips, and drag resize handles to adjust column widths.

```{r}
#| include: false
library(webforest)
library(dplyr)
```

## Dark Theme

Dark mode with row badges and quality indicators. Ideal for presentations or dark-themed dashboards.

```{r}
oncology_data <- tibble(
  study = c(
    "CheckMate 067", "KEYNOTE-006", "CheckMate 238",
    "KEYNOTE-054", "CheckMate 915", "KEYNOTE-716",
    "IMpassion130", "KEYNOTE-522", "CheckMate 816"
  ),
  tumor = c(
    rep("Melanoma", 6),
    rep("Triple-Negative Breast", 2),
    "NSCLC"
  ),
  hr = c(0.55, 0.63, 0.65, 0.57, 0.77, 0.65, 0.84, 0.63, 0.63),
  lower = c(0.45, 0.52, 0.51, 0.43, 0.63, 0.52, 0.69, 0.48, 0.43),
  upper = c(0.67, 0.76, 0.83, 0.74, 0.94, 0.81, 1.02, 0.82, 0.91),
  n = c(945, 834, 906, 1019, 1034, 976, 902, 1174, 358),
  median_fu = c(60.0, 57.7, 51.1, 42.3, 32.1, 27.4, 18.0, 39.1, 29.5),
  quality = c("High", "High", "High", "High", "Moderate", "High", "High", "High", "High"),
  pvalue = c(0.001, 0.001, 0.001, 0.001, 0.034, 0.001, 0.057, 0.001, 0.005),
  .row_bold = c(TRUE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE),
  .row_badge = c("Primary", NA, NA, NA, NA, NA, NA, NA, NA)
)

forest_plot(
  oncology_data,
  point = "hr", lower = "lower", upper = "upper",
  label = "study", label_header = "Trial", group = "tumor",
  columns = list(
    col_numeric("n", "N", position = "left"),
    col_numeric("median_fu", "Follow-up (mo)", position = "left"),
    col_text("quality", "Quality", position = "left"),
    col_interval("HR (95% CI)"),
    col_pvalue("pvalue", "P")
  ),
  theme = web_theme_dark(),
  scale = "log", null_value = 1,
  axis_label = "Hazard Ratio (95% CI)",
  title = "Immune Checkpoint Inhibitor Trials",
  subtitle = "Overall Survival or Disease-Free Survival",
  caption = "Sources: Published trial results",
  footnote = "HR < 1 favors immunotherapy"
)
```

## Nested Groups

Multi-level hierarchy with continent > country structure. Rows are indented and shaded by nesting depth.

```{r}
set.seed(789)
regional_data <- tibble(
  study = c(
    "USA - Northeast", "USA - Southeast", "USA - Midwest", "USA - West",
    "Canada - Ontario", "Canada - Quebec",
    "UK - England", "UK - Scotland",
    "Germany - North", "Germany - South",
    "France - Paris", "France - Lyon",
    "Japan - Tokyo", "Japan - Osaka",
    "China - Beijing", "China - Shanghai"
  ),
  region = c(rep("north_america", 6), rep("europe", 6), rep("asia", 4)),
  country = c(
    rep("usa", 4), rep("canada", 2),
    rep("uk", 2), rep("germany", 2), rep("france", 2),
    rep("japan", 2), rep("china", 2)
  ),
  or = runif(16, 0.6, 1.4),
  n = sample(500:2000, 16)
) |>
  mutate(
    se = 0.1 + runif(n()) * 0.15,
    lower = or * exp(-1.96 * se),
    upper = or * exp(1.96 * se)
  )

forest_plot(
  regional_data,
  point = "or", lower = "lower", upper = "upper",
  label = "study", group = "country",
  columns = list(
    col_numeric("n", "N", position = "left"),
    col_interval("OR (95% CI)", position = "right")
  ),
  theme = web_theme_modern(),
  scale = "log", null_value = 1,
  axis_label = "Odds Ratio (95% CI)",
  title = "Global Treatment Effect by Region",
  subtitle = "Hierarchical geographic analysis",
  caption = "Rows indented and shaded by nesting depth"
)
```

## Multiple Effects

Three color-coded effects per row showing ITT, Per-Protocol, and As-Treated analyses.

```{r}
set.seed(654)
multi_effect_data <- tibble(
  study = c("ARISTOTLE 2011", "RE-LY 2009", "ROCKET-AF 2011", "ENGAGE AF 2013", "ATLAS ACS 2012"),
  itt_or = c(0.79, 0.91, 0.88, 0.87, 0.84),
  itt_lower = c(0.66, 0.74, 0.75, 0.73, 0.72),
  itt_upper = c(0.95, 1.11, 1.03, 1.04, 0.97),
  pp_or = c(0.75, 0.85, 0.82, 0.81, 0.78),
  pp_lower = c(0.62, 0.68, 0.69, 0.67, 0.66),
  pp_upper = c(0.91, 1.06, 0.98, 0.98, 0.92),
  at_or = c(0.72, 0.88, 0.85, 0.84, 0.80),
  at_lower = c(0.59, 0.71, 0.71, 0.69, 0.67),
  at_upper = c(0.88, 1.09, 1.02, 1.02, 0.95),
  n_itt = c(18201, 18113, 14264, 21105, 15526),
  n_pp = c(16850, 16920, 13280, 19650, 14420)
)

forest_plot(
  multi_effect_data,
  point = "itt_or", lower = "itt_lower", upper = "itt_upper",
  label = "study",
  columns = list(
    col_numeric("n_itt", "N (ITT)", position = "left"),
    col_numeric("n_pp", "N (PP)", position = "left"),
    col_interval("ITT OR", position = "right")
  ),
  effects = list(
    web_effect("itt_or", "itt_lower", "itt_upper", label = "Intention-to-Treat", color = "#2563eb"),
    web_effect("pp_or", "pp_lower", "pp_upper", label = "Per-Protocol", color = "#16a34a"),
    web_effect("at_or", "at_lower", "at_upper", label = "As-Treated", color = "#dc2626")
  ),
  theme = web_theme_modern(),
  scale = "log", null_value = 1,
  axis_label = "Odds Ratio (95% CI)",
  title = "Sensitivity Analyses: DOAC Trials",
  subtitle = "Comparing ITT, Per-Protocol, and As-Treated populations",
  caption = "Three analysis methods shown per study",
  footnote = "Blue = ITT, Green = Per-Protocol, Red = As-Treated"
)
```

## Interactive Demo

Clinical trial meta-analysis with interactive features. Click group headers to collapse, click rows to select, hover for tooltips.

```{r}
meta_data <- tibble(
  study = c(
    "EMPA-REG OUTCOME", "CANVAS Program", "DECLARE-TIMI 58", "CREDENCE",
    "LEADER", "SUSTAIN-6", "REWIND", "PIONEER 6",
    "SAVOR-TIMI 53", "EXAMINE", "TECOS", "CARMELINA"
  ),
  drug_class = c(
    rep("SGLT2 Inhibitors", 4),
    rep("GLP-1 Receptor Agonists", 4),
    rep("DPP-4 Inhibitors", 4)
  ),
  hr = c(0.86, 0.86, 0.93, 0.80, 0.87, 0.74, 0.88, 0.79, 1.00, 0.96, 0.98, 1.02),
  lower = c(0.74, 0.75, 0.84, 0.67, 0.78, 0.58, 0.79, 0.57, 0.89, 0.80, 0.89, 0.89),
  upper = c(0.99, 0.97, 1.03, 0.95, 0.97, 0.95, 0.99, 1.11, 1.12, 1.15, 1.08, 1.17),
  n = c(7020, 10142, 17160, 4401, 9340, 3297, 9901, 3183, 16492, 5380, 14671, 6979),
  events = c(490, 585, 756, 245, 608, 108, 594, 137, 1222, 305, 839, 434),
  year = c(2015, 2017, 2019, 2019, 2016, 2016, 2019, 2019, 2013, 2013, 2015, 2018)
)

forest_plot(
  meta_data,
  point = "hr", lower = "lower", upper = "upper",
  label = "study", label_header = "Trial", group = "drug_class",
  columns = list(
    col_numeric("year", "Year", position = "left"),
    col_numeric("n", "N", position = "left"),
    col_numeric("events", "Events", position = "left"),
    col_interval("HR (95% CI)"),
    col_bar("n", "Sample Size", position = "right")
  ),
  theme = web_theme_modern(),
  scale = "log", null_value = 1,
  axis_label = "Hazard Ratio for MACE (95% CI)",
  title = "Cardiovascular Outcomes Trials: Diabetes Medications",
  subtitle = "Major Adverse Cardiovascular Events (MACE)",
  caption = "Click group headers to collapse. Click rows to select. Hover for details.",
  footnote = "HR < 1 favors treatment"
)
```

## Column Groups

Hierarchical column headers grouping related statistics (primary endpoint + components).

```{r}
set.seed(321)
outcomes_data <- tibble(
  study = c("PARADIGM-HF 2014", "DAPA-HF 2019", "EMPEROR-Reduced 2020", "GALACTIC-HF 2020", "VICTORIA 2020"),
  primary_hr = c(0.80, 0.74, 0.75, 0.92, 0.90),
  primary_lower = c(0.73, 0.65, 0.65, 0.86, 0.82),
  primary_upper = c(0.87, 0.85, 0.86, 0.99, 0.98),
  primary_p = c(0.001, 0.001, 0.001, 0.025, 0.019),
  cvdeath_hr = c(0.80, 0.82, 0.92, 0.96, 0.93),
  cvdeath_lower = c(0.71, 0.69, 0.75, 0.85, 0.81),
  cvdeath_upper = c(0.89, 0.98, 1.12, 1.08, 1.06),
  cvdeath_p = c(0.001, 0.029, 0.382, 0.494, 0.281),
  hfhosp_hr = c(0.79, 0.70, 0.69, 0.92, 0.90),
  hfhosp_lower = c(0.71, 0.59, 0.59, 0.84, 0.81),
  hfhosp_upper = c(0.89, 0.83, 0.81, 1.01, 1.00),
  hfhosp_p = c(0.001, 0.001, 0.001, 0.070, 0.048),
  n = c(8442, 4744, 3730, 8256, 5050)
)

forest_plot(
  outcomes_data,
  point = "primary_hr", lower = "primary_lower", upper = "primary_upper",
  label = "study",
  columns = list(
    col_numeric("n", "N", position = "left"),
    col_group("Primary Endpoint",
      col_interval("HR (95% CI)"),
      col_pvalue("primary_p", "P"),
      position = "right"
    ),
    col_group("CV Death",
      col_numeric("cvdeath_hr", "HR"),
      col_pvalue("cvdeath_p", "P"),
      position = "right"
    ),
    col_group("HF Hosp",
      col_numeric("hfhosp_hr", "HR"),
      col_pvalue("hfhosp_p", "P"),
      position = "right"
    )
  ),
  theme = web_theme_modern(),
  scale = "log", null_value = 1,
  axis_label = "Hazard Ratio (95% CI)",
  title = "Heart Failure Trials: Primary and Component Endpoints",
  subtitle = "Comparing ARNI, SGLT2i, and novel agents",
  caption = "Primary endpoint: CV death or HF hospitalization",
  footnote = "All trials enrolled patients with reduced ejection fraction"
)
```

## JAMA Style

Clean, minimal journal styling for publication-ready figures.

```{r}
intervention_data <- tibble(
  subgroup = c(
    "All Patients", "Age <65 years", "Age >=65 years",
    "Male", "Female", "BMI <30", "BMI >=30",
    "Diabetes", "No Diabetes", "Prior MI", "No Prior MI"
  ),
  rr = c(0.82, 0.78, 0.88, 0.80, 0.85, 0.84, 0.79, 0.76, 0.86, 0.74, 0.89),
  lower = c(0.74, 0.66, 0.76, 0.70, 0.72, 0.72, 0.66, 0.62, 0.76, 0.60, 0.78),
  upper = c(0.91, 0.92, 1.02, 0.91, 1.00, 0.98, 0.95, 0.93, 0.97, 0.91, 1.02),
  n_int = c(5000, 2400, 2600, 3200, 1800, 2800, 2200, 1500, 3500, 1200, 3800),
  n_ctrl = c(5000, 2380, 2620, 3180, 1820, 2750, 2250, 1480, 3520, 1190, 3810),
  p_int = c(0.001, 0.005, 0.089, 0.001, 0.048, 0.025, 0.012, 0.008, 0.003, 0.004, 0.098),
  .row_type = c("summary", rep("data", 10)),
  .row_bold = c(TRUE, rep(FALSE, 10))
)

forest_plot(
  intervention_data,
  point = "rr", lower = "lower", upper = "upper",
  label = "subgroup", label_header = "Subgroup",
  columns = list(
    col_numeric("n_int", "Intervention (n)", position = "left"),
    col_numeric("n_ctrl", "Control (n)", position = "left"),
    col_interval("RR (95% CI)"),
    col_pvalue("p_int", "P Value")
  ),
  theme = web_theme_jama(),
  scale = "log", null_value = 1,
  axis_label = "Relative Risk (95% CI)",
  title = "Primary Outcome by Prespecified Subgroups",
  subtitle = "Composite of Death, MI, or Stroke at 1 Year",
  footnote = "RR indicates relative risk; CI, confidence interval"
)
```

## Lancet Style

Serif fonts and blue palette for academic publications.

```{r}
set.seed(456)
survival_data <- tibble(
  subgroup = c(
    "Overall", "Age < 65", "Age >= 65",
    "Male", "Female", "Stage I-II", "Stage III-IV",
    "ECOG 0-1", "ECOG 2+"
  ),
  hr = c(0.73, 0.68, 0.81, 0.75, 0.70, 0.65, 0.82, 0.71, 0.88),
  lower = c(0.62, 0.52, 0.65, 0.60, 0.54, 0.48, 0.66, 0.56, 0.68),
  upper = c(0.86, 0.89, 1.01, 0.94, 0.91, 0.88, 1.02, 0.90, 1.14),
  n_treatment = c(450, 220, 230, 280, 170, 180, 270, 320, 130),
  n_control = c(448, 218, 230, 275, 173, 182, 266, 318, 130),
  events_treatment = c(156, 68, 88, 95, 61, 52, 104, 98, 58),
  events_control = c(198, 92, 106, 118, 80, 72, 126, 128, 70)
) |>
  mutate(
    events = paste0(events_treatment, "/", events_control),
    n_total = paste0(n_treatment, "/", n_control)
  )

forest_plot(
  survival_data,
  point = "hr", lower = "lower", upper = "upper",
  label = "subgroup",
  columns = list(
    col_text("n_total", "N (Tx/Ctrl)", position = "left"),
    col_text("events", "Events", position = "left"),
    col_interval("HR (95% CI)", position = "right")
  ),
  theme = web_theme_lancet(),
  scale = "log", null_value = 1,
  axis_label = "Hazard Ratio (95% CI)",
  title = "Subgroup Analysis: Overall Survival",
  subtitle = "Treatment vs Control in Phase III Trial",
  caption = "HR < 1 favors treatment arm",
  footnote = "Stratified Cox proportional hazards model"
)
```

## Row Styling

Headers, summaries, badges, indentation, and custom colors using `.row_*` columns.

```{r}
styled_data <- tibble(
  study = c(
    "Cardiovascular Outcomes",
    "  EMPA-REG 2015", "  CANVAS 2017", "  DECLARE 2019", "  Subtotal", "",
    "Renal Outcomes",
    "  CREDENCE 2019", "  DAPA-CKD 2020", "  Subtotal", "",
    "Overall"
  ),
  hr = c(NA, 0.86, 0.86, 0.93, 0.88, NA, NA, 0.70, 0.61, 0.66, NA, 0.78),
  lower = c(NA, 0.74, 0.75, 0.84, 0.82, NA, NA, 0.59, 0.51, 0.57, NA, 0.73),
  upper = c(NA, 0.99, 0.97, 1.03, 0.95, NA, NA, 0.82, 0.72, 0.76, NA, 0.84),
  n = c(NA, 7020, 10142, 17160, 34322, NA, NA, 4401, 4304, 8705, NA, 43027),
  .row_type = c(
    "header", "data", "data", "data", "summary", "spacer",
    "header", "data", "data", "summary", "spacer", "summary"
  ),
  .row_bold = c(TRUE, FALSE, FALSE, FALSE, TRUE, FALSE, TRUE, FALSE, FALSE, TRUE, FALSE, TRUE),
  .row_indent = c(0, 1, 1, 1, 1, 0, 0, 1, 1, 1, 0, 0),
  .row_color = c("#0369a1", NA, NA, NA, "#0369a1", NA, "#0369a1", NA, NA, "#0369a1", NA, "#166534"),
  .row_badge = c(NA, NA, NA, NA, "n=3", NA, NA, NA, NA, "n=2", NA, "n=5")
)

forest_plot(
  styled_data,
  point = "hr", lower = "lower", upper = "upper",
  label = "study",
  columns = list(
    col_numeric("n", "N", position = "right"),
    col_interval("HR (95% CI)", position = "right")
  ),
  theme = web_theme_modern(),
  scale = "log", null_value = 1,
  axis_label = "Hazard Ratio (95% CI)",
  title = "SGLT2 Inhibitors Meta-Analysis",
  subtitle = "Cardiovascular and renal outcomes",
  caption = "Data from landmark SGLT2 inhibitor trials",
  footnote = "Headers in blue, overall summary in green"
)
```

## Presentation Theme

Large fonts and bold colors for slides and presentations.

```{r}
set.seed(123)
trial_data <- tibble(
  study = c("APOLLO 2020", "BEACON 2019", "CASCADE 2021", "DELTA 2018", "ECHO 2022", "FRONTIER 2021"),
  or = c(0.72, 0.85, 0.65, 0.91, 0.78, 0.69),
  lower = c(0.58, 0.71, 0.48, 0.75, 0.62, 0.52),
  upper = c(0.89, 1.02, 0.88, 1.10, 0.98, 0.92),
  n = c(1250, 890, 2100, 650, 1500, 1800),
  events = c(89, 112, 156, 78, 95, 142),
  pvalue = c(0.002, 0.078, 0.005, 0.32, 0.031, 0.011)
)

forest_plot(
  trial_data,
  point = "or", lower = "lower", upper = "upper",
  label = "study",
  columns = list(
    col_numeric("n", "N", position = "left"),
    col_numeric("events", "Events", position = "left"),
    col_interval("OR (95% CI)", position = "right"),
    col_pvalue("pvalue", "P", position = "right")
  ),
  theme = web_theme_presentation(),
  scale = "log", null_value = 1,
  axis_label = "Odds Ratio (95% CI)",
  title = "Treatment Effect Across Trials",
  subtitle = "Pooled analysis of randomized controlled trials",
  caption = "OR < 1 favors treatment",
  footnote = "Random effects meta-analysis"
)
```

## Iris Regression

Non-clinical example: regression coefficients from linear models, grouped by species.

```{r}
library(broom)

coef_data <- iris |>
  group_by(Species) |>
  group_modify(~ {
    model <- lm(Sepal.Length ~ Sepal.Width + Petal.Length + Petal.Width, data = .x)
    tidy(model, conf.int = TRUE) |>
      filter(term != "(Intercept)")
  }) |>
  ungroup() |>
  mutate(
    term = case_when(
      term == "Sepal.Width" ~ "Sepal Width",
      term == "Petal.Length" ~ "Petal Length",
      term == "Petal.Width" ~ "Petal Width",
      TRUE ~ term
    ),
    pvalue = p.value
  )

forest_plot(
  coef_data,
  point = "estimate", lower = "conf.low", upper = "conf.high",
  label = "term", group = "Species",
  columns = list(
    col_interval("95% CI", position = "right"),
    col_pvalue("pvalue", "P-value", position = "right")
  ),
  theme = web_theme_modern(),
  null_value = 0,
  axis_label = "Regression Coefficient (95% CI)",
  title = "Predictors of Sepal Length",
  subtitle = "Linear regression coefficients by species",
  caption = "Data: Fisher's Iris dataset"
)
```

## mtcars Meta-Analysis

Built-in dataset transformed into a meta-analysis with weight bars and grouping.

```{r}
set.seed(42)
meta_data <- mtcars |>
  tibble::rownames_to_column("study") |>
  mutate(
    effect = scale(mpg)[, 1],
    se = 0.15 + runif(n()) * 0.25,
    lower = effect - 1.96 * se,
    upper = effect + 1.96 * se,
    weight = 1 / se^2,
    pvalue = 2 * pnorm(-abs(effect / se)),
    group = paste0(cyl, " Cylinder")
  ) |>
  select(study, effect, lower, upper, weight, pvalue, group, hp, wt)

forest_plot(
  meta_data,
  point = "effect", lower = "lower", upper = "upper",
  label = "study", group = "group",
  columns = list(
    col_numeric("hp", "HP", position = "left"),
    col_numeric("wt", "Wt", position = "left"),
    col_bar("weight", "Weight", position = "right"),
    col_pvalue("pvalue", "P", position = "right")
  ),
  theme = web_theme_jama(),
  axis_label = "Standardized Effect (95% CI)",
  title = "Meta-analysis of Fuel Efficiency",
  subtitle = "Effect sizes grouped by cylinder count",
  caption = "Source: mtcars dataset (R)",
  footnote = "* Weights computed as inverse variance"
)
```
