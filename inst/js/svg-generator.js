(function(){"use strict";const Yt=[1,5,2,2.5,4,3],at=[.001,.002,.005,.01,.02,.05,.1,.15,.2,.25,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2,1.3,1.4,1.5,1.75,2,2.5,3,4,5,6,7,8,10,12,15,20,25,30,40,50,75,100,150,200,300,500,750,1e3];function bt(t,n){return n?pn(t):gn(t)}function pn(t){if(t[0]<=0||t[1]<=0)return[.1,10];if(t[0]>=t[1])return t;let n=at[0];for(const e of at)if(e<=t[0])n=e;else break;t[0]<at[0]&&(n=Math.pow(10,Math.floor(Math.log10(t[0]))));let o=at[at.length-1];for(let e=at.length-1;e>=0&&at[e]>=t[1];e--)o=at[e];return t[1]>at[at.length-1]&&(o=Math.pow(10,Math.ceil(Math.log10(t[1])))),[n,o]}function gn(t){const n=t[1]-t[0];if(n===0)return t;if(n<0)return[t[1],t[0]];const o=Math.pow(10,Math.floor(Math.log10(n)));let e=o,a=1/0;for(const h of Yt)for(const s of[.1,1,10]){const r=h*o*s;if(r<=0)continue;const l=Math.floor(t[0]/r)*r,c=(Math.ceil(t[1]/r)*r-l)/n-1;c>=0&&c<a&&(a=c,e=r)}const i=Math.floor(t[0]/e)*e,u=Math.ceil(t[1]/e)*e;return[Math.round(i*1e10)/1e10,Math.round(u*1e10)/1e10]}function lt(t,n,o,e,a=!1){if(t&&o in t){const i=t[o];if(typeof i=="number"&&Number.isFinite(i)&&(!a||i>0))return i}return o===e&&n!=null&&Number.isFinite(n)&&(!a||n>0)?n:null}const mn=20;function yn(t){const{rows:n,config:o,scale:e,nullValue:a,forestWidth:i,pointSize:u,effects:h=[],pointCol:s,lowerCol:r,upperCol:l}=t,d=$n(n,o,e,a,h,s,r,l),f=xn(d,o,e,i,u),c=Ot(d,o,e,a);return{axisLimits:d,plotRegion:f,ticks:c}}function $n(t,n,o,e,a=[],i,u,h){const s=n.rangeMin!=null,r=n.rangeMax!=null;if(s&&r)return[n.rangeMin,n.rangeMax];const l=[],d=o==="log",f=i||"point";for(const I of t){const H=lt(I.metadata,void 0,f,"point",d);H!=null&&l.push(H);for(const X of a){const B=lt(I.metadata,void 0,X.pointCol,"point",d);B!=null&&l.push(B)}}if(l.length===0)return o==="log"?[.1,10]:[-1,1];let c=Math.min(...l),$=Math.max(...l);(n.includeNull??!0)&&(c=Math.min(c,e),$=Math.max($,e));const w=c,N=$;let _;if(d){const I=Math.max(c,.001),H=Math.max($,.001);_=Math.log(H)-Math.log(I)}else _=$-c;if(_===0||!Number.isFinite(_)){const I=l[0];if(d)return bt([I/2,I*2],!0);{const H=Math.max(1,Math.abs(I)*.1);return bt([I-H,I+H],!1)}}const[F,A]=bt([c,$],d),G=n.ciClipFactor??2;let y=F,m=A;const p=[],T=[],g=u||"lower",E=h||"upper";for(const I of t){const H=lt(I.metadata,void 0,g,"lower",d);H!=null&&p.push(H);const X=lt(I.metadata,void 0,E,"upper",d);X!=null&&T.push(X);for(const B of a){const j=lt(I.metadata,void 0,B.lowerCol,"lower",d);j!=null&&p.push(j);const U=lt(I.metadata,void 0,B.upperCol,"upper",d);U!=null&&T.push(U)}}let x,D;if(d)x=y/G,D=m*G;else{const I=m-y;x=y-I*G,D=m+I*G}let b=!1,L=!1;for(const I of p)I>=x?y=Math.min(y,I):b=!0;for(const I of T)I<=D?m=Math.max(m,I):L=!0;if(b&&(y=Math.min(y,x)),L&&(m=Math.max(m,D)),n.symmetric===!0&&!s&&!r)if(o==="log"){const I=Math.log(e),H=Math.max(Math.abs(Math.log(Math.max(w,.001))-I),Math.abs(Math.log(N)-I));y=Math.exp(I-H),m=Math.exp(I+H)}else{const I=Math.max(Math.abs(w-e),Math.abs(N-e));y=e-I,m=e+I}let P=s?n.rangeMin:y,R=r?n.rangeMax:m;return bt([P,R],o==="log")}function xn(t,n,o,e,a){if(!(n.markerMargin??!0)||e<=0)return t;const u=e-2*mn;if(u<=0)return t;if(o==="log"){const r=Math.log(Math.max(t[0],.001)),l=Math.log(Math.max(t[1],.001)),d=l-r,f=a/2*(d/u),c=Math.min(f,.5);return[Math.exp(r-c),Math.exp(l+c)]}const h=t[1]-t[0],s=a/2*(h/u);return[t[0]-s,t[1]+s]}function Ot(t,n,o,e){const[a,i]=t,u=e>=a&&e<=i,h=(n.nullTick??!0)&&u;if(n.tickValues&&n.tickValues.length>0){let l=n.tickValues.filter(d=>d>=a&&d<=i);return h&&!l.includes(e)&&(l=[...l,e].sort((d,f)=>d-f)),l}const s=n.tickCount??5;let r=o==="log"?bn(t,s):Mn(t,s);return h&&!r.includes(e)&&(r=[...r,e].sort((l,d)=>l-d)),r}function Mn(t,n){const[o,e]=t,a=e-o;if(a===0)return[o];const i=a/Math.max(n-1,1),u=Math.pow(10,Math.floor(Math.log10(i)));let h=u,s=1/0;for(const d of Yt){const f=d*u,c=Math.floor(a/f)+1,$=Math.abs(c-n);$<s&&(s=$,h=f);const M=d*u/10;if(M>0){const w=Math.floor(a/M)+1,N=Math.abs(w-n);N<s&&(s=N,h=M)}}const r=Math.ceil(o/h)*h,l=[];for(let d=r;d<=e+h*.001;d+=h){const f=Math.round(d*1e10)/1e10;f>=o&&f<=e&&l.push(f)}return l.length<2&&(l.includes(o)||l.unshift(o),l.includes(e)||l.push(e)),l}function bn(t,n){const[o,e]=t,i=[.01,.02,.05,.1,.15,.2,.25,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2,1.3,1.4,1.5,1.75,2,2.5,3,4,5,6,7,8,10,12,15,20,25,30,40,50,75,100,150,200,500,1e3].filter(s=>s>=o&&s<=e);if(i.length<=n)return i;const u=[1,.1,10,100,.5,2,5,.2,.25,1.5,3,4,20,50],h=[];for(const s of u)i.includes(s)&&h.length<n&&h.push(s);if(h.length<n){const s=i.filter(l=>!h.includes(l)),r=Math.max(1,Math.floor(s.length/(n-h.length)));for(let l=0;l<s.length&&h.length<n;l+=r)h.push(s[l])}return h.sort((s,r)=>s-r)}function Tn(t){var e,a;const n=((e=t==null?void 0:t.shapes)==null?void 0:e.lineWidth)??1.5,o=((a=t==null?void 0:t.colors)==null?void 0:a.intervalLine)??"#475569";return{width:Math.max(4,Math.round(n*3)),height:Math.max(6,Math.round(n*4)),color:o,opacity:1}}function Jt(t,n,o,e){const{width:a,height:i}=e,u=i/2;return t==="left"?`M ${n} ${o} L ${n+a} ${o-u} L ${n+a} ${o+u} Z`:`M ${n} ${o} L ${n-a} ${o-u} L ${n-a} ${o+u} Z`}const Lt={RENDERING_BUFFER:4},pt={FONT_SCALE:.8,PADDING:4,GAP:6},K={DEFAULT_COLUMN_WIDTH:100,AXIS_HEIGHT:32,AXIS_LABEL_HEIGHT:20,BOTTOM_MARGIN:16,MIN_FOREST_WIDTH:200,DEFAULT_WIDTH:800,COLUMN_GAP:16},Q={TITLE_HEIGHT:28,SUBTITLE_HEIGHT:20,CAPTION_HEIGHT:16,FOOTNOTE_HEIGHT:14,DEFAULT_FONT_SIZE:14,REM_BASE:16,TEXT_BASELINE_ADJUSTMENT:1/3},v={INDENT_PER_LEVEL:12,TEXT_PADDING:10,DEFAULT_TICK_COUNT:5,AXIS_LABEL_PADDING:30},qt={GROUP_HEADER_HEIGHT_MULTIPLIER:1.3,OVERALL_ROW_HEIGHT_MULTIPLIER:1.5},$t={MIN:60,MAX:600,LABEL_MAX:400,VISUAL_MIN:{sparkline:92,bar:100,stars:84,range:84,badge:74}},Tt={CHEVRON_WIDTH:12,GAP:6,SAFETY_MARGIN:8},Zt={SPACING:6};function En(t,n){return n<=1?0:-((n-1)*Zt.SPACING)/2+t*Zt.SPACING}function Et(t,n){const o=t.split(".");return o[0]=o[0].replace(/\B(?=(\d{3})+(?!\d))/g,n),o.join(".")}function Ht(t){const n=Math.abs(t),o=t<0?"-":"";if(n>=1e12)throw new Error(`Cannot abbreviate value >= 1 trillion: ${t}`);if(n>=1e9){const e=n/1e9;return o+vt(e)+"B"}if(n>=1e6){const e=n/1e6;return o+vt(e)+"M"}if(n>=1e3){const e=n/1e3;return o+vt(e)+"K"}return o+Math.round(n).toString()}function vt(t){const n=Math.round(t*10)/10;return n===Math.floor(n)?n.toFixed(0):n.toFixed(1)}const In={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","-":"⁻","+":"⁺"};function Nn(t){return t.split("").map(n=>In[n]??n).join("")}function It(t,n){var h,s,r,l,d;if(t==null||Number.isNaN(t))return(n==null?void 0:n.naText)??"";if(n!=null&&n.percent){const{decimals:f,digits:c,multiply:$=!0,symbol:M=!0}=n.percent,w=$?t*100:t,N=c!=null?w.toPrecision(c):w.toFixed(f??1);return M?`${N}%`:N}if(((h=n==null?void 0:n.numeric)==null?void 0:h.abbreviate)&&Math.abs(t)>=1e3)return Ht(t);const e=(s=n==null?void 0:n.numeric)==null?void 0:s.digits;if(e!=null){const f=t.toPrecision(e),c=(r=n==null?void 0:n.numeric)==null?void 0:r.thousandsSep;return c&&typeof c=="string"?Et(f,c):f}const a=(l=n==null?void 0:n.numeric)==null?void 0:l.decimals,i=(d=n==null?void 0:n.numeric)==null?void 0:d.thousandsSep;let u;return a!==void 0?u=t.toFixed(a):Number.isInteger(t)||Math.abs(t-Math.round(t))<1e-4?u=Math.round(t).toString():u=t.toFixed(2),i&&typeof i=="string"&&(u=Et(u,i)),u}function Kt(t,n){const{eventsField:o,nField:e,separator:a="/",showPct:i=!1,thousandsSep:u,abbreviate:h}=n.events,s=t.metadata[o],r=t.metadata[e];if(s==null||r===void 0||r===null)return n.naText??"";const l=Number(s),d=Number(r);let f,c;h&&(l>=1e3||d>=1e3)?(f=l>=1e3?Ht(l):String(l),c=d>=1e3?Ht(d):String(d)):(f=String(l),c=String(d),u&&typeof u=="string"&&(f=Et(f,u),c=Et(c,u)));let $=`${f}${a}${c}`;if(i&&d>0){const M=(l/d*100).toFixed(1);$+=` (${M}%)`}return $}function Qt(t,n,o,e){var h,s,r;if(t==null||Number.isNaN(t))return"";const a=((h=e==null?void 0:e.interval)==null?void 0:h.decimals)??2,i=((s=e==null?void 0:e.interval)==null?void 0:s.sep)??" ",u=(r=e==null?void 0:e.interval)==null?void 0:r.impreciseThreshold;return n==null||o===void 0||o===null||Number.isNaN(n)||Number.isNaN(o)?t.toFixed(a):u!=null&&n>0&&o/n>u?"—":`${t.toFixed(a)}${i}(${n.toFixed(a)}, ${o.toFixed(a)})`}function tn(t,n){if(t==null||Number.isNaN(t))return(n==null?void 0:n.naText)??"";const o=n==null?void 0:n.pvalue,e=(o==null?void 0:o.digits)??2,a=(o==null?void 0:o.expThreshold)??.001,i=(o==null?void 0:o.abbrevThreshold)??null,u=(o==null?void 0:o.format)??"auto",h=(o==null?void 0:o.stars)??!1,s=(o==null?void 0:o.thresholds)??[.05,.01,.001];let r="";if(h&&(t<s[2]?r="***":t<s[1]?r="**":t<s[0]&&(r="*")),i!==null&&t<i)return`<${i}${r}`;if(u==="scientific"||u==="auto"&&t<a){const d=Math.floor(Math.log10(t));return`${(t/Math.pow(10,d)).toPrecision(e)}×10${Nn(d.toString())}${r}`}let l;return t>=.1?l=t.toFixed(e):t>=.01?l=t.toFixed(e+1):l=t.toFixed(e+2),`${l}${r}`}function An(t,n){var i,u,h,s;const{type:o,field:e,options:a}=n;switch(o){case"interval":{const r=(i=a==null?void 0:a.interval)!=null&&i.point?t.metadata[a.interval.point]:t.point,l=(u=a==null?void 0:a.interval)!=null&&u.lower?t.metadata[a.interval.lower]:t.lower,d=(h=a==null?void 0:a.interval)!=null&&h.upper?t.metadata[a.interval.upper]:t.upper;return Qt(r,l,d,a)}case"custom":return a!=null&&a.events?Kt(t,a):String(t.metadata[e]??"");case"pvalue":return tn(t.metadata[e],a);case"numeric":return It(t.metadata[e],a);case"percent":return It(t.metadata[e],a);case"sparkline":case"icon":case"stars":case"img":case"range":return"";case"badge":{const r=t.metadata[e];return r==null?"":`  ${String(r)}  `}case"bar":{if(((s=a==null?void 0:a.bar)==null?void 0:s.showLabel)===!1)return"";const r=t.metadata[e];return r==null?"":r>=100?r.toFixed(0):r>=10?r.toFixed(1):r.toFixed(2)}case"text":default:return String(t.metadata[e]??"")}}function q(t,n){const o="⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻";let e=0;for(const a of t)o.includes(a)?e+=n*.3:"il1.,;:|!()[]{}' ".includes(a)?e+=n*.35:"×−".includes(a)?e+=n*.5:"mwMW@%".includes(a)?e+=n*.85:a>="0"&&a<="9"?e+=n*.6:e+=n*.55;return e}function Sn(t,n){var r,l;const o=new Map,e=tt(t.theme.typography.fontSizeBase),a=t.theme.typography.headerFontScale??1.05,i=e*a,u=t.data.rows,h=(t.theme.spacing.cellPaddingX??10)*2,s=(t.theme.spacing.groupPadding??8)*2;for(const d of n){if(d.width!=="auto"&&d.width!==null&&d.width!==void 0)continue;let f=0;d.header&&(f=Math.max(f,q(d.header,i)));for(const M of u){if(((r=M.style)==null?void 0:r.type)==="header"||((l=M.style)==null?void 0:l.type)==="spacer")continue;const w=An(M,d);w&&(f=Math.max(f,q(w,e)))}const c=$t.VISUAL_MIN[d.type]??$t.MIN,$=Math.ceil(f+h+Lt.RENDERING_BUFFER);o.set(d.id,Math.min($t.MAX,Math.max(c,$)))}return _n(t.columns,o,i,s,Lt.RENDERING_BUFFER),o}function _n(t,n,o,e,a){function i(s){return s.isGroup?s.columns.flatMap(i):[s]}function u(s){const r=n.get(s.id);return r!==void 0?r:typeof s.width=="number"?s.width:$t.MIN}function h(s){if(s.isGroup){for(const r of s.columns)h(r);if(s.header){const r=q(s.header,o)+e+a,l=i(s),d=l.reduce((f,c)=>f+u(c),0);if(r>d&&l.length>0){const f=Math.ceil((r-d)/l.length);for(const c of l)n.set(c.id,u(c)+f)}}}}for(const s of t)h(s)}function nn(t,n,o){let e=o.filter(i=>i.groupId===t).length;const a=n.filter(i=>i.parentId===t);for(const i of a)e+=nn(i.id,n,o);return e}function en(t){var s,r;const n=tt(t.theme.typography.fontSizeBase),o=(t.theme.spacing.cellPaddingX??10)*2;let e=0;const a=new Map,i=Array.isArray(t.data.groups)?t.data.groups:[];for(const l of i)a.set(l.id,l.depth);const u=l=>l?(a.get(l)??0)+1:0;t.data.labelHeader&&(e=Math.max(e,q(t.data.labelHeader,n)));for(const l of t.data.rows)if(l.label){const d=u(l.groupId),f=((s=l.style)==null?void 0:s.indent)??0,$=(d+f)*v.INDENT_PER_LEVEL;let M=q(l.label,n)+$;if((r=l.style)!=null&&r.badge){const w=String(l.style.badge),N=n*pt.FONT_SCALE,F=q(w,N)+pt.PADDING*2;M+=pt.GAP+F}e=Math.max(e,M)}for(const l of i)if(l.label){const d=l.depth*v.INDENT_PER_LEVEL,f=q(l.label,n),$=`(${nn(l.id,i,t.data.rows)})`,M=n*.75,w=q($,M),N=d+Tt.CHEVRON_WIDTH+Tt.GAP+f+Tt.GAP+w+Tt.SAFETY_MARGIN;e=Math.max(e,N)}const h=Math.ceil(e+o+Lt.RENDERING_BUFFER);return Math.min($t.LABEL_MAX,Math.max($t.MIN,h))}function Wt(t,n){const o=n.get(t.id);return o!==void 0?o:typeof t.width=="number"?t.width:K.DEFAULT_COLUMN_WIDTH}function wn(t,n,o=0){var nt,ot,rt,ct,ut;const e=t.theme,a=e.spacing.rowHeight,i=e.spacing.padding,u=Array.isArray(t.columns)?t.columns:[],h=rn(u,"left"),s=rn(u,"right"),l=Xt(h)||Xt(s)?e.spacing.headerHeight*qt.GROUP_HEADER_HEIGHT_MULTIPLIER:e.spacing.headerHeight,d=!!((nt=t.labels)!=null&&nt.title),f=!!((ot=t.labels)!=null&&ot.subtitle),c=!!((rt=t.labels)!=null&&rt.caption),$=!!((ct=t.labels)!=null&&ct.footnote),M=d?Q.TITLE_HEIGHT:0,w=f?Q.SUBTITLE_HEIGHT:0,N=M+w+(d||f?i:0),_=c?Q.CAPTION_HEIGHT:0,F=$?Q.FOOTNOTE_HEIGHT:0,A=_+F+(c||$?i:0),G=on(t),y=!!t.data.overall;let m=0;for(const S of G){const V=S.type==="data"&&((ut=S.row.style)==null?void 0:ut.type)==="spacer";m+=V?a/2:a}y&&(m+=a*qt.OVERALL_ROW_HEIGHT_MULTIPLIER);const p=Rt(u,"left"),T=Rt(u,"right"),g=Pt(u).filter(S=>S.position===void 0),E=[...p,...T,...g];let x,D;if(n.columnWidths){x=new Map;for(const[S,V]of Object.entries(n.columnWidths))S!=="__label__"&&x.set(S,V);D=n.columnWidths.__label__??en(t)}else x=Sn(t,E),D=en(t);const b=D+p.reduce((S,V)=>S+Wt(V,x),0),L=T.reduce((S,V)=>S+Wt(V,x),0),k=g.filter(S=>S.type!=="forest").reduce((S,V)=>S+Wt(V,x),0),P=n.width??K.DEFAULT_WIDTH,I=E.some(S=>S.type==="forest")||t.data.includeForest,H=b+L+k;let X;if(!I)X=0;else if(typeof n.forestWidth=="number")X=n.forestWidth;else if(typeof t.layout.plotWidth=="number")X=t.layout.plotWidth;else{const S=P-H-K.COLUMN_GAP*2-i*2;X=Math.max(S,K.MIN_FOREST_WIDTH)}const B=i*2+H+X+K.COLUMN_GAP*2,j=Math.max(n.width??P,B),U=N+i+l+m+K.AXIS_HEIGHT+K.AXIS_LABEL_HEIGHT+A+K.BOTTOM_MARGIN;return{totalWidth:j,totalHeight:n.height??U,tableWidth:b+L,forestWidth:X,headerHeight:l,rowHeight:a,plotHeight:m,axisHeight:K.AXIS_HEIGHT,nullValue:o,summaryYPosition:m-a,showOverallSummary:y,headerTextHeight:N,footerTextHeight:A,titleY:i+Q.TITLE_HEIGHT-8,subtitleY:i+M+Q.SUBTITLE_HEIGHT-4,mainY:N+i,footerY:N+i+l+m+K.AXIS_HEIGHT+K.AXIS_LABEL_HEIGHT+i,autoWidths:x,labelWidth:D}}function on(t){var d;const n=t.data.rows,o=Array.isArray(t.data.groups)?t.data.groups:[];if(o.length===0)return n.map(f=>({type:"data",row:f,depth:0}));const e=new Map;for(const f of o)e.set(f.id,f);const a=new Map;for(const f of n){const c=f.groupId??null;a.has(c)||a.set(c,[]),a.get(c).push(f)}const i=new Set;for(const f of a.keys()){if(!f)continue;let c=f;for(;c;)i.add(c),c=(d=e.get(c))==null?void 0:d.parentId}function u(f){return o.filter(c=>(c.parentId??null)===f&&i.has(c.id))}function h(f){if(!f)return 0;const c=e.get(f);return c?c.depth+1:0}function s(f){var $;let c=(($=a.get(f))==null?void 0:$.length)??0;for(const M of u(f))c+=s(M.id);return c}const r=[];function l(f){if(f){const $=e.get(f);if(!$)return;const M=s(f);r.push({type:"group_header",groupId:$.id,label:$.label,depth:$.depth,rowCount:M})}for(const $ of u(f))l($.id);const c=a.get(f)??[];for(const $ of c)r.push({type:"data",row:$,depth:h($.groupId)})}return l(null),r}function kt(t){const n=[];for(const o of t)o.isGroup?n.push(...kt(o.columns)):n.push(o);return n}function Pt(t){const n=[];for(const o of t)o.isGroup?n.push(...kt(o.columns)):n.push(o);return n}function Rt(t,n){if(n===void 0)return Pt(t);const o=[];for(const e of t)e.position===n&&(e.isGroup?o.push(...kt(e.columns)):o.push(e));return o}function rn(t,n){return t.filter(o=>o.position===n)}function Xt(t){return t.some(n=>n.isGroup)}function tt(t){return t.endsWith("rem")?parseFloat(t)*Q.REM_BASE:t.endsWith("px")?parseFloat(t):Q.DEFAULT_FONT_SIZE}function Nt(t,n,o){return o==="right"?{textX:t+n-v.TEXT_PADDING,anchor:"end"}:o==="center"?{textX:t+n/2,anchor:"middle"}:{textX:t+v.TEXT_PADDING,anchor:"start"}}function Y(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function Bt(t,n,o,e=0){const a=n-e*2;if(q(t,o)<=a)return t;const u="…",h=o*.55;let s=0,r=t.length;for(;s<r;){const l=Math.ceil((s+r)/2),d=t.slice(0,l);q(d,o)+h<=a?s=l:r=l-1}return s===0?u:t.slice(0,s)+u}function Dn(t){return Math.abs(t)<.01?"0":Math.abs(t)>=100?t.toFixed(0):Math.abs(t)>=10?t.toFixed(1):t.toFixed(2)}function an(t,n){const[o,e]=t,[a,i]=n,u=(i-a)/(e-o),h=s=>a+(s-o)*u;return h.domain=()=>t,h.range=()=>n,h.ticks=s=>{const r=(e-o)/(s-1),l=[];for(let d=0;d<s;d++)l.push(o+r*d);return l},h}function sn(t,n){const[o,e]=t.map(l=>Math.max(l,.001)),[a,i]=n,u=Math.log10(o),h=Math.log10(e),s=(i-a)/(h-u),r=l=>{const d=Math.log10(Math.max(l,.001));return a+(d-u)*s};return r.domain=()=>[o,e],r.range=()=>n,r.ticks=l=>{const d=[],f=Math.floor(Math.log10(o)),c=Math.ceil(Math.log10(e));for(let $=f;$<=c;$++){const M=Math.pow(10,$);for(const w of[1,2,5]){const N=M*w;N>=o&&N<=e&&d.push(N)}}return d.length>0?d:[o,e]},r}function Cn(t,n,o,e){const a=o.scale==="log",i=v.AXIS_LABEL_PADDING,u=i,h=Math.max(n-i,u+50);if(e!=null&&e.xDomain){const f=e.xDomain,c=e.clipBounds??f,$=Ot(c,t.theme.axis,o.scale,o.nullValue);return a?{scale:sn([Math.max(f[0],.01),Math.max(f[1],.02)],[u,h]),clipBounds:c,ticks:$}:{scale:an(f,[u,h]),clipBounds:c,ticks:$}}const s=yn({rows:t.data.rows,config:t.theme.axis,scale:o.scale,nullValue:o.nullValue,forestWidth:n,pointSize:t.theme.shapes.pointSize,effects:o.effects,pointCol:o.pointCol,lowerCol:o.lowerCol,upperCol:o.upperCol}),{plotRegion:r,axisLimits:l,ticks:d}=s;return a?{scale:sn([Math.max(r[0],.01),Math.max(r[1],.02)],[u,h]),clipBounds:l,ticks:d}:{scale:an(r,[u,h]),clipBounds:l,ticks:d}}function Fn(t,n,o){var i,u;const e=[],a=o.spacing.padding;if((i=t.labels)!=null&&i.title){const h=tt(o.typography.fontSizeLg);e.push(`<text x="${a}" y="${n.titleY}"
      font-family="${o.typography.fontFamily}"
      font-size="${h}px"
      font-weight="${o.typography.fontWeightBold}"
      fill="${o.colors.foreground}">${Y(t.labels.title)}</text>`)}if((u=t.labels)!=null&&u.subtitle){const h=tt(o.typography.fontSizeBase);e.push(`<text x="${a}" y="${n.subtitleY}"
      font-family="${o.typography.fontFamily}"
      font-size="${h}px"
      fill="${o.colors.secondary}">${Y(t.labels.subtitle)}</text>`)}return e.join(`
`)}function Gn(t,n,o){var u,h;const e=[],a=o.spacing.padding;let i=n.footerY;if((u=t.labels)!=null&&u.caption){const s=tt(o.typography.fontSizeSm);e.push(`<text x="${a}" y="${i}"
      font-family="${o.typography.fontFamily}"
      font-size="${s}px"
      fill="${o.colors.secondary}">${Y(t.labels.caption)}</text>`),i+=Q.CAPTION_HEIGHT}if((h=t.labels)!=null&&h.footnote){const s=tt(o.typography.fontSizeSm);e.push(`<text x="${a}" y="${i}"
      font-family="${o.typography.fontFamily}"
      font-size="${s}px"
      font-style="italic"
      fill="${o.colors.muted}">${Y(t.labels.footnote)}</text>`)}return e.join(`
`)}function Ln(t,n,o,e,a,i,u){const h=[],s=n+1,r=u.groupHeaders;let l,d,f,c,$;if(s===1?(l=tt((r==null?void 0:r.level1FontSize)??u.typography.fontSizeBase),d=(r==null?void 0:r.level1FontWeight)??u.typography.fontWeightBold,f=(r==null?void 0:r.level1Italic)??!1,c=(r==null?void 0:r.level1Background)??null,$=(r==null?void 0:r.level1BorderBottom)??!1):s===2?(l=tt((r==null?void 0:r.level2FontSize)??u.typography.fontSizeBase),d=(r==null?void 0:r.level2FontWeight)??u.typography.fontWeightMedium,f=(r==null?void 0:r.level2Italic)??!0,c=(r==null?void 0:r.level2Background)??null,$=(r==null?void 0:r.level2BorderBottom)??!1):(l=tt((r==null?void 0:r.level3FontSize)??u.typography.fontSizeBase),d=(r==null?void 0:r.level3FontWeight)??u.typography.fontWeightNormal,f=(r==null?void 0:r.level3Italic)??!1,c=(r==null?void 0:r.level3Background)??null,$=(r==null?void 0:r.level3BorderBottom)??!1),!c){const _=u.colors.primary,F=s===1?.15:s===2?.1:.06,A=_.replace("#",""),G=parseInt(A.substring(0,2),16),y=parseInt(A.substring(2,4),16),m=parseInt(A.substring(4,6),16);c=`rgba(${G}, ${y}, ${m}, ${F})`}const M=e+a/2+l*Q.TEXT_BASELINE_ADJUSTMENT,w=n*((r==null?void 0:r.indentPerLevel)??v.INDENT_PER_LEVEL);h.push(`<rect x="${o}" y="${e}"
    width="${i}" height="${a}"
    fill="${c}"/>`),$&&h.push(`<line x1="${o}" x2="${o+i}" y1="${e+a}" y2="${e+a}"
      stroke="${u.colors.border}" stroke-width="1" opacity="0.5"/>`);const N=f?' font-style="italic"':"";return h.push(`<text x="${o+v.TEXT_PADDING+w}" y="${M}"
    font-family="${u.typography.fontFamily}"
    font-size="${l}px"
    font-weight="${d}"${N}
    fill="${u.colors.foreground}">${Y(t)}</text>`),h.join(`
`)}function Hn(t,n){const o=new Map;for(const e of n)if(e.type==="bar"){let a=0;for(const i of t){const u=i.metadata[e.field];typeof u=="number"&&u>a&&(a=u)}o.set(e.field,a>0?a:1)}return o}function vn(t,n){var e,a,i,u,h,s,r,l,d,f,c,$,M,w,N,_,F,A,G;if(n.type==="interval"){const y=(a=(e=n.options)==null?void 0:e.interval)!=null&&a.point?t.metadata[n.options.interval.point]:t.point,m=(u=(i=n.options)==null?void 0:i.interval)!=null&&u.lower?t.metadata[n.options.interval.lower]:t.lower,p=(s=(h=n.options)==null?void 0:h.interval)!=null&&s.upper?t.metadata[n.options.interval.upper]:t.upper;return Qt(y,m,p,n.options)}if(n.type==="numeric"){const y=t.metadata[n.field];return typeof y=="number"?It(y,n.options):((r=n.options)==null?void 0:r.naText)??""}if(n.type==="custom"&&((l=n.options)!=null&&l.events))return Kt(t,n.options);if(n.type==="pvalue"){const y=t.metadata[n.field];return typeof y!="number"?((d=n.options)==null?void 0:d.naText)??"":tn(y,n.options)}if(n.type==="icon"){const y=t.metadata[n.field];if(y==null)return"";const m=String(y),p=(c=(f=n.options)==null?void 0:f.icon)==null?void 0:c.mapping;return p&&m in p?p[m]:m}if(n.type==="badge"){const y=t.metadata[n.field];return y!=null?String(y):""}if(n.type==="stars"){const y=t.metadata[n.field];if(typeof y!="number")return"";const m=((M=($=n.options)==null?void 0:$.stars)==null?void 0:M.maxStars)??5,p=Math.max(0,Math.min(m,y)),T=Math.floor(p),g=m-T;return"★".repeat(T)+"☆".repeat(g)}if(n.type==="img")return((N=(w=n.options)==null?void 0:w.img)==null?void 0:N.fallback)??"[IMG]";if(n.type==="reference"){const y=t.metadata[n.field];if(y==null)return"";const m=String(y),p=((F=(_=n.options)==null?void 0:_.reference)==null?void 0:F.maxChars)??30;return m.length<=p?m:m.substring(0,p)+"..."}if(n.type==="range"){const y=(A=n.options)==null?void 0:A.range;if(!y)return"";const m=t.metadata[y.minField],p=t.metadata[y.maxField],T=y.separator??" – ",g=y.decimals,E=x=>typeof x!="number"?"":g==null?Number.isInteger(x)?String(x):x.toFixed(1):x.toFixed(g);return m===null&&p===null?"":m===null?E(p):p===null?E(m):`${E(m)}${T}${E(p)}`}const o=t.metadata[n.field];return o!=null?String(o):((G=n.options)==null?void 0:G.naText)??""}function Wn(t,n,o,e,a){const i=t.filter(l=>Number.isFinite(l));if(i.length===0)return"";if(i.length===1){const l=n+e/2,d=o+a/2;return`M${l.toFixed(1)},${d.toFixed(1)}`}const u=Math.min(...i),s=Math.max(...i)-u||1;return`M${i.map((l,d)=>{const f=n+d/(i.length-1)*e,c=o+a-(l-u)/s*a;return`${f.toFixed(1)},${c.toFixed(1)}`}).join("L")}`}function kn(t,n,o,e,a,i=[],u,h=0,s=1/0,r,l=!1){var m;let d;if(i.length===0){const p=!l||t.point!=null&&t.point>0?t.point:null,T=!l||t.lower!=null&&t.lower>0?t.lower:null,g=!l||t.upper!=null&&t.upper>0?t.upper:null;d=[{point:p,lower:T,upper:g,color:null,shape:null,opacity:null}]}else d=i.map(p=>({point:lt(t.metadata,t.point,p.pointCol,"point",l),lower:lt(t.metadata,t.lower,p.lowerCol,"lower",l),upper:lt(t.metadata,t.upper,p.upperCol,"upper",l),color:p.color??null,shape:p.shape??null,opacity:p.opacity??null}));const f=d.filter(p=>p.point!=null&&!Number.isNaN(p.point)&&p.lower!=null&&!Number.isNaN(p.lower)&&p.upper!=null&&!Number.isNaN(p.upper));if(f.length===0)return"";const c=e.shapes.pointSize,$=e.shapes.lineWidth,M=e.colors.intervalLine,w=((m=t.style)==null?void 0:m.type)==="summary",_=e.shapes.summaryHeight/2;function F(p){var g;if(p&&((g=t.markerStyle)==null?void 0:g.size)!=null)return c*t.markerStyle.size;const T=u?t.metadata[u]:void 0;if(T){const E=.5+Math.sqrt(T/100)*1.5;return Math.min(Math.max(c*E,3),c*2.5)}return c}function A(p,T){const g=T===0,E=t.markerStyle,x=e.shapes.markerColors,D=e.shapes.markerShapes,b=["square","circle","diamond","triangle"];let L;g&&(E!=null&&E.color)?L=E.color:p.color?L=p.color:x&&x.length>0?L=x[T%x.length]:L=e.colors.interval??e.colors.primary??"#2563eb";let k;g&&(E!=null&&E.shape)?k=E.shape:p.shape?k=p.shape:D&&D.length>0?k=D[T%D.length]:k=b[T%b.length];let P;return g&&(E==null?void 0:E.opacity)!=null?P=E.opacity:p.opacity!=null?P=p.opacity:P=1,{color:L,shape:k,opacity:P}}function G(p,T,g,E){const{color:x,shape:D,opacity:b}=E,L=b<1?` fill-opacity="${b}"`:"";switch(D){case"circle":return`<circle cx="${p}" cy="${T}" r="${g}" fill="${x}"${L}/>`;case"diamond":return`<polygon points="${[`${p},${T-g}`,`${p+g},${T}`,`${p},${T+g}`,`${p-g},${T}`].join(" ")}" fill="${x}"${L}/>`;case"triangle":return`<polygon points="${[`${p},${T-g}`,`${p+g},${T+g}`,`${p-g},${T+g}`].join(" ")}" fill="${x}"${L}/>`;default:return`<rect x="${p-g}" y="${T-g}" width="${g*2}" height="${g*2}" fill="${x}"${L}/>`}}const y=[];return f.forEach((p,T)=>{const g=n+En(T,f.length),E=o(p.lower),x=o(p.upper),D=o(p.point),b=A(p,T),L=F(T===0),k=M;if(w){const P=b.opacity<1?` fill-opacity="${b.opacity}"`:"",R=[`${E},${g}`,`${D},${g-_}`,`${x},${g}`,`${D},${g+_}`].join(" ");y.push(`
        <g class="interval effect-${T} summary">
          <polygon points="${R}"
            fill="${b.color}"${P} stroke="${e.colors.summaryBorder}" stroke-width="1"/>
        </g>`)}else{const P=v.AXIS_LABEL_PADDING,R=h+P,I=h+s-P,H=r?p.lower<r[0]:E<R,X=r?p.upper>r[1]:x>I;let B,j;if(r){const ut=Math.max(r[0],Math.min(r[1],p.lower)),S=Math.max(r[0],Math.min(r[1],p.upper));B=o(ut),j=o(S)}else B=Math.max(R,Math.min(I,E)),j=Math.max(R,Math.min(I,x));const U=Tn(e),nt=U.height/2;let ot="";H?ot=`<path d="${Jt("left",R,g,U)}" fill="${U.color}"/>`:ot=`<line x1="${B}" x2="${B}" y1="${g-nt}" y2="${g+nt}" stroke="${k}" stroke-width="${$}"/>`;let rt="";X?rt=`<path d="${Jt("right",I,g,U)}" fill="${U.color}"/>`:rt=`<line x1="${j}" x2="${j}" y1="${g-nt}" y2="${g+nt}" stroke="${k}" stroke-width="${$}"/>`;const ct=r?o(Math.max(r[0],Math.min(r[1],p.point))):Math.max(R,Math.min(I,D));y.push(`
        <g class="interval effect-${T}">
          <line x1="${B}" x2="${j}" y1="${g}" y2="${g}"
            stroke="${k}" stroke-width="${$}"/>
          ${ot}
          ${rt}
          ${G(ct,g,L,b)}
        </g>`)}}),y.join("")}function Pn(t,n,o,e,a,i,u,h){const r=h.shapes.summaryHeight/2,[l,d]=a.domain().map(G=>a(G)),f=Math.min(l,d),c=Math.max(l,d),$=a(n),M=a(t),w=a(o),N=i+Math.max(f,Math.min(c,$)),_=i+Math.max(f,Math.min(c,M)),F=i+Math.max(f,Math.min(c,w));return`<polygon points="${[`${N},${e}`,`${_},${e-r}`,`${F},${e}`,`${_},${e+r}`].join(" ")}"
    fill="${h.colors.summaryFill}"
    stroke="${h.colors.summaryBorder}"
    stroke-width="1"/>`}function Rn(t,n,o,e,a,i,u=1,h){const s=[],r=typeof o.axis.tickCount=="number"?o.axis.tickCount:v.DEFAULT_TICK_COUNT,l=Un(t,r,o,u,i,h),d=tt(o.typography.fontSizeSm),f=35,c=M=>M<f?"start":M>i-f?"end":"middle",$=M=>M<f?2:M>i-f?-2:0;s.push(`<line x1="${a}" x2="${a+i}"
    y1="0" y2="0" stroke="${o.colors.border}" stroke-width="1"/>`);for(const M of l){const w=t(M),N=a+w,_=c(w),F=$(w);s.push(`<line x1="${N}" x2="${N}" y1="0" y2="4"
      stroke="${o.colors.border}" stroke-width="1"/>`),s.push(`<text x="${N+F}" y="16" text-anchor="${_}"
      font-family="${o.typography.fontFamily}"
      font-size="${d}px"
      fill="${o.colors.secondary}">${Dn(M)}</text>`)}return e&&s.push(`<text x="${a+i/2}" y="28"
      text-anchor="middle"
      font-family="${o.typography.fontFamily}"
      font-size="${d}px"
      font-weight="500"
      fill="${o.colors.secondary}">${Y(e)}</text>`),`<g transform="translate(0, ${n.mainY+n.headerHeight+n.plotHeight})">${s.join(`
`)}</g>`}function Xn(t,n,o,e,a,i,u,h,s,r){const l=[],d=tt(i.typography.fontSizeBase),f=i.typography.headerFontScale??1.05,c=d*f,$=i.typography.fontWeightMedium,M=i.typography.fontWeightBold,w=Xt(t),N=(_,F)=>_+F/2+c*Q.TEXT_BASELINE_ADJUSTMENT;if(w){const _=a/2,F=a/2;let A=o;l.push(`<text x="${A+v.TEXT_PADDING}" y="${N(e,a)}"
      font-family="${i.typography.fontFamily}"
      font-size="${c}px"
      font-weight="${$}"
      fill="${i.colors.foreground}">${Y(u)}</text>`),A+=h;const G=[];for(const y of t)if(y.isGroup){const m=y.columns.reduce((T,g)=>g.isGroup?T+g.columns.reduce((E,x)=>E+r(x),0):T+r(g),0),p=A+m/2;l.push(`<text x="${p}" y="${N(e,_)}"
          font-family="${i.typography.fontFamily}"
          font-size="${c}px"
          font-weight="${M}"
          text-anchor="middle"
          fill="${i.colors.foreground}">${Y(y.header)}</text>`),G.push({x1:A,x2:A+m}),A+=m}else{const m=r(y),p=y.headerAlign??y.align,{textX:T,anchor:g}=Nt(A,m,p),E=Bt(y.header,m,c,v.TEXT_PADDING);l.push(`<text x="${T}" y="${N(e,a)}"
          font-family="${i.typography.fontFamily}"
          font-size="${c}px"
          font-weight="${$}"
          text-anchor="${g}"
          fill="${i.colors.foreground}">${Y(E)}</text>`),A+=m}for(const y of G)l.push(`<line x1="${y.x1}" x2="${y.x2}"
        y1="${e+_}" y2="${e+_}"
        stroke="${i.colors.border}" stroke-width="1" opacity="0.5"/>`);A=o+h;for(const y of t)if(y.isGroup){for(const m of y.columns)if(!m.isGroup){const p=r(m),T=m.headerAlign??m.align,{textX:g,anchor:E}=Nt(A,p,T);l.push(`<text x="${g}" y="${N(e+_,F)}"
              font-family="${i.typography.fontFamily}"
              font-size="${c}px"
              font-weight="${$}"
              text-anchor="${E}"
              fill="${i.colors.foreground}">${Y(m.header)}</text>`),A+=p}}else A+=r(y)}else{let _=o;l.push(`<text x="${_+v.TEXT_PADDING}" y="${N(e,a)}"
      font-family="${i.typography.fontFamily}"
      font-size="${c}px"
      font-weight="${$}"
      fill="${i.colors.foreground}">${Y(u)}</text>`),_+=h;for(const F of n){const A=r(F),G=F.headerAlign??F.align,{textX:y,anchor:m}=Nt(_,A,G),p=Bt(F.header,A,c,v.TEXT_PADDING);l.push(`<text x="${y}" y="${N(e,a)}"
        font-family="${i.typography.fontFamily}"
        font-size="${c}px"
        font-weight="${$}"
        text-anchor="${m}"
        fill="${i.colors.foreground}">${Y(p)}</text>`),_+=A}}return l.join(`
`)}function Bn(t,n,o,e,a,i,u,h,s,r,l,d){var G,y,m,p,T,g,E,x,D,b,L,k,P,R,I,H,X,B,j,U,nt,ot,rt,ct,ut,S,V,At,St;const f=[],c=tt(i.typography.fontSizeBase),$=e+a/2+c*Q.TEXT_BASELINE_ADJUSTMENT,M=h*v.INDENT_PER_LEVEL+(((G=t.style)==null?void 0:G.indent)??0)*v.INDENT_PER_LEVEL,w=(y=t.style)!=null&&y.bold||(m=t.style)!=null&&m.emphasis?i.typography.fontWeightBold:i.typography.fontWeightNormal,N=(p=t.style)!=null&&p.italic?"italic":"normal";let _=i.colors.foreground;(T=t.style)!=null&&T.color?_=t.style.color:(g=t.style)!=null&&g.muted?_=i.colors.muted:(E=t.style)!=null&&E.accent&&(_=i.colors.accent);const F=u-M-v.TEXT_PADDING*2,A=Bt(t.label,F,c,0);if(f.push(`<text x="${o+v.TEXT_PADDING+M}" y="${$}"
    font-family="${i.typography.fontFamily}"
    font-size="${c}px"
    font-weight="${w}"
    font-style="${N}"
    fill="${_}">${Y(A)}</text>`),(x=t.style)!=null&&x.badge){const mt=String(t.style.badge),C=c*pt.FONT_SCALE,J=C+pt.PADDING*2,st=q(t.label,c),_t=o+v.TEXT_PADDING+M+st+pt.GAP,wt=q(mt,C)+pt.PADDING*2,W=e+(a-J)/2;f.push(`<rect x="${_t}" y="${W}" width="${wt}" height="${J}"
      rx="3" fill="${i.colors.primary}" opacity="0.15"/>`),f.push(`<text x="${_t+wt/2}" y="${W+J/2+C*.35}"
      text-anchor="middle"
      font-family="${i.typography.fontFamily}"
      font-size="${C}px"
      font-weight="500"
      fill="${i.colors.primary}">${Y(mt)}</text>`)}for(let mt=0;mt<n.length;mt++){const C=n[mt],J=d[mt],st=l(C);if(C.type==="forest")continue;const _t=vn(t,C),{textX:ln,anchor:wt}=Nt(J,st,C.align);if(C.type==="bar"&&typeof t.metadata[C.field]=="number"){const W=t.metadata[C.field],z=s.get(C.field),Z=((b=(D=C.options)==null?void 0:D.bar)==null?void 0:b.maxValue)??z??100,O=((k=(L=C.options)==null?void 0:L.bar)==null?void 0:k.color)??i.colors.primary,it=i.shapes.pointSize*2,dt=st-v.TEXT_PADDING*2-50,et=Math.min(W/Z*dt,dt);f.push(`<rect x="${J+v.TEXT_PADDING}" y="${e+a/2-it/2}"
        width="${Math.max(0,et)}" height="${it}"
        fill="${O}" opacity="0.7" rx="2"/>`),f.push(`<text x="${J+st-v.TEXT_PADDING}" y="${$}"
        font-family="${i.typography.fontFamily}"
        font-size="${c}px"
        text-anchor="end"
        fill="${i.colors.foreground}">${It(W)}</text>`)}else if(C.type==="sparkline"&&Array.isArray(t.metadata[C.field])){let W=t.metadata[C.field];Array.isArray(W[0])&&(W=W[0]);const z=((R=(P=C.options)==null?void 0:P.sparkline)==null?void 0:R.height)??16,Z=((H=(I=C.options)==null?void 0:I.sparkline)==null?void 0:H.color)??i.colors.primary,O=v.TEXT_PADDING*2,it=Wn(W,J+v.TEXT_PADDING,e+a/2-z/2,st-O,z);f.push(`<path d="${it}" fill="none" stroke="${Z}" stroke-width="1.5"/>`)}else if(C.type==="badge"){const W=t.metadata[C.field];if(W!=null){const z=String(W),Z=c*.85,O=Z+8,it=(B=(X=C.options)==null?void 0:X.badge)==null?void 0:B.variants,ft=(U=(j=C.options)==null?void 0:j.badge)==null?void 0:U.colors;let dt=i.colors.primary,et=i.colors.primary;if(ft&&z in ft)dt=ft[z],et=ft[z];else if(it&&z in it){const Vt=it[z];dt={default:i.colors.primary,success:"#16a34a",warning:"#d97706",error:"#dc2626",info:"#2563eb",muted:i.colors.muted}[Vt]??i.colors.primary,et=dt}const yt=q(z,Z)+12,xt=C.align==="right"?J+st-v.TEXT_PADDING-yt:C.align==="center"?J+(st-yt)/2:J+v.TEXT_PADDING,Dt=e+(a-O)/2;f.push(`<rect x="${xt}" y="${Dt}" width="${yt}" height="${O}"
          rx="${O/2}" fill="${dt}" opacity="0.15"/>`),f.push(`<text x="${xt+yt/2}" y="${Dt+O/2+Z*.35}"
          text-anchor="middle"
          font-family="${i.typography.fontFamily}"
          font-size="${Z}px"
          font-weight="500"
          fill="${et}">${Y(z)}</text>`)}}else if(C.type==="stars"){const W=t.metadata[C.field];if(typeof W=="number"){const z=((ot=(nt=C.options)==null?void 0:nt.stars)==null?void 0:ot.maxStars)??5,Z=((ct=(rt=C.options)==null?void 0:rt.stars)==null?void 0:ct.color)??"#f59e0b",O=((S=(ut=C.options)==null?void 0:ut.stars)==null?void 0:S.emptyColor)??"#d1d5db",it=Math.max(0,Math.min(z,W)),ft=Math.floor(it),dt=((At=(V=C.options)==null?void 0:V.stars)==null?void 0:At.halfStars)&&it-ft>=.5,et=12,zt=2,yt=z*et+(z-1)*zt;let xt=C.align==="right"?J+st-v.TEXT_PADDING-yt:C.align==="center"?J+(st-yt)/2:J+v.TEXT_PADDING;const Dt=e+(a-et)/2,Vt=(ht,Ct,jt)=>{const Ft=jt/2,Gt=Ft*.4;let cn="";for(let Mt=0;Mt<5;Mt++){const un=(Mt*72-90)*Math.PI/180,fn=(Mt*72+36-90)*Math.PI/180,dn=ht+Ft*Math.cos(un),hn=Ct+Ft*Math.sin(un),On=ht+Gt*Math.cos(fn),Jn=Ct+Gt*Math.sin(fn);cn+=(Mt===0?`M${dn},${hn}`:`L${dn},${hn}`)+`L${On},${Jn}`}return cn+"Z"};for(let ht=0;ht<z;ht++){const Ct=xt+et/2,jt=Dt+et/2,Gt=ht<ft||ht===ft&&dt?Z:O;f.push(`<path d="${Vt(Ct,jt,et)}" fill="${Gt}"/>`),xt+=et+zt}}}else{const W=(St=t.cellStyles)==null?void 0:St[C.field];let z=i.typography.fontWeightNormal,Z="normal",O=i.colors.foreground;W&&((W.bold||W.emphasis)&&(z=i.typography.fontWeightBold),W.italic&&(Z="italic"),W.color?O=W.color:W.muted?O=i.colors.muted:W.accent&&(O=i.colors.accent)),f.push(`<text x="${ln}" y="${$}"
        font-family="${i.typography.fontFamily}"
        font-size="${c}px"
        font-weight="${z}"
        font-style="${Z}"
        text-anchor="${wt}"
        fill="${O}">${Y(_t)}</text>`)}}return f.join(`
`)}function Un(t,n,o,e,a,i){if(Array.isArray(o.axis.tickValues)&&o.axis.tickValues.length>0){const[m,p]=t.domain();let T=o.axis.tickValues.filter(x=>x>=m&&x<=p);const g=o.axis.nullTick!==!1,E=e>=m&&e<=p;return g&&E&&!T.includes(e)&&(T=[...T,e].sort((x,D)=>x-D)),T}const[u,h]=t.domain(),s=o.axis.nullTick!==!1,r=e>=u&&e<=h,l=50,d=Math.max(2,Math.floor(a/l)),f=Math.min(n,Math.min(7,d)),c=i&&i.length>0?i.filter(m=>m>=u&&m<=h):t.ticks(f);if(c.length===0)return s&&r?[e]:[];const $=t(e),M=c.filter(m=>m<e).reverse(),w=c.filter(m=>m>e),N=c.some(m=>m===e),_=[];let F=$;for(const m of M){const p=t(m);F-p>=l&&(_.unshift(m),F=p)}const A=[];let G=$;for(const m of w){const p=t(m);p-G>=l&&(A.push(m),G=p)}const y=[..._];if((N||s&&r)&&y.push(e),y.push(...A),y.length<2){const m=new Set(y);m.has(u)||y.unshift(u),y.length<2&&!m.has(h)&&y.push(h)}return y}function Ut(t,n,o,e,a,i,u=1,h=.6){let r=`<line x1="${t}" x2="${t}" y1="${n}" y2="${o}"
    stroke="${a}" stroke-width="${u}" stroke-opacity="${h}" stroke-dasharray="${e==="dashed"?"6,4":e==="dotted"?"2,2":"none"}"/>`;return i&&(r+=`<text x="${t}" y="${n-4}" text-anchor="middle"
      font-size="10px" fill="${a}">${Y(i)}</text>`),r}class gt extends Error{constructor(n){super(`SVG Generator: ${n}`),this.name="SVGGeneratorError"}}function zn(t){if(!t||typeof t!="object")throw new gt("Invalid spec: expected an object");const n=t;if(!n.data||typeof n.data!="object")throw new gt("Invalid spec: missing or invalid 'data' property");const o=n.data;if(!Array.isArray(o.rows))throw new gt("Invalid spec: 'data.rows' must be an array");if(!n.theme||typeof n.theme!="object")throw new gt("Invalid spec: missing or invalid 'theme' property");const e=n.theme;if(!e.colors||typeof e.colors!="object")throw new gt("Invalid spec: missing or invalid 'theme.colors'");if(!e.typography||typeof e.typography!="object")throw new gt("Invalid spec: missing or invalid 'theme.typography'");if(!e.spacing||typeof e.spacing!="object")throw new gt("Invalid spec: missing or invalid 'theme.spacing'")}function Vn(t){var i;const o=Rt(t.columns,void 0).find(u=>u.type==="forest");if(!o||!((i=o.options)!=null&&i.forest))return{scale:"linear",nullValue:0,effects:[],axisLabel:"Effect",pointCol:null,lowerCol:null,upperCol:null};const e=o.options.forest,a=e.scale??"linear";return{scale:a,nullValue:e.nullValue??(a==="log"?1:0),effects:e.effects??[],axisLabel:e.axisLabel??"Effect",pointCol:e.point??null,lowerCol:e.lower??null,upperCol:e.upper??null}}function jn(t,n={}){var p,T;zn(t);const o=t.theme,e=o.spacing.padding,a=Array.isArray(t.columns)?t.columns:[],i=Pt(a),u=[];for(let g=0;g<i.length;g++)i[g].type==="forest"&&u.push(g);u.length>0;const h=Vn(t),s=wn(t,n,h.nullValue),r=s.autoWidths,l=g=>{var x,D;if(g.type==="forest")return typeof g.width=="number"?g.width:((D=(x=g.options)==null?void 0:x.forest)==null?void 0:D.width)??s.forestWidth;const E=r.get(g.id);return E!==void 0?E:typeof g.width=="number"?g.width:K.DEFAULT_COLUMN_WIDTH},d=[];let f=e+s.labelWidth;for(const g of i)d.push(f),f+=l(g);const c=[];c.push(`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg"
  width="${s.totalWidth}" height="${s.totalHeight}"
  viewBox="0 0 ${s.totalWidth} ${s.totalHeight}">`);const $=n.backgroundColor??o.colors.background;c.push(`<rect width="100%" height="100%" fill="${$}"/>`),c.push(Fn(t,s,o)),c.push(`<line x1="${e}" x2="${s.totalWidth-e}"
    y1="${s.mainY}" y2="${s.mainY}"
    stroke="${o.colors.border}" stroke-width="2"/>`);const M=s.mainY;c.push(Xn(a,i,e,M,s.headerHeight,o,t.data.labelHeader??"Study",s.labelWidth,r,l)),c.push(`<line x1="${e}" x2="${s.totalWidth-e}"
    y1="${M+s.headerHeight}" y2="${M+s.headerHeight}"
    stroke="${o.colors.border}" stroke-width="2"/>`);const w=on(t),N=[],_=[];let F=0;for(const g of w){const x=g.type==="data"&&((p=g.row.style)==null?void 0:p.type)==="spacer"?s.rowHeight/2:s.rowHeight;N.push(F),_.push(x),F+=x}const A=s.mainY+s.headerHeight;for(const g of u){const E=i[g],x=d[g],D=l(E),b=(T=E.options)==null?void 0:T.forest,L=(b==null?void 0:b.scale)??"linear",k=(b==null?void 0:b.nullValue)??(L==="log"?1:0),P=(b==null?void 0:b.axisLabel)??"Effect",R=L==="log";let I=(b==null?void 0:b.effects)??[];const H=(b==null?void 0:b.point)??null,X=(b==null?void 0:b.lower)??null,B=(b==null?void 0:b.upper)??null;I.length===0&&(H||X||B)&&(I=[{pointCol:H,lowerCol:X,upperCol:B}]);const j={scale:L,nullValue:k,effects:I,pointCol:(b==null?void 0:b.point)??null,lowerCol:(b==null?void 0:b.lower)??null,upperCol:(b==null?void 0:b.upper)??null},{scale:U,clipBounds:nt,ticks:ot}=Cn(t,D,j,n),rt=x+U(k);c.push(Ut(rt,A,A+s.plotHeight,"dashed",o.colors.muted));const ct=(b==null?void 0:b.annotations)??[];for(const S of ct)if(S.type==="reference_line"){const V=x+U(S.x);c.push(Ut(V,A,A+s.plotHeight,S.style,S.color??o.colors.accent,S.label,S.width??1,S.opacity??.6))}const ut=Array.isArray(t.annotations)?t.annotations:[];for(const S of ut)if(S.type==="reference_line"){const V=x+U(S.x);c.push(Ut(V,A,A+s.plotHeight,S.style,S.color??o.colors.accent,S.label,S.width??1,S.opacity??.6))}if(w.forEach((S,V)=>{if(S.type==="data"){const At=A+N[V]+_[V]/2;c.push(kn(S.row,At,St=>x+U(St),o,k,I,t.data.weightCol,x,D,nt,R))}}),t.data.overall&&s.showOverallSummary&&typeof t.data.overall.point=="number"&&!Number.isNaN(t.data.overall.point)&&typeof t.data.overall.lower=="number"&&!Number.isNaN(t.data.overall.lower)&&typeof t.data.overall.upper=="number"&&!Number.isNaN(t.data.overall.upper)){const S=A+s.summaryYPosition;c.push(Pn(t.data.overall.point,t.data.overall.lower,t.data.overall.upper,S,U,x,D,o))}c.push(Rn(U,s,o,P,x,D,k,ot))}const G=s.mainY+s.headerHeight,y=t.data.rows,m=Hn(y,i);return w.forEach((g,E)=>{var b,L,k,P;const x=G+N[E],D=_[E];if(g.type==="group_header")c.push(Ln(g.label,g.depth,e,x,D,s.totalWidth-e*2,o));else{const R=g.row,I=g.depth,H=((b=R.style)==null?void 0:b.type)==="spacer",X=(L=R.style)==null?void 0:L.bg;if(!H&&!X&&o.layout.banding){const j=E%2===1?o.colors.altBg:o.colors.rowBg;j!==o.colors.background&&c.push(`<rect x="${e}" y="${x}"
            width="${s.totalWidth-e*2}" height="${D}"
            fill="${j}"/>`)}c.push(Bn(R,i,e,x,D,o,s.labelWidth,I,m,r,l,d))}if(g.type==="data"){const R=g.row,I=((k=R.style)==null?void 0:k.type)==="summary",H=((P=R.style)==null?void 0:P.type)==="spacer";I&&c.push(`<line x1="${e}" x2="${s.totalWidth-e}"
          y1="${x}" y2="${x}"
          stroke="${o.colors.border}" stroke-width="2"/>`),H||c.push(`<line x1="${e}" x2="${s.totalWidth-e}"
          y1="${x+D}" y2="${x+D}"
          stroke="${o.colors.border}" stroke-width="1"/>`)}else c.push(`<line x1="${e}" x2="${s.totalWidth-e}"
        y1="${x+D}" y2="${x+D}"
        stroke="${o.colors.border}" stroke-width="1"/>`)}),c.push(Gn(t,s,o)),c.push("</svg>"),c.join(`
`)}function Yn(t,n){const o=JSON.parse(t);return jn(o,n)}globalThis.generateSVG=Yn})();
