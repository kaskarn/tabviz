(function(){"use strict";function _t(t,n){if(n){const d=[.05,.1,.15,.2,.25,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2,1.3,1.4,1.5,1.75,2,2.5,3,4,5,6,7,8,10,12,15,20,25,30,40,50,75,100];let a=d[0];for(const c of d)if(c<=t[0])a=c;else break;let l=d[d.length-1];for(let c=d.length-1;c>=0&&d[c]>=t[1];c--)l=d[c];return[a,l]}const o=t[1]-t[0];if(o===0)return t;const e=Math.pow(10,Math.floor(Math.log10(o))),r=o/e;let i;r<=1?i=e*.1:r<=2?i=e*.2:r<=5?i=e*.5:i=e;const s=Math.floor(t[0]/i)*i,f=Math.ceil(t[1]/i)*i;return[s,f]}const dt=.08,Nt=.06,At=.05,ut=.04;function Ht(t){return t<=0?0:ut+t*ut}const v={DEFAULT_LABEL_WIDTH:200,DEFAULT_COLUMN_WIDTH:100,AXIS_HEIGHT:32,AXIS_LABEL_HEIGHT:20,BOTTOM_MARGIN:16,MIN_FOREST_WIDTH:200,DEFAULT_WIDTH:800,COLUMN_GAP:16},X={TITLE_HEIGHT:28,SUBTITLE_HEIGHT:20,CAPTION_HEIGHT:16,FOOTNOTE_HEIGHT:14,DEFAULT_FONT_SIZE:14,REM_BASE:16,TEXT_BASELINE_ADJUSTMENT:1/3},D={INDENT_PER_LEVEL:12,TEXT_PADDING:10,WHISKER_HALF_HEIGHT:4,DEFAULT_TICK_COUNT:5},ft={GROUP_HEADER_HEIGHT_MULTIPLIER:1.5,OVERALL_ROW_HEIGHT_MULTIPLIER:1.5},Z={PADDING:28,MIN:60,MAX:600,LABEL_MAX:400};function q(t,n){const o=t.split(".");return o[0]=o[0].replace(/\B(?=(\d{3})+(?!\d))/g,n),o.join(".")}function rt(t){const n=Math.abs(t),o=t<0?"-":"";if(n>=1e12)throw new Error(`Cannot abbreviate value >= 1 trillion: ${t}`);if(n>=1e9){const e=n/1e9;return o+it(e)+"B"}if(n>=1e6){const e=n/1e6;return o+it(e)+"M"}if(n>=1e3){const e=n/1e3;return o+it(e)+"K"}return o+Math.round(n).toString()}function it(t){const n=Math.round(t*10)/10;return n===Math.floor(n)?n.toFixed(0):n.toFixed(1)}const St={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","-":"⁻","+":"⁺"};function Dt(t){return t.split("").map(n=>St[n]??n).join("")}function Q(t,n){var f,d,a,l,c;if(t==null||Number.isNaN(t))return(n==null?void 0:n.naText)??"";if(n!=null&&n.percent){const{decimals:h,digits:m,multiply:p=!0,symbol:I=!0}=n.percent,S=p?t*100:t,N=m!=null?S.toPrecision(m):S.toFixed(h??1);return I?`${N}%`:N}if(((f=n==null?void 0:n.numeric)==null?void 0:f.abbreviate)&&Math.abs(t)>=1e3)return rt(t);const e=(d=n==null?void 0:n.numeric)==null?void 0:d.digits;if(e!=null){const h=t.toPrecision(e),m=(a=n==null?void 0:n.numeric)==null?void 0:a.thousandsSep;return m&&typeof m=="string"?q(h,m):h}const r=(l=n==null?void 0:n.numeric)==null?void 0:l.decimals,i=(c=n==null?void 0:n.numeric)==null?void 0:c.thousandsSep;let s;return r!==void 0?s=t.toFixed(r):Number.isInteger(t)||Math.abs(t-Math.round(t))<1e-4?s=Math.round(t).toString():s=t.toFixed(2),i&&typeof i=="string"&&(s=q(s,i)),s}function ht(t,n){const{eventsField:o,nField:e,separator:r="/",showPct:i=!1,thousandsSep:s,abbreviate:f}=n.events,d=t.metadata[o],a=t.metadata[e];if(d==null||a===void 0||a===null)return n.naText??"";const l=Number(d),c=Number(a);let h,m;f&&(l>=1e3||c>=1e3)?(h=l>=1e3?rt(l):String(l),m=c>=1e3?rt(c):String(c)):(h=String(l),m=String(c),s&&typeof s=="string"&&(h=q(h,s),m=q(m,s)));let p=`${h}${r}${m}`;if(i&&c>0){const I=(l/c*100).toFixed(1);p+=` (${I}%)`}return p}function pt(t,n,o,e){var f,d,a;if(t==null||Number.isNaN(t))return"";const r=((f=e==null?void 0:e.interval)==null?void 0:f.decimals)??2,i=((d=e==null?void 0:e.interval)==null?void 0:d.sep)??" ",s=(a=e==null?void 0:e.interval)==null?void 0:a.impreciseThreshold;return n==null||o===void 0||o===null||Number.isNaN(n)||Number.isNaN(o)?t.toFixed(r):s!=null&&n>0&&o/n>s?"—":`${t.toFixed(r)}${i}(${n.toFixed(r)}, ${o.toFixed(r)})`}function gt(t,n){if(t==null||Number.isNaN(t))return(n==null?void 0:n.naText)??"";const o=n==null?void 0:n.pvalue,e=(o==null?void 0:o.digits)??2,r=(o==null?void 0:o.expThreshold)??.001,i=(o==null?void 0:o.abbrevThreshold)??null,s=(o==null?void 0:o.format)??"auto",f=(o==null?void 0:o.stars)??!1,d=(o==null?void 0:o.thresholds)??[.05,.01,.001];let a="";if(f&&(t<d[2]?a="***":t<d[1]?a="**":t<d[0]&&(a="*")),i!==null&&t<i)return`<${i}${a}`;if(s==="scientific"||s==="auto"&&t<r){const c=Math.floor(Math.log10(t));return`${(t/Math.pow(10,c)).toPrecision(e)}×10${Dt(c.toString())}${a}`}let l;return t>=.1?l=t.toFixed(e):t>=.01?l=t.toFixed(e+1):l=t.toFixed(e+2),`${l}${a}`}function Wt(t,n){var i,s,f,d;const{type:o,field:e,options:r}=n;switch(o){case"interval":{const a=(i=r==null?void 0:r.interval)!=null&&i.point?t.metadata[r.interval.point]:t.point,l=(s=r==null?void 0:r.interval)!=null&&s.lower?t.metadata[r.interval.lower]:t.lower,c=(f=r==null?void 0:r.interval)!=null&&f.upper?t.metadata[r.interval.upper]:t.upper;return pt(a,l,c,r)}case"custom":return r!=null&&r.events?ht(t,r):String(t.metadata[e]??"");case"pvalue":return gt(t.metadata[e],r);case"numeric":return Q(t.metadata[e],r);case"percent":return Q(t.metadata[e],r);case"sparkline":case"icon":case"stars":case"img":case"range":return"";case"badge":{const a=t.metadata[e];return a==null?"":`  ${String(a)}  `}case"bar":{if(((d=r==null?void 0:r.bar)==null?void 0:d.showLabel)===!1)return"";const a=t.metadata[e];return a==null?"":a>=100?a.toFixed(0):a>=10?a.toFixed(1):a.toFixed(2)}case"text":default:return String(t.metadata[e]??"")}}function Y(t,n){const o="⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻";let e=0;for(const r of t)o.includes(r)?e+=n*.3:"il1.,;:|!()[]{}' ".includes(r)?e+=n*.35:"×−".includes(r)?e+=n*.5:"mwMW@%".includes(r)?e+=n*.85:r>="0"&&r<="9"?e+=n*.6:e+=n*.55;return e}function wt(t,n){var i,s;const o=new Map,e=O(t.theme.typography.fontSizeBase),r=t.data.rows;for(const f of n){if(f.width!=="auto"&&f.width!==null&&f.width!==void 0)continue;let d=0;f.header&&(d=Math.max(d,Y(f.header,e)));for(const l of r){if(((i=l.style)==null?void 0:i.type)==="header"||((s=l.style)==null?void 0:s.type)==="spacer")continue;const c=Wt(l,f);c&&(d=Math.max(d,Y(c,e)))}const a=Math.ceil(d+Z.PADDING);o.set(f.id,Math.min(Z.MAX,Math.max(Z.MIN,a)))}return o}function Lt(t){var r,i;const n=O(t.theme.typography.fontSizeBase);let o=0;t.data.labelHeader&&(o=Math.max(o,Y(t.data.labelHeader,n)));for(const s of t.data.rows)if(s.label){const d=(((r=s.style)==null?void 0:r.indent)??0)*D.INDENT_PER_LEVEL;let a=Y(s.label,n)+d;if((i=s.style)!=null&&i.badge){const l=String(s.style.badge),c=n*.8,h=4,m=6,I=Y(l,c)+h*2;a+=m+I}o=Math.max(o,a)}for(const s of t.data.groups)if(s.label){const f=s.depth*D.INDENT_PER_LEVEL;o=Math.max(o,Y(s.label,n)+f)}const e=Math.ceil(o+Z.PADDING);return Math.min(Z.LABEL_MAX,Math.max(Z.MIN,e))}function at(t,n){const o=n.get(t.id);return o!==void 0?o:typeof t.width=="number"?t.width:v.DEFAULT_COLUMN_WIDTH}function Ft(t,n){var C,k,z,U;const o=t.theme,e=o.spacing.rowHeight,r=o.spacing.padding,i=Array.isArray(t.columns)?t.columns:[],s=et(i,"left"),f=et(i,"right"),a=st(s)||st(f)?o.spacing.headerHeight*ft.GROUP_HEADER_HEIGHT_MULTIPLIER:o.spacing.headerHeight,l=!!((C=t.labels)!=null&&C.title),c=!!((k=t.labels)!=null&&k.subtitle),h=!!((z=t.labels)!=null&&z.caption),m=!!((U=t.labels)!=null&&U.footnote),p=l?X.TITLE_HEIGHT:0,I=c?X.SUBTITLE_HEIGHT:0,S=p+I+(l||c?r:0),N=h?X.CAPTION_HEIGHT:0,E=m?X.FOOTNOTE_HEIGHT:0,A=N+E+(h||m?r:0),H=$t(t).length,g=!!t.data.overall,u=H*e+(g?e*ft.OVERALL_ROW_HEIGHT_MULTIPLIER:0),y=tt(i,"left"),$=tt(i,"right"),x=[...y,...$],b=wt(t,x),_=Lt(t),L=_+y.reduce((J,j)=>J+at(j,b),0),F=$.reduce((J,j)=>J+at(j,b),0),W=n.width??v.DEFAULT_WIDTH,T=t.data.includeForest,w=L+F;let R;if(!T)R=0;else if(typeof t.layout.plotWidth=="number")R=t.layout.plotWidth;else{const J=W-w-v.COLUMN_GAP*2-r*2;R=Math.max(J,v.MIN_FOREST_WIDTH)}const V=r*2+w+R+v.COLUMN_GAP*2,B=Math.max(n.width??W,V),P=S+r+a+u+v.AXIS_HEIGHT+v.AXIS_LABEL_HEIGHT+A+v.BOTTOM_MARGIN;return{totalWidth:B,totalHeight:n.height??P,tableWidth:L+F,forestWidth:R,headerHeight:a,rowHeight:e,plotHeight:u,axisHeight:v.AXIS_HEIGHT,nullValue:t.data.nullValue,summaryYPosition:u-e,showOverallSummary:g,headerTextHeight:S,footerTextHeight:A,titleY:r+X.TITLE_HEIGHT-8,subtitleY:r+p+X.SUBTITLE_HEIGHT-4,mainY:S+r,footerY:S+r+a+u+v.AXIS_HEIGHT+v.AXIS_LABEL_HEIGHT+r,autoWidths:b,labelWidth:_}}function $t(t){var c;const n=t.data.rows,o=Array.isArray(t.data.groups)?t.data.groups:[];if(o.length===0)return n.map(h=>({type:"data",row:h,depth:0}));const e=new Map;for(const h of o)e.set(h.id,h);const r=new Map;for(const h of n){const m=h.groupId??null;r.has(m)||r.set(m,[]),r.get(m).push(h)}const i=new Set;for(const h of r.keys()){if(!h)continue;let m=h;for(;m;)i.add(m),m=(c=e.get(m))==null?void 0:c.parentId}function s(h){return o.filter(m=>(m.parentId??null)===h&&i.has(m.id))}function f(h){if(!h)return 0;const m=e.get(h);return m?m.depth+1:0}function d(h){var p;let m=((p=r.get(h))==null?void 0:p.length)??0;for(const I of s(h))m+=d(I.id);return m}const a=[];function l(h){if(h){const p=e.get(h);if(!p)return;const I=d(h);a.push({type:"group_header",groupId:p.id,label:p.label,depth:p.depth,rowCount:I})}for(const p of s(h))l(p.id);const m=r.get(h)??[];for(const p of m)a.push({type:"data",row:p,depth:f(p.groupId)})}return l(null),a}function yt(t){const n=[];for(const o of t)o.isGroup?n.push(...yt(o.columns)):n.push(o);return n}function tt(t,n){const o=[];for(const e of t)e.position===n&&(e.isGroup?o.push(...yt(e.columns)):o.push(e));return o}function et(t,n){return t.filter(o=>o.position===n)}function st(t){return t.some(n=>n.isGroup)}function O(t){return t.endsWith("rem")?parseFloat(t)*X.REM_BASE:t.endsWith("px")?parseFloat(t):X.DEFAULT_FONT_SIZE}function nt(t,n,o){return o==="right"?{textX:t+n-D.TEXT_PADDING,anchor:"end"}:o==="center"?{textX:t+n/2,anchor:"middle"}:{textX:t+D.TEXT_PADDING,anchor:"start"}}function G(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function lt(t,n,o,e=0){const r=n-e*2;if(Y(t,o)<=r)return t;const s="…",f=o*.55;let d=0,a=t.length;for(;d<a;){const l=Math.ceil((d+a)/2),c=t.slice(0,l);Y(c,o)+f<=r?d=l:a=l-1}return d===0?s:t.slice(0,d)+s}function Gt(t){return Math.abs(t)<.01?"0":Math.abs(t)>=100?t.toFixed(0):Math.abs(t)>=10?t.toFixed(1):t.toFixed(2)}function vt(t,n){const[o,e]=t,[r,i]=n,s=(i-r)/(e-o),f=d=>r+(d-o)*s;return f.domain=()=>t,f.range=()=>n,f.ticks=d=>{const a=(e-o)/(d-1),l=[];for(let c=0;c<d;c++)l.push(o+a*c);return l},f}function Pt(t,n){const[o,e]=t.map(l=>Math.max(l,.001)),[r,i]=n,s=Math.log10(o),f=Math.log10(e),d=(i-r)/(f-s),a=l=>{const c=Math.log10(Math.max(l,.001));return r+(c-s)*d};return a.domain=()=>[o,e],a.range=()=>n,a.ticks=l=>{const c=[],h=Math.floor(Math.log10(o)),m=Math.ceil(Math.log10(e));for(let p=h;p<=m;p++){const I=Math.pow(10,p);for(const S of[1,2,5]){const N=I*S;N>=o&&N<=e&&c.push(N)}}return c.length>0?c:[o,e]},a}function kt(t,n){const o=t.data.rows,e=t.theme.axis,r=t.data.scale==="log",i=typeof(e==null?void 0:e.rangeMin)=="number",s=typeof(e==null?void 0:e.rangeMax)=="number";let f;if(i&&s)f=[e.rangeMin,e.rangeMax];else{const a=o.flatMap(l=>[l.lower,l.upper]).filter(l=>l!=null&&!Number.isNaN(l)&&Number.isFinite(l));if(a.length===0)f=r?[.1,10]:[0,1];else{const[l,c]=[Math.min(...a),Math.max(...a)],h=c-l||1;f=[i?e.rangeMin:l-h*dt,s?e.rangeMax:c+h*dt]}}const d=_t(f,r);return r?Pt([Math.max(d[0],.01),Math.max(d[1],.02)],[0,n]):vt(d,[0,n])}function Ct(t,n,o){var i,s;const e=[],r=o.spacing.padding;if((i=t.labels)!=null&&i.title){const f=O(o.typography.fontSizeLg);e.push(`<text x="${r}" y="${n.titleY}"
      font-family="${o.typography.fontFamily}"
      font-size="${f}px"
      font-weight="${o.typography.fontWeightBold}"
      fill="${o.colors.foreground}">${G(t.labels.title)}</text>`)}if((s=t.labels)!=null&&s.subtitle){const f=O(o.typography.fontSizeBase);e.push(`<text x="${r}" y="${n.subtitleY}"
      font-family="${o.typography.fontFamily}"
      font-size="${f}px"
      fill="${o.colors.secondary}">${G(t.labels.subtitle)}</text>`)}return e.join(`
`)}function Xt(t,n,o){var s,f;const e=[],r=o.spacing.padding;let i=n.footerY;if((s=t.labels)!=null&&s.caption){const d=O(o.typography.fontSizeSm);e.push(`<text x="${r}" y="${i}"
      font-family="${o.typography.fontFamily}"
      font-size="${d}px"
      fill="${o.colors.secondary}">${G(t.labels.caption)}</text>`),i+=X.CAPTION_HEIGHT}if((f=t.labels)!=null&&f.footnote){const d=O(o.typography.fontSizeSm);e.push(`<text x="${r}" y="${i}"
      font-family="${o.typography.fontFamily}"
      font-size="${d}px"
      font-style="italic"
      fill="${o.colors.muted}">${G(t.labels.footnote)}</text>`)}return e.join(`
`)}function mt(t,n,o,e,r,i,s,f,d){const a=[],l=O(i.typography.fontSizeSm),c=i.typography.fontWeightMedium,h=i.typography.fontWeightBold,m=st(t),p=f??v.DEFAULT_LABEL_WIDTH,I=E=>{if(d){const A=d.get(E.id);if(A!==void 0)return A}return typeof E.width=="number"?E.width:v.DEFAULT_COLUMN_WIDTH},S=E=>E.isGroup?E.columns.reduce((A,M)=>A+S(M),0):I(E),N=(E,A)=>E+A/2+l*X.TEXT_BASELINE_ADJUSTMENT;if(m){const E=r/2,A=r/2;let M=o;s&&(a.push(`<text x="${M+D.TEXT_PADDING}" y="${N(e,r)}"
        font-family="${i.typography.fontFamily}"
        font-size="${l}px"
        font-weight="${c}"
        fill="${i.colors.foreground}">${G(s)}</text>`),a.push(`<line x1="${M+p}" x2="${M+p}"
        y1="${e}" y2="${e+r}"
        stroke="${i.colors.border}" stroke-width="1" opacity="0.3"/>`),M+=p);for(const H of t)if(H.isGroup){const g=S(H),u=M+g/2;a.push(`<text x="${u}" y="${N(e,E)}"
          font-family="${i.typography.fontFamily}"
          font-size="${l}px"
          font-weight="${h}"
          text-anchor="middle"
          fill="${i.colors.foreground}">${G(H.header)}</text>`),a.push(`<line x1="${M}" x2="${M+g}"
          y1="${e+E}" y2="${e+E}"
          stroke="${i.colors.border}" stroke-width="1" opacity="0.5"/>`),M+=g}else{const g=I(H),u=H.headerAlign??H.align,{textX:y,anchor:$}=nt(M,g,u),x=lt(H.header,g,l,D.TEXT_PADDING);a.push(`<text x="${y}" y="${N(e,r)}"
          font-family="${i.typography.fontFamily}"
          font-size="${l}px"
          font-weight="${c}"
          text-anchor="${$}"
          fill="${i.colors.foreground}">${G(x)}</text>`),M+=g}M=o+(s?p:0);for(const H of t)if(H.isGroup){for(const g of H.columns)if(!g.isGroup){const u=I(g),y=g.headerAlign??g.align,{textX:$,anchor:x}=nt(M,u,y);a.push(`<text x="${$}" y="${N(e+E,A)}"
              font-family="${i.typography.fontFamily}"
              font-size="${l}px"
              font-weight="${c}"
              text-anchor="${x}"
              fill="${i.colors.foreground}">${G(g.header)}</text>`),M+=u}}else{const g=I(H);M+=g}}else{let E=o;s&&(a.push(`<text x="${E+D.TEXT_PADDING}" y="${N(e,r)}"
        font-family="${i.typography.fontFamily}"
        font-size="${l}px"
        font-weight="${c}"
        fill="${i.colors.foreground}">${G(s)}</text>`),E+=p);for(const A of n){const M=I(A),H=A.headerAlign??A.align,{textX:g,anchor:u}=nt(E,M,H),y=lt(A.header,M,l,D.TEXT_PADDING);a.push(`<text x="${g}" y="${N(e,r)}"
        font-family="${i.typography.fontFamily}"
        font-size="${l}px"
        font-weight="${c}"
        text-anchor="${u}"
        fill="${i.colors.foreground}">${G(y)}</text>`),E+=M}}return a.join(`
`)}function Rt(t,n,o,e,r,i,s){const f=[],d=O(s.typography.fontSizeBase),a=e+r/2+d*X.TEXT_BASELINE_ADJUSTMENT,l=n*D.INDENT_PER_LEVEL;return f.push(`<rect x="${o}" y="${e}"
    width="${i}" height="${r}"
    fill="${s.colors.primary}" opacity="${At}"/>`),f.push(`<text x="${o+D.TEXT_PADDING+l}" y="${a}"
    font-family="${s.typography.fontFamily}"
    font-size="${d}px"
    font-weight="${s.typography.fontWeightBold}"
    fill="${s.colors.foreground}">${G(t)}</text>`),f.join(`
`)}function xt(t,n){const o=new Map;for(const e of n)if(e.type==="bar"){let r=0;for(const i of t){const s=i.metadata[e.field];typeof s=="number"&&s>r&&(r=s)}o.set(e.field,r>0?r:1)}return o}function Tt(t,n,o,e,r,i,s,f=v.DEFAULT_LABEL_WIDTH,d=0,a,l){var S,N,E,A,M,H,g,u,y,$,x,b,_,L,F,W;const c=[],h=O(i.typography.fontSizeBase),m=e+r/2+h*X.TEXT_BASELINE_ADJUSTMENT;let p=o;const I=T=>{if(l){const w=l.get(T.id);if(w!==void 0)return w}return typeof T.width=="number"?T.width:v.DEFAULT_COLUMN_WIDTH};if(s){const T=d*D.INDENT_PER_LEVEL+(((S=t.style)==null?void 0:S.indent)??0)*D.INDENT_PER_LEVEL,w=(N=t.style)!=null&&N.bold||(E=t.style)!=null&&E.emphasis?i.typography.fontWeightBold:i.typography.fontWeightNormal,R=(A=t.style)!=null&&A.italic?"italic":"normal";let V=i.colors.foreground;(M=t.style)!=null&&M.color?V=t.style.color:(H=t.style)!=null&&H.muted?V=i.colors.muted:(g=t.style)!=null&&g.accent&&(V=i.colors.accent);const B=f-T-D.TEXT_PADDING*2,P=lt(t.label,B,h,0);if(c.push(`<text x="${p+D.TEXT_PADDING+T}" y="${m}"
      font-family="${i.typography.fontFamily}"
      font-size="${h}px"
      font-weight="${w}"
      font-style="${R}"
      fill="${V}">${G(P)}</text>`),(u=t.style)!=null&&u.badge){const C=String(t.style.badge),k=h*.8,z=4,U=k+z*2,J=t.label.length*h*.55,j=p+D.TEXT_PADDING+T+J+6,ot=C.length*k*.6+z*2,It=e+(r-U)/2;c.push(`<rect x="${j}" y="${It}" width="${ot}" height="${U}"
        rx="3" fill="${i.colors.primary}" opacity="0.15"/>`),c.push(`<text x="${j+ot/2}" y="${It+U/2+k*.35}"
        text-anchor="middle"
        font-family="${i.typography.fontFamily}"
        font-size="${k}px"
        font-weight="500"
        fill="${i.colors.primary}">${G(C)}</text>`)}p+=f}for(const T of n){const w=I(T),R=Ut(t,T),{textX:V,anchor:B}=nt(p,w,T.align);if(T.type==="bar"&&typeof t.metadata[T.field]=="number"){const P=t.metadata[T.field],C=a==null?void 0:a.get(T.field),k=(($=(y=T.options)==null?void 0:y.bar)==null?void 0:$.maxValue)??C??100,z=((b=(x=T.options)==null?void 0:x.bar)==null?void 0:b.color)??i.colors.primary,U=i.shapes.pointSize*2,j=w-D.TEXT_PADDING*2-50,Mt=Math.min(P/k*j,j);c.push(`<rect x="${p+D.TEXT_PADDING}" y="${e+r/2-U/2}"
        width="${Math.max(0,Mt)}" height="${U}"
        fill="${z}" opacity="0.7" rx="2"/>`);const ot=p+w-D.TEXT_PADDING;c.push(`<text x="${ot}" y="${m}"
        font-family="${i.typography.fontFamily}"
        font-size="${h}px"
        text-anchor="end"
        fill="${i.colors.foreground}">${Q(P)}</text>`)}else if(T.type==="sparkline"&&Array.isArray(t.metadata[T.field])){let P=t.metadata[T.field];Array.isArray(P[0])&&(P=P[0]);const C=((L=(_=T.options)==null?void 0:_.sparkline)==null?void 0:L.height)??16,k=((W=(F=T.options)==null?void 0:F.sparkline)==null?void 0:W.color)??i.colors.primary,z=D.TEXT_PADDING*2,U=Ot(P,p+D.TEXT_PADDING,e+r/2-C/2,w-z,C);c.push(`<path d="${U}" fill="none" stroke="${k}" stroke-width="1.5"/>`)}else c.push(`<text x="${V}" y="${m}"
        font-family="${i.typography.fontFamily}"
        font-size="${h}px"
        text-anchor="${B}"
        fill="${i.colors.foreground}">${G(R)}</text>`);p+=w}return c.join(`
`)}function Ut(t,n){var e,r,i,s,f,d,a,l,c,h,m,p,I,S,N,E,A,M,H;if(n.type==="interval"){const g=(r=(e=n.options)==null?void 0:e.interval)!=null&&r.point?t.metadata[n.options.interval.point]:t.point,u=(s=(i=n.options)==null?void 0:i.interval)!=null&&s.lower?t.metadata[n.options.interval.lower]:t.lower,y=(d=(f=n.options)==null?void 0:f.interval)!=null&&d.upper?t.metadata[n.options.interval.upper]:t.upper;return pt(g,u,y,n.options)}if(n.type==="numeric"){const g=t.metadata[n.field];return typeof g=="number"?Q(g,n.options):((a=n.options)==null?void 0:a.naText)??""}if(n.type==="custom"&&((l=n.options)!=null&&l.events))return ht(t,n.options);if(n.type==="pvalue"){const g=t.metadata[n.field];return typeof g!="number"?((c=n.options)==null?void 0:c.naText)??"":gt(g,n.options)}if(n.type==="icon"){const g=t.metadata[n.field];if(g==null)return"";const u=String(g),y=(m=(h=n.options)==null?void 0:h.icon)==null?void 0:m.mapping;return y&&u in y?y[u]:u}if(n.type==="badge"){const g=t.metadata[n.field];return g!=null?String(g):""}if(n.type==="stars"){const g=t.metadata[n.field];if(typeof g!="number")return"";const u=((I=(p=n.options)==null?void 0:p.stars)==null?void 0:I.maxStars)??5,y=Math.max(0,Math.min(u,g)),$=Math.floor(y),x=u-$;return"★".repeat($)+"☆".repeat(x)}if(n.type==="img")return((N=(S=n.options)==null?void 0:S.img)==null?void 0:N.fallback)??"[IMG]";if(n.type==="reference"){const g=t.metadata[n.field];if(g==null)return"";const u=String(g),y=((A=(E=n.options)==null?void 0:E.reference)==null?void 0:A.maxChars)??30;return u.length<=y?u:u.substring(0,y)+"..."}if(n.type==="range"){const g=(M=n.options)==null?void 0:M.range;if(!g)return"";const u=t.metadata[g.minField],y=t.metadata[g.maxField],$=g.separator??" – ",x=g.decimals,b=_=>typeof _!="number"?"":x==null?Number.isInteger(_)?String(_):_.toFixed(1):_.toFixed(x);return u===null&&y===null?"":u===null?b(y):y===null?b(u):`${b(u)}${$}${b(y)}`}const o=t.metadata[n.field];return o!=null?String(o):((H=n.options)==null?void 0:H.naText)??""}function Ot(t,n,o,e,r){const i=t.filter(l=>Number.isFinite(l));if(i.length===0)return"";if(i.length===1){const l=n+e/2,c=o+r/2;return`M${l.toFixed(1)},${c.toFixed(1)}`}const s=Math.min(...i),d=Math.max(...i)-s||1;return`M${i.map((l,c)=>{const h=n+c/(i.length-1)*e,m=o+r-(l-s)/d*r;return`${h.toFixed(1)},${m.toFixed(1)}`}).join("L")}`}const bt=6;function ct(t,n,o){const e=t.metadata[n];return e!=null&&typeof e=="number"&&!Number.isNaN(e)?e:o}function Vt(t,n){return n<=1?0:-((n-1)*bt)/2+t*bt}function Bt(t,n,o,e,r,i=[],s,f=0,d=1/0){var g;let a;i.length===0?a=[{point:t.point,lower:t.lower,upper:t.upper,color:null,shape:null,opacity:null}]:a=i.map(u=>({point:ct(t,u.pointCol,t.point),lower:ct(t,u.lowerCol,t.lower),upper:ct(t,u.upperCol,t.upper),color:u.color??null,shape:u.shape??null,opacity:u.opacity??null}));const l=a.filter(u=>u.point!=null&&!Number.isNaN(u.point)&&u.lower!=null&&!Number.isNaN(u.lower)&&u.upper!=null&&!Number.isNaN(u.upper));if(l.length===0)return"";const c=e.shapes.pointSize,h=e.shapes.lineWidth,m=e.colors.intervalLine,p=D.WHISKER_HALF_HEIGHT,I=((g=t.style)==null?void 0:g.type)==="summary",N=e.shapes.summaryHeight/2;function E(u){var $;if(u&&(($=t.markerStyle)==null?void 0:$.size)!=null)return c*t.markerStyle.size;const y=s?t.metadata[s]:void 0;if(y){const x=.5+Math.sqrt(y/100)*1.5;return Math.min(Math.max(c*x,3),c*2.5)}return c}function A(u,y){const $=y===0,x=t.markerStyle,b=e.shapes.markerColors,_=e.shapes.markerShapes,L=["square","circle","diamond","triangle"];let F;$&&(x!=null&&x.color)?F=x.color:u.color?F=u.color:b&&b.length>0?F=b[y%b.length]:F=e.colors.interval??e.colors.primary??"#2563eb";let W;$&&(x!=null&&x.shape)?W=x.shape:u.shape?W=u.shape:_&&_.length>0?W=_[y%_.length]:W=L[y%L.length];let T;return $&&(x==null?void 0:x.opacity)!=null?T=x.opacity:u.opacity!=null?T=u.opacity:T=1,{color:F,shape:W,opacity:T}}function M(u,y,$,x){const{color:b,shape:_,opacity:L}=x,F=L<1?` fill-opacity="${L}"`:"";switch(_){case"circle":return`<circle cx="${u}" cy="${y}" r="${$}" fill="${b}"${F}/>`;case"diamond":return`<polygon points="${[`${u},${y-$}`,`${u+$},${y}`,`${u},${y+$}`,`${u-$},${y}`].join(" ")}" fill="${b}"${F}/>`;case"triangle":return`<polygon points="${[`${u},${y-$}`,`${u+$},${y+$}`,`${u-$},${y+$}`].join(" ")}" fill="${b}"${F}/>`;default:return`<rect x="${u-$}" y="${y-$}" width="${$*2}" height="${$*2}" fill="${b}"${F}/>`}}const H=[];return l.forEach((u,y)=>{const $=n+Vt(y,l.length),x=o(u.lower),b=o(u.upper),_=o(u.point),L=A(u,y),F=E(y===0),W=m;if(I){const T=L.opacity<1?` fill-opacity="${L.opacity}"`:"",w=[`${x},${$}`,`${_},${$-N}`,`${b},${$}`,`${_},${$+N}`].join(" ");H.push(`
        <g class="interval effect-${y} summary">
          <polygon points="${w}"
            fill="${L.color}"${T} stroke="${e.colors.summaryBorder}" stroke-width="1"/>
        </g>`)}else{const T=f,w=f+d,R=x<T,V=b>w,B=Math.max(T,Math.min(w,x)),P=Math.max(T,Math.min(w,b));let C="";R?C=`<path d="M ${T+4} ${$} L ${T+10} ${$-4} L ${T+10} ${$+4} Z" fill="${W}"/>`:C=`<line x1="${B}" x2="${B}" y1="${$-p}" y2="${$+p}" stroke="${W}" stroke-width="${h}"/>`;let k="";V?k=`<path d="M ${w-4} ${$} L ${w-10} ${$-4} L ${w-10} ${$+4} Z" fill="${W}"/>`:k=`<line x1="${P}" x2="${P}" y1="${$-p}" y2="${$+p}" stroke="${W}" stroke-width="${h}"/>`,H.push(`
        <g class="interval effect-${y}">
          <line x1="${B}" x2="${P}" y1="${$}" y2="${$}"
            stroke="${W}" stroke-width="${h}"/>
          ${C}
          ${k}
          ${M(_,$,F,L)}
        </g>`)}}),H.join("")}function zt(t,n,o,e,r,i,s,f){const a=f.shapes.summaryHeight/2,l=r(n),c=r(t),h=r(o),m=i+Math.max(0,Math.min(s,l)),p=i+Math.max(0,Math.min(s,c)),I=i+Math.max(0,Math.min(s,h));return`<polygon points="${[`${m},${e}`,`${p},${e-a}`,`${I},${e}`,`${p},${e+a}`].join(" ")}"
    fill="${f.colors.summaryFill}"
    stroke="${f.colors.summaryBorder}"
    stroke-width="1"/>`}function jt(t,n,o,e,r){const i=[],s=typeof o.axis.tickCount=="number"?o.axis.tickCount:D.DEFAULT_TICK_COUNT,f=Array.isArray(o.axis.tickValues)?o.axis.tickValues:t.ticks(s),d=O(o.typography.fontSizeSm);i.push(`<line x1="${r}" x2="${r+n.forestWidth}"
    y1="0" y2="0" stroke="${o.colors.border}" stroke-width="1"/>`);for(const a of f){const l=r+t(a);i.push(`<line x1="${l}" x2="${l}" y1="0" y2="4"
      stroke="${o.colors.border}" stroke-width="1"/>`),i.push(`<text x="${l}" y="16" text-anchor="middle"
      font-family="${o.typography.fontFamily}"
      font-size="${d}px"
      fill="${o.colors.secondary}">${Gt(a)}</text>`)}return e&&i.push(`<text x="${r+n.forestWidth/2}" y="28"
      text-anchor="middle"
      font-family="${o.typography.fontFamily}"
      font-size="${d}px"
      font-weight="500"
      fill="${o.colors.secondary}">${G(e)}</text>`),`<g transform="translate(0, ${n.mainY+n.headerHeight+n.plotHeight})">${i.join(`
`)}</g>`}function Et(t,n,o,e,r,i,s=1,f=.6){let a=`<line x1="${t}" x2="${t}" y1="${n}" y2="${o}"
    stroke="${r}" stroke-width="${s}" stroke-opacity="${f}" stroke-dasharray="${e==="dashed"?"6,4":e==="dotted"?"2,2":"none"}"/>`;return i&&(a+=`<text x="${t}" y="${n-4}" text-anchor="middle"
      font-size="10px" fill="${r}">${G(i)}</text>`),a}class K extends Error{constructor(n){super(`SVG Generator: ${n}`),this.name="SVGGeneratorError"}}function Yt(t){if(!t||typeof t!="object")throw new K("Invalid spec: expected an object");const n=t;if(!n.data||typeof n.data!="object")throw new K("Invalid spec: missing or invalid 'data' property");const o=n.data;if(!Array.isArray(o.rows))throw new K("Invalid spec: 'data.rows' must be an array");if(!n.theme||typeof n.theme!="object")throw new K("Invalid spec: missing or invalid 'theme' property");const e=n.theme;if(!e.colors||typeof e.colors!="object")throw new K("Invalid spec: missing or invalid 'theme.colors'");if(!e.typography||typeof e.typography!="object")throw new K("Invalid spec: missing or invalid 'theme.typography'");if(!e.spacing||typeof e.spacing!="object")throw new K("Invalid spec: missing or invalid 'theme.spacing'")}function Jt(t,n={}){Yt(t);const o=t.theme,e=Ft(t,n),r=o.spacing.padding,i=Array.isArray(t.columns)?t.columns:[],s=et(i,"left"),f=et(i,"right"),d=tt(i,"left"),a=tt(i,"right"),l=e.labelWidth+d.reduce((g,u)=>g+at(u,e.autoWidths),0),c=r+l,h=kt(t,e.forestWidth),m=c+e.forestWidth,p=[];p.push(`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg"
  width="${e.totalWidth}" height="${e.totalHeight}"
  viewBox="0 0 ${e.totalWidth} ${e.totalHeight}">`);const I=n.backgroundColor??o.colors.background;p.push(`<rect width="100%" height="100%" fill="${I}"/>`),p.push(Ct(t,e,o));const S=e.mainY;p.push(mt(s,d,r,S,e.headerHeight,o,t.data.labelHeader??"Study",e.labelWidth,e.autoWidths)),a.length>0&&p.push(mt(f,a,m,S,e.headerHeight,o,void 0,void 0,e.autoWidths)),p.push(`<line x1="${r}" x2="${e.totalWidth-r}"
    y1="${S+e.headerHeight}" y2="${S+e.headerHeight}"
    stroke="${o.colors.border}" stroke-width="1"/>`);const N=$t(t);if(t.data.includeForest&&e.forestWidth>0){const g=e.mainY+e.headerHeight,u=c+h(t.data.nullValue);p.push(Et(u,g,g+e.plotHeight,"dashed",o.colors.muted));const y=Array.isArray(t.annotations)?t.annotations:[];for(const $ of y)if($.type==="reference_line"){const x=c+h($.x);p.push(Et(x,g,g+e.plotHeight,$.style,$.color??o.colors.accent,$.label,$.width??1,$.opacity??.6))}if(N.forEach(($,x)=>{if($.type==="data"){const b=g+x*e.rowHeight+e.rowHeight/2;p.push(Bt($.row,b,_=>c+h(_),o,t.data.nullValue,t.data.effects,t.data.weightCol,c,e.forestWidth))}}),t.data.overall&&e.showOverallSummary&&typeof t.data.overall.point=="number"&&!Number.isNaN(t.data.overall.point)&&typeof t.data.overall.lower=="number"&&!Number.isNaN(t.data.overall.lower)&&typeof t.data.overall.upper=="number"&&!Number.isNaN(t.data.overall.upper)){const $=g+e.summaryYPosition;p.push(zt(t.data.overall.point,t.data.overall.lower,t.data.overall.upper,$,h,c,e.forestWidth,o))}p.push(jt(h,e,o,t.data.axisLabel,c))}const E=e.mainY+e.headerHeight,A=t.data.rows,M=xt(A,d),H=xt(A,a);return N.forEach((g,u)=>{var $,x;const y=E+u*e.rowHeight;if(g.type==="group_header")p.push(Rt(g.label,g.depth,r,y,e.rowHeight,e.totalWidth-r*2,o));else{const b=g.row,_=g.depth,L=Ht(_),F=u%2===1?Nt:0,W=Math.max(L,F);W>0&&p.push(`<rect x="${r}" y="${y}"
          width="${e.totalWidth-r*2}" height="${e.rowHeight}"
          fill="${o.colors.muted}" opacity="${W}"/>`),p.push(Tt(b,d,r,y,e.rowHeight,o,!0,e.labelWidth,_,M,e.autoWidths)),a.length>0&&p.push(Tt(b,a,m,y,e.rowHeight,o,!1,0,_,H,e.autoWidths))}if(g.type==="data"){const b=g.row,_=(($=b.style)==null?void 0:$.type)==="summary",L=((x=b.style)==null?void 0:x.type)==="spacer";_&&p.push(`<line x1="${r}" x2="${e.totalWidth-r}"
          y1="${y}" y2="${y}"
          stroke="${o.colors.border}" stroke-width="2"/>`),L||p.push(`<line x1="${r}" x2="${e.totalWidth-r}"
          y1="${y+e.rowHeight}" y2="${y+e.rowHeight}"
          stroke="${o.colors.border}" stroke-width="1" opacity="0.5"/>`)}else p.push(`<line x1="${r}" x2="${e.totalWidth-r}"
        y1="${y+e.rowHeight}" y2="${y+e.rowHeight}"
        stroke="${o.colors.border}" stroke-width="1" opacity="0.5"/>`)}),p.push(Xt(t,e,o)),p.push("</svg>"),p.join(`
`)}function Kt(t,n){const o=JSON.parse(t);return Jt(o,n)}globalThis.generateSVG=Kt})();
