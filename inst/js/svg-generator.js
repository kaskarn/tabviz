(function(){"use strict";function Dt(t,n){if(n){const f=[.05,.1,.15,.2,.25,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2,1.3,1.4,1.5,1.75,2,2.5,3,4,5,6,7,8,10,12,15,20,25,30,40,50,75,100];let r=f[0];for(const c of f)if(c<=t[0])r=c;else break;let d=f[f.length-1];for(let c=f.length-1;c>=0&&f[c]>=t[1];c--)d=f[c];return[r,d]}const o=t[1]-t[0];if(o===0)return t;const e=Math.pow(10,Math.floor(Math.log10(o))),i=o/e;let a;i<=1?a=e*.1:i<=2?a=e*.2:i<=5?a=e*.5:a=e;const l=Math.floor(t[0]/a)*a,y=Math.ceil(t[1]/a)*a;return[l,y]}const Wt=.06,pt=.04;function Ht(t){return t<=0?0:pt+t*pt}const st={RENDERING_BUFFER:4},K={FONT_SCALE:.8,PADDING:4,GAP:6},k={DEFAULT_LABEL_WIDTH:200,DEFAULT_COLUMN_WIDTH:100,AXIS_HEIGHT:32,AXIS_LABEL_HEIGHT:20,BOTTOM_MARGIN:16,MIN_FOREST_WIDTH:200,DEFAULT_WIDTH:800,COLUMN_GAP:16},z={TITLE_HEIGHT:28,SUBTITLE_HEIGHT:20,CAPTION_HEIGHT:16,FOOTNOTE_HEIGHT:14,DEFAULT_FONT_SIZE:14,REM_BASE:16,TEXT_BASELINE_ADJUSTMENT:1/3},G={INDENT_PER_LEVEL:12,TEXT_PADDING:10,WHISKER_HALF_HEIGHT:4,DEFAULT_TICK_COUNT:5,AXIS_LABEL_PADDING:30},gt={GROUP_HEADER_HEIGHT_MULTIPLIER:1.3,OVERALL_ROW_HEIGHT_MULTIPLIER:1.5},q={MIN:60,MAX:600,LABEL_MAX:400,VISUAL_MIN:{sparkline:92,bar:100,stars:84,range:84,badge:74}},Q={CHEVRON_WIDTH:12,GAP:6,SAFETY_MARGIN:8};function tt(t,n){const o=t.split(".");return o[0]=o[0].replace(/\B(?=(\d{3})+(?!\d))/g,n),o.join(".")}function lt(t){const n=Math.abs(t),o=t<0?"-":"";if(n>=1e12)throw new Error(`Cannot abbreviate value >= 1 trillion: ${t}`);if(n>=1e9){const e=n/1e9;return o+ct(e)+"B"}if(n>=1e6){const e=n/1e6;return o+ct(e)+"M"}if(n>=1e3){const e=n/1e3;return o+ct(e)+"K"}return o+Math.round(n).toString()}function ct(t){const n=Math.round(t*10)/10;return n===Math.floor(n)?n.toFixed(0):n.toFixed(1)}const Lt={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","-":"⁻","+":"⁺"};function Ft(t){return t.split("").map(n=>Lt[n]??n).join("")}function et(t,n){var y,f,r,d,c;if(t==null||Number.isNaN(t))return(n==null?void 0:n.naText)??"";if(n!=null&&n.percent){const{decimals:s,digits:h,multiply:g=!0,symbol:E=!0}=n.percent,N=g?t*100:t,S=h!=null?N.toPrecision(h):N.toFixed(s??1);return E?`${S}%`:S}if(((y=n==null?void 0:n.numeric)==null?void 0:y.abbreviate)&&Math.abs(t)>=1e3)return lt(t);const e=(f=n==null?void 0:n.numeric)==null?void 0:f.digits;if(e!=null){const s=t.toPrecision(e),h=(r=n==null?void 0:n.numeric)==null?void 0:r.thousandsSep;return h&&typeof h=="string"?tt(s,h):s}const i=(d=n==null?void 0:n.numeric)==null?void 0:d.decimals,a=(c=n==null?void 0:n.numeric)==null?void 0:c.thousandsSep;let l;return i!==void 0?l=t.toFixed(i):Number.isInteger(t)||Math.abs(t-Math.round(t))<1e-4?l=Math.round(t).toString():l=t.toFixed(2),a&&typeof a=="string"&&(l=tt(l,a)),l}function mt(t,n){const{eventsField:o,nField:e,separator:i="/",showPct:a=!1,thousandsSep:l,abbreviate:y}=n.events,f=t.metadata[o],r=t.metadata[e];if(f==null||r===void 0||r===null)return n.naText??"";const d=Number(f),c=Number(r);let s,h;y&&(d>=1e3||c>=1e3)?(s=d>=1e3?lt(d):String(d),h=c>=1e3?lt(c):String(c)):(s=String(d),h=String(c),l&&typeof l=="string"&&(s=tt(s,l),h=tt(h,l)));let g=`${s}${i}${h}`;if(a&&c>0){const E=(d/c*100).toFixed(1);g+=` (${E}%)`}return g}function yt(t,n,o,e){var y,f,r;if(t==null||Number.isNaN(t))return"";const i=((y=e==null?void 0:e.interval)==null?void 0:y.decimals)??2,a=((f=e==null?void 0:e.interval)==null?void 0:f.sep)??" ",l=(r=e==null?void 0:e.interval)==null?void 0:r.impreciseThreshold;return n==null||o===void 0||o===null||Number.isNaN(n)||Number.isNaN(o)?t.toFixed(i):l!=null&&n>0&&o/n>l?"—":`${t.toFixed(i)}${a}(${n.toFixed(i)}, ${o.toFixed(i)})`}function $t(t,n){if(t==null||Number.isNaN(t))return(n==null?void 0:n.naText)??"";const o=n==null?void 0:n.pvalue,e=(o==null?void 0:o.digits)??2,i=(o==null?void 0:o.expThreshold)??.001,a=(o==null?void 0:o.abbrevThreshold)??null,l=(o==null?void 0:o.format)??"auto",y=(o==null?void 0:o.stars)??!1,f=(o==null?void 0:o.thresholds)??[.05,.01,.001];let r="";if(y&&(t<f[2]?r="***":t<f[1]?r="**":t<f[0]&&(r="*")),a!==null&&t<a)return`<${a}${r}`;if(l==="scientific"||l==="auto"&&t<i){const c=Math.floor(Math.log10(t));return`${(t/Math.pow(10,c)).toPrecision(e)}×10${Ft(c.toString())}${r}`}let d;return t>=.1?d=t.toFixed(e):t>=.01?d=t.toFixed(e+1):d=t.toFixed(e+2),`${d}${r}`}function Gt(t,n){var a,l,y,f;const{type:o,field:e,options:i}=n;switch(o){case"interval":{const r=(a=i==null?void 0:i.interval)!=null&&a.point?t.metadata[i.interval.point]:t.point,d=(l=i==null?void 0:i.interval)!=null&&l.lower?t.metadata[i.interval.lower]:t.lower,c=(y=i==null?void 0:i.interval)!=null&&y.upper?t.metadata[i.interval.upper]:t.upper;return yt(r,d,c,i)}case"custom":return i!=null&&i.events?mt(t,i):String(t.metadata[e]??"");case"pvalue":return $t(t.metadata[e],i);case"numeric":return et(t.metadata[e],i);case"percent":return et(t.metadata[e],i);case"sparkline":case"icon":case"stars":case"img":case"range":return"";case"badge":{const r=t.metadata[e];return r==null?"":`  ${String(r)}  `}case"bar":{if(((f=i==null?void 0:i.bar)==null?void 0:f.showLabel)===!1)return"";const r=t.metadata[e];return r==null?"":r>=100?r.toFixed(0):r>=10?r.toFixed(1):r.toFixed(2)}case"text":default:return String(t.metadata[e]??"")}}function V(t,n){const o="⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻";let e=0;for(const i of t)o.includes(i)?e+=n*.3:"il1.,;:|!()[]{}' ".includes(i)?e+=n*.35:"×−".includes(i)?e+=n*.5:"mwMW@%".includes(i)?e+=n*.85:i>="0"&&i<="9"?e+=n*.6:e+=n*.55;return e}function wt(t,n){var r,d;const o=new Map,e=Y(t.theme.typography.fontSizeBase),i=t.theme.typography.headerFontScale??1.05,a=e*i,l=t.data.rows,y=(t.theme.spacing.cellPaddingX??10)*2,f=(t.theme.spacing.groupPadding??8)*2;for(const c of n){if(c.width!=="auto"&&c.width!==null&&c.width!==void 0)continue;let s=0;c.header&&(s=Math.max(s,V(c.header,a)));for(const E of l){if(((r=E.style)==null?void 0:r.type)==="header"||((d=E.style)==null?void 0:d.type)==="spacer")continue;const N=Gt(E,c);N&&(s=Math.max(s,V(N,e)))}const h=q.VISUAL_MIN[c.type]??q.MIN,g=Math.ceil(s+y+st.RENDERING_BUFFER);o.set(c.id,Math.min(q.MAX,Math.max(h,g)))}return Pt(t.columns,o,a,f,st.RENDERING_BUFFER),o}function Pt(t,n,o,e,i){function a(f){return f.isGroup?f.columns.flatMap(a):[f]}function l(f){const r=n.get(f.id);return r!==void 0?r:typeof f.width=="number"?f.width:q.MIN}function y(f){if(f.isGroup){for(const r of f.columns)y(r);if(f.header){const r=V(f.header,o)+e+i,d=a(f),c=d.reduce((s,h)=>s+l(h),0);if(r>c&&d.length>0){const s=Math.ceil((r-c)/d.length);for(const h of d)n.set(h.id,l(h)+s)}}}}for(const f of t)y(f)}function xt(t){var f,r;const n=Y(t.theme.typography.fontSizeBase),o=(t.theme.spacing.cellPaddingX??10)*2;let e=0;const i=new Map,a=Array.isArray(t.data.groups)?t.data.groups:[];for(const d of a)i.set(d.id,d.depth);const l=d=>d?(i.get(d)??0)+1:0;t.data.labelHeader&&(e=Math.max(e,V(t.data.labelHeader,n)));for(const d of t.data.rows)if(d.label){const c=l(d.groupId),s=((f=d.style)==null?void 0:f.indent)??0,g=(c+s)*G.INDENT_PER_LEVEL;let E=V(d.label,n)+g;if((r=d.style)!=null&&r.badge){const N=String(d.style.badge),S=n*K.FONT_SCALE,H=V(N,S)+K.PADDING*2;E+=K.GAP+H}e=Math.max(e,E)}for(const d of a)if(d.label){const c=d.depth*G.INDENT_PER_LEVEL,s=V(d.label,n),g=`(${countAllDescendantRows(d.id)})`,E=n*.75,N=V(g,E),S=c+Q.CHEVRON_WIDTH+Q.GAP+s+Q.GAP+N+Q.SAFETY_MARGIN;e=Math.max(e,S)}const y=Math.ceil(e+o+st.RENDERING_BUFFER);return Math.min(q.LABEL_MAX,Math.max(q.MIN,y))}function dt(t,n){const o=n.get(t.id);return o!==void 0?o:typeof t.width=="number"?t.width:k.DEFAULT_COLUMN_WIDTH}function kt(t,n){var P,X,R,B,J;const o=t.theme,e=o.spacing.rowHeight,i=o.spacing.padding,a=Array.isArray(t.columns)?t.columns:[],l=ot(a,"left"),y=ot(a,"right"),r=ut(l)||ut(y)?o.spacing.headerHeight*gt.GROUP_HEADER_HEIGHT_MULTIPLIER:o.spacing.headerHeight,d=!!((P=t.labels)!=null&&P.title),c=!!((X=t.labels)!=null&&X.subtitle),s=!!((R=t.labels)!=null&&R.caption),h=!!((B=t.labels)!=null&&B.footnote),g=d?z.TITLE_HEIGHT:0,E=c?z.SUBTITLE_HEIGHT:0,N=g+E+(d||c?i:0),S=s?z.CAPTION_HEIGHT:0,F=h?z.FOOTNOTE_HEIGHT:0,H=S+F+(s||h?i:0),I=Tt(t),T=!!t.data.overall;let u=0;for(const U of I){const j=U.type==="data"&&((J=U.row.style)==null?void 0:J.type)==="spacer";u+=j?e/2:e}T&&(u+=e*gt.OVERALL_ROW_HEIGHT_MULTIPLIER);const p=nt(a,"left"),m=nt(a,"right"),$=[...p,...m];let b,D;if(n.columnWidths){b=new Map;for(const[U,j]of Object.entries(n.columnWidths))U!=="__label__"&&b.set(U,j);D=n.columnWidths.__label__??xt(t)}else b=wt(t,$),D=xt(t);const M=D+p.reduce((U,j)=>U+dt(j,b),0),L=m.reduce((U,j)=>U+dt(j,b),0),W=n.width??k.DEFAULT_WIDTH,A=t.data.includeForest,_=M+L;let x;if(!A)x=0;else if(typeof n.forestWidth=="number")x=n.forestWidth;else if(typeof t.layout.plotWidth=="number")x=t.layout.plotWidth;else{const U=W-_-k.COLUMN_GAP*2-i*2;x=Math.max(U,k.MIN_FOREST_WIDTH)}const w=i*2+_+x+k.COLUMN_GAP*2,v=Math.max(n.width??W,w),O=N+i+r+u+k.AXIS_HEIGHT+k.AXIS_LABEL_HEIGHT+H+k.BOTTOM_MARGIN;return{totalWidth:v,totalHeight:n.height??O,tableWidth:M+L,forestWidth:x,headerHeight:r,rowHeight:e,plotHeight:u,axisHeight:k.AXIS_HEIGHT,nullValue:t.data.nullValue,summaryYPosition:u-e,showOverallSummary:T,headerTextHeight:N,footerTextHeight:H,titleY:i+z.TITLE_HEIGHT-8,subtitleY:i+g+z.SUBTITLE_HEIGHT-4,mainY:N+i,footerY:N+i+r+u+k.AXIS_HEIGHT+k.AXIS_LABEL_HEIGHT+i,autoWidths:b,labelWidth:D}}function Tt(t){var c;const n=t.data.rows,o=Array.isArray(t.data.groups)?t.data.groups:[];if(o.length===0)return n.map(s=>({type:"data",row:s,depth:0}));const e=new Map;for(const s of o)e.set(s.id,s);const i=new Map;for(const s of n){const h=s.groupId??null;i.has(h)||i.set(h,[]),i.get(h).push(s)}const a=new Set;for(const s of i.keys()){if(!s)continue;let h=s;for(;h;)a.add(h),h=(c=e.get(h))==null?void 0:c.parentId}function l(s){return o.filter(h=>(h.parentId??null)===s&&a.has(h.id))}function y(s){if(!s)return 0;const h=e.get(s);return h?h.depth+1:0}function f(s){var g;let h=((g=i.get(s))==null?void 0:g.length)??0;for(const E of l(s))h+=f(E.id);return h}const r=[];function d(s){if(s){const g=e.get(s);if(!g)return;const E=f(s);r.push({type:"group_header",groupId:g.id,label:g.label,depth:g.depth,rowCount:E})}for(const g of l(s))d(g.id);const h=i.get(s)??[];for(const g of h)r.push({type:"data",row:g,depth:y(g.groupId)})}return d(null),r}function bt(t){const n=[];for(const o of t)o.isGroup?n.push(...bt(o.columns)):n.push(o);return n}function nt(t,n){const o=[];for(const e of t)e.position===n&&(e.isGroup?o.push(...bt(e.columns)):o.push(e));return o}function ot(t,n){return t.filter(o=>o.position===n)}function ut(t){return t.some(n=>n.isGroup)}function Y(t){return t.endsWith("rem")?parseFloat(t)*z.REM_BASE:t.endsWith("px")?parseFloat(t):z.DEFAULT_FONT_SIZE}function rt(t,n,o){return o==="right"?{textX:t+n-G.TEXT_PADDING,anchor:"end"}:o==="center"?{textX:t+n/2,anchor:"middle"}:{textX:t+G.TEXT_PADDING,anchor:"start"}}function C(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function ft(t,n,o,e=0){const i=n-e*2;if(V(t,o)<=i)return t;const l="…",y=o*.55;let f=0,r=t.length;for(;f<r;){const d=Math.ceil((f+r)/2),c=t.slice(0,d);V(c,o)+y<=i?f=d:r=d-1}return f===0?l:t.slice(0,f)+l}function vt(t){return Math.abs(t)<.01?"0":Math.abs(t)>=100?t.toFixed(0):Math.abs(t)>=10?t.toFixed(1):t.toFixed(2)}function Et(t,n){const[o,e]=t,[i,a]=n,l=(a-i)/(e-o),y=f=>i+(f-o)*l;return y.domain=()=>t,y.range=()=>n,y.ticks=f=>{const r=(e-o)/(f-1),d=[];for(let c=0;c<f;c++)d.push(o+r*c);return d},y}function Mt(t,n){const[o,e]=t.map(d=>Math.max(d,.001)),[i,a]=n,l=Math.log10(o),y=Math.log10(e),f=(a-i)/(y-l),r=d=>{const c=Math.log10(Math.max(d,.001));return i+(c-l)*f};return r.domain=()=>[o,e],r.range=()=>n,r.ticks=d=>{const c=[],s=Math.floor(Math.log10(o)),h=Math.ceil(Math.log10(e));for(let g=s;g<=h;g++){const E=Math.pow(10,g);for(const N of[1,2,5]){const S=E*N;S>=o&&S<=e&&c.push(S)}}return c.length>0?c:[o,e]},r}function Rt(t,n,o){const e=t.data.scale==="log";if(o!=null&&o.xDomain){const T=o.xDomain;return e?Mt([Math.max(T[0],.01),Math.max(T[1],.02)],[0,n]):Et(T,[0,n])}const i=t.data.rows,a=t.theme.axis,l=t.data.nullValue,y=(a==null?void 0:a.padding)??.15,f=(a==null?void 0:a.includeNull)??!0,r=a==null?void 0:a.symmetric,d=(a==null?void 0:a.markerMargin)??!0,c=(a==null?void 0:a.ciTruncationThreshold)??3,s=typeof(a==null?void 0:a.rangeMin)=="number",h=typeof(a==null?void 0:a.rangeMax)=="number";let g;if(s&&h)g=[a.rangeMin,a.rangeMax];else{const T=i.map(u=>u.point).filter(u=>u!=null&&!Number.isNaN(u)&&Number.isFinite(u));if(T.length===0)g=e?[.1,10]:[0,1];else{let u=Math.min(...T),p=Math.max(...T);f&&(u=Math.min(u,l),p=Math.max(p,l));const m=u,$=p,b=p-u||1,D=b*c,M=i.map(x=>x.lower).filter(x=>x!=null&&!Number.isNaN(x)&&Number.isFinite(x)),L=i.map(x=>x.upper).filter(x=>x!=null&&!Number.isNaN(x)&&Number.isFinite(x));for(const x of M)u-x<=D&&(u=Math.min(u,x));for(const x of L)x-p<=D&&(p=Math.max(p,x));let W=s?a.rangeMin:u-b*y,A=h?a.rangeMax:p+b*y;if(r===!0&&!s&&!h)if(e){const x=Math.log(l),w=Math.max(Math.abs(Math.log(Math.max(m,.001))-x),Math.abs(Math.log($)-x));W=Math.exp(x-w),A=Math.exp(x+w)}else{const x=Math.max(Math.abs(m-l),Math.abs($-l));W=l-x,A=l+x}g=[W,A]}}const E=Dt(g,e),N=G.AXIS_LABEL_PADDING,S=n-2*N;let F=E;if(d&&S>0){const T=t.theme.shapes.pointSize,u=E[1]-E[0],p=T/2*(u/S);if(e){const m=p/E[0];F=[E[0]/(1+m),E[1]*(1+m)]}else F=[E[0]-p,E[1]+p]}const H=N,I=Math.max(n-N,H+50);return e?Mt([Math.max(F[0],.01),Math.max(F[1],.02)],[H,I]):Et(F,[H,I])}function Bt(t,n,o){var a,l;const e=[],i=o.spacing.padding;if((a=t.labels)!=null&&a.title){const y=Y(o.typography.fontSizeLg);e.push(`<text x="${i}" y="${n.titleY}"
      font-family="${o.typography.fontFamily}"
      font-size="${y}px"
      font-weight="${o.typography.fontWeightBold}"
      fill="${o.colors.foreground}">${C(t.labels.title)}</text>`)}if((l=t.labels)!=null&&l.subtitle){const y=Y(o.typography.fontSizeBase);e.push(`<text x="${i}" y="${n.subtitleY}"
      font-family="${o.typography.fontFamily}"
      font-size="${y}px"
      fill="${o.colors.secondary}">${C(t.labels.subtitle)}</text>`)}return e.join(`
`)}function Ct(t,n,o){var l,y;const e=[],i=o.spacing.padding;let a=n.footerY;if((l=t.labels)!=null&&l.caption){const f=Y(o.typography.fontSizeSm);e.push(`<text x="${i}" y="${a}"
      font-family="${o.typography.fontFamily}"
      font-size="${f}px"
      fill="${o.colors.secondary}">${C(t.labels.caption)}</text>`),a+=z.CAPTION_HEIGHT}if((y=t.labels)!=null&&y.footnote){const f=Y(o.typography.fontSizeSm);e.push(`<text x="${i}" y="${a}"
      font-family="${o.typography.fontFamily}"
      font-size="${f}px"
      font-style="italic"
      fill="${o.colors.muted}">${C(t.labels.footnote)}</text>`)}return e.join(`
`)}function Nt(t,n,o,e,i,a,l,y,f){const r=[],d=Y(a.typography.fontSizeBase),c=a.typography.headerFontScale??1.05,s=d*c,h=a.typography.fontWeightMedium,g=a.typography.fontWeightBold,E=ut(t),N=y??k.DEFAULT_LABEL_WIDTH,S=I=>{if(f){const T=f.get(I.id);if(T!==void 0)return T}return typeof I.width=="number"?I.width:k.DEFAULT_COLUMN_WIDTH},F=I=>I.isGroup?I.columns.reduce((T,u)=>T+F(u),0):S(I),H=(I,T)=>I+T/2+s*z.TEXT_BASELINE_ADJUSTMENT;if(E){const I=i/2,T=i/2;let u=o;l&&(r.push(`<text x="${u+G.TEXT_PADDING}" y="${H(e,i)}"
        font-family="${a.typography.fontFamily}"
        font-size="${s}px"
        font-weight="${h}"
        fill="${a.colors.foreground}">${C(l)}</text>`),u+=N);const p=[];for(const m of t)if(m.isGroup){const $=F(m),b=u+$/2;r.push(`<text x="${b}" y="${H(e,I)}"
          font-family="${a.typography.fontFamily}"
          font-size="${s}px"
          font-weight="${g}"
          text-anchor="middle"
          fill="${a.colors.foreground}">${C(m.header)}</text>`),p.push({x1:u,x2:u+$}),u+=$}else{const $=S(m),b=m.headerAlign??m.align,{textX:D,anchor:M}=rt(u,$,b),L=ft(m.header,$,s,G.TEXT_PADDING);r.push(`<text x="${D}" y="${H(e,i)}"
          font-family="${a.typography.fontFamily}"
          font-size="${s}px"
          font-weight="${h}"
          text-anchor="${M}"
          fill="${a.colors.foreground}">${C(L)}</text>`),u+=$}for(const m of p)r.push(`<line x1="${m.x1}" x2="${m.x2}"
        y1="${e+I}" y2="${e+I}"
        stroke="${a.colors.border}" stroke-width="1" opacity="0.5"/>`);u=o+(l?N:0);for(const m of t)if(m.isGroup){for(const $ of m.columns)if(!$.isGroup){const b=S($),D=$.headerAlign??$.align,{textX:M,anchor:L}=rt(u,b,D);r.push(`<text x="${M}" y="${H(e+I,T)}"
              font-family="${a.typography.fontFamily}"
              font-size="${s}px"
              font-weight="${h}"
              text-anchor="${L}"
              fill="${a.colors.foreground}">${C($.header)}</text>`),u+=b}}else{const $=S(m);u+=$}}else{let I=o;l&&(r.push(`<text x="${I+G.TEXT_PADDING}" y="${H(e,i)}"
        font-family="${a.typography.fontFamily}"
        font-size="${s}px"
        font-weight="${h}"
        fill="${a.colors.foreground}">${C(l)}</text>`),I+=N);for(const T of n){const u=S(T),p=T.headerAlign??T.align,{textX:m,anchor:$}=rt(I,u,p),b=ft(T.header,u,s,G.TEXT_PADDING);r.push(`<text x="${m}" y="${H(e,i)}"
        font-family="${a.typography.fontFamily}"
        font-size="${s}px"
        font-weight="${h}"
        text-anchor="${$}"
        fill="${a.colors.foreground}">${C(b)}</text>`),I+=u}}return r.join(`
`)}function Xt(t,n,o,e,i,a,l){const y=[],f=n+1,r=l.groupHeaders;let d,c,s,h,g;if(f===1?(d=Y((r==null?void 0:r.level1FontSize)??l.typography.fontSizeBase),c=(r==null?void 0:r.level1FontWeight)??l.typography.fontWeightBold,s=(r==null?void 0:r.level1Italic)??!1,h=(r==null?void 0:r.level1Background)??null,g=(r==null?void 0:r.level1BorderBottom)??!1):f===2?(d=Y((r==null?void 0:r.level2FontSize)??l.typography.fontSizeBase),c=(r==null?void 0:r.level2FontWeight)??l.typography.fontWeightMedium,s=(r==null?void 0:r.level2Italic)??!0,h=(r==null?void 0:r.level2Background)??null,g=(r==null?void 0:r.level2BorderBottom)??!1):(d=Y((r==null?void 0:r.level3FontSize)??l.typography.fontSizeBase),c=(r==null?void 0:r.level3FontWeight)??l.typography.fontWeightNormal,s=(r==null?void 0:r.level3Italic)??!1,h=(r==null?void 0:r.level3Background)??null,g=(r==null?void 0:r.level3BorderBottom)??!1),!h){const F=l.colors.primary,H=f===1?.15:f===2?.1:.06,I=F.replace("#",""),T=parseInt(I.substring(0,2),16),u=parseInt(I.substring(2,4),16),p=parseInt(I.substring(4,6),16);h=`rgba(${T}, ${u}, ${p}, ${H})`}const E=e+i/2+d*z.TEXT_BASELINE_ADJUSTMENT,N=n*((r==null?void 0:r.indentPerLevel)??G.INDENT_PER_LEVEL);y.push(`<rect x="${o}" y="${e}"
    width="${a}" height="${i}"
    fill="${h}"/>`),g&&y.push(`<line x1="${o}" x2="${o+a}" y1="${e+i}" y2="${e+i}"
      stroke="${l.colors.border}" stroke-width="1" opacity="0.5"/>`);const S=s?' font-style="italic"':"";return y.push(`<text x="${o+G.TEXT_PADDING+N}" y="${E}"
    font-family="${l.typography.fontFamily}"
    font-size="${d}px"
    font-weight="${c}"${S}
    fill="${l.colors.foreground}">${C(t)}</text>`),y.join(`
`)}function It(t,n){const o=new Map;for(const e of n)if(e.type==="bar"){let i=0;for(const a of t){const l=a.metadata[e.field];typeof l=="number"&&l>i&&(i=l)}o.set(e.field,i>0?i:1)}return o}function At(t,n,o,e,i,a,l,y=k.DEFAULT_LABEL_WIDTH,f=0,r,d){var N,S,F,H,I,T,u,p,m,$,b,D,M,L,W,A;const c=[],s=Y(a.typography.fontSizeBase),h=e+i/2+s*z.TEXT_BASELINE_ADJUSTMENT;let g=o;const E=_=>{if(d){const x=d.get(_.id);if(x!==void 0)return x}return typeof _.width=="number"?_.width:k.DEFAULT_COLUMN_WIDTH};if(l){const _=f*G.INDENT_PER_LEVEL+(((N=t.style)==null?void 0:N.indent)??0)*G.INDENT_PER_LEVEL,x=(S=t.style)!=null&&S.bold||(F=t.style)!=null&&F.emphasis?a.typography.fontWeightBold:a.typography.fontWeightNormal,w=(H=t.style)!=null&&H.italic?"italic":"normal";let v=a.colors.foreground;(I=t.style)!=null&&I.color?v=t.style.color:(T=t.style)!=null&&T.muted?v=a.colors.muted:(u=t.style)!=null&&u.accent&&(v=a.colors.accent);const O=y-_-G.TEXT_PADDING*2,P=ft(t.label,O,s,0);if(c.push(`<text x="${g+G.TEXT_PADDING+_}" y="${h}"
      font-family="${a.typography.fontFamily}"
      font-size="${s}px"
      font-weight="${x}"
      font-style="${w}"
      fill="${v}">${C(P)}</text>`),(p=t.style)!=null&&p.badge){const X=String(t.style.badge),R=s*K.FONT_SCALE,B=R+K.PADDING*2,J=V(t.label,s),U=g+G.TEXT_PADDING+_+J+K.GAP,it=V(X,R)+K.PADDING*2,at=e+(i-B)/2;c.push(`<rect x="${U}" y="${at}" width="${it}" height="${B}"
        rx="3" fill="${a.colors.primary}" opacity="0.15"/>`),c.push(`<text x="${U+it/2}" y="${at+B/2+R*.35}"
        text-anchor="middle"
        font-family="${a.typography.fontFamily}"
        font-size="${R}px"
        font-weight="500"
        fill="${a.colors.primary}">${C(X)}</text>`)}g+=y}for(const _ of n){const x=E(_),w=Ut(t,_),{textX:v,anchor:O}=rt(g,x,_.align);if(_.type==="bar"&&typeof t.metadata[_.field]=="number"){const P=t.metadata[_.field],X=r==null?void 0:r.get(_.field),R=(($=(m=_.options)==null?void 0:m.bar)==null?void 0:$.maxValue)??X??100,B=((D=(b=_.options)==null?void 0:b.bar)==null?void 0:D.color)??a.colors.primary,J=a.shapes.pointSize*2,j=x-G.TEXT_PADDING*2-50,it=Math.min(P/R*j,j);c.push(`<rect x="${g+G.TEXT_PADDING}" y="${e+i/2-J/2}"
        width="${Math.max(0,it)}" height="${J}"
        fill="${B}" opacity="0.7" rx="2"/>`);const at=g+x-G.TEXT_PADDING;c.push(`<text x="${at}" y="${h}"
        font-family="${a.typography.fontFamily}"
        font-size="${s}px"
        text-anchor="end"
        fill="${a.colors.foreground}">${et(P)}</text>`)}else if(_.type==="sparkline"&&Array.isArray(t.metadata[_.field])){let P=t.metadata[_.field];Array.isArray(P[0])&&(P=P[0]);const X=((L=(M=_.options)==null?void 0:M.sparkline)==null?void 0:L.height)??16,R=((A=(W=_.options)==null?void 0:W.sparkline)==null?void 0:A.color)??a.colors.primary,B=G.TEXT_PADDING*2,J=Ot(P,g+G.TEXT_PADDING,e+i/2-X/2,x-B,X);c.push(`<path d="${J}" fill="none" stroke="${R}" stroke-width="1.5"/>`)}else c.push(`<text x="${v}" y="${h}"
        font-family="${a.typography.fontFamily}"
        font-size="${s}px"
        text-anchor="${O}"
        fill="${a.colors.foreground}">${C(w)}</text>`);g+=x}return c.join(`
`)}function Ut(t,n){var e,i,a,l,y,f,r,d,c,s,h,g,E,N,S,F,H,I,T;if(n.type==="interval"){const u=(i=(e=n.options)==null?void 0:e.interval)!=null&&i.point?t.metadata[n.options.interval.point]:t.point,p=(l=(a=n.options)==null?void 0:a.interval)!=null&&l.lower?t.metadata[n.options.interval.lower]:t.lower,m=(f=(y=n.options)==null?void 0:y.interval)!=null&&f.upper?t.metadata[n.options.interval.upper]:t.upper;return yt(u,p,m,n.options)}if(n.type==="numeric"){const u=t.metadata[n.field];return typeof u=="number"?et(u,n.options):((r=n.options)==null?void 0:r.naText)??""}if(n.type==="custom"&&((d=n.options)!=null&&d.events))return mt(t,n.options);if(n.type==="pvalue"){const u=t.metadata[n.field];return typeof u!="number"?((c=n.options)==null?void 0:c.naText)??"":$t(u,n.options)}if(n.type==="icon"){const u=t.metadata[n.field];if(u==null)return"";const p=String(u),m=(h=(s=n.options)==null?void 0:s.icon)==null?void 0:h.mapping;return m&&p in m?m[p]:p}if(n.type==="badge"){const u=t.metadata[n.field];return u!=null?String(u):""}if(n.type==="stars"){const u=t.metadata[n.field];if(typeof u!="number")return"";const p=((E=(g=n.options)==null?void 0:g.stars)==null?void 0:E.maxStars)??5,m=Math.max(0,Math.min(p,u)),$=Math.floor(m),b=p-$;return"★".repeat($)+"☆".repeat(b)}if(n.type==="img")return((S=(N=n.options)==null?void 0:N.img)==null?void 0:S.fallback)??"[IMG]";if(n.type==="reference"){const u=t.metadata[n.field];if(u==null)return"";const p=String(u),m=((H=(F=n.options)==null?void 0:F.reference)==null?void 0:H.maxChars)??30;return p.length<=m?p:p.substring(0,m)+"..."}if(n.type==="range"){const u=(I=n.options)==null?void 0:I.range;if(!u)return"";const p=t.metadata[u.minField],m=t.metadata[u.maxField],$=u.separator??" – ",b=u.decimals,D=M=>typeof M!="number"?"":b==null?Number.isInteger(M)?String(M):M.toFixed(1):M.toFixed(b);return p===null&&m===null?"":p===null?D(m):m===null?D(p):`${D(p)}${$}${D(m)}`}const o=t.metadata[n.field];return o!=null?String(o):((T=n.options)==null?void 0:T.naText)??""}function Ot(t,n,o,e,i){const a=t.filter(d=>Number.isFinite(d));if(a.length===0)return"";if(a.length===1){const d=n+e/2,c=o+i/2;return`M${d.toFixed(1)},${c.toFixed(1)}`}const l=Math.min(...a),f=Math.max(...a)-l||1;return`M${a.map((d,c)=>{const s=n+c/(a.length-1)*e,h=o+i-(d-l)/f*i;return`${s.toFixed(1)},${h.toFixed(1)}`}).join("L")}`}const _t=6;function ht(t,n,o){const e=t.metadata[n];return e!=null&&typeof e=="number"&&!Number.isNaN(e)?e:o}function zt(t,n){return n<=1?0:-((n-1)*_t)/2+t*_t}function Vt(t,n,o,e,i,a=[],l,y=0,f=1/0){var u;let r;a.length===0?r=[{point:t.point,lower:t.lower,upper:t.upper,color:null,shape:null,opacity:null}]:r=a.map(p=>({point:ht(t,p.pointCol,t.point),lower:ht(t,p.lowerCol,t.lower),upper:ht(t,p.upperCol,t.upper),color:p.color??null,shape:p.shape??null,opacity:p.opacity??null}));const d=r.filter(p=>p.point!=null&&!Number.isNaN(p.point)&&p.lower!=null&&!Number.isNaN(p.lower)&&p.upper!=null&&!Number.isNaN(p.upper));if(d.length===0)return"";const c=e.shapes.pointSize,s=e.shapes.lineWidth,h=e.colors.intervalLine,g=G.WHISKER_HALF_HEIGHT,E=((u=t.style)==null?void 0:u.type)==="summary",S=e.shapes.summaryHeight/2;function F(p){var $;if(p&&(($=t.markerStyle)==null?void 0:$.size)!=null)return c*t.markerStyle.size;const m=l?t.metadata[l]:void 0;if(m){const b=.5+Math.sqrt(m/100)*1.5;return Math.min(Math.max(c*b,3),c*2.5)}return c}function H(p,m){const $=m===0,b=t.markerStyle,D=e.shapes.markerColors,M=e.shapes.markerShapes,L=["square","circle","diamond","triangle"];let W;$&&(b!=null&&b.color)?W=b.color:p.color?W=p.color:D&&D.length>0?W=D[m%D.length]:W=e.colors.interval??e.colors.primary??"#2563eb";let A;$&&(b!=null&&b.shape)?A=b.shape:p.shape?A=p.shape:M&&M.length>0?A=M[m%M.length]:A=L[m%L.length];let _;return $&&(b==null?void 0:b.opacity)!=null?_=b.opacity:p.opacity!=null?_=p.opacity:_=1,{color:W,shape:A,opacity:_}}function I(p,m,$,b){const{color:D,shape:M,opacity:L}=b,W=L<1?` fill-opacity="${L}"`:"";switch(M){case"circle":return`<circle cx="${p}" cy="${m}" r="${$}" fill="${D}"${W}/>`;case"diamond":return`<polygon points="${[`${p},${m-$}`,`${p+$},${m}`,`${p},${m+$}`,`${p-$},${m}`].join(" ")}" fill="${D}"${W}/>`;case"triangle":return`<polygon points="${[`${p},${m-$}`,`${p+$},${m+$}`,`${p-$},${m+$}`].join(" ")}" fill="${D}"${W}/>`;default:return`<rect x="${p-$}" y="${m-$}" width="${$*2}" height="${$*2}" fill="${D}"${W}/>`}}const T=[];return d.forEach((p,m)=>{const $=n+zt(m,d.length),b=o(p.lower),D=o(p.upper),M=o(p.point),L=H(p,m),W=F(m===0),A=h;if(E){const _=L.opacity<1?` fill-opacity="${L.opacity}"`:"",x=[`${b},${$}`,`${M},${$-S}`,`${D},${$}`,`${M},${$+S}`].join(" ");T.push(`
        <g class="interval effect-${m} summary">
          <polygon points="${x}"
            fill="${L.color}"${_} stroke="${e.colors.summaryBorder}" stroke-width="1"/>
        </g>`)}else{const _=G.AXIS_LABEL_PADDING,x=y+_,w=y+f-_,v=b<x,O=D>w,P=Math.max(x,Math.min(w,b)),X=Math.max(x,Math.min(w,D));let R="";v?R=`<path d="M ${x} ${$} L ${x+6} ${$-4} L ${x+6} ${$+4} Z" fill="${A}"/>`:R=`<line x1="${P}" x2="${P}" y1="${$-g}" y2="${$+g}" stroke="${A}" stroke-width="${s}"/>`;let B="";O?B=`<path d="M ${w} ${$} L ${w-6} ${$-4} L ${w-6} ${$+4} Z" fill="${A}"/>`:B=`<line x1="${X}" x2="${X}" y1="${$-g}" y2="${$+g}" stroke="${A}" stroke-width="${s}"/>`,T.push(`
        <g class="interval effect-${m}">
          <line x1="${P}" x2="${X}" y1="${$}" y2="${$}"
            stroke="${A}" stroke-width="${s}"/>
          ${R}
          ${B}
          ${I(M,$,W,L)}
        </g>`)}}),T.join("")}function Yt(t,n,o,e,i,a,l,y){const r=y.shapes.summaryHeight/2,[d,c]=i.domain().map(T=>i(T)),s=Math.min(d,c),h=Math.max(d,c),g=i(n),E=i(t),N=i(o),S=a+Math.max(s,Math.min(h,g)),F=a+Math.max(s,Math.min(h,E)),H=a+Math.max(s,Math.min(h,N));return`<polygon points="${[`${S},${e}`,`${F},${e-r}`,`${H},${e}`,`${F},${e+r}`].join(" ")}"
    fill="${y.colors.summaryFill}"
    stroke="${y.colors.summaryBorder}"
    stroke-width="1"/>`}function jt(t,n,o,e,i,a=1){const l=[],y=typeof o.axis.tickCount=="number"?o.axis.tickCount:G.DEFAULT_TICK_COUNT,f=Jt(t,y,o,a,n.forestWidth),r=Y(o.typography.fontSizeSm),d=35,c=h=>h<d?"start":h>n.forestWidth-d?"end":"middle",s=h=>h<d?2:h>n.forestWidth-d?-2:0;l.push(`<line x1="${i}" x2="${i+n.forestWidth}"
    y1="0" y2="0" stroke="${o.colors.border}" stroke-width="1"/>`);for(const h of f){const g=t(h),E=i+g,N=c(g),S=s(g);l.push(`<line x1="${E}" x2="${E}" y1="0" y2="4"
      stroke="${o.colors.border}" stroke-width="1"/>`),l.push(`<text x="${E+S}" y="16" text-anchor="${N}"
      font-family="${o.typography.fontFamily}"
      font-size="${r}px"
      fill="${o.colors.secondary}">${vt(h)}</text>`)}return e&&l.push(`<text x="${i+n.forestWidth/2}" y="28"
      text-anchor="middle"
      font-family="${o.typography.fontFamily}"
      font-size="${r}px"
      font-weight="500"
      fill="${o.colors.secondary}">${C(e)}</text>`),`<g transform="translate(0, ${n.mainY+n.headerHeight+n.plotHeight})">${l.join(`
`)}</g>`}function Jt(t,n,o,e,i){if(Array.isArray(o.axis.tickValues)&&o.axis.tickValues.length>0){const[u,p]=t.domain();let m=o.axis.tickValues.filter(D=>D>=u&&D<=p);const $=o.axis.nullTick!==!1,b=e>=u&&e<=p;return $&&b&&!m.includes(e)&&(m=[...m,e].sort((D,M)=>D-M)),m}const[a,l]=t.domain(),y=o.axis.nullTick!==!1,f=e>=a&&e<=l,r=50,d=Math.max(2,Math.floor(i/r)),c=Math.min(n,Math.min(7,d)),s=t.ticks(c);if(s.length===0)return y&&f?[e]:[];const h=t(e),g=s.filter(u=>u<e).reverse(),E=s.filter(u=>u>e),N=s.some(u=>u===e),S=[];let F=h;for(const u of g){const p=t(u);F-p>=r&&(S.unshift(u),F=p)}const H=[];let I=h;for(const u of E){const p=t(u);p-I>=r&&(H.push(u),I=p)}const T=[...S];if((N||y&&f)&&T.push(e),T.push(...H),T.length<2){const u=new Set(T);u.has(a)||T.unshift(a),T.length<2&&!u.has(l)&&T.push(l)}return T}function St(t,n,o,e,i,a,l=1,y=.6){let r=`<line x1="${t}" x2="${t}" y1="${n}" y2="${o}"
    stroke="${i}" stroke-width="${l}" stroke-opacity="${y}" stroke-dasharray="${e==="dashed"?"6,4":e==="dotted"?"2,2":"none"}"/>`;return a&&(r+=`<text x="${t}" y="${n-4}" text-anchor="middle"
      font-size="10px" fill="${i}">${C(a)}</text>`),r}class Z extends Error{constructor(n){super(`SVG Generator: ${n}`),this.name="SVGGeneratorError"}}function Kt(t){if(!t||typeof t!="object")throw new Z("Invalid spec: expected an object");const n=t;if(!n.data||typeof n.data!="object")throw new Z("Invalid spec: missing or invalid 'data' property");const o=n.data;if(!Array.isArray(o.rows))throw new Z("Invalid spec: 'data.rows' must be an array");if(!n.theme||typeof n.theme!="object")throw new Z("Invalid spec: missing or invalid 'theme' property");const e=n.theme;if(!e.colors||typeof e.colors!="object")throw new Z("Invalid spec: missing or invalid 'theme.colors'");if(!e.typography||typeof e.typography!="object")throw new Z("Invalid spec: missing or invalid 'theme.typography'");if(!e.spacing||typeof e.spacing!="object")throw new Z("Invalid spec: missing or invalid 'theme.spacing'")}function Zt(t,n={}){var D;Kt(t);const o=t.theme,e=kt(t,n),i=o.spacing.padding,a=Array.isArray(t.columns)?t.columns:[],l=ot(a,"left"),y=ot(a,"right"),f=nt(a,"left"),r=nt(a,"right"),d=e.labelWidth+f.reduce((M,L)=>M+dt(L,e.autoWidths),0),c=i+d+k.COLUMN_GAP,s=Rt(t,e.forestWidth,n),h=c+e.forestWidth+k.COLUMN_GAP,g=[];g.push(`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg"
  width="${e.totalWidth}" height="${e.totalHeight}"
  viewBox="0 0 ${e.totalWidth} ${e.totalHeight}">`);const E=n.backgroundColor??o.colors.background;g.push(`<rect width="100%" height="100%" fill="${E}"/>`),g.push(Bt(t,e,o)),g.push(`<line x1="${i}" x2="${e.totalWidth-i}"
    y1="${e.mainY}" y2="${e.mainY}"
    stroke="${o.colors.border}" stroke-width="2"/>`);const N=e.mainY;g.push(Nt(l,f,i,N,e.headerHeight,o,t.data.labelHeader??"Study",e.labelWidth,e.autoWidths)),r.length>0&&g.push(Nt(y,r,h,N,e.headerHeight,o,void 0,void 0,e.autoWidths)),g.push(`<line x1="${i}" x2="${e.totalWidth-i}"
    y1="${N+e.headerHeight}" y2="${N+e.headerHeight}"
    stroke="${o.colors.border}" stroke-width="2"/>`);const S=Tt(t),H=(Array.isArray(t.data.groups)?t.data.groups:[]).length>0,I=[],T=[];let u=0;for(const M of S){const W=M.type==="data"&&((D=M.row.style)==null?void 0:D.type)==="spacer"?e.rowHeight/2:e.rowHeight;I.push(u),T.push(W),u+=W}if(t.data.includeForest&&e.forestWidth>0){const M=e.mainY+e.headerHeight,L=c+s(t.data.nullValue);g.push(St(L,M,M+e.plotHeight,"dashed",o.colors.muted));const W=Array.isArray(t.annotations)?t.annotations:[];for(const A of W)if(A.type==="reference_line"){const _=c+s(A.x);g.push(St(_,M,M+e.plotHeight,A.style,A.color??o.colors.accent,A.label,A.width??1,A.opacity??.6))}if(S.forEach((A,_)=>{if(A.type==="data"){const x=M+I[_]+T[_]/2;g.push(Vt(A.row,x,w=>c+s(w),o,t.data.nullValue,t.data.effects,t.data.weightCol,c,e.forestWidth))}}),t.data.overall&&e.showOverallSummary&&typeof t.data.overall.point=="number"&&!Number.isNaN(t.data.overall.point)&&typeof t.data.overall.lower=="number"&&!Number.isNaN(t.data.overall.lower)&&typeof t.data.overall.upper=="number"&&!Number.isNaN(t.data.overall.upper)){const A=M+e.summaryYPosition;g.push(Yt(t.data.overall.point,t.data.overall.lower,t.data.overall.upper,A,s,c,e.forestWidth,o))}g.push(jt(s,e,o,t.data.axisLabel,c,t.data.nullValue))}const p=e.mainY+e.headerHeight,m=t.data.rows,$=It(m,f),b=It(m,r);return S.forEach((M,L)=>{var _,x,w;const W=p+I[L],A=T[L];if(M.type==="group_header")g.push(Xt(M.label,M.depth,i,W,A,e.totalWidth-i*2,o));else{const v=M.row,O=M.depth;if(!(((_=v.style)==null?void 0:_.type)==="spacer")){const X=Ht(O),R=!H&&L%2===1?Wt:0,B=Math.max(X,R);B>0&&g.push(`<rect x="${i}" y="${W}"
            width="${e.totalWidth-i*2}" height="${A}"
            fill="${o.colors.muted}" opacity="${B}"/>`)}g.push(At(v,f,i,W,A,o,!0,e.labelWidth,O,$,e.autoWidths)),r.length>0&&g.push(At(v,r,h,W,A,o,!1,0,O,b,e.autoWidths))}if(M.type==="data"){const v=M.row,O=((x=v.style)==null?void 0:x.type)==="summary",P=((w=v.style)==null?void 0:w.type)==="spacer";O&&g.push(`<line x1="${i}" x2="${e.totalWidth-i}"
          y1="${W}" y2="${W}"
          stroke="${o.colors.border}" stroke-width="2"/>`),P||g.push(`<line x1="${i}" x2="${e.totalWidth-i}"
          y1="${W+A}" y2="${W+A}"
          stroke="${o.colors.border}" stroke-width="1"/>`)}else g.push(`<line x1="${i}" x2="${e.totalWidth-i}"
        y1="${W+A}" y2="${W+A}"
        stroke="${o.colors.border}" stroke-width="1"/>`)}),g.push(Ct(t,e,o)),g.push("</svg>"),g.join(`
`)}function qt(t,n){const o=JSON.parse(t);return Zt(o,n)}globalThis.generateSVG=qt})();
