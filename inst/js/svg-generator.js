(function(){"use strict";function Wt(t,n){if(n){const f=[.05,.1,.15,.2,.25,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2,1.3,1.4,1.5,1.75,2,2.5,3,4,5,6,7,8,10,12,15,20,25,30,40,50,75,100];let i=f[0];for(const l of f)if(l<=t[0])i=l;else break;let g=f[f.length-1];for(let l=f.length-1;l>=0&&f[l]>=t[1];l--)g=f[l];return[i,g]}const o=t[1]-t[0];if(o===0)return t;const e=Math.pow(10,Math.floor(Math.log10(o))),r=o/e;let a;r<=1?a=e*.1:r<=2?a=e*.2:r<=5?a=e*.5:a=e;const c=Math.floor(t[0]/a)*a,y=Math.ceil(t[1]/a)*a;return[c,y]}const Ht=.06,ut=.04;function Dt(t){return t<=0?0:ut+t*ut}const v={DEFAULT_LABEL_WIDTH:200,DEFAULT_COLUMN_WIDTH:100,AXIS_HEIGHT:32,AXIS_LABEL_HEIGHT:20,BOTTOM_MARGIN:16,MIN_FOREST_WIDTH:200,DEFAULT_WIDTH:800,COLUMN_GAP:16},z={TITLE_HEIGHT:28,SUBTITLE_HEIGHT:20,CAPTION_HEIGHT:16,FOOTNOTE_HEIGHT:14,DEFAULT_FONT_SIZE:14,REM_BASE:16,TEXT_BASELINE_ADJUSTMENT:1/3},F={INDENT_PER_LEVEL:12,TEXT_PADDING:10,WHISKER_HALF_HEIGHT:4,DEFAULT_TICK_COUNT:5,AXIS_LABEL_PADDING:30},ft={GROUP_HEADER_HEIGHT_MULTIPLIER:1.3,OVERALL_ROW_HEIGHT_MULTIPLIER:1.5},Z={MIN:60,MAX:600,LABEL_MAX:400,VISUAL_MIN:{sparkline:92,bar:100,stars:84,range:84,badge:74}},q={CHEVRON_WIDTH:12,GAP:6,SAFETY_MARGIN:8};function Q(t,n){const o=t.split(".");return o[0]=o[0].replace(/\B(?=(\d{3})+(?!\d))/g,n),o.join(".")}function it(t){const n=Math.abs(t),o=t<0?"-":"";if(n>=1e12)throw new Error(`Cannot abbreviate value >= 1 trillion: ${t}`);if(n>=1e9){const e=n/1e9;return o+at(e)+"B"}if(n>=1e6){const e=n/1e6;return o+at(e)+"M"}if(n>=1e3){const e=n/1e3;return o+at(e)+"K"}return o+Math.round(n).toString()}function at(t){const n=Math.round(t*10)/10;return n===Math.floor(n)?n.toFixed(0):n.toFixed(1)}const Lt={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","-":"⁻","+":"⁺"};function wt(t){return t.split("").map(n=>Lt[n]??n).join("")}function tt(t,n){var y,f,i,g,l;if(t==null||Number.isNaN(t))return(n==null?void 0:n.naText)??"";if(n!=null&&n.percent){const{decimals:s,digits:u,multiply:p=!0,symbol:E=!0}=n.percent,I=p?t*100:t,N=u!=null?I.toPrecision(u):I.toFixed(s??1);return E?`${N}%`:N}if(((y=n==null?void 0:n.numeric)==null?void 0:y.abbreviate)&&Math.abs(t)>=1e3)return it(t);const e=(f=n==null?void 0:n.numeric)==null?void 0:f.digits;if(e!=null){const s=t.toPrecision(e),u=(i=n==null?void 0:n.numeric)==null?void 0:i.thousandsSep;return u&&typeof u=="string"?Q(s,u):s}const r=(g=n==null?void 0:n.numeric)==null?void 0:g.decimals,a=(l=n==null?void 0:n.numeric)==null?void 0:l.thousandsSep;let c;return r!==void 0?c=t.toFixed(r):Number.isInteger(t)||Math.abs(t-Math.round(t))<1e-4?c=Math.round(t).toString():c=t.toFixed(2),a&&typeof a=="string"&&(c=Q(c,a)),c}function ht(t,n){const{eventsField:o,nField:e,separator:r="/",showPct:a=!1,thousandsSep:c,abbreviate:y}=n.events,f=t.metadata[o],i=t.metadata[e];if(f==null||i===void 0||i===null)return n.naText??"";const g=Number(f),l=Number(i);let s,u;y&&(g>=1e3||l>=1e3)?(s=g>=1e3?it(g):String(g),u=l>=1e3?it(l):String(l)):(s=String(g),u=String(l),c&&typeof c=="string"&&(s=Q(s,c),u=Q(u,c)));let p=`${s}${r}${u}`;if(a&&l>0){const E=(g/l*100).toFixed(1);p+=` (${E}%)`}return p}function pt(t,n,o,e){var y,f,i;if(t==null||Number.isNaN(t))return"";const r=((y=e==null?void 0:e.interval)==null?void 0:y.decimals)??2,a=((f=e==null?void 0:e.interval)==null?void 0:f.sep)??" ",c=(i=e==null?void 0:e.interval)==null?void 0:i.impreciseThreshold;return n==null||o===void 0||o===null||Number.isNaN(n)||Number.isNaN(o)?t.toFixed(r):c!=null&&n>0&&o/n>c?"—":`${t.toFixed(r)}${a}(${n.toFixed(r)}, ${o.toFixed(r)})`}function gt(t,n){if(t==null||Number.isNaN(t))return(n==null?void 0:n.naText)??"";const o=n==null?void 0:n.pvalue,e=(o==null?void 0:o.digits)??2,r=(o==null?void 0:o.expThreshold)??.001,a=(o==null?void 0:o.abbrevThreshold)??null,c=(o==null?void 0:o.format)??"auto",y=(o==null?void 0:o.stars)??!1,f=(o==null?void 0:o.thresholds)??[.05,.01,.001];let i="";if(y&&(t<f[2]?i="***":t<f[1]?i="**":t<f[0]&&(i="*")),a!==null&&t<a)return`<${a}${i}`;if(c==="scientific"||c==="auto"&&t<r){const l=Math.floor(Math.log10(t));return`${(t/Math.pow(10,l)).toPrecision(e)}×10${wt(l.toString())}${i}`}let g;return t>=.1?g=t.toFixed(e):t>=.01?g=t.toFixed(e+1):g=t.toFixed(e+2),`${g}${i}`}function Ft(t,n){var a,c,y,f;const{type:o,field:e,options:r}=n;switch(o){case"interval":{const i=(a=r==null?void 0:r.interval)!=null&&a.point?t.metadata[r.interval.point]:t.point,g=(c=r==null?void 0:r.interval)!=null&&c.lower?t.metadata[r.interval.lower]:t.lower,l=(y=r==null?void 0:r.interval)!=null&&y.upper?t.metadata[r.interval.upper]:t.upper;return pt(i,g,l,r)}case"custom":return r!=null&&r.events?ht(t,r):String(t.metadata[e]??"");case"pvalue":return gt(t.metadata[e],r);case"numeric":return tt(t.metadata[e],r);case"percent":return tt(t.metadata[e],r);case"sparkline":case"icon":case"stars":case"img":case"range":return"";case"badge":{const i=t.metadata[e];return i==null?"":`  ${String(i)}  `}case"bar":{if(((f=r==null?void 0:r.bar)==null?void 0:f.showLabel)===!1)return"";const i=t.metadata[e];return i==null?"":i>=100?i.toFixed(0):i>=10?i.toFixed(1):i.toFixed(2)}case"text":default:return String(t.metadata[e]??"")}}function V(t,n){const o="⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻";let e=0;for(const r of t)o.includes(r)?e+=n*.3:"il1.,;:|!()[]{}' ".includes(r)?e+=n*.35:"×−".includes(r)?e+=n*.5:"mwMW@%".includes(r)?e+=n*.85:r>="0"&&r<="9"?e+=n*.6:e+=n*.55;return e}function Gt(t,n){var g,l;const o=new Map,e=Y(t.theme.typography.fontSizeBase),r=t.theme.typography.headerFontScale??1.05,a=e*r,c=t.data.rows,y=(t.theme.spacing.cellPaddingX??10)*2,f=(t.theme.spacing.groupPadding??8)*2,i=4;for(const s of n){if(s.width!=="auto"&&s.width!==null&&s.width!==void 0)continue;let u=0;s.header&&(u=Math.max(u,V(s.header,a)));for(const I of c){if(((g=I.style)==null?void 0:g.type)==="header"||((l=I.style)==null?void 0:l.type)==="spacer")continue;const N=Ft(I,s);N&&(u=Math.max(u,V(N,e)))}const p=Z.VISUAL_MIN[s.type]??Z.MIN,E=Math.ceil(u+y+i);o.set(s.id,Math.min(Z.MAX,Math.max(p,E)))}return kt(t.columns,o,a,f,i),o}function kt(t,n,o,e,r){function a(f){return f.isGroup?f.columns.flatMap(a):[f]}function c(f){const i=n.get(f.id);return i!==void 0?i:typeof f.width=="number"?f.width:Z.MIN}function y(f){if(f.isGroup){for(const i of f.columns)y(i);if(f.header){const i=V(f.header,o)+e+r,g=a(f),l=g.reduce((s,u)=>s+c(u),0);if(i>l&&g.length>0){const s=Math.ceil((i-l)/g.length);for(const u of g)n.set(u.id,c(u)+s)}}}}for(const f of t)y(f)}function mt(t){var i,g;const n=Y(t.theme.typography.fontSizeBase),o=(t.theme.spacing.cellPaddingX??10)*2,e=4;let r=0;const a=new Map,c=Array.isArray(t.data.groups)?t.data.groups:[];for(const l of c)a.set(l.id,l.depth);const y=l=>l?(a.get(l)??0)+1:0;t.data.labelHeader&&(r=Math.max(r,V(t.data.labelHeader,n)));for(const l of t.data.rows)if(l.label){const s=y(l.groupId),u=((i=l.style)==null?void 0:i.indent)??0,E=(s+u)*F.INDENT_PER_LEVEL;let I=V(l.label,n)+E;if((g=l.style)!=null&&g.badge){const N=String(l.style.badge),L=n*.8,D=4,_=6,d=V(N,L)+D*2;I+=_+d}r=Math.max(r,I)}for(const l of c)if(l.label){const s=l.depth*F.INDENT_PER_LEVEL,u=V(l.label,n),E=`(${countAllDescendantRows(l.id)})`,I=n*.75,N=V(E,I),L=s+q.CHEVRON_WIDTH+q.GAP+u+q.GAP+N+q.SAFETY_MARGIN;r=Math.max(r,L)}const f=Math.ceil(r+o+e);return Math.min(Z.LABEL_MAX,Math.max(Z.MIN,f))}function st(t,n){const o=n.get(t.id);return o!==void 0?o:typeof t.width=="number"?t.width:v.DEFAULT_COLUMN_WIDTH}function vt(t,n){var k,C,R,X,J;const o=t.theme,e=o.spacing.rowHeight,r=o.spacing.padding,a=Array.isArray(t.columns)?t.columns:[],c=nt(a,"left"),y=nt(a,"right"),i=lt(c)||lt(y)?o.spacing.headerHeight*ft.GROUP_HEADER_HEIGHT_MULTIPLIER:o.spacing.headerHeight,g=!!((k=t.labels)!=null&&k.title),l=!!((C=t.labels)!=null&&C.subtitle),s=!!((R=t.labels)!=null&&R.caption),u=!!((X=t.labels)!=null&&X.footnote),p=g?z.TITLE_HEIGHT:0,E=l?z.SUBTITLE_HEIGHT:0,I=p+E+(g||l?r:0),N=s?z.CAPTION_HEIGHT:0,L=u?z.FOOTNOTE_HEIGHT:0,D=N+L+(s||u?r:0),_=yt(t),b=!!t.data.overall;let d=0;for(const U of _){const j=U.type==="data"&&((J=U.row.style)==null?void 0:J.type)==="spacer";d+=j?e/2:e}b&&(d+=e*ft.OVERALL_ROW_HEIGHT_MULTIPLIER);const h=et(a,"left"),m=et(a,"right"),$=[...h,...m];let T,W;if(n.columnWidths){T=new Map;for(const[U,j]of Object.entries(n.columnWidths))U!=="__label__"&&T.set(U,j);W=n.columnWidths.__label__??mt(t)}else T=Gt(t,$),W=mt(t);const M=W+h.reduce((U,j)=>U+st(j,T),0),w=m.reduce((U,j)=>U+st(j,T),0),H=n.width??v.DEFAULT_WIDTH,A=t.data.includeForest,S=M+w;let x;if(!A)x=0;else if(typeof n.forestWidth=="number")x=n.forestWidth;else if(typeof t.layout.plotWidth=="number")x=t.layout.plotWidth;else{const U=H-S-v.COLUMN_GAP*2-r*2;x=Math.max(U,v.MIN_FOREST_WIDTH)}const G=r*2+S+x+v.COLUMN_GAP*2,P=Math.max(n.width??H,G),O=I+r+i+d+v.AXIS_HEIGHT+v.AXIS_LABEL_HEIGHT+D+v.BOTTOM_MARGIN;return{totalWidth:P,totalHeight:n.height??O,tableWidth:M+w,forestWidth:x,headerHeight:i,rowHeight:e,plotHeight:d,axisHeight:v.AXIS_HEIGHT,nullValue:t.data.nullValue,summaryYPosition:d-e,showOverallSummary:b,headerTextHeight:I,footerTextHeight:D,titleY:r+z.TITLE_HEIGHT-8,subtitleY:r+p+z.SUBTITLE_HEIGHT-4,mainY:I+r,footerY:I+r+i+d+v.AXIS_HEIGHT+v.AXIS_LABEL_HEIGHT+r,autoWidths:T,labelWidth:W}}function yt(t){var l;const n=t.data.rows,o=Array.isArray(t.data.groups)?t.data.groups:[];if(o.length===0)return n.map(s=>({type:"data",row:s,depth:0}));const e=new Map;for(const s of o)e.set(s.id,s);const r=new Map;for(const s of n){const u=s.groupId??null;r.has(u)||r.set(u,[]),r.get(u).push(s)}const a=new Set;for(const s of r.keys()){if(!s)continue;let u=s;for(;u;)a.add(u),u=(l=e.get(u))==null?void 0:l.parentId}function c(s){return o.filter(u=>(u.parentId??null)===s&&a.has(u.id))}function y(s){if(!s)return 0;const u=e.get(s);return u?u.depth+1:0}function f(s){var p;let u=((p=r.get(s))==null?void 0:p.length)??0;for(const E of c(s))u+=f(E.id);return u}const i=[];function g(s){if(s){const p=e.get(s);if(!p)return;const E=f(s);i.push({type:"group_header",groupId:p.id,label:p.label,depth:p.depth,rowCount:E})}for(const p of c(s))g(p.id);const u=r.get(s)??[];for(const p of u)i.push({type:"data",row:p,depth:y(p.groupId)})}return g(null),i}function $t(t){const n=[];for(const o of t)o.isGroup?n.push(...$t(o.columns)):n.push(o);return n}function et(t,n){const o=[];for(const e of t)e.position===n&&(e.isGroup?o.push(...$t(e.columns)):o.push(e));return o}function nt(t,n){return t.filter(o=>o.position===n)}function lt(t){return t.some(n=>n.isGroup)}function Y(t){return t.endsWith("rem")?parseFloat(t)*z.REM_BASE:t.endsWith("px")?parseFloat(t):z.DEFAULT_FONT_SIZE}function ot(t,n,o){return o==="right"?{textX:t+n-F.TEXT_PADDING,anchor:"end"}:o==="center"?{textX:t+n/2,anchor:"middle"}:{textX:t+F.TEXT_PADDING,anchor:"start"}}function B(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function ct(t,n,o,e=0){const r=n-e*2;if(V(t,o)<=r)return t;const c="…",y=o*.55;let f=0,i=t.length;for(;f<i;){const g=Math.ceil((f+i)/2),l=t.slice(0,g);V(l,o)+y<=r?f=g:i=g-1}return f===0?c:t.slice(0,f)+c}function Pt(t){return Math.abs(t)<.01?"0":Math.abs(t)>=100?t.toFixed(0):Math.abs(t)>=10?t.toFixed(1):t.toFixed(2)}function xt(t,n){const[o,e]=t,[r,a]=n,c=(a-r)/(e-o),y=f=>r+(f-o)*c;return y.domain=()=>t,y.range=()=>n,y.ticks=f=>{const i=(e-o)/(f-1),g=[];for(let l=0;l<f;l++)g.push(o+i*l);return g},y}function bt(t,n){const[o,e]=t.map(g=>Math.max(g,.001)),[r,a]=n,c=Math.log10(o),y=Math.log10(e),f=(a-r)/(y-c),i=g=>{const l=Math.log10(Math.max(g,.001));return r+(l-c)*f};return i.domain=()=>[o,e],i.range=()=>n,i.ticks=g=>{const l=[],s=Math.floor(Math.log10(o)),u=Math.ceil(Math.log10(e));for(let p=s;p<=u;p++){const E=Math.pow(10,p);for(const I of[1,2,5]){const N=E*I;N>=o&&N<=e&&l.push(N)}}return l.length>0?l:[o,e]},i}function Rt(t,n,o){const e=t.data.scale==="log";if(o!=null&&o.xDomain){const b=o.xDomain;return e?bt([Math.max(b[0],.01),Math.max(b[1],.02)],[0,n]):xt(b,[0,n])}const r=t.data.rows,a=t.theme.axis,c=t.data.nullValue,y=(a==null?void 0:a.padding)??.15,f=(a==null?void 0:a.includeNull)??!0,i=a==null?void 0:a.symmetric,g=(a==null?void 0:a.markerMargin)??!0,l=(a==null?void 0:a.ciTruncationThreshold)??3,s=typeof(a==null?void 0:a.rangeMin)=="number",u=typeof(a==null?void 0:a.rangeMax)=="number";let p;if(s&&u)p=[a.rangeMin,a.rangeMax];else{const b=r.map(d=>d.point).filter(d=>d!=null&&!Number.isNaN(d)&&Number.isFinite(d));if(b.length===0)p=e?[.1,10]:[0,1];else{let d=Math.min(...b),h=Math.max(...b);f&&(d=Math.min(d,c),h=Math.max(h,c));const m=d,$=h,T=h-d||1,W=T*l,M=r.map(x=>x.lower).filter(x=>x!=null&&!Number.isNaN(x)&&Number.isFinite(x)),w=r.map(x=>x.upper).filter(x=>x!=null&&!Number.isNaN(x)&&Number.isFinite(x));for(const x of M)d-x<=W&&(d=Math.min(d,x));for(const x of w)x-h<=W&&(h=Math.max(h,x));let H=s?a.rangeMin:d-T*y,A=u?a.rangeMax:h+T*y;if(i===!0&&!s&&!u)if(e){const x=Math.log(c),G=Math.max(Math.abs(Math.log(Math.max(m,.001))-x),Math.abs(Math.log($)-x));H=Math.exp(x-G),A=Math.exp(x+G)}else{const x=Math.max(Math.abs(m-c),Math.abs($-c));H=c-x,A=c+x}p=[H,A]}}const E=Wt(p,e),I=F.AXIS_LABEL_PADDING,N=n-2*I;let L=E;if(g&&N>0){const b=t.theme.shapes.pointSize,d=E[1]-E[0],h=b/2*(d/N);if(e){const m=h/E[0];L=[E[0]/(1+m),E[1]*(1+m)]}else L=[E[0]-h,E[1]+h]}const D=I,_=Math.max(n-I,D+50);return e?bt([Math.max(L[0],.01),Math.max(L[1],.02)],[D,_]):xt(L,[D,_])}function Bt(t,n,o){var a,c;const e=[],r=o.spacing.padding;if((a=t.labels)!=null&&a.title){const y=Y(o.typography.fontSizeLg);e.push(`<text x="${r}" y="${n.titleY}"
      font-family="${o.typography.fontFamily}"
      font-size="${y}px"
      font-weight="${o.typography.fontWeightBold}"
      fill="${o.colors.foreground}">${B(t.labels.title)}</text>`)}if((c=t.labels)!=null&&c.subtitle){const y=Y(o.typography.fontSizeBase);e.push(`<text x="${r}" y="${n.subtitleY}"
      font-family="${o.typography.fontFamily}"
      font-size="${y}px"
      fill="${o.colors.secondary}">${B(t.labels.subtitle)}</text>`)}return e.join(`
`)}function Ct(t,n,o){var c,y;const e=[],r=o.spacing.padding;let a=n.footerY;if((c=t.labels)!=null&&c.caption){const f=Y(o.typography.fontSizeSm);e.push(`<text x="${r}" y="${a}"
      font-family="${o.typography.fontFamily}"
      font-size="${f}px"
      fill="${o.colors.secondary}">${B(t.labels.caption)}</text>`),a+=z.CAPTION_HEIGHT}if((y=t.labels)!=null&&y.footnote){const f=Y(o.typography.fontSizeSm);e.push(`<text x="${r}" y="${a}"
      font-family="${o.typography.fontFamily}"
      font-size="${f}px"
      font-style="italic"
      fill="${o.colors.muted}">${B(t.labels.footnote)}</text>`)}return e.join(`
`)}function Tt(t,n,o,e,r,a,c,y,f){const i=[],g=Y(a.typography.fontSizeBase),l=a.typography.headerFontScale??1.05,s=g*l,u=a.typography.fontWeightMedium,p=a.typography.fontWeightBold,E=lt(t),I=y??v.DEFAULT_LABEL_WIDTH,N=_=>{if(f){const b=f.get(_.id);if(b!==void 0)return b}return typeof _.width=="number"?_.width:v.DEFAULT_COLUMN_WIDTH},L=_=>_.isGroup?_.columns.reduce((b,d)=>b+L(d),0):N(_),D=(_,b)=>_+b/2+s*z.TEXT_BASELINE_ADJUSTMENT;if(E){const _=r/2,b=r/2;let d=o;c&&(i.push(`<text x="${d+F.TEXT_PADDING}" y="${D(e,r)}"
        font-family="${a.typography.fontFamily}"
        font-size="${s}px"
        font-weight="${u}"
        fill="${a.colors.foreground}">${B(c)}</text>`),d+=I);const h=[];for(const m of t)if(m.isGroup){const $=L(m),T=d+$/2;i.push(`<text x="${T}" y="${D(e,_)}"
          font-family="${a.typography.fontFamily}"
          font-size="${s}px"
          font-weight="${p}"
          text-anchor="middle"
          fill="${a.colors.foreground}">${B(m.header)}</text>`),h.push({x1:d,x2:d+$}),d+=$}else{const $=N(m),T=m.headerAlign??m.align,{textX:W,anchor:M}=ot(d,$,T),w=ct(m.header,$,s,F.TEXT_PADDING);i.push(`<text x="${W}" y="${D(e,r)}"
          font-family="${a.typography.fontFamily}"
          font-size="${s}px"
          font-weight="${u}"
          text-anchor="${M}"
          fill="${a.colors.foreground}">${B(w)}</text>`),d+=$}for(const m of h)i.push(`<line x1="${m.x1}" x2="${m.x2}"
        y1="${e+_}" y2="${e+_}"
        stroke="${a.colors.border}" stroke-width="1" opacity="0.5"/>`);d=o+(c?I:0);for(const m of t)if(m.isGroup){for(const $ of m.columns)if(!$.isGroup){const T=N($),W=$.headerAlign??$.align,{textX:M,anchor:w}=ot(d,T,W);i.push(`<text x="${M}" y="${D(e+_,b)}"
              font-family="${a.typography.fontFamily}"
              font-size="${s}px"
              font-weight="${u}"
              text-anchor="${w}"
              fill="${a.colors.foreground}">${B($.header)}</text>`),d+=T}}else{const $=N(m);d+=$}}else{let _=o;c&&(i.push(`<text x="${_+F.TEXT_PADDING}" y="${D(e,r)}"
        font-family="${a.typography.fontFamily}"
        font-size="${s}px"
        font-weight="${u}"
        fill="${a.colors.foreground}">${B(c)}</text>`),_+=I);for(const b of n){const d=N(b),h=b.headerAlign??b.align,{textX:m,anchor:$}=ot(_,d,h),T=ct(b.header,d,s,F.TEXT_PADDING);i.push(`<text x="${m}" y="${D(e,r)}"
        font-family="${a.typography.fontFamily}"
        font-size="${s}px"
        font-weight="${u}"
        text-anchor="${$}"
        fill="${a.colors.foreground}">${B(T)}</text>`),_+=d}}return i.join(`
`)}function Xt(t,n,o,e,r,a,c){const y=[],f=n+1,i=c.groupHeaders;let g,l,s,u,p;if(f===1?(g=Y((i==null?void 0:i.level1FontSize)??c.typography.fontSizeBase),l=(i==null?void 0:i.level1FontWeight)??c.typography.fontWeightBold,s=(i==null?void 0:i.level1Italic)??!1,u=(i==null?void 0:i.level1Background)??null,p=(i==null?void 0:i.level1BorderBottom)??!1):f===2?(g=Y((i==null?void 0:i.level2FontSize)??c.typography.fontSizeBase),l=(i==null?void 0:i.level2FontWeight)??c.typography.fontWeightMedium,s=(i==null?void 0:i.level2Italic)??!0,u=(i==null?void 0:i.level2Background)??null,p=(i==null?void 0:i.level2BorderBottom)??!1):(g=Y((i==null?void 0:i.level3FontSize)??c.typography.fontSizeBase),l=(i==null?void 0:i.level3FontWeight)??c.typography.fontWeightNormal,s=(i==null?void 0:i.level3Italic)??!1,u=(i==null?void 0:i.level3Background)??null,p=(i==null?void 0:i.level3BorderBottom)??!1),!u){const L=c.colors.primary,D=f===1?.15:f===2?.1:.06,_=L.replace("#",""),b=parseInt(_.substring(0,2),16),d=parseInt(_.substring(2,4),16),h=parseInt(_.substring(4,6),16);u=`rgba(${b}, ${d}, ${h}, ${D})`}const E=e+r/2+g*z.TEXT_BASELINE_ADJUSTMENT,I=n*((i==null?void 0:i.indentPerLevel)??F.INDENT_PER_LEVEL);y.push(`<rect x="${o}" y="${e}"
    width="${a}" height="${r}"
    fill="${u}"/>`),p&&y.push(`<line x1="${o}" x2="${o+a}" y1="${e+r}" y2="${e+r}"
      stroke="${c.colors.border}" stroke-width="1" opacity="0.5"/>`);const N=s?' font-style="italic"':"";return y.push(`<text x="${o+F.TEXT_PADDING+I}" y="${E}"
    font-family="${c.typography.fontFamily}"
    font-size="${g}px"
    font-weight="${l}"${N}
    fill="${c.colors.foreground}">${B(t)}</text>`),y.join(`
`)}function Mt(t,n){const o=new Map;for(const e of n)if(e.type==="bar"){let r=0;for(const a of t){const c=a.metadata[e.field];typeof c=="number"&&c>r&&(r=c)}o.set(e.field,r>0?r:1)}return o}function Et(t,n,o,e,r,a,c,y=v.DEFAULT_LABEL_WIDTH,f=0,i,g){var I,N,L,D,_,b,d,h,m,$,T,W,M,w,H,A;const l=[],s=Y(a.typography.fontSizeBase),u=e+r/2+s*z.TEXT_BASELINE_ADJUSTMENT;let p=o;const E=S=>{if(g){const x=g.get(S.id);if(x!==void 0)return x}return typeof S.width=="number"?S.width:v.DEFAULT_COLUMN_WIDTH};if(c){const S=f*F.INDENT_PER_LEVEL+(((I=t.style)==null?void 0:I.indent)??0)*F.INDENT_PER_LEVEL,x=(N=t.style)!=null&&N.bold||(L=t.style)!=null&&L.emphasis?a.typography.fontWeightBold:a.typography.fontWeightNormal,G=(D=t.style)!=null&&D.italic?"italic":"normal";let P=a.colors.foreground;(_=t.style)!=null&&_.color?P=t.style.color:(b=t.style)!=null&&b.muted?P=a.colors.muted:(d=t.style)!=null&&d.accent&&(P=a.colors.accent);const O=y-S-F.TEXT_PADDING*2,k=ct(t.label,O,s,0);if(l.push(`<text x="${p+F.TEXT_PADDING+S}" y="${u}"
      font-family="${a.typography.fontFamily}"
      font-size="${s}px"
      font-weight="${x}"
      font-style="${G}"
      fill="${P}">${B(k)}</text>`),(h=t.style)!=null&&h.badge){const C=String(t.style.badge),R=s*.8,X=4,J=6,U=R+X*2,j=V(t.label,s),rt=p+F.TEXT_PADDING+S+j+J,At=V(C,R)+X*2,St=e+(r-U)/2;l.push(`<rect x="${rt}" y="${St}" width="${At}" height="${U}"
        rx="3" fill="${a.colors.primary}" opacity="0.15"/>`),l.push(`<text x="${rt+At/2}" y="${St+U/2+R*.35}"
        text-anchor="middle"
        font-family="${a.typography.fontFamily}"
        font-size="${R}px"
        font-weight="500"
        fill="${a.colors.primary}">${B(C)}</text>`)}p+=y}for(const S of n){const x=E(S),G=Ut(t,S),{textX:P,anchor:O}=ot(p,x,S.align);if(S.type==="bar"&&typeof t.metadata[S.field]=="number"){const k=t.metadata[S.field],C=i==null?void 0:i.get(S.field),R=(($=(m=S.options)==null?void 0:m.bar)==null?void 0:$.maxValue)??C??100,X=((W=(T=S.options)==null?void 0:T.bar)==null?void 0:W.color)??a.colors.primary,J=a.shapes.pointSize*2,j=x-F.TEXT_PADDING*2-50,rt=Math.min(k/R*j,j);l.push(`<rect x="${p+F.TEXT_PADDING}" y="${e+r/2-J/2}"
        width="${Math.max(0,rt)}" height="${J}"
        fill="${X}" opacity="0.7" rx="2"/>`);const _t=p+x-F.TEXT_PADDING;l.push(`<text x="${_t}" y="${u}"
        font-family="${a.typography.fontFamily}"
        font-size="${s}px"
        text-anchor="end"
        fill="${a.colors.foreground}">${tt(k)}</text>`)}else if(S.type==="sparkline"&&Array.isArray(t.metadata[S.field])){let k=t.metadata[S.field];Array.isArray(k[0])&&(k=k[0]);const C=((w=(M=S.options)==null?void 0:M.sparkline)==null?void 0:w.height)??16,R=((A=(H=S.options)==null?void 0:H.sparkline)==null?void 0:A.color)??a.colors.primary,X=F.TEXT_PADDING*2,J=Ot(k,p+F.TEXT_PADDING,e+r/2-C/2,x-X,C);l.push(`<path d="${J}" fill="none" stroke="${R}" stroke-width="1.5"/>`)}else l.push(`<text x="${P}" y="${u}"
        font-family="${a.typography.fontFamily}"
        font-size="${s}px"
        text-anchor="${O}"
        fill="${a.colors.foreground}">${B(G)}</text>`);p+=x}return l.join(`
`)}function Ut(t,n){var e,r,a,c,y,f,i,g,l,s,u,p,E,I,N,L,D,_,b;if(n.type==="interval"){const d=(r=(e=n.options)==null?void 0:e.interval)!=null&&r.point?t.metadata[n.options.interval.point]:t.point,h=(c=(a=n.options)==null?void 0:a.interval)!=null&&c.lower?t.metadata[n.options.interval.lower]:t.lower,m=(f=(y=n.options)==null?void 0:y.interval)!=null&&f.upper?t.metadata[n.options.interval.upper]:t.upper;return pt(d,h,m,n.options)}if(n.type==="numeric"){const d=t.metadata[n.field];return typeof d=="number"?tt(d,n.options):((i=n.options)==null?void 0:i.naText)??""}if(n.type==="custom"&&((g=n.options)!=null&&g.events))return ht(t,n.options);if(n.type==="pvalue"){const d=t.metadata[n.field];return typeof d!="number"?((l=n.options)==null?void 0:l.naText)??"":gt(d,n.options)}if(n.type==="icon"){const d=t.metadata[n.field];if(d==null)return"";const h=String(d),m=(u=(s=n.options)==null?void 0:s.icon)==null?void 0:u.mapping;return m&&h in m?m[h]:h}if(n.type==="badge"){const d=t.metadata[n.field];return d!=null?String(d):""}if(n.type==="stars"){const d=t.metadata[n.field];if(typeof d!="number")return"";const h=((E=(p=n.options)==null?void 0:p.stars)==null?void 0:E.maxStars)??5,m=Math.max(0,Math.min(h,d)),$=Math.floor(m),T=h-$;return"★".repeat($)+"☆".repeat(T)}if(n.type==="img")return((N=(I=n.options)==null?void 0:I.img)==null?void 0:N.fallback)??"[IMG]";if(n.type==="reference"){const d=t.metadata[n.field];if(d==null)return"";const h=String(d),m=((D=(L=n.options)==null?void 0:L.reference)==null?void 0:D.maxChars)??30;return h.length<=m?h:h.substring(0,m)+"..."}if(n.type==="range"){const d=(_=n.options)==null?void 0:_.range;if(!d)return"";const h=t.metadata[d.minField],m=t.metadata[d.maxField],$=d.separator??" – ",T=d.decimals,W=M=>typeof M!="number"?"":T==null?Number.isInteger(M)?String(M):M.toFixed(1):M.toFixed(T);return h===null&&m===null?"":h===null?W(m):m===null?W(h):`${W(h)}${$}${W(m)}`}const o=t.metadata[n.field];return o!=null?String(o):((b=n.options)==null?void 0:b.naText)??""}function Ot(t,n,o,e,r){const a=t.filter(g=>Number.isFinite(g));if(a.length===0)return"";if(a.length===1){const g=n+e/2,l=o+r/2;return`M${g.toFixed(1)},${l.toFixed(1)}`}const c=Math.min(...a),f=Math.max(...a)-c||1;return`M${a.map((g,l)=>{const s=n+l/(a.length-1)*e,u=o+r-(g-c)/f*r;return`${s.toFixed(1)},${u.toFixed(1)}`}).join("L")}`}const It=6;function dt(t,n,o){const e=t.metadata[n];return e!=null&&typeof e=="number"&&!Number.isNaN(e)?e:o}function zt(t,n){return n<=1?0:-((n-1)*It)/2+t*It}function Vt(t,n,o,e,r,a=[],c,y=0,f=1/0){var d;let i;a.length===0?i=[{point:t.point,lower:t.lower,upper:t.upper,color:null,shape:null,opacity:null}]:i=a.map(h=>({point:dt(t,h.pointCol,t.point),lower:dt(t,h.lowerCol,t.lower),upper:dt(t,h.upperCol,t.upper),color:h.color??null,shape:h.shape??null,opacity:h.opacity??null}));const g=i.filter(h=>h.point!=null&&!Number.isNaN(h.point)&&h.lower!=null&&!Number.isNaN(h.lower)&&h.upper!=null&&!Number.isNaN(h.upper));if(g.length===0)return"";const l=e.shapes.pointSize,s=e.shapes.lineWidth,u=e.colors.intervalLine,p=F.WHISKER_HALF_HEIGHT,E=((d=t.style)==null?void 0:d.type)==="summary",N=e.shapes.summaryHeight/2;function L(h){var $;if(h&&(($=t.markerStyle)==null?void 0:$.size)!=null)return l*t.markerStyle.size;const m=c?t.metadata[c]:void 0;if(m){const T=.5+Math.sqrt(m/100)*1.5;return Math.min(Math.max(l*T,3),l*2.5)}return l}function D(h,m){const $=m===0,T=t.markerStyle,W=e.shapes.markerColors,M=e.shapes.markerShapes,w=["square","circle","diamond","triangle"];let H;$&&(T!=null&&T.color)?H=T.color:h.color?H=h.color:W&&W.length>0?H=W[m%W.length]:H=e.colors.interval??e.colors.primary??"#2563eb";let A;$&&(T!=null&&T.shape)?A=T.shape:h.shape?A=h.shape:M&&M.length>0?A=M[m%M.length]:A=w[m%w.length];let S;return $&&(T==null?void 0:T.opacity)!=null?S=T.opacity:h.opacity!=null?S=h.opacity:S=1,{color:H,shape:A,opacity:S}}function _(h,m,$,T){const{color:W,shape:M,opacity:w}=T,H=w<1?` fill-opacity="${w}"`:"";switch(M){case"circle":return`<circle cx="${h}" cy="${m}" r="${$}" fill="${W}"${H}/>`;case"diamond":return`<polygon points="${[`${h},${m-$}`,`${h+$},${m}`,`${h},${m+$}`,`${h-$},${m}`].join(" ")}" fill="${W}"${H}/>`;case"triangle":return`<polygon points="${[`${h},${m-$}`,`${h+$},${m+$}`,`${h-$},${m+$}`].join(" ")}" fill="${W}"${H}/>`;default:return`<rect x="${h-$}" y="${m-$}" width="${$*2}" height="${$*2}" fill="${W}"${H}/>`}}const b=[];return g.forEach((h,m)=>{const $=n+zt(m,g.length),T=o(h.lower),W=o(h.upper),M=o(h.point),w=D(h,m),H=L(m===0),A=u;if(E){const S=w.opacity<1?` fill-opacity="${w.opacity}"`:"",x=[`${T},${$}`,`${M},${$-N}`,`${W},${$}`,`${M},${$+N}`].join(" ");b.push(`
        <g class="interval effect-${m} summary">
          <polygon points="${x}"
            fill="${w.color}"${S} stroke="${e.colors.summaryBorder}" stroke-width="1"/>
        </g>`)}else{const S=F.AXIS_LABEL_PADDING,x=y+S,G=y+f-S,P=T<x,O=W>G,k=Math.max(x,Math.min(G,T)),C=Math.max(x,Math.min(G,W));let R="";P?R=`<path d="M ${x} ${$} L ${x+6} ${$-4} L ${x+6} ${$+4} Z" fill="${A}"/>`:R=`<line x1="${k}" x2="${k}" y1="${$-p}" y2="${$+p}" stroke="${A}" stroke-width="${s}"/>`;let X="";O?X=`<path d="M ${G} ${$} L ${G-6} ${$-4} L ${G-6} ${$+4} Z" fill="${A}"/>`:X=`<line x1="${C}" x2="${C}" y1="${$-p}" y2="${$+p}" stroke="${A}" stroke-width="${s}"/>`,b.push(`
        <g class="interval effect-${m}">
          <line x1="${k}" x2="${C}" y1="${$}" y2="${$}"
            stroke="${A}" stroke-width="${s}"/>
          ${R}
          ${X}
          ${_(M,$,H,w)}
        </g>`)}}),b.join("")}function Yt(t,n,o,e,r,a,c,y){const i=y.shapes.summaryHeight/2,[g,l]=r.domain().map(b=>r(b)),s=Math.min(g,l),u=Math.max(g,l),p=r(n),E=r(t),I=r(o),N=a+Math.max(s,Math.min(u,p)),L=a+Math.max(s,Math.min(u,E)),D=a+Math.max(s,Math.min(u,I));return`<polygon points="${[`${N},${e}`,`${L},${e-i}`,`${D},${e}`,`${L},${e+i}`].join(" ")}"
    fill="${y.colors.summaryFill}"
    stroke="${y.colors.summaryBorder}"
    stroke-width="1"/>`}function jt(t,n,o,e,r,a=1){const c=[],y=typeof o.axis.tickCount=="number"?o.axis.tickCount:F.DEFAULT_TICK_COUNT,f=Jt(t,y,o,a,n.forestWidth),i=Y(o.typography.fontSizeSm),g=35,l=u=>u<g?"start":u>n.forestWidth-g?"end":"middle",s=u=>u<g?2:u>n.forestWidth-g?-2:0;c.push(`<line x1="${r}" x2="${r+n.forestWidth}"
    y1="0" y2="0" stroke="${o.colors.border}" stroke-width="1"/>`);for(const u of f){const p=t(u),E=r+p,I=l(p),N=s(p);c.push(`<line x1="${E}" x2="${E}" y1="0" y2="4"
      stroke="${o.colors.border}" stroke-width="1"/>`),c.push(`<text x="${E+N}" y="16" text-anchor="${I}"
      font-family="${o.typography.fontFamily}"
      font-size="${i}px"
      fill="${o.colors.secondary}">${Pt(u)}</text>`)}return e&&c.push(`<text x="${r+n.forestWidth/2}" y="28"
      text-anchor="middle"
      font-family="${o.typography.fontFamily}"
      font-size="${i}px"
      font-weight="500"
      fill="${o.colors.secondary}">${B(e)}</text>`),`<g transform="translate(0, ${n.mainY+n.headerHeight+n.plotHeight})">${c.join(`
`)}</g>`}function Jt(t,n,o,e,r){if(Array.isArray(o.axis.tickValues)&&o.axis.tickValues.length>0){const[d,h]=t.domain();let m=o.axis.tickValues.filter(W=>W>=d&&W<=h);const $=o.axis.nullTick!==!1,T=e>=d&&e<=h;return $&&T&&!m.includes(e)&&(m=[...m,e].sort((W,M)=>W-M)),m}const[a,c]=t.domain(),y=o.axis.nullTick!==!1,f=e>=a&&e<=c,i=50,g=Math.max(2,Math.floor(r/i)),l=Math.min(n,Math.min(7,g)),s=t.ticks(l);if(s.length===0)return y&&f?[e]:[];const u=t(e),p=s.filter(d=>d<e).reverse(),E=s.filter(d=>d>e),I=s.some(d=>d===e),N=[];let L=u;for(const d of p){const h=t(d);L-h>=i&&(N.unshift(d),L=h)}const D=[];let _=u;for(const d of E){const h=t(d);h-_>=i&&(D.push(d),_=h)}const b=[...N];if((I||y&&f)&&b.push(e),b.push(...D),b.length<2){const d=new Set(b);d.has(a)||b.unshift(a),b.length<2&&!d.has(c)&&b.push(c)}return b}function Nt(t,n,o,e,r,a,c=1,y=.6){let i=`<line x1="${t}" x2="${t}" y1="${n}" y2="${o}"
    stroke="${r}" stroke-width="${c}" stroke-opacity="${y}" stroke-dasharray="${e==="dashed"?"6,4":e==="dotted"?"2,2":"none"}"/>`;return a&&(i+=`<text x="${t}" y="${n-4}" text-anchor="middle"
      font-size="10px" fill="${r}">${B(a)}</text>`),i}class K extends Error{constructor(n){super(`SVG Generator: ${n}`),this.name="SVGGeneratorError"}}function Kt(t){if(!t||typeof t!="object")throw new K("Invalid spec: expected an object");const n=t;if(!n.data||typeof n.data!="object")throw new K("Invalid spec: missing or invalid 'data' property");const o=n.data;if(!Array.isArray(o.rows))throw new K("Invalid spec: 'data.rows' must be an array");if(!n.theme||typeof n.theme!="object")throw new K("Invalid spec: missing or invalid 'theme' property");const e=n.theme;if(!e.colors||typeof e.colors!="object")throw new K("Invalid spec: missing or invalid 'theme.colors'");if(!e.typography||typeof e.typography!="object")throw new K("Invalid spec: missing or invalid 'theme.typography'");if(!e.spacing||typeof e.spacing!="object")throw new K("Invalid spec: missing or invalid 'theme.spacing'")}function Zt(t,n={}){var W;Kt(t);const o=t.theme,e=vt(t,n),r=o.spacing.padding,a=Array.isArray(t.columns)?t.columns:[],c=nt(a,"left"),y=nt(a,"right"),f=et(a,"left"),i=et(a,"right"),g=e.labelWidth+f.reduce((M,w)=>M+st(w,e.autoWidths),0),l=r+g+v.COLUMN_GAP,s=Rt(t,e.forestWidth,n),u=l+e.forestWidth+v.COLUMN_GAP,p=[];p.push(`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg"
  width="${e.totalWidth}" height="${e.totalHeight}"
  viewBox="0 0 ${e.totalWidth} ${e.totalHeight}">`);const E=n.backgroundColor??o.colors.background;p.push(`<rect width="100%" height="100%" fill="${E}"/>`),p.push(Bt(t,e,o)),p.push(`<line x1="${r}" x2="${e.totalWidth-r}"
    y1="${e.mainY}" y2="${e.mainY}"
    stroke="${o.colors.border}" stroke-width="2"/>`);const I=e.mainY;p.push(Tt(c,f,r,I,e.headerHeight,o,t.data.labelHeader??"Study",e.labelWidth,e.autoWidths)),i.length>0&&p.push(Tt(y,i,u,I,e.headerHeight,o,void 0,void 0,e.autoWidths)),p.push(`<line x1="${r}" x2="${e.totalWidth-r}"
    y1="${I+e.headerHeight}" y2="${I+e.headerHeight}"
    stroke="${o.colors.border}" stroke-width="2"/>`);const N=yt(t),D=(Array.isArray(t.data.groups)?t.data.groups:[]).length>0,_=[],b=[];let d=0;for(const M of N){const H=M.type==="data"&&((W=M.row.style)==null?void 0:W.type)==="spacer"?e.rowHeight/2:e.rowHeight;_.push(d),b.push(H),d+=H}if(t.data.includeForest&&e.forestWidth>0){const M=e.mainY+e.headerHeight,w=l+s(t.data.nullValue);p.push(Nt(w,M,M+e.plotHeight,"dashed",o.colors.muted));const H=Array.isArray(t.annotations)?t.annotations:[];for(const A of H)if(A.type==="reference_line"){const S=l+s(A.x);p.push(Nt(S,M,M+e.plotHeight,A.style,A.color??o.colors.accent,A.label,A.width??1,A.opacity??.6))}if(N.forEach((A,S)=>{if(A.type==="data"){const x=M+_[S]+b[S]/2;p.push(Vt(A.row,x,G=>l+s(G),o,t.data.nullValue,t.data.effects,t.data.weightCol,l,e.forestWidth))}}),t.data.overall&&e.showOverallSummary&&typeof t.data.overall.point=="number"&&!Number.isNaN(t.data.overall.point)&&typeof t.data.overall.lower=="number"&&!Number.isNaN(t.data.overall.lower)&&typeof t.data.overall.upper=="number"&&!Number.isNaN(t.data.overall.upper)){const A=M+e.summaryYPosition;p.push(Yt(t.data.overall.point,t.data.overall.lower,t.data.overall.upper,A,s,l,e.forestWidth,o))}p.push(jt(s,e,o,t.data.axisLabel,l,t.data.nullValue))}const h=e.mainY+e.headerHeight,m=t.data.rows,$=Mt(m,f),T=Mt(m,i);return N.forEach((M,w)=>{var S,x,G;const H=h+_[w],A=b[w];if(M.type==="group_header")p.push(Xt(M.label,M.depth,r,H,A,e.totalWidth-r*2,o));else{const P=M.row,O=M.depth;if(!(((S=P.style)==null?void 0:S.type)==="spacer")){const C=Dt(O),R=!D&&w%2===1?Ht:0,X=Math.max(C,R);X>0&&p.push(`<rect x="${r}" y="${H}"
            width="${e.totalWidth-r*2}" height="${A}"
            fill="${o.colors.muted}" opacity="${X}"/>`)}p.push(Et(P,f,r,H,A,o,!0,e.labelWidth,O,$,e.autoWidths)),i.length>0&&p.push(Et(P,i,u,H,A,o,!1,0,O,T,e.autoWidths))}if(M.type==="data"){const P=M.row,O=((x=P.style)==null?void 0:x.type)==="summary",k=((G=P.style)==null?void 0:G.type)==="spacer";O&&p.push(`<line x1="${r}" x2="${e.totalWidth-r}"
          y1="${H}" y2="${H}"
          stroke="${o.colors.border}" stroke-width="2"/>`),k||p.push(`<line x1="${r}" x2="${e.totalWidth-r}"
          y1="${H+A}" y2="${H+A}"
          stroke="${o.colors.border}" stroke-width="1"/>`)}else p.push(`<line x1="${r}" x2="${e.totalWidth-r}"
        y1="${H+A}" y2="${H+A}"
        stroke="${o.colors.border}" stroke-width="1"/>`)}),p.push(Ct(t,e,o)),p.push("</svg>"),p.join(`
`)}function qt(t,n){const o=JSON.parse(t);return Zt(o,n)}globalThis.generateSVG=qt})();
