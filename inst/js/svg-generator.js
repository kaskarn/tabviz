(function(){"use strict";function bt(t,o){if(o){const d=[.05,.1,.15,.2,.25,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2,1.3,1.4,1.5,1.75,2,2.5,3,4,5,6,7,8,10,12,15,20,25,30,40,50,75,100];let a=d[0];for(const l of d)if(l<=t[0])a=l;else break;let c=d[d.length-1];for(let l=d.length-1;l>=0&&d[l]>=t[1];l--)c=d[l];return[a,c]}const e=t[1]-t[0];if(e===0)return t;const n=Math.pow(10,Math.floor(Math.log10(e))),r=e/n;let i;r<=1?i=n*.1:r<=2?i=n*.2:r<=5?i=n*.5:i=n;const s=Math.floor(t[0]/i)*i,f=Math.ceil(t[1]/i)*i;return[s,f]}const lt=.15,Et=.06,It=.05,ct=.04;function Mt(t){return t<=0?0:ct+t*ct}const G={DEFAULT_LABEL_WIDTH:200,DEFAULT_COLUMN_WIDTH:100,AXIS_HEIGHT:32,AXIS_LABEL_HEIGHT:20,BOTTOM_MARGIN:16,MIN_FOREST_WIDTH:200,DEFAULT_WIDTH:800,COLUMN_GAP:16},R={TITLE_HEIGHT:28,SUBTITLE_HEIGHT:20,CAPTION_HEIGHT:16,FOOTNOTE_HEIGHT:14,DEFAULT_FONT_SIZE:14,REM_BASE:16,TEXT_BASELINE_ADJUSTMENT:1/3},D={INDENT_PER_LEVEL:12,TEXT_PADDING:10,WHISKER_HALF_HEIGHT:4,DEFAULT_TICK_COUNT:5},ut={GROUP_HEADER_HEIGHT_MULTIPLIER:1.5,OVERALL_ROW_HEIGHT_MULTIPLIER:1.5},Y={PADDING:28,MIN:60,MAX:600,LABEL_MAX:400};function Z(t,o){const e=t.split(".");return e[0]=e[0].replace(/\B(?=(\d{3})+(?!\d))/g,o),e.join(".")}function et(t,o=2){const e=Math.abs(t),n=t<0?"-":"";return e>=1e9?n+(e/1e9).toPrecision(o)+"B":e>=1e6?n+(e/1e6).toPrecision(o)+"M":e>=1e3?n+(e/1e3).toPrecision(o)+"K":t.toPrecision(o)}const _t={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","-":"⁻","+":"⁺"};function Nt(t){return t.split("").map(o=>_t[o]??o).join("")}function q(t,o){var f,d,a,c,l;if(t==null||Number.isNaN(t))return(o==null?void 0:o.naText)??"";if(o!=null&&o.percent){const{decimals:h=1,multiply:m=!1,symbol:g=!0}=o.percent,H=(m?t*100:t).toFixed(h);return g?`${H}%`:H}const e=(f=o==null?void 0:o.numeric)==null?void 0:f.abbreviate;if(e&&Math.abs(t)>=1e3)return et(t,typeof e=="number"?e:2);const n=(d=o==null?void 0:o.numeric)==null?void 0:d.digits;if(n!=null){const h=t.toPrecision(n),m=(a=o==null?void 0:o.numeric)==null?void 0:a.thousandsSep;return m&&typeof m=="string"?Z(h,m):h}const r=(c=o==null?void 0:o.numeric)==null?void 0:c.decimals,i=(l=o==null?void 0:o.numeric)==null?void 0:l.thousandsSep;let s;return r!==void 0?s=t.toFixed(r):Number.isInteger(t)||Math.abs(t-Math.round(t))<1e-4?s=Math.round(t).toString():s=t.toFixed(2),i&&typeof i=="string"&&(s=Z(s,i)),s}function ft(t,o){const{eventsField:e,nField:n,separator:r="/",showPct:i=!1,thousandsSep:s,abbreviate:f}=o.events,d=t.metadata[e],a=t.metadata[n];if(d==null||a===void 0||a===null)return o.naText??"";const c=Number(d),l=Number(a);let h,m;if(f&&(c>=1e3||l>=1e3)){const I=typeof f=="number"?f:2;h=c>=1e3?et(c,I):String(c),m=l>=1e3?et(l,I):String(l)}else h=String(c),m=String(l),s&&typeof s=="string"&&(h=Z(h,s),m=Z(m,s));let g=`${h}${r}${m}`;if(i&&l>0){const I=(c/l*100).toFixed(1);g+=` (${I}%)`}return g}function dt(t,o,e,n){var f,d,a;if(t==null||Number.isNaN(t))return"";const r=((f=n==null?void 0:n.interval)==null?void 0:f.decimals)??2,i=((d=n==null?void 0:n.interval)==null?void 0:d.sep)??" ",s=(a=n==null?void 0:n.interval)==null?void 0:a.impreciseThreshold;return o==null||e===void 0||e===null||Number.isNaN(o)||Number.isNaN(e)?t.toFixed(r):s!=null&&o>0&&e/o>s?"—":`${t.toFixed(r)}${i}(${o.toFixed(r)}, ${e.toFixed(r)})`}function ht(t,o){if(t==null||Number.isNaN(t))return(o==null?void 0:o.naText)??"";const e=o==null?void 0:o.pvalue,n=(e==null?void 0:e.digits)??2,r=(e==null?void 0:e.expThreshold)??.001,i=(e==null?void 0:e.abbrevThreshold)??null,s=(e==null?void 0:e.format)??"auto",f=(e==null?void 0:e.stars)??!1,d=(e==null?void 0:e.thresholds)??[.05,.01,.001];let a="";if(f&&(t<d[2]?a="***":t<d[1]?a="**":t<d[0]&&(a="*")),i!==null&&t<i)return`<${i}${a}`;if(s==="scientific"||s==="auto"&&t<r){const l=Math.floor(Math.log10(t));return`${(t/Math.pow(10,l)).toPrecision(n)}×10${Nt(l.toString())}${a}`}let c;return t>=.1?c=t.toFixed(n):t>=.01?c=t.toFixed(n+1):c=t.toFixed(n+2),`${c}${a}`}function At(t,o){var i,s,f,d;const{type:e,field:n,options:r}=o;switch(e){case"interval":{const a=(i=r==null?void 0:r.interval)!=null&&i.point?t.metadata[r.interval.point]:t.point,c=(s=r==null?void 0:r.interval)!=null&&s.lower?t.metadata[r.interval.lower]:t.lower,l=(f=r==null?void 0:r.interval)!=null&&f.upper?t.metadata[r.interval.upper]:t.upper;return dt(a,c,l,r)}case"custom":return r!=null&&r.events?ft(t,r):String(t.metadata[n]??"");case"pvalue":return ht(t.metadata[n],r);case"numeric":return q(t.metadata[n],r);case"percent":return q(t.metadata[n],r);case"sparkline":case"icon":case"badge":case"stars":case"img":case"range":return"";case"bar":{if(((d=r==null?void 0:r.bar)==null?void 0:d.showLabel)===!1)return"";const a=t.metadata[n];return a==null?"":a>=100?a.toFixed(0):a>=10?a.toFixed(1):a.toFixed(2)}case"text":default:return String(t.metadata[n]??"")}}function K(t,o){let e=0;for(const n of t)"il1.,;:|!()[]{}' ".includes(n)?e+=o*.35:"mwMW@%".includes(n)?e+=o*.85:n>="0"&&n<="9"?e+=o*.6:e+=o*.55;return e}function Ht(t,o){var i,s;const e=new Map,n=O(t.theme.typography.fontSizeBase),r=t.data.rows;for(const f of o){if(f.width!=="auto"&&f.width!==null&&f.width!==void 0)continue;let d=0;f.header&&(d=Math.max(d,K(f.header,n)));for(const c of r){if(((i=c.style)==null?void 0:i.type)==="header"||((s=c.style)==null?void 0:s.type)==="spacer")continue;const l=At(c,f);l&&(d=Math.max(d,K(l,n)))}const a=Math.ceil(d+Y.PADDING);e.set(f.id,Math.min(Y.MAX,Math.max(Y.MIN,a)))}return e}function St(t){var r;const o=O(t.theme.typography.fontSizeBase);let e=0;t.data.labelHeader&&(e=Math.max(e,K(t.data.labelHeader,o)));for(const i of t.data.rows)if(i.label){const f=(((r=i.style)==null?void 0:r.indent)??0)*D.INDENT_PER_LEVEL;e=Math.max(e,K(i.label,o)+f)}for(const i of t.data.groups)if(i.label){const s=i.depth*D.INDENT_PER_LEVEL;e=Math.max(e,K(i.label,o)+s)}const n=Math.ceil(e+Y.PADDING);return Math.min(Y.LABEL_MAX,Math.max(Y.MIN,n))}function ot(t,o){const e=o.get(t.id);return e!==void 0?e:typeof t.width=="number"?t.width:G.DEFAULT_COLUMN_WIDTH}function Dt(t,o){var X,V,J,j;const e=t.theme,n=e.spacing.rowHeight,r=e.spacing.padding,i=Array.isArray(t.columns)?t.columns:[],s=tt(i,"left"),f=tt(i,"right"),a=rt(s)||rt(f)?e.spacing.headerHeight*ut.GROUP_HEADER_HEIGHT_MULTIPLIER:e.spacing.headerHeight,c=!!((X=t.labels)!=null&&X.title),l=!!((V=t.labels)!=null&&V.subtitle),h=!!((J=t.labels)!=null&&J.caption),m=!!((j=t.labels)!=null&&j.footnote),g=c?R.TITLE_HEIGHT:0,I=l?R.SUBTITLE_HEIGHT:0,H=g+I+(c||l?r:0),S=h?R.CAPTION_HEIGHT:0,b=m?R.FOOTNOTE_HEIGHT:0,_=S+b+(h||m?r:0),N=pt(t).length,p=!!t.data.overall,u=N*n+(p?n*ut.OVERALL_ROW_HEIGHT_MULTIPLIER:0),y=Q(i,"left"),$=Q(i,"right"),x=[...y,...$],M=Ht(t,x),A=St(t),T=A+y.reduce((B,st)=>B+ot(st,M),0),L=$.reduce((B,st)=>B+ot(st,M),0),P=o.width??G.DEFAULT_WIDTH,v=t.data.includeForest,F=T+L;let w;if(!v)w=0;else if(typeof t.layout.plotWidth=="number")w=t.layout.plotWidth;else{const B=P-F-G.COLUMN_GAP*2-r*2;w=Math.max(B,G.MIN_FOREST_WIDTH)}const k=r*2+F+w+G.COLUMN_GAP*2,U=Math.max(o.width??P,k),C=H+r+a+u+G.AXIS_HEIGHT+G.AXIS_LABEL_HEIGHT+_+G.BOTTOM_MARGIN;return{totalWidth:U,totalHeight:o.height??C,tableWidth:T+L,forestWidth:w,headerHeight:a,rowHeight:n,plotHeight:u,axisHeight:G.AXIS_HEIGHT,nullValue:t.data.nullValue,summaryYPosition:u-n,showOverallSummary:p,headerTextHeight:H,footerTextHeight:_,titleY:r+R.TITLE_HEIGHT-8,subtitleY:r+g+R.SUBTITLE_HEIGHT-4,mainY:H+r,footerY:H+r+a+u+G.AXIS_HEIGHT+G.AXIS_LABEL_HEIGHT+r,autoWidths:M,labelWidth:A}}function pt(t){var l;const o=t.data.rows,e=Array.isArray(t.data.groups)?t.data.groups:[];if(e.length===0)return o.map(h=>({type:"data",row:h,depth:0}));const n=new Map;for(const h of e)n.set(h.id,h);const r=new Map;for(const h of o){const m=h.groupId??null;r.has(m)||r.set(m,[]),r.get(m).push(h)}const i=new Set;for(const h of r.keys()){if(!h)continue;let m=h;for(;m;)i.add(m),m=(l=n.get(m))==null?void 0:l.parentId}function s(h){return e.filter(m=>(m.parentId??null)===h&&i.has(m.id))}function f(h){if(!h)return 0;const m=n.get(h);return m?m.depth+1:0}function d(h){var g;let m=((g=r.get(h))==null?void 0:g.length)??0;for(const I of s(h))m+=d(I.id);return m}const a=[];function c(h){if(h){const g=n.get(h);if(!g)return;const I=d(h);a.push({type:"group_header",groupId:g.id,label:g.label,depth:g.depth,rowCount:I})}for(const g of s(h))c(g.id);const m=r.get(h)??[];for(const g of m)a.push({type:"data",row:g,depth:f(g.groupId)})}return c(null),a}function gt(t){const o=[];for(const e of t)e.isGroup?o.push(...gt(e.columns)):o.push(e);return o}function Q(t,o){const e=[];for(const n of t)n.position===o&&(n.isGroup?e.push(...gt(n.columns)):e.push(n));return e}function tt(t,o){return t.filter(e=>e.position===o)}function rt(t){return t.some(o=>o.isGroup)}function O(t){return t.endsWith("rem")?parseFloat(t)*R.REM_BASE:t.endsWith("px")?parseFloat(t):R.DEFAULT_FONT_SIZE}function nt(t,o,e){return e==="right"?{textX:t+o-D.TEXT_PADDING,anchor:"end"}:e==="center"?{textX:t+o/2,anchor:"middle"}:{textX:t+D.TEXT_PADDING,anchor:"start"}}function W(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function it(t,o,e,n=0){const r=e*.55,i=o-n*2,s=Math.floor(i/r);return t.length<=s?t:t.slice(0,s-1)+"…"}function Lt(t){return Math.abs(t)<.01?"0":Math.abs(t)>=100?t.toFixed(0):Math.abs(t)>=10?t.toFixed(1):t.toFixed(2)}function wt(t,o){const[e,n]=t,[r,i]=o,s=(i-r)/(n-e),f=d=>r+(d-e)*s;return f.domain=()=>t,f.range=()=>o,f.ticks=d=>{const a=(n-e)/(d-1),c=[];for(let l=0;l<d;l++)c.push(e+a*l);return c},f}function Wt(t,o){const[e,n]=t.map(c=>Math.max(c,.001)),[r,i]=o,s=Math.log10(e),f=Math.log10(n),d=(i-r)/(f-s),a=c=>{const l=Math.log10(Math.max(c,.001));return r+(l-s)*d};return a.domain=()=>[e,n],a.range=()=>o,a.ticks=c=>{const l=[],h=Math.floor(Math.log10(e)),m=Math.ceil(Math.log10(n));for(let g=h;g<=m;g++){const I=Math.pow(10,g);for(const H of[1,2,5]){const S=I*H;S>=e&&S<=n&&l.push(S)}}return l.length>0?l:[e,n]},a}function Gt(t,o){const e=t.data.rows,n=t.theme.axis,r=t.data.scale==="log",i=typeof(n==null?void 0:n.rangeMin)=="number",s=typeof(n==null?void 0:n.rangeMax)=="number";let f;if(i&&s)f=[n.rangeMin,n.rangeMax];else{const a=e.flatMap(c=>[c.lower,c.upper]).filter(c=>c!=null&&!Number.isNaN(c)&&Number.isFinite(c));if(a.length===0)f=r?[.1,10]:[0,1];else{const[c,l]=[Math.min(...a),Math.max(...a)],h=l-c||1;f=[i?n.rangeMin:c-h*lt,s?n.rangeMax:l+h*lt]}}const d=bt(f,r);return r?Wt([Math.max(d[0],.01),Math.max(d[1],.02)],[0,o]):wt(d,[0,o])}function Ft(t,o,e){var i,s;const n=[],r=e.spacing.padding;if((i=t.labels)!=null&&i.title){const f=O(e.typography.fontSizeLg);n.push(`<text x="${r}" y="${o.titleY}"
      font-family="${e.typography.fontFamily}"
      font-size="${f}px"
      font-weight="${e.typography.fontWeightBold}"
      fill="${e.colors.foreground}">${W(t.labels.title)}</text>`)}if((s=t.labels)!=null&&s.subtitle){const f=O(e.typography.fontSizeBase);n.push(`<text x="${r}" y="${o.subtitleY}"
      font-family="${e.typography.fontFamily}"
      font-size="${f}px"
      fill="${e.colors.secondary}">${W(t.labels.subtitle)}</text>`)}return n.join(`
`)}function Pt(t,o,e){var s,f;const n=[],r=e.spacing.padding;let i=o.footerY;if((s=t.labels)!=null&&s.caption){const d=O(e.typography.fontSizeSm);n.push(`<text x="${r}" y="${i}"
      font-family="${e.typography.fontFamily}"
      font-size="${d}px"
      fill="${e.colors.secondary}">${W(t.labels.caption)}</text>`),i+=R.CAPTION_HEIGHT}if((f=t.labels)!=null&&f.footnote){const d=O(e.typography.fontSizeSm);n.push(`<text x="${r}" y="${i}"
      font-family="${e.typography.fontFamily}"
      font-size="${d}px"
      font-style="italic"
      fill="${e.colors.muted}">${W(t.labels.footnote)}</text>`)}return n.join(`
`)}function $t(t,o,e,n,r,i,s,f,d){const a=[],c=O(i.typography.fontSizeSm),l=i.typography.fontWeightMedium,h=i.typography.fontWeightBold,m=rt(t),g=f??G.DEFAULT_LABEL_WIDTH,I=b=>{if(d){const _=d.get(b.id);if(_!==void 0)return _}return typeof b.width=="number"?b.width:G.DEFAULT_COLUMN_WIDTH},H=b=>b.isGroup?b.columns.reduce((_,E)=>_+H(E),0):I(b),S=(b,_)=>b+_/2+c*R.TEXT_BASELINE_ADJUSTMENT;if(m){const b=r/2,_=r/2;let E=e;s&&(a.push(`<text x="${E+D.TEXT_PADDING}" y="${S(n,r)}"
        font-family="${i.typography.fontFamily}"
        font-size="${c}px"
        font-weight="${l}"
        fill="${i.colors.foreground}">${W(s)}</text>`),a.push(`<line x1="${E+g}" x2="${E+g}"
        y1="${n}" y2="${n+r}"
        stroke="${i.colors.border}" stroke-width="1" opacity="0.3"/>`),E+=g);for(const N of t)if(N.isGroup){const p=H(N),u=E+p/2;a.push(`<text x="${u}" y="${S(n,b)}"
          font-family="${i.typography.fontFamily}"
          font-size="${c}px"
          font-weight="${h}"
          text-anchor="middle"
          fill="${i.colors.foreground}">${W(N.header)}</text>`),a.push(`<line x1="${E}" x2="${E+p}"
          y1="${n+b}" y2="${n+b}"
          stroke="${i.colors.border}" stroke-width="1" opacity="0.5"/>`),E+=p}else{const p=I(N),u=N.headerAlign??N.align,{textX:y,anchor:$}=nt(E,p,u),x=it(N.header,p,c,D.TEXT_PADDING);a.push(`<text x="${y}" y="${S(n,r)}"
          font-family="${i.typography.fontFamily}"
          font-size="${c}px"
          font-weight="${l}"
          text-anchor="${$}"
          fill="${i.colors.foreground}">${W(x)}</text>`),E+=p}E=e+(s?g:0);for(const N of t)if(N.isGroup){for(const p of N.columns)if(!p.isGroup){const u=I(p),y=p.headerAlign??p.align,{textX:$,anchor:x}=nt(E,u,y);a.push(`<text x="${$}" y="${S(n+b,_)}"
              font-family="${i.typography.fontFamily}"
              font-size="${c}px"
              font-weight="${l}"
              text-anchor="${x}"
              fill="${i.colors.foreground}">${W(p.header)}</text>`),E+=u}}else{const p=I(N);E+=p}}else{let b=e;s&&(a.push(`<text x="${b+D.TEXT_PADDING}" y="${S(n,r)}"
        font-family="${i.typography.fontFamily}"
        font-size="${c}px"
        font-weight="${l}"
        fill="${i.colors.foreground}">${W(s)}</text>`),b+=g);for(const _ of o){const E=I(_),N=_.headerAlign??_.align,{textX:p,anchor:u}=nt(b,E,N),y=it(_.header,E,c,D.TEXT_PADDING);a.push(`<text x="${p}" y="${S(n,r)}"
        font-family="${i.typography.fontFamily}"
        font-size="${c}px"
        font-weight="${l}"
        text-anchor="${u}"
        fill="${i.colors.foreground}">${W(y)}</text>`),b+=E}}return a.join(`
`)}function vt(t,o,e,n,r,i,s){const f=[],d=O(s.typography.fontSizeBase),a=n+r/2+d*R.TEXT_BASELINE_ADJUSTMENT,c=o*D.INDENT_PER_LEVEL;return f.push(`<rect x="${e}" y="${n}"
    width="${i}" height="${r}"
    fill="${s.colors.primary}" opacity="${It}"/>`),f.push(`<text x="${e+D.TEXT_PADDING+c}" y="${a}"
    font-family="${s.typography.fontFamily}"
    font-size="${d}px"
    font-weight="${s.typography.fontWeightBold}"
    fill="${s.colors.foreground}">${W(t)}</text>`),f.join(`
`)}function yt(t,o){const e=new Map;for(const n of o)if(n.type==="bar"){let r=0;for(const i of t){const s=i.metadata[n.field];typeof s=="number"&&s>r&&(r=s)}e.set(n.field,r>0?r:1)}return e}function mt(t,o,e,n,r,i,s,f=G.DEFAULT_LABEL_WIDTH,d=0,a,c){var H,S,b,_,E,N,p,u,y,$,x,M,A;const l=[],h=O(i.typography.fontSizeBase),m=n+r/2+h*R.TEXT_BASELINE_ADJUSTMENT;let g=e;const I=T=>{if(c){const L=c.get(T.id);if(L!==void 0)return L}return typeof T.width=="number"?T.width:G.DEFAULT_COLUMN_WIDTH};if(s){const T=d*D.INDENT_PER_LEVEL+(((H=t.style)==null?void 0:H.indent)??0)*D.INDENT_PER_LEVEL,L=(S=t.style)!=null&&S.bold?i.typography.fontWeightBold:i.typography.fontWeightNormal,P=(b=t.style)!=null&&b.italic?"italic":"normal",v=f-T-D.TEXT_PADDING*2,F=it(t.label,v,h,0);if(l.push(`<text x="${g+D.TEXT_PADDING+T}" y="${m}"
      font-family="${i.typography.fontFamily}"
      font-size="${h}px"
      font-weight="${L}"
      font-style="${P}"
      fill="${((_=t.style)==null?void 0:_.color)??i.colors.foreground}">${W(F)}</text>`),(E=t.style)!=null&&E.badge){const w=String(t.style.badge),k=h*.8,U=4,C=k+U*2,X=t.label.length*h*.55,V=g+D.TEXT_PADDING+T+X+6,j=w.length*k*.6+U*2,B=n+(r-C)/2;l.push(`<rect x="${V}" y="${B}" width="${j}" height="${C}"
        rx="3" fill="${i.colors.primary}" opacity="0.15"/>`),l.push(`<text x="${V+j/2}" y="${B+C/2+k*.35}"
        text-anchor="middle"
        font-family="${i.typography.fontFamily}"
        font-size="${k}px"
        font-weight="500"
        fill="${i.colors.primary}">${W(w)}</text>`)}g+=f}for(const T of o){const L=I(T),P=kt(t,T),{textX:v,anchor:F}=nt(g,L,T.align);if(T.type==="bar"&&typeof t.metadata[T.field]=="number"){const w=t.metadata[T.field],k=a==null?void 0:a.get(T.field),U=((p=(N=T.options)==null?void 0:N.bar)==null?void 0:p.maxValue)??k??100,C=((y=(u=T.options)==null?void 0:u.bar)==null?void 0:y.color)??i.colors.primary,X=i.shapes.pointSize*2,J=L-D.TEXT_PADDING*2-50,j=Math.min(w/U*J,J);l.push(`<rect x="${g+D.TEXT_PADDING}" y="${n+r/2-X/2}"
        width="${Math.max(0,j)}" height="${X}"
        fill="${C}" opacity="0.7" rx="2"/>`);const B=g+L-D.TEXT_PADDING;l.push(`<text x="${B}" y="${m}"
        font-family="${i.typography.fontFamily}"
        font-size="${h}px"
        text-anchor="end"
        fill="${i.colors.foreground}">${q(w)}</text>`)}else if(T.type==="sparkline"&&Array.isArray(t.metadata[T.field])){let w=t.metadata[T.field];Array.isArray(w[0])&&(w=w[0]);const k=((x=($=T.options)==null?void 0:$.sparkline)==null?void 0:x.height)??16,U=((A=(M=T.options)==null?void 0:M.sparkline)==null?void 0:A.color)??i.colors.primary,C=D.TEXT_PADDING*2,X=Ct(w,g+D.TEXT_PADDING,n+r/2-k/2,L-C,k);l.push(`<path d="${X}" fill="none" stroke="${U}" stroke-width="1.5"/>`)}else l.push(`<text x="${v}" y="${m}"
        font-family="${i.typography.fontFamily}"
        font-size="${h}px"
        text-anchor="${F}"
        fill="${i.colors.foreground}">${W(P)}</text>`);g+=L}return l.join(`
`)}function kt(t,o){var n,r,i,s,f,d,a,c,l,h,m,g,I,H,S,b,_,E,N;if(o.type==="interval"){const p=(r=(n=o.options)==null?void 0:n.interval)!=null&&r.point?t.metadata[o.options.interval.point]:t.point,u=(s=(i=o.options)==null?void 0:i.interval)!=null&&s.lower?t.metadata[o.options.interval.lower]:t.lower,y=(d=(f=o.options)==null?void 0:f.interval)!=null&&d.upper?t.metadata[o.options.interval.upper]:t.upper;return dt(p,u,y,o.options)}if(o.type==="numeric"){const p=t.metadata[o.field];return typeof p=="number"?q(p,o.options):((a=o.options)==null?void 0:a.naText)??""}if(o.type==="custom"&&((c=o.options)!=null&&c.events))return ft(t,o.options);if(o.type==="pvalue"){const p=t.metadata[o.field];return typeof p!="number"?((l=o.options)==null?void 0:l.naText)??"":ht(p,o.options)}if(o.type==="icon"){const p=t.metadata[o.field];if(p==null)return"";const u=String(p),y=(m=(h=o.options)==null?void 0:h.icon)==null?void 0:m.mapping;return y&&u in y?y[u]:u}if(o.type==="badge"){const p=t.metadata[o.field];return p!=null?String(p):""}if(o.type==="stars"){const p=t.metadata[o.field];if(typeof p!="number")return"";const u=((I=(g=o.options)==null?void 0:g.stars)==null?void 0:I.maxStars)??5,y=Math.max(0,Math.min(u,p)),$=Math.floor(y),x=u-$;return"★".repeat($)+"☆".repeat(x)}if(o.type==="img")return((S=(H=o.options)==null?void 0:H.img)==null?void 0:S.fallback)??"[IMG]";if(o.type==="reference"){const p=t.metadata[o.field];if(p==null)return"";const u=String(p),y=((_=(b=o.options)==null?void 0:b.reference)==null?void 0:_.maxChars)??30;return u.length<=y?u:u.substring(0,y)+"..."}if(o.type==="range"){const p=(E=o.options)==null?void 0:E.range;if(!p)return"";const u=t.metadata[p.minField],y=t.metadata[p.maxField],$=p.separator??" – ",x=p.decimals,M=A=>typeof A!="number"?"":x==null?Number.isInteger(A)?String(A):A.toFixed(1):A.toFixed(x);return u===null&&y===null?"":u===null?M(y):y===null?M(u):`${M(u)}${$}${M(y)}`}const e=t.metadata[o.field];return e!=null?String(e):((N=o.options)==null?void 0:N.naText)??""}function Ct(t,o,e,n,r){if(t.length===0)return"";const i=Math.min(...t),f=Math.max(...t)-i||1;return`M${t.map((a,c)=>{const l=o+c/(t.length-1)*n,h=e+r-(a-i)/f*r;return`${l.toFixed(1)},${h.toFixed(1)}`}).join("L")}`}const xt=6;function at(t,o,e){const n=t.metadata[o];return n!=null&&typeof n=="number"&&!Number.isNaN(n)?n:e}function Xt(t,o){return o<=1?0:-((o-1)*xt)/2+t*xt}function Rt(t,o,e,n,r,i=[],s,f=0,d=1/0){var p;let a;i.length===0?a=[{point:t.point,lower:t.lower,upper:t.upper,color:null,shape:null,opacity:null}]:a=i.map(u=>({point:at(t,u.pointCol,t.point),lower:at(t,u.lowerCol,t.lower),upper:at(t,u.upperCol,t.upper),color:u.color??null,shape:u.shape??null,opacity:u.opacity??null}));const c=a.filter(u=>u.point!=null&&!Number.isNaN(u.point)&&u.lower!=null&&!Number.isNaN(u.lower)&&u.upper!=null&&!Number.isNaN(u.upper));if(c.length===0)return"";const l=n.shapes.pointSize,h=n.shapes.lineWidth,m=n.colors.intervalLine,g=D.WHISKER_HALF_HEIGHT,I=((p=t.style)==null?void 0:p.type)==="summary",S=n.shapes.summaryHeight/2;function b(u){var $;if(u&&(($=t.markerStyle)==null?void 0:$.size)!=null)return l*t.markerStyle.size;const y=s?t.metadata[s]:void 0;if(y){const x=.5+Math.sqrt(y/100)*1.5;return Math.min(Math.max(l*x,3),l*2.5)}return l}function _(u,y){const $=y===0,x=t.markerStyle;let M;$&&(x!=null&&x.color)?M=x.color:u.color?M=u.color:M=n.colors.interval??n.colors.primary??"#2563eb";let A;$&&(x!=null&&x.shape)?A=x.shape:u.shape?A=u.shape:A="square";let T;return $&&(x==null?void 0:x.opacity)!=null?T=x.opacity:u.opacity!=null?T=u.opacity:T=1,{color:M,shape:A,opacity:T}}function E(u,y,$,x){const{color:M,shape:A,opacity:T}=x,L=T<1?` fill-opacity="${T}"`:"";switch(A){case"circle":return`<circle cx="${u}" cy="${y}" r="${$}" fill="${M}"${L}/>`;case"diamond":return`<polygon points="${[`${u},${y-$}`,`${u+$},${y}`,`${u},${y+$}`,`${u-$},${y}`].join(" ")}" fill="${M}"${L}/>`;case"triangle":return`<polygon points="${[`${u},${y-$}`,`${u+$},${y+$}`,`${u-$},${y+$}`].join(" ")}" fill="${M}"${L}/>`;default:return`<rect x="${u-$}" y="${y-$}" width="${$*2}" height="${$*2}" fill="${M}"${L}/>`}}const N=[];return c.forEach((u,y)=>{const $=o+Xt(y,c.length),x=e(u.lower),M=e(u.upper),A=e(u.point),T=_(u,y),L=b(y===0),P=m;if(I){const v=T.opacity<1?` fill-opacity="${T.opacity}"`:"",F=[`${x},${$}`,`${A},${$-S}`,`${M},${$}`,`${A},${$+S}`].join(" ");N.push(`
        <g class="interval effect-${y} summary">
          <polygon points="${F}"
            fill="${T.color}"${v} stroke="${n.colors.summaryBorder}" stroke-width="1"/>
        </g>`)}else{const v=f,F=f+d,w=x<v,k=M>F,U=Math.max(v,Math.min(F,x)),C=Math.max(v,Math.min(F,M));let X="";w?X=`<path d="M ${v+4} ${$} L ${v+10} ${$-4} L ${v+10} ${$+4} Z" fill="${P}"/>`:X=`<line x1="${U}" x2="${U}" y1="${$-g}" y2="${$+g}" stroke="${P}" stroke-width="${h}"/>`;let V="";k?V=`<path d="M ${F-4} ${$} L ${F-10} ${$-4} L ${F-10} ${$+4} Z" fill="${P}"/>`:V=`<line x1="${C}" x2="${C}" y1="${$-g}" y2="${$+g}" stroke="${P}" stroke-width="${h}"/>`,N.push(`
        <g class="interval effect-${y}">
          <line x1="${U}" x2="${C}" y1="${$}" y2="${$}"
            stroke="${P}" stroke-width="${h}"/>
          ${X}
          ${V}
          ${E(A,$,L,T)}
        </g>`)}}),N.join("")}function Ut(t,o,e,n,r,i,s,f){const a=f.shapes.summaryHeight/2,c=r(o),l=r(t),h=r(e),m=i+Math.max(0,Math.min(s,c)),g=i+Math.max(0,Math.min(s,l)),I=i+Math.max(0,Math.min(s,h));return`<polygon points="${[`${m},${n}`,`${g},${n-a}`,`${I},${n}`,`${g},${n+a}`].join(" ")}"
    fill="${f.colors.summaryFill}"
    stroke="${f.colors.summaryBorder}"
    stroke-width="1"/>`}function Ot(t,o,e,n,r){const i=[],s=typeof e.axis.tickCount=="number"?e.axis.tickCount:D.DEFAULT_TICK_COUNT,f=Array.isArray(e.axis.tickValues)?e.axis.tickValues:t.ticks(s),d=O(e.typography.fontSizeSm);i.push(`<line x1="${r}" x2="${r+o.forestWidth}"
    y1="0" y2="0" stroke="${e.colors.border}" stroke-width="1"/>`);for(const a of f){const c=r+t(a);i.push(`<line x1="${c}" x2="${c}" y1="0" y2="4"
      stroke="${e.colors.border}" stroke-width="1"/>`),i.push(`<text x="${c}" y="16" text-anchor="middle"
      font-family="${e.typography.fontFamily}"
      font-size="${d}px"
      fill="${e.colors.secondary}">${Lt(a)}</text>`)}return n&&i.push(`<text x="${r+o.forestWidth/2}" y="28"
      text-anchor="middle"
      font-family="${e.typography.fontFamily}"
      font-size="${d}px"
      font-weight="500"
      fill="${e.colors.secondary}">${W(n)}</text>`),`<g transform="translate(0, ${o.mainY+o.headerHeight+o.plotHeight})">${i.join(`
`)}</g>`}function Tt(t,o,e,n,r,i,s=1,f=.6){let a=`<line x1="${t}" x2="${t}" y1="${o}" y2="${e}"
    stroke="${r}" stroke-width="${s}" stroke-opacity="${f}" stroke-dasharray="${n==="dashed"?"6,4":n==="dotted"?"2,2":"none"}"/>`;return i&&(a+=`<text x="${t}" y="${o-4}" text-anchor="middle"
      font-size="10px" fill="${r}">${W(i)}</text>`),a}class z extends Error{constructor(o){super(`SVG Generator: ${o}`),this.name="SVGGeneratorError"}}function Vt(t){if(!t||typeof t!="object")throw new z("Invalid spec: expected an object");const o=t;if(!o.data||typeof o.data!="object")throw new z("Invalid spec: missing or invalid 'data' property");const e=o.data;if(!Array.isArray(e.rows))throw new z("Invalid spec: 'data.rows' must be an array");if(!o.theme||typeof o.theme!="object")throw new z("Invalid spec: missing or invalid 'theme' property");const n=o.theme;if(!n.colors||typeof n.colors!="object")throw new z("Invalid spec: missing or invalid 'theme.colors'");if(!n.typography||typeof n.typography!="object")throw new z("Invalid spec: missing or invalid 'theme.typography'");if(!n.spacing||typeof n.spacing!="object")throw new z("Invalid spec: missing or invalid 'theme.spacing'")}function Bt(t,o={}){Vt(t);const e=t.theme,n=Dt(t,o),r=e.spacing.padding,i=Array.isArray(t.columns)?t.columns:[],s=tt(i,"left"),f=tt(i,"right"),d=Q(i,"left"),a=Q(i,"right"),c=n.labelWidth+d.reduce((p,u)=>p+ot(u,n.autoWidths),0),l=r+c,h=Gt(t,n.forestWidth),m=l+n.forestWidth,g=[];g.push(`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg"
  width="${n.totalWidth}" height="${n.totalHeight}"
  viewBox="0 0 ${n.totalWidth} ${n.totalHeight}">`);const I=o.backgroundColor??e.colors.background;g.push(`<rect width="100%" height="100%" fill="${I}"/>`),g.push(Ft(t,n,e));const H=n.mainY;g.push($t(s,d,r,H,n.headerHeight,e,t.data.labelHeader??"Study",n.labelWidth,n.autoWidths)),a.length>0&&g.push($t(f,a,m,H,n.headerHeight,e,void 0,void 0,n.autoWidths)),g.push(`<line x1="${r}" x2="${n.totalWidth-r}"
    y1="${H+n.headerHeight}" y2="${H+n.headerHeight}"
    stroke="${e.colors.border}" stroke-width="1"/>`);const S=pt(t);if(t.data.includeForest&&n.forestWidth>0){const p=n.mainY+n.headerHeight,u=l+h(t.data.nullValue);g.push(Tt(u,p,p+n.plotHeight,"dashed",e.colors.muted));const y=Array.isArray(t.annotations)?t.annotations:[];for(const $ of y)if($.type==="reference_line"){const x=l+h($.x);g.push(Tt(x,p,p+n.plotHeight,$.style,$.color??e.colors.accent,$.label,$.width??1,$.opacity??.6))}if(S.forEach(($,x)=>{if($.type==="data"){const M=p+x*n.rowHeight+n.rowHeight/2;g.push(Rt($.row,M,A=>l+h(A),e,t.data.nullValue,t.data.effects,t.data.weightCol,l,n.forestWidth))}}),t.data.overall&&n.showOverallSummary&&typeof t.data.overall.point=="number"&&!Number.isNaN(t.data.overall.point)&&typeof t.data.overall.lower=="number"&&!Number.isNaN(t.data.overall.lower)&&typeof t.data.overall.upper=="number"&&!Number.isNaN(t.data.overall.upper)){const $=p+n.summaryYPosition;g.push(Ut(t.data.overall.point,t.data.overall.lower,t.data.overall.upper,$,h,l,n.forestWidth,e))}g.push(Ot(h,n,e,t.data.axisLabel,l))}const b=n.mainY+n.headerHeight,_=t.data.rows,E=yt(_,d),N=yt(_,a);return S.forEach((p,u)=>{const y=b+u*n.rowHeight;if(p.type==="group_header")g.push(vt(p.label,p.depth,r,y,n.rowHeight,n.totalWidth-r*2,e));else{const $=p.row,x=p.depth,M=Mt(x),A=u%2===1?Et:0,T=Math.max(M,A);T>0&&g.push(`<rect x="${r}" y="${y}"
          width="${n.totalWidth-r*2}" height="${n.rowHeight}"
          fill="${e.colors.muted}" opacity="${T}"/>`),g.push(mt($,d,r,y,n.rowHeight,e,!0,n.labelWidth,x,E,n.autoWidths)),a.length>0&&g.push(mt($,a,m,y,n.rowHeight,e,!1,0,x,N,n.autoWidths))}g.push(`<line x1="${r}" x2="${n.totalWidth-r}"
      y1="${y+n.rowHeight}" y2="${y+n.rowHeight}"
      stroke="${e.colors.border}" stroke-width="1" opacity="0.5"/>`)}),g.push(Pt(t,n,e)),g.push("</svg>"),g.join(`
`)}function zt(t,o){const e=JSON.parse(t);return Bt(e,o)}globalThis.generateSVG=zt})();
