(function(){"use strict";const Bt=[1,5,2,2.5,4,3],it=[.001,.002,.005,.01,.02,.05,.1,.15,.2,.25,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2,1.3,1.4,1.5,1.75,2,2.5,3,4,5,6,7,8,10,12,15,20,25,30,40,50,75,100,150,200,300,500,750,1e3];function Mt(t,n){return n?pn(t):gn(t)}function pn(t){if(t[0]<=0||t[1]<=0)return[.1,10];if(t[0]>=t[1])return t;let n=it[0];for(const e of it)if(e<=t[0])n=e;else break;t[0]<it[0]&&(n=Math.pow(10,Math.floor(Math.log10(t[0]))));let o=it[it.length-1];for(let e=it.length-1;e>=0&&it[e]>=t[1];e--)o=it[e];return t[1]>it[it.length-1]&&(o=Math.pow(10,Math.ceil(Math.log10(t[1])))),[n,o]}function gn(t){const n=t[1]-t[0];if(n===0)return t;if(n<0)return[t[1],t[0]];const o=Math.pow(10,Math.floor(Math.log10(n)));let e=o,a=1/0;for(const h of Bt)for(const s of[.1,1,10]){const r=h*o*s;if(r<=0)continue;const l=Math.floor(t[0]/r)*r,c=(Math.ceil(t[1]/r)*r-l)/n-1;c>=0&&c<a&&(a=c,e=r)}const i=Math.floor(t[0]/e)*e,u=Math.ceil(t[1]/e)*e;return[Math.round(i*1e10)/1e10,Math.round(u*1e10)/1e10]}function st(t,n,o,e,a=!1){if(t&&o in t){const i=t[o];if(typeof i=="number"&&Number.isFinite(i)&&(!a||i>0))return i}return o===e&&n!=null&&Number.isFinite(n)&&(!a||n>0)?n:null}const mn=20;function yn(t){const{rows:n,config:o,scale:e,nullValue:a,forestWidth:i,pointSize:u,effects:h=[],pointCol:s,lowerCol:r,upperCol:l}=t,d=$n(n,o,e,a,h,s,r,l),f=xn(d,o,e,i,u),c=Ut(d,o,e,a);return{axisLimits:d,plotRegion:f,ticks:c}}function $n(t,n,o,e,a=[],i,u,h){const s=n.rangeMin!=null,r=n.rangeMax!=null;if(s&&r)return[n.rangeMin,n.rangeMax];const l=[],d=o==="log",f=i||"point";for(const E of t){const W=st(E.metadata,void 0,f,"point",d);W!=null&&l.push(W);for(const X of a){const B=st(E.metadata,void 0,X.pointCol,"point",d);B!=null&&l.push(B)}}if(l.length===0)return o==="log"?[.1,10]:[-1,1];let c=Math.min(...l),$=Math.max(...l);(n.includeNull??!0)&&(c=Math.min(c,e),$=Math.max($,e));const _=c,I=$;let S;if(d){const E=Math.max(c,.001),W=Math.max($,.001);S=Math.log(W)-Math.log(E)}else S=$-c;if(S===0||!Number.isFinite(S)){const E=l[0];if(d)return Mt([E/2,E*2],!0);{const W=Math.max(1,Math.abs(E)*.1);return Mt([E-W,E+W],!1)}}const[C,N]=Mt([c,$],d),L=n.ciClipFactor??2;let y=C,m=N;const p=[],T=[],g=u||"lower",b=h||"upper";for(const E of t){const W=st(E.metadata,void 0,g,"lower",d);W!=null&&p.push(W);const X=st(E.metadata,void 0,b,"upper",d);X!=null&&T.push(X);for(const B of a){const z=st(E.metadata,void 0,B.lowerCol,"lower",d);z!=null&&p.push(z);const j=st(E.metadata,void 0,B.upperCol,"upper",d);j!=null&&T.push(j)}}let x,w;if(d)x=y/L,w=m*L;else{const E=m-y;x=y-E*L,w=m+E*L}let A=!1,H=!1;for(const E of p)E>=x?y=Math.min(y,E):A=!0;for(const E of T)E<=w?m=Math.max(m,E):H=!0;if(A&&(y=Math.min(y,x)),H&&(m=Math.max(m,w)),n.symmetric===!0&&!s&&!r)if(o==="log"){const E=Math.log(e),W=Math.max(Math.abs(Math.log(Math.max(_,.001))-E),Math.abs(Math.log(I)-E));y=Math.exp(E-W),m=Math.exp(E+W)}else{const E=Math.max(Math.abs(_-e),Math.abs(I-e));y=e-E,m=e+E}let R=s?n.rangeMin:y,G=r?n.rangeMax:m;return Mt([R,G],o==="log")}function xn(t,n,o,e,a){if(!(n.markerMargin??!0)||e<=0)return t;const u=e-2*mn;if(u<=0)return t;if(o==="log"){const r=Math.log(Math.max(t[0],.001)),l=Math.log(Math.max(t[1],.001)),d=l-r,f=a/2*(d/u),c=Math.min(f,.5);return[Math.exp(r-c),Math.exp(l+c)]}const h=t[1]-t[0],s=a/2*(h/u);return[t[0]-s,t[1]+s]}function Ut(t,n,o,e){const[a,i]=t,u=e>=a&&e<=i,h=(n.nullTick??!0)&&u;if(n.tickValues&&n.tickValues.length>0){let l=n.tickValues.filter(d=>d>=a&&d<=i);return h&&!l.includes(e)&&(l=[...l,e].sort((d,f)=>d-f)),l}const s=n.tickCount??5;let r=o==="log"?bn(t,s):Mn(t,s);return h&&!r.includes(e)&&(r=[...r,e].sort((l,d)=>l-d)),r}function Mn(t,n){const[o,e]=t,a=e-o;if(a===0)return[o];const i=a/Math.max(n-1,1),u=Math.pow(10,Math.floor(Math.log10(i)));let h=u,s=1/0;for(const d of Bt){const f=d*u,c=Math.floor(a/f)+1,$=Math.abs(c-n);$<s&&(s=$,h=f);const M=d*u/10;if(M>0){const _=Math.floor(a/M)+1,I=Math.abs(_-n);I<s&&(s=I,h=M)}}const r=Math.ceil(o/h)*h,l=[];for(let d=r;d<=e+h*.001;d+=h){const f=Math.round(d*1e10)/1e10;f>=o&&f<=e&&l.push(f)}return l.length<2&&(l.includes(o)||l.unshift(o),l.includes(e)||l.push(e)),l}function bn(t,n){const[o,e]=t,i=[.01,.02,.05,.1,.15,.2,.25,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2,1.3,1.4,1.5,1.75,2,2.5,3,4,5,6,7,8,10,12,15,20,25,30,40,50,75,100,150,200,500,1e3].filter(s=>s>=o&&s<=e);if(i.length<=n)return i;const u=[1,.1,10,100,.5,2,5,.2,.25,1.5,3,4,20,50],h=[];for(const s of u)i.includes(s)&&h.length<n&&h.push(s);if(h.length<n){const s=i.filter(l=>!h.includes(l)),r=Math.max(1,Math.floor(s.length/(n-h.length)));for(let l=0;l<s.length&&h.length<n;l+=r)h.push(s[l])}return h.sort((s,r)=>s-r)}function Tn(t){var e,a;const n=((e=t==null?void 0:t.shapes)==null?void 0:e.lineWidth)??1.5,o=((a=t==null?void 0:t.colors)==null?void 0:a.intervalLine)??"#475569";return{width:Math.max(4,Math.round(n*3)),height:Math.max(6,Math.round(n*4)),color:o,opacity:1}}function zt(t,n,o,e){const{width:a,height:i}=e,u=i/2;return t==="left"?`M ${n} ${o} L ${n+a} ${o-u} L ${n+a} ${o+u} Z`:`M ${n} ${o} L ${n-a} ${o-u} L ${n-a} ${o+u} Z`}const Ft={RENDERING_BUFFER:4},ft={FONT_SCALE:.8,PADDING:4,GAP:6},K={DEFAULT_COLUMN_WIDTH:100,AXIS_HEIGHT:32,AXIS_LABEL_HEIGHT:20,BOTTOM_MARGIN:16,MIN_FOREST_WIDTH:200,DEFAULT_WIDTH:800,COLUMN_GAP:16},Q={TITLE_HEIGHT:28,SUBTITLE_HEIGHT:20,CAPTION_HEIGHT:16,FOOTNOTE_HEIGHT:14,DEFAULT_FONT_SIZE:14,REM_BASE:16,TEXT_BASELINE_ADJUSTMENT:1/3},v={INDENT_PER_LEVEL:12,TEXT_PADDING:10,DEFAULT_TICK_COUNT:5,AXIS_LABEL_PADDING:30},Vt={GROUP_HEADER_HEIGHT_MULTIPLIER:1.3,OVERALL_ROW_HEIGHT_MULTIPLIER:1.5},gt={MIN:60,MAX:600,LABEL_MAX:400,VISUAL_MIN:{sparkline:92,bar:100,stars:84,range:84,badge:74}},bt={CHEVRON_WIDTH:12,GAP:6,SAFETY_MARGIN:8},Ot={SPACING:6};function En(t,n){return n<=1?0:-((n-1)*Ot.SPACING)/2+t*Ot.SPACING}function Tt(t,n){const o=t.split(".");return o[0]=o[0].replace(/\B(?=(\d{3})+(?!\d))/g,n),o.join(".")}function Ct(t){const n=Math.abs(t),o=t<0?"-":"";if(n>=1e12)throw new Error(`Cannot abbreviate value >= 1 trillion: ${t}`);if(n>=1e9){const e=n/1e9;return o+Gt(e)+"B"}if(n>=1e6){const e=n/1e6;return o+Gt(e)+"M"}if(n>=1e3){const e=n/1e3;return o+Gt(e)+"K"}return o+Math.round(n).toString()}function Gt(t){const n=Math.round(t*10)/10;return n===Math.floor(n)?n.toFixed(0):n.toFixed(1)}const In={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","-":"⁻","+":"⁺"};function An(t){return t.split("").map(n=>In[n]??n).join("")}function Et(t,n){var h,s,r,l,d;if(t==null||Number.isNaN(t))return(n==null?void 0:n.naText)??"";if(n!=null&&n.percent){const{decimals:f,digits:c,multiply:$=!0,symbol:M=!0}=n.percent,_=$?t*100:t,I=c!=null?_.toPrecision(c):_.toFixed(f??1);return M?`${I}%`:I}if(((h=n==null?void 0:n.numeric)==null?void 0:h.abbreviate)&&Math.abs(t)>=1e3)return Ct(t);const e=(s=n==null?void 0:n.numeric)==null?void 0:s.digits;if(e!=null){const f=t.toPrecision(e),c=(r=n==null?void 0:n.numeric)==null?void 0:r.thousandsSep;return c&&typeof c=="string"?Tt(f,c):f}const a=(l=n==null?void 0:n.numeric)==null?void 0:l.decimals,i=(d=n==null?void 0:n.numeric)==null?void 0:d.thousandsSep;let u;return a!==void 0?u=t.toFixed(a):Number.isInteger(t)||Math.abs(t-Math.round(t))<1e-4?u=Math.round(t).toString():u=t.toFixed(2),i&&typeof i=="string"&&(u=Tt(u,i)),u}function jt(t,n){const{eventsField:o,nField:e,separator:a="/",showPct:i=!1,thousandsSep:u,abbreviate:h}=n.events,s=t.metadata[o],r=t.metadata[e];if(s==null||r===void 0||r===null)return n.naText??"";const l=Number(s),d=Number(r);let f,c;h&&(l>=1e3||d>=1e3)?(f=l>=1e3?Ct(l):String(l),c=d>=1e3?Ct(d):String(d)):(f=String(l),c=String(d),u&&typeof u=="string"&&(f=Tt(f,u),c=Tt(c,u)));let $=`${f}${a}${c}`;if(i&&d>0){const M=(l/d*100).toFixed(1);$+=` (${M}%)`}return $}function Yt(t,n,o,e){var h,s,r;if(t==null||Number.isNaN(t))return"";const a=((h=e==null?void 0:e.interval)==null?void 0:h.decimals)??2,i=((s=e==null?void 0:e.interval)==null?void 0:s.sep)??" ",u=(r=e==null?void 0:e.interval)==null?void 0:r.impreciseThreshold;return n==null||o===void 0||o===null||Number.isNaN(n)||Number.isNaN(o)?t.toFixed(a):u!=null&&n>0&&o/n>u?"—":`${t.toFixed(a)}${i}(${n.toFixed(a)}, ${o.toFixed(a)})`}function Jt(t,n){if(t==null||Number.isNaN(t))return(n==null?void 0:n.naText)??"";const o=n==null?void 0:n.pvalue,e=(o==null?void 0:o.digits)??2,a=(o==null?void 0:o.expThreshold)??.001,i=(o==null?void 0:o.abbrevThreshold)??null,u=(o==null?void 0:o.format)??"auto",h=(o==null?void 0:o.stars)??!1,s=(o==null?void 0:o.thresholds)??[.05,.01,.001];let r="";if(h&&(t<s[2]?r="***":t<s[1]?r="**":t<s[0]&&(r="*")),i!==null&&t<i)return`<${i}${r}`;if(u==="scientific"||u==="auto"&&t<a){const d=Math.floor(Math.log10(t));return`${(t/Math.pow(10,d)).toPrecision(e)}×10${An(d.toString())}${r}`}let l;return t>=.1?l=t.toFixed(e):t>=.01?l=t.toFixed(e+1):l=t.toFixed(e+2),`${l}${r}`}function Nn(t,n){var i,u,h,s;const{type:o,field:e,options:a}=n;switch(o){case"interval":{const r=(i=a==null?void 0:a.interval)!=null&&i.point?t.metadata[a.interval.point]:t.point,l=(u=a==null?void 0:a.interval)!=null&&u.lower?t.metadata[a.interval.lower]:t.lower,d=(h=a==null?void 0:a.interval)!=null&&h.upper?t.metadata[a.interval.upper]:t.upper;return Yt(r,l,d,a)}case"custom":return a!=null&&a.events?jt(t,a):String(t.metadata[e]??"");case"pvalue":return Jt(t.metadata[e],a);case"numeric":return Et(t.metadata[e],a);case"percent":return Et(t.metadata[e],a);case"sparkline":case"icon":case"stars":case"img":case"range":return"";case"badge":{const r=t.metadata[e];return r==null?"":`  ${String(r)}  `}case"bar":{if(((s=a==null?void 0:a.bar)==null?void 0:s.showLabel)===!1)return"";const r=t.metadata[e];return r==null?"":r>=100?r.toFixed(0):r>=10?r.toFixed(1):r.toFixed(2)}case"text":default:return String(t.metadata[e]??"")}}function q(t,n){const o="⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻";let e=0;for(const a of t)o.includes(a)?e+=n*.3:"il1.,;:|!()[]{}' ".includes(a)?e+=n*.35:"×−".includes(a)?e+=n*.5:"mwMW@%".includes(a)?e+=n*.85:a>="0"&&a<="9"?e+=n*.6:e+=n*.55;return e}function Sn(t,n){var r,l;const o=new Map,e=tt(t.theme.typography.fontSizeBase),a=t.theme.typography.headerFontScale??1.05,i=e*a,u=t.data.rows,h=(t.theme.spacing.cellPaddingX??10)*2,s=(t.theme.spacing.groupPadding??8)*2;for(const d of n){if(d.width!=="auto"&&d.width!==null&&d.width!==void 0)continue;let f=0;d.header&&(f=Math.max(f,q(d.header,i)));for(const M of u){if(((r=M.style)==null?void 0:r.type)==="header"||((l=M.style)==null?void 0:l.type)==="spacer")continue;const _=Nn(M,d);_&&(f=Math.max(f,q(_,e)))}const c=gt.VISUAL_MIN[d.type]??gt.MIN,$=Math.ceil(f+h+Ft.RENDERING_BUFFER);o.set(d.id,Math.min(gt.MAX,Math.max(c,$)))}return _n(t.columns,o,i,s,Ft.RENDERING_BUFFER),o}function _n(t,n,o,e,a){function i(s){return s.isGroup?s.columns.flatMap(i):[s]}function u(s){const r=n.get(s.id);return r!==void 0?r:typeof s.width=="number"?s.width:gt.MIN}function h(s){if(s.isGroup){for(const r of s.columns)h(r);if(s.header){const r=q(s.header,o)+e+a,l=i(s),d=l.reduce((f,c)=>f+u(c),0);if(r>d&&l.length>0){const f=Math.ceil((r-d)/l.length);for(const c of l)n.set(c.id,u(c)+f)}}}}for(const s of t)h(s)}function qt(t,n,o){let e=o.filter(i=>i.groupId===t).length;const a=n.filter(i=>i.parentId===t);for(const i of a)e+=qt(i.id,n,o);return e}function Zt(t){var s,r;const n=tt(t.theme.typography.fontSizeBase),o=(t.theme.spacing.cellPaddingX??10)*2;let e=0;const a=new Map,i=Array.isArray(t.data.groups)?t.data.groups:[];for(const l of i)a.set(l.id,l.depth);const u=l=>l?(a.get(l)??0)+1:0;t.data.labelHeader&&(e=Math.max(e,q(t.data.labelHeader,n)));for(const l of t.data.rows)if(l.label){const d=u(l.groupId),f=((s=l.style)==null?void 0:s.indent)??0,$=(d+f)*v.INDENT_PER_LEVEL;let M=q(l.label,n)+$;if((r=l.style)!=null&&r.badge){const _=String(l.style.badge),I=n*ft.FONT_SCALE,C=q(_,I)+ft.PADDING*2;M+=ft.GAP+C}e=Math.max(e,M)}for(const l of i)if(l.label){const d=l.depth*v.INDENT_PER_LEVEL,f=q(l.label,n),$=`(${qt(l.id,i,t.data.rows)})`,M=n*.75,_=q($,M),I=d+bt.CHEVRON_WIDTH+bt.GAP+f+bt.GAP+_+bt.SAFETY_MARGIN;e=Math.max(e,I)}const h=Math.ceil(e+o+Ft.RENDERING_BUFFER);return Math.min(gt.LABEL_MAX,Math.max(gt.MIN,h))}function Kt(t,n){const o=n.get(t.id);return o!==void 0?o:typeof t.width=="number"?t.width:K.DEFAULT_COLUMN_WIDTH}function wn(t,n,o=0){var B,z,j,nt,ot;const e=t.theme,a=e.spacing.rowHeight,i=e.spacing.padding,u=Array.isArray(t.columns)?t.columns:[],h=nn(u,"left"),s=nn(u,"right"),l=vt(h)||vt(s)?e.spacing.headerHeight*Vt.GROUP_HEADER_HEIGHT_MULTIPLIER:e.spacing.headerHeight,d=!!((B=t.labels)!=null&&B.title),f=!!((z=t.labels)!=null&&z.subtitle),c=!!((j=t.labels)!=null&&j.caption),$=!!((nt=t.labels)!=null&&nt.footnote),M=d?Q.TITLE_HEIGHT:0,_=f?Q.SUBTITLE_HEIGHT:0,I=M+_+(d||f?i:0),S=c?Q.CAPTION_HEIGHT:0,C=$?Q.FOOTNOTE_HEIGHT:0,N=S+C+(c||$?i:0),L=Qt(t),y=!!t.data.overall;let m=0;for(const D of L){const V=D.type==="data"&&((ot=D.row.style)==null?void 0:ot.type)==="spacer";m+=V?a/2:a}y&&(m+=a*Vt.OVERALL_ROW_HEIGHT_MULTIPLIER);const p=Ht(u,"left"),T=Ht(u,"right"),g=[...p,...T];let b,x;if(n.columnWidths){b=new Map;for(const[D,V]of Object.entries(n.columnWidths))D!=="__label__"&&b.set(D,V);x=n.columnWidths.__label__??Zt(t)}else b=Sn(t,g),x=Zt(t);const w=x+p.reduce((D,V)=>D+Kt(V,b),0),A=T.reduce((D,V)=>D+Kt(V,b),0),H=n.width??K.DEFAULT_WIDTH,P=t.data.includeForest,R=w+A;let G;if(!P)G=0;else if(typeof n.forestWidth=="number")G=n.forestWidth;else if(typeof t.layout.plotWidth=="number")G=t.layout.plotWidth;else{const D=H-R-K.COLUMN_GAP*2-i*2;G=Math.max(D,K.MIN_FOREST_WIDTH)}const E=i*2+R+G+K.COLUMN_GAP*2,W=Math.max(n.width??H,E),X=I+i+l+m+K.AXIS_HEIGHT+K.AXIS_LABEL_HEIGHT+N+K.BOTTOM_MARGIN;return{totalWidth:W,totalHeight:n.height??X,tableWidth:w+A,forestWidth:G,headerHeight:l,rowHeight:a,plotHeight:m,axisHeight:K.AXIS_HEIGHT,nullValue:o,summaryYPosition:m-a,showOverallSummary:y,headerTextHeight:I,footerTextHeight:N,titleY:i+Q.TITLE_HEIGHT-8,subtitleY:i+M+Q.SUBTITLE_HEIGHT-4,mainY:I+i,footerY:I+i+l+m+K.AXIS_HEIGHT+K.AXIS_LABEL_HEIGHT+i,autoWidths:b,labelWidth:x}}function Qt(t){var d;const n=t.data.rows,o=Array.isArray(t.data.groups)?t.data.groups:[];if(o.length===0)return n.map(f=>({type:"data",row:f,depth:0}));const e=new Map;for(const f of o)e.set(f.id,f);const a=new Map;for(const f of n){const c=f.groupId??null;a.has(c)||a.set(c,[]),a.get(c).push(f)}const i=new Set;for(const f of a.keys()){if(!f)continue;let c=f;for(;c;)i.add(c),c=(d=e.get(c))==null?void 0:d.parentId}function u(f){return o.filter(c=>(c.parentId??null)===f&&i.has(c.id))}function h(f){if(!f)return 0;const c=e.get(f);return c?c.depth+1:0}function s(f){var $;let c=(($=a.get(f))==null?void 0:$.length)??0;for(const M of u(f))c+=s(M.id);return c}const r=[];function l(f){if(f){const $=e.get(f);if(!$)return;const M=s(f);r.push({type:"group_header",groupId:$.id,label:$.label,depth:$.depth,rowCount:M})}for(const $ of u(f))l($.id);const c=a.get(f)??[];for(const $ of c)r.push({type:"data",row:$,depth:h($.groupId)})}return l(null),r}function Lt(t){const n=[];for(const o of t)o.isGroup?n.push(...Lt(o.columns)):n.push(o);return n}function tn(t){const n=[];for(const o of t)o.isGroup?n.push(...Lt(o.columns)):n.push(o);return n}function Ht(t,n){if(n===void 0)return tn(t);const o=[];for(const e of t)e.position===n&&(e.isGroup?o.push(...Lt(e.columns)):o.push(e));return o}function nn(t,n){return t.filter(o=>o.position===n)}function vt(t){return t.some(n=>n.isGroup)}function tt(t){return t.endsWith("rem")?parseFloat(t)*Q.REM_BASE:t.endsWith("px")?parseFloat(t):Q.DEFAULT_FONT_SIZE}function It(t,n,o){return o==="right"?{textX:t+n-v.TEXT_PADDING,anchor:"end"}:o==="center"?{textX:t+n/2,anchor:"middle"}:{textX:t+v.TEXT_PADDING,anchor:"start"}}function O(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function Wt(t,n,o,e=0){const a=n-e*2;if(q(t,o)<=a)return t;const u="…",h=o*.55;let s=0,r=t.length;for(;s<r;){const l=Math.ceil((s+r)/2),d=t.slice(0,l);q(d,o)+h<=a?s=l:r=l-1}return s===0?u:t.slice(0,s)+u}function Dn(t){return Math.abs(t)<.01?"0":Math.abs(t)>=100?t.toFixed(0):Math.abs(t)>=10?t.toFixed(1):t.toFixed(2)}function en(t,n){const[o,e]=t,[a,i]=n,u=(i-a)/(e-o),h=s=>a+(s-o)*u;return h.domain=()=>t,h.range=()=>n,h.ticks=s=>{const r=(e-o)/(s-1),l=[];for(let d=0;d<s;d++)l.push(o+r*d);return l},h}function on(t,n){const[o,e]=t.map(l=>Math.max(l,.001)),[a,i]=n,u=Math.log10(o),h=Math.log10(e),s=(i-a)/(h-u),r=l=>{const d=Math.log10(Math.max(l,.001));return a+(d-u)*s};return r.domain=()=>[o,e],r.range=()=>n,r.ticks=l=>{const d=[],f=Math.floor(Math.log10(o)),c=Math.ceil(Math.log10(e));for(let $=f;$<=c;$++){const M=Math.pow(10,$);for(const _ of[1,2,5]){const I=M*_;I>=o&&I<=e&&d.push(I)}}return d.length>0?d:[o,e]},r}function Fn(t,n,o,e){const a=o.scale==="log",i=v.AXIS_LABEL_PADDING,u=i,h=Math.max(n-i,u+50);if(e!=null&&e.xDomain){const f=e.xDomain,c=e.clipBounds??f,$=Ut(c,t.theme.axis,o.scale,o.nullValue);return a?{scale:on([Math.max(f[0],.01),Math.max(f[1],.02)],[u,h]),clipBounds:c,ticks:$}:{scale:en(f,[u,h]),clipBounds:c,ticks:$}}const s=yn({rows:t.data.rows,config:t.theme.axis,scale:o.scale,nullValue:o.nullValue,forestWidth:n,pointSize:t.theme.shapes.pointSize,effects:o.effects,pointCol:o.pointCol,lowerCol:o.lowerCol,upperCol:o.upperCol}),{plotRegion:r,axisLimits:l,ticks:d}=s;return a?{scale:on([Math.max(r[0],.01),Math.max(r[1],.02)],[u,h]),clipBounds:l,ticks:d}:{scale:en(r,[u,h]),clipBounds:l,ticks:d}}function Cn(t,n,o){var i,u;const e=[],a=o.spacing.padding;if((i=t.labels)!=null&&i.title){const h=tt(o.typography.fontSizeLg);e.push(`<text x="${a}" y="${n.titleY}"
      font-family="${o.typography.fontFamily}"
      font-size="${h}px"
      font-weight="${o.typography.fontWeightBold}"
      fill="${o.colors.foreground}">${O(t.labels.title)}</text>`)}if((u=t.labels)!=null&&u.subtitle){const h=tt(o.typography.fontSizeBase);e.push(`<text x="${a}" y="${n.subtitleY}"
      font-family="${o.typography.fontFamily}"
      font-size="${h}px"
      fill="${o.colors.secondary}">${O(t.labels.subtitle)}</text>`)}return e.join(`
`)}function Gn(t,n,o){var u,h;const e=[],a=o.spacing.padding;let i=n.footerY;if((u=t.labels)!=null&&u.caption){const s=tt(o.typography.fontSizeSm);e.push(`<text x="${a}" y="${i}"
      font-family="${o.typography.fontFamily}"
      font-size="${s}px"
      fill="${o.colors.secondary}">${O(t.labels.caption)}</text>`),i+=Q.CAPTION_HEIGHT}if((h=t.labels)!=null&&h.footnote){const s=tt(o.typography.fontSizeSm);e.push(`<text x="${a}" y="${i}"
      font-family="${o.typography.fontFamily}"
      font-size="${s}px"
      font-style="italic"
      fill="${o.colors.muted}">${O(t.labels.footnote)}</text>`)}return e.join(`
`)}function Ln(t,n,o,e,a,i,u){const h=[],s=n+1,r=u.groupHeaders;let l,d,f,c,$;if(s===1?(l=tt((r==null?void 0:r.level1FontSize)??u.typography.fontSizeBase),d=(r==null?void 0:r.level1FontWeight)??u.typography.fontWeightBold,f=(r==null?void 0:r.level1Italic)??!1,c=(r==null?void 0:r.level1Background)??null,$=(r==null?void 0:r.level1BorderBottom)??!1):s===2?(l=tt((r==null?void 0:r.level2FontSize)??u.typography.fontSizeBase),d=(r==null?void 0:r.level2FontWeight)??u.typography.fontWeightMedium,f=(r==null?void 0:r.level2Italic)??!0,c=(r==null?void 0:r.level2Background)??null,$=(r==null?void 0:r.level2BorderBottom)??!1):(l=tt((r==null?void 0:r.level3FontSize)??u.typography.fontSizeBase),d=(r==null?void 0:r.level3FontWeight)??u.typography.fontWeightNormal,f=(r==null?void 0:r.level3Italic)??!1,c=(r==null?void 0:r.level3Background)??null,$=(r==null?void 0:r.level3BorderBottom)??!1),!c){const S=u.colors.primary,C=s===1?.15:s===2?.1:.06,N=S.replace("#",""),L=parseInt(N.substring(0,2),16),y=parseInt(N.substring(2,4),16),m=parseInt(N.substring(4,6),16);c=`rgba(${L}, ${y}, ${m}, ${C})`}const M=e+a/2+l*Q.TEXT_BASELINE_ADJUSTMENT,_=n*((r==null?void 0:r.indentPerLevel)??v.INDENT_PER_LEVEL);h.push(`<rect x="${o}" y="${e}"
    width="${i}" height="${a}"
    fill="${c}"/>`),$&&h.push(`<line x1="${o}" x2="${o+i}" y1="${e+a}" y2="${e+a}"
      stroke="${u.colors.border}" stroke-width="1" opacity="0.5"/>`);const I=f?' font-style="italic"':"";return h.push(`<text x="${o+v.TEXT_PADDING+_}" y="${M}"
    font-family="${u.typography.fontFamily}"
    font-size="${l}px"
    font-weight="${d}"${I}
    fill="${u.colors.foreground}">${O(t)}</text>`),h.join(`
`)}function Hn(t,n){const o=new Map;for(const e of n)if(e.type==="bar"){let a=0;for(const i of t){const u=i.metadata[e.field];typeof u=="number"&&u>a&&(a=u)}o.set(e.field,a>0?a:1)}return o}function vn(t,n){var e,a,i,u,h,s,r,l,d,f,c,$,M,_,I,S,C,N,L;if(n.type==="interval"){const y=(a=(e=n.options)==null?void 0:e.interval)!=null&&a.point?t.metadata[n.options.interval.point]:t.point,m=(u=(i=n.options)==null?void 0:i.interval)!=null&&u.lower?t.metadata[n.options.interval.lower]:t.lower,p=(s=(h=n.options)==null?void 0:h.interval)!=null&&s.upper?t.metadata[n.options.interval.upper]:t.upper;return Yt(y,m,p,n.options)}if(n.type==="numeric"){const y=t.metadata[n.field];return typeof y=="number"?Et(y,n.options):((r=n.options)==null?void 0:r.naText)??""}if(n.type==="custom"&&((l=n.options)!=null&&l.events))return jt(t,n.options);if(n.type==="pvalue"){const y=t.metadata[n.field];return typeof y!="number"?((d=n.options)==null?void 0:d.naText)??"":Jt(y,n.options)}if(n.type==="icon"){const y=t.metadata[n.field];if(y==null)return"";const m=String(y),p=(c=(f=n.options)==null?void 0:f.icon)==null?void 0:c.mapping;return p&&m in p?p[m]:m}if(n.type==="badge"){const y=t.metadata[n.field];return y!=null?String(y):""}if(n.type==="stars"){const y=t.metadata[n.field];if(typeof y!="number")return"";const m=((M=($=n.options)==null?void 0:$.stars)==null?void 0:M.maxStars)??5,p=Math.max(0,Math.min(m,y)),T=Math.floor(p),g=m-T;return"★".repeat(T)+"☆".repeat(g)}if(n.type==="img")return((I=(_=n.options)==null?void 0:_.img)==null?void 0:I.fallback)??"[IMG]";if(n.type==="reference"){const y=t.metadata[n.field];if(y==null)return"";const m=String(y),p=((C=(S=n.options)==null?void 0:S.reference)==null?void 0:C.maxChars)??30;return m.length<=p?m:m.substring(0,p)+"..."}if(n.type==="range"){const y=(N=n.options)==null?void 0:N.range;if(!y)return"";const m=t.metadata[y.minField],p=t.metadata[y.maxField],T=y.separator??" – ",g=y.decimals,b=x=>typeof x!="number"?"":g==null?Number.isInteger(x)?String(x):x.toFixed(1):x.toFixed(g);return m===null&&p===null?"":m===null?b(p):p===null?b(m):`${b(m)}${T}${b(p)}`}const o=t.metadata[n.field];return o!=null?String(o):((L=n.options)==null?void 0:L.naText)??""}function Wn(t,n,o,e,a){const i=t.filter(l=>Number.isFinite(l));if(i.length===0)return"";if(i.length===1){const l=n+e/2,d=o+a/2;return`M${l.toFixed(1)},${d.toFixed(1)}`}const u=Math.min(...i),s=Math.max(...i)-u||1;return`M${i.map((l,d)=>{const f=n+d/(i.length-1)*e,c=o+a-(l-u)/s*a;return`${f.toFixed(1)},${c.toFixed(1)}`}).join("L")}`}function kn(t,n,o,e,a,i=[],u,h=0,s=1/0,r,l=!1){var m;let d;if(i.length===0){const p=!l||t.point!=null&&t.point>0?t.point:null,T=!l||t.lower!=null&&t.lower>0?t.lower:null,g=!l||t.upper!=null&&t.upper>0?t.upper:null;d=[{point:p,lower:T,upper:g,color:null,shape:null,opacity:null}]}else d=i.map(p=>({point:st(t.metadata,t.point,p.pointCol,"point",l),lower:st(t.metadata,t.lower,p.lowerCol,"lower",l),upper:st(t.metadata,t.upper,p.upperCol,"upper",l),color:p.color??null,shape:p.shape??null,opacity:p.opacity??null}));const f=d.filter(p=>p.point!=null&&!Number.isNaN(p.point)&&p.lower!=null&&!Number.isNaN(p.lower)&&p.upper!=null&&!Number.isNaN(p.upper));if(f.length===0)return"";const c=e.shapes.pointSize,$=e.shapes.lineWidth,M=e.colors.intervalLine,_=((m=t.style)==null?void 0:m.type)==="summary",S=e.shapes.summaryHeight/2;function C(p){var g;if(p&&((g=t.markerStyle)==null?void 0:g.size)!=null)return c*t.markerStyle.size;const T=u?t.metadata[u]:void 0;if(T){const b=.5+Math.sqrt(T/100)*1.5;return Math.min(Math.max(c*b,3),c*2.5)}return c}function N(p,T){const g=T===0,b=t.markerStyle,x=e.shapes.markerColors,w=e.shapes.markerShapes,A=["square","circle","diamond","triangle"];let H;g&&(b!=null&&b.color)?H=b.color:p.color?H=p.color:x&&x.length>0?H=x[T%x.length]:H=e.colors.interval??e.colors.primary??"#2563eb";let P;g&&(b!=null&&b.shape)?P=b.shape:p.shape?P=p.shape:w&&w.length>0?P=w[T%w.length]:P=A[T%A.length];let R;return g&&(b==null?void 0:b.opacity)!=null?R=b.opacity:p.opacity!=null?R=p.opacity:R=1,{color:H,shape:P,opacity:R}}function L(p,T,g,b){const{color:x,shape:w,opacity:A}=b,H=A<1?` fill-opacity="${A}"`:"";switch(w){case"circle":return`<circle cx="${p}" cy="${T}" r="${g}" fill="${x}"${H}/>`;case"diamond":return`<polygon points="${[`${p},${T-g}`,`${p+g},${T}`,`${p},${T+g}`,`${p-g},${T}`].join(" ")}" fill="${x}"${H}/>`;case"triangle":return`<polygon points="${[`${p},${T-g}`,`${p+g},${T+g}`,`${p-g},${T+g}`].join(" ")}" fill="${x}"${H}/>`;default:return`<rect x="${p-g}" y="${T-g}" width="${g*2}" height="${g*2}" fill="${x}"${H}/>`}}const y=[];return f.forEach((p,T)=>{const g=n+En(T,f.length),b=o(p.lower),x=o(p.upper),w=o(p.point),A=N(p,T),H=C(T===0),P=M;if(_){const R=A.opacity<1?` fill-opacity="${A.opacity}"`:"",G=[`${b},${g}`,`${w},${g-S}`,`${x},${g}`,`${w},${g+S}`].join(" ");y.push(`
        <g class="interval effect-${T} summary">
          <polygon points="${G}"
            fill="${A.color}"${R} stroke="${e.colors.summaryBorder}" stroke-width="1"/>
        </g>`)}else{const R=v.AXIS_LABEL_PADDING,G=h+R,E=h+s-R,W=r?p.lower<r[0]:b<G,X=r?p.upper>r[1]:x>E;let B,z;if(r){const mt=Math.max(r[0],Math.min(r[1],p.lower)),yt=Math.max(r[0],Math.min(r[1],p.upper));B=o(mt),z=o(yt)}else B=Math.max(G,Math.min(E,b)),z=Math.max(G,Math.min(E,x));const j=Tn(e),nt=j.height/2;let ot="";W?ot=`<path d="${zt("left",G,g,j)}" fill="${j.color}"/>`:ot=`<line x1="${B}" x2="${B}" y1="${g-nt}" y2="${g+nt}" stroke="${P}" stroke-width="${$}"/>`;let D="";X?D=`<path d="${zt("right",E,g,j)}" fill="${j.color}"/>`:D=`<line x1="${z}" x2="${z}" y1="${g-nt}" y2="${g+nt}" stroke="${P}" stroke-width="${$}"/>`;const V=r?o(Math.max(r[0],Math.min(r[1],p.point))):Math.max(G,Math.min(E,w));y.push(`
        <g class="interval effect-${T}">
          <line x1="${B}" x2="${z}" y1="${g}" y2="${g}"
            stroke="${P}" stroke-width="${$}"/>
          ${ot}
          ${D}
          ${L(V,g,H,A)}
        </g>`)}}),y.join("")}function Pn(t,n,o,e,a,i,u,h){const r=h.shapes.summaryHeight/2,[l,d]=a.domain().map(L=>a(L)),f=Math.min(l,d),c=Math.max(l,d),$=a(n),M=a(t),_=a(o),I=i+Math.max(f,Math.min(c,$)),S=i+Math.max(f,Math.min(c,M)),C=i+Math.max(f,Math.min(c,_));return`<polygon points="${[`${I},${e}`,`${S},${e-r}`,`${C},${e}`,`${S},${e+r}`].join(" ")}"
    fill="${h.colors.summaryFill}"
    stroke="${h.colors.summaryBorder}"
    stroke-width="1"/>`}function Rn(t,n,o,e,a,i,u=1,h){const s=[],r=typeof o.axis.tickCount=="number"?o.axis.tickCount:v.DEFAULT_TICK_COUNT,l=Un(t,r,o,u,i,h),d=tt(o.typography.fontSizeSm),f=35,c=M=>M<f?"start":M>i-f?"end":"middle",$=M=>M<f?2:M>i-f?-2:0;s.push(`<line x1="${a}" x2="${a+i}"
    y1="0" y2="0" stroke="${o.colors.border}" stroke-width="1"/>`);for(const M of l){const _=t(M),I=a+_,S=c(_),C=$(_);s.push(`<line x1="${I}" x2="${I}" y1="0" y2="4"
      stroke="${o.colors.border}" stroke-width="1"/>`),s.push(`<text x="${I+C}" y="16" text-anchor="${S}"
      font-family="${o.typography.fontFamily}"
      font-size="${d}px"
      fill="${o.colors.secondary}">${Dn(M)}</text>`)}return e&&s.push(`<text x="${a+i/2}" y="28"
      text-anchor="middle"
      font-family="${o.typography.fontFamily}"
      font-size="${d}px"
      font-weight="500"
      fill="${o.colors.secondary}">${O(e)}</text>`),`<g transform="translate(0, ${n.mainY+n.headerHeight+n.plotHeight})">${s.join(`
`)}</g>`}function Xn(t,n,o,e,a,i,u,h,s,r){const l=[],d=tt(i.typography.fontSizeBase),f=i.typography.headerFontScale??1.05,c=d*f,$=i.typography.fontWeightMedium,M=i.typography.fontWeightBold,_=vt(t),I=(S,C)=>S+C/2+c*Q.TEXT_BASELINE_ADJUSTMENT;if(_){const S=a/2,C=a/2;let N=o;l.push(`<text x="${N+v.TEXT_PADDING}" y="${I(e,a)}"
      font-family="${i.typography.fontFamily}"
      font-size="${c}px"
      font-weight="${$}"
      fill="${i.colors.foreground}">${O(u)}</text>`),N+=h;const L=[];for(const y of t)if(y.isGroup){const m=y.columns.reduce((T,g)=>g.isGroup?T+g.columns.reduce((b,x)=>b+r(x),0):T+r(g),0),p=N+m/2;l.push(`<text x="${p}" y="${I(e,S)}"
          font-family="${i.typography.fontFamily}"
          font-size="${c}px"
          font-weight="${M}"
          text-anchor="middle"
          fill="${i.colors.foreground}">${O(y.header)}</text>`),L.push({x1:N,x2:N+m}),N+=m}else{const m=r(y),p=y.headerAlign??y.align,{textX:T,anchor:g}=It(N,m,p),b=Wt(y.header,m,c,v.TEXT_PADDING);l.push(`<text x="${T}" y="${I(e,a)}"
          font-family="${i.typography.fontFamily}"
          font-size="${c}px"
          font-weight="${$}"
          text-anchor="${g}"
          fill="${i.colors.foreground}">${O(b)}</text>`),N+=m}for(const y of L)l.push(`<line x1="${y.x1}" x2="${y.x2}"
        y1="${e+S}" y2="${e+S}"
        stroke="${i.colors.border}" stroke-width="1" opacity="0.5"/>`);N=o+h;for(const y of t)if(y.isGroup){for(const m of y.columns)if(!m.isGroup){const p=r(m),T=m.headerAlign??m.align,{textX:g,anchor:b}=It(N,p,T);l.push(`<text x="${g}" y="${I(e+S,C)}"
              font-family="${i.typography.fontFamily}"
              font-size="${c}px"
              font-weight="${$}"
              text-anchor="${b}"
              fill="${i.colors.foreground}">${O(m.header)}</text>`),N+=p}}else N+=r(y)}else{let S=o;l.push(`<text x="${S+v.TEXT_PADDING}" y="${I(e,a)}"
      font-family="${i.typography.fontFamily}"
      font-size="${c}px"
      font-weight="${$}"
      fill="${i.colors.foreground}">${O(u)}</text>`),S+=h;for(const C of n){const N=r(C),L=C.headerAlign??C.align,{textX:y,anchor:m}=It(S,N,L),p=Wt(C.header,N,c,v.TEXT_PADDING);l.push(`<text x="${y}" y="${I(e,a)}"
        font-family="${i.typography.fontFamily}"
        font-size="${c}px"
        font-weight="${$}"
        text-anchor="${m}"
        fill="${i.colors.foreground}">${O(p)}</text>`),S+=N}}return l.join(`
`)}function Bn(t,n,o,e,a,i,u,h,s,r,l,d){var L,y,m,p,T,g,b,x,w,A,H,P,R,G,E,W,X,B,z,j,nt,ot,D,V,mt,yt,rn,an,sn;const f=[],c=tt(i.typography.fontSizeBase),$=e+a/2+c*Q.TEXT_BASELINE_ADJUSTMENT,M=h*v.INDENT_PER_LEVEL+(((L=t.style)==null?void 0:L.indent)??0)*v.INDENT_PER_LEVEL,_=(y=t.style)!=null&&y.bold||(m=t.style)!=null&&m.emphasis?i.typography.fontWeightBold:i.typography.fontWeightNormal,I=(p=t.style)!=null&&p.italic?"italic":"normal";let S=i.colors.foreground;(T=t.style)!=null&&T.color?S=t.style.color:(g=t.style)!=null&&g.muted?S=i.colors.muted:(b=t.style)!=null&&b.accent&&(S=i.colors.accent);const C=u-M-v.TEXT_PADDING*2,N=Wt(t.label,C,c,0);if(f.push(`<text x="${o+v.TEXT_PADDING+M}" y="${$}"
    font-family="${i.typography.fontFamily}"
    font-size="${c}px"
    font-weight="${_}"
    font-style="${I}"
    fill="${S}">${O(N)}</text>`),(x=t.style)!=null&&x.badge){const ht=String(t.style.badge),F=c*ft.FONT_SCALE,J=F+ft.PADDING*2,at=q(t.label,c),At=o+v.TEXT_PADDING+M+at+ft.GAP,Nt=q(ht,F)+ft.PADDING*2,k=e+(a-J)/2;f.push(`<rect x="${At}" y="${k}" width="${Nt}" height="${J}"
      rx="3" fill="${i.colors.primary}" opacity="0.15"/>`),f.push(`<text x="${At+Nt/2}" y="${k+J/2+F*.35}"
      text-anchor="middle"
      font-family="${i.typography.fontFamily}"
      font-size="${F}px"
      font-weight="500"
      fill="${i.colors.primary}">${O(ht)}</text>`)}for(let ht=0;ht<n.length;ht++){const F=n[ht],J=d[ht],at=l(F);if(F.type==="forest")continue;const At=vn(t,F),{textX:ln,anchor:Nt}=It(J,at,F.align);if(F.type==="bar"&&typeof t.metadata[F.field]=="number"){const k=t.metadata[F.field],U=s.get(F.field),Z=((A=(w=F.options)==null?void 0:w.bar)==null?void 0:A.maxValue)??U??100,Y=((P=(H=F.options)==null?void 0:H.bar)==null?void 0:P.color)??i.colors.primary,rt=i.shapes.pointSize*2,ct=at-v.TEXT_PADDING*2-50,et=Math.min(k/Z*ct,ct);f.push(`<rect x="${J+v.TEXT_PADDING}" y="${e+a/2-rt/2}"
        width="${Math.max(0,et)}" height="${rt}"
        fill="${Y}" opacity="0.7" rx="2"/>`),f.push(`<text x="${J+at-v.TEXT_PADDING}" y="${$}"
        font-family="${i.typography.fontFamily}"
        font-size="${c}px"
        text-anchor="end"
        fill="${i.colors.foreground}">${Et(k)}</text>`)}else if(F.type==="sparkline"&&Array.isArray(t.metadata[F.field])){let k=t.metadata[F.field];Array.isArray(k[0])&&(k=k[0]);const U=((G=(R=F.options)==null?void 0:R.sparkline)==null?void 0:G.height)??16,Z=((W=(E=F.options)==null?void 0:E.sparkline)==null?void 0:W.color)??i.colors.primary,Y=v.TEXT_PADDING*2,rt=Wn(k,J+v.TEXT_PADDING,e+a/2-U/2,at-Y,U);f.push(`<path d="${rt}" fill="none" stroke="${Z}" stroke-width="1.5"/>`)}else if(F.type==="badge"){const k=t.metadata[F.field];if(k!=null){const U=String(k),Z=c*.85,Y=Z+8,rt=(B=(X=F.options)==null?void 0:X.badge)==null?void 0:B.variants,lt=(j=(z=F.options)==null?void 0:z.badge)==null?void 0:j.colors;let ct=i.colors.primary,et=i.colors.primary;if(lt&&U in lt)ct=lt[U],et=lt[U];else if(rt&&U in rt){const Rt=rt[U];ct={default:i.colors.primary,success:"#16a34a",warning:"#d97706",error:"#dc2626",info:"#2563eb",muted:i.colors.muted}[Rt]??i.colors.primary,et=ct}const pt=q(U,Z)+12,$t=F.align==="right"?J+at-v.TEXT_PADDING-pt:F.align==="center"?J+(at-pt)/2:J+v.TEXT_PADDING,St=e+(a-Y)/2;f.push(`<rect x="${$t}" y="${St}" width="${pt}" height="${Y}"
          rx="${Y/2}" fill="${ct}" opacity="0.15"/>`),f.push(`<text x="${$t+pt/2}" y="${St+Y/2+Z*.35}"
          text-anchor="middle"
          font-family="${i.typography.fontFamily}"
          font-size="${Z}px"
          font-weight="500"
          fill="${et}">${O(U)}</text>`)}}else if(F.type==="stars"){const k=t.metadata[F.field];if(typeof k=="number"){const U=((ot=(nt=F.options)==null?void 0:nt.stars)==null?void 0:ot.maxStars)??5,Z=((V=(D=F.options)==null?void 0:D.stars)==null?void 0:V.color)??"#f59e0b",Y=((yt=(mt=F.options)==null?void 0:mt.stars)==null?void 0:yt.emptyColor)??"#d1d5db",rt=Math.max(0,Math.min(U,k)),lt=Math.floor(rt),ct=((an=(rn=F.options)==null?void 0:rn.stars)==null?void 0:an.halfStars)&&rt-lt>=.5,et=12,Pt=2,pt=U*et+(U-1)*Pt;let $t=F.align==="right"?J+at-v.TEXT_PADDING-pt:F.align==="center"?J+(at-pt)/2:J+v.TEXT_PADDING;const St=e+(a-et)/2,Rt=(ut,_t,Xt)=>{const wt=Xt/2,Dt=wt*.4;let cn="";for(let xt=0;xt<5;xt++){const un=(xt*72-90)*Math.PI/180,fn=(xt*72+36-90)*Math.PI/180,dn=ut+wt*Math.cos(un),hn=_t+wt*Math.sin(un),Yn=ut+Dt*Math.cos(fn),Jn=_t+Dt*Math.sin(fn);cn+=(xt===0?`M${dn},${hn}`:`L${dn},${hn}`)+`L${Yn},${Jn}`}return cn+"Z"};for(let ut=0;ut<U;ut++){const _t=$t+et/2,Xt=St+et/2,Dt=ut<lt||ut===lt&&ct?Z:Y;f.push(`<path d="${Rt(_t,Xt,et)}" fill="${Dt}"/>`),$t+=et+Pt}}}else{const k=(sn=t.cellStyles)==null?void 0:sn[F.field];let U=i.typography.fontWeightNormal,Z="normal",Y=i.colors.foreground;k&&((k.bold||k.emphasis)&&(U=i.typography.fontWeightBold),k.italic&&(Z="italic"),k.color?Y=k.color:k.muted?Y=i.colors.muted:k.accent&&(Y=i.colors.accent)),f.push(`<text x="${ln}" y="${$}"
        font-family="${i.typography.fontFamily}"
        font-size="${c}px"
        font-weight="${U}"
        font-style="${Z}"
        text-anchor="${Nt}"
        fill="${Y}">${O(At)}</text>`)}}return f.join(`
`)}function Un(t,n,o,e,a,i){if(Array.isArray(o.axis.tickValues)&&o.axis.tickValues.length>0){const[m,p]=t.domain();let T=o.axis.tickValues.filter(x=>x>=m&&x<=p);const g=o.axis.nullTick!==!1,b=e>=m&&e<=p;return g&&b&&!T.includes(e)&&(T=[...T,e].sort((x,w)=>x-w)),T}const[u,h]=t.domain(),s=o.axis.nullTick!==!1,r=e>=u&&e<=h,l=50,d=Math.max(2,Math.floor(a/l)),f=Math.min(n,Math.min(7,d)),c=i&&i.length>0?i.filter(m=>m>=u&&m<=h):t.ticks(f);if(c.length===0)return s&&r?[e]:[];const $=t(e),M=c.filter(m=>m<e).reverse(),_=c.filter(m=>m>e),I=c.some(m=>m===e),S=[];let C=$;for(const m of M){const p=t(m);C-p>=l&&(S.unshift(m),C=p)}const N=[];let L=$;for(const m of _){const p=t(m);p-L>=l&&(N.push(m),L=p)}const y=[...S];if((I||s&&r)&&y.push(e),y.push(...N),y.length<2){const m=new Set(y);m.has(u)||y.unshift(u),y.length<2&&!m.has(h)&&y.push(h)}return y}function kt(t,n,o,e,a,i,u=1,h=.6){let r=`<line x1="${t}" x2="${t}" y1="${n}" y2="${o}"
    stroke="${a}" stroke-width="${u}" stroke-opacity="${h}" stroke-dasharray="${e==="dashed"?"6,4":e==="dotted"?"2,2":"none"}"/>`;return i&&(r+=`<text x="${t}" y="${n-4}" text-anchor="middle"
      font-size="10px" fill="${a}">${O(i)}</text>`),r}class dt extends Error{constructor(n){super(`SVG Generator: ${n}`),this.name="SVGGeneratorError"}}function zn(t){if(!t||typeof t!="object")throw new dt("Invalid spec: expected an object");const n=t;if(!n.data||typeof n.data!="object")throw new dt("Invalid spec: missing or invalid 'data' property");const o=n.data;if(!Array.isArray(o.rows))throw new dt("Invalid spec: 'data.rows' must be an array");if(!n.theme||typeof n.theme!="object")throw new dt("Invalid spec: missing or invalid 'theme' property");const e=n.theme;if(!e.colors||typeof e.colors!="object")throw new dt("Invalid spec: missing or invalid 'theme.colors'");if(!e.typography||typeof e.typography!="object")throw new dt("Invalid spec: missing or invalid 'theme.typography'");if(!e.spacing||typeof e.spacing!="object")throw new dt("Invalid spec: missing or invalid 'theme.spacing'")}function Vn(t){var i;const o=Ht(t.columns,void 0).find(u=>u.type==="forest");if(!o||!((i=o.options)!=null&&i.forest))return{scale:"linear",nullValue:0,effects:[],axisLabel:"Effect",pointCol:null,lowerCol:null,upperCol:null};const e=o.options.forest,a=e.scale??"linear";return{scale:a,nullValue:e.nullValue??(a==="log"?1:0),effects:e.effects??[],axisLabel:e.axisLabel??"Effect",pointCol:e.point??null,lowerCol:e.lower??null,upperCol:e.upper??null}}function On(t,n={}){var p,T;zn(t);const o=t.theme,e=o.spacing.padding,a=Array.isArray(t.columns)?t.columns:[],i=tn(a),u=[];for(let g=0;g<i.length;g++)i[g].type==="forest"&&u.push(g);u.length>0;const h=Vn(t),s=wn(t,n,h.nullValue),r=s.autoWidths,l=g=>{var x,w;if(g.type==="forest")return((w=(x=g.options)==null?void 0:x.forest)==null?void 0:w.width)??s.forestWidth;const b=r.get(g.id);return b!==void 0?b:typeof g.width=="number"?g.width:K.DEFAULT_COLUMN_WIDTH},d=[];let f=e+s.labelWidth;for(const g of i)d.push(f),f+=l(g);const c=[];c.push(`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg"
  width="${s.totalWidth}" height="${s.totalHeight}"
  viewBox="0 0 ${s.totalWidth} ${s.totalHeight}">`);const $=n.backgroundColor??o.colors.background;c.push(`<rect width="100%" height="100%" fill="${$}"/>`),c.push(Cn(t,s,o)),c.push(`<line x1="${e}" x2="${s.totalWidth-e}"
    y1="${s.mainY}" y2="${s.mainY}"
    stroke="${o.colors.border}" stroke-width="2"/>`);const M=s.mainY;c.push(Xn(a,i,e,M,s.headerHeight,o,t.data.labelHeader??"Study",s.labelWidth,r,l)),c.push(`<line x1="${e}" x2="${s.totalWidth-e}"
    y1="${M+s.headerHeight}" y2="${M+s.headerHeight}"
    stroke="${o.colors.border}" stroke-width="2"/>`);const _=Qt(t),I=[],S=[];let C=0;for(const g of _){const x=g.type==="data"&&((p=g.row.style)==null?void 0:p.type)==="spacer"?s.rowHeight/2:s.rowHeight;I.push(C),S.push(x),C+=x}const N=s.mainY+s.headerHeight;for(const g of u){const b=i[g],x=d[g],w=l(b),A=(T=b.options)==null?void 0:T.forest,H=(A==null?void 0:A.scale)??"linear",P=(A==null?void 0:A.nullValue)??(H==="log"?1:0),R=(A==null?void 0:A.axisLabel)??"Effect",G=(A==null?void 0:A.effects)??[],E=H==="log",W={scale:H,nullValue:P,effects:G,pointCol:(A==null?void 0:A.point)??null,lowerCol:(A==null?void 0:A.lower)??null,upperCol:(A==null?void 0:A.upper)??null},{scale:X,clipBounds:B,ticks:z}=Fn(t,w,W,n),j=x+X(P);c.push(kt(j,N,N+s.plotHeight,"dashed",o.colors.muted));const nt=(A==null?void 0:A.annotations)??[];for(const D of nt)if(D.type==="reference_line"){const V=x+X(D.x);c.push(kt(V,N,N+s.plotHeight,D.style,D.color??o.colors.accent,D.label,D.width??1,D.opacity??.6))}const ot=Array.isArray(t.annotations)?t.annotations:[];for(const D of ot)if(D.type==="reference_line"){const V=x+X(D.x);c.push(kt(V,N,N+s.plotHeight,D.style,D.color??o.colors.accent,D.label,D.width??1,D.opacity??.6))}if(_.forEach((D,V)=>{if(D.type==="data"){const mt=N+I[V]+S[V]/2;c.push(kn(D.row,mt,yt=>x+X(yt),o,P,G,t.data.weightCol,x,w,B,E))}}),t.data.overall&&s.showOverallSummary&&typeof t.data.overall.point=="number"&&!Number.isNaN(t.data.overall.point)&&typeof t.data.overall.lower=="number"&&!Number.isNaN(t.data.overall.lower)&&typeof t.data.overall.upper=="number"&&!Number.isNaN(t.data.overall.upper)){const D=N+s.summaryYPosition;c.push(Pn(t.data.overall.point,t.data.overall.lower,t.data.overall.upper,D,X,x,w,o))}c.push(Rn(X,s,o,R,x,w,P,z))}const L=s.mainY+s.headerHeight,y=t.data.rows,m=Hn(y,i);return _.forEach((g,b)=>{var A,H,P,R;const x=L+I[b],w=S[b];if(g.type==="group_header")c.push(Ln(g.label,g.depth,e,x,w,s.totalWidth-e*2,o));else{const G=g.row,E=g.depth,W=((A=G.style)==null?void 0:A.type)==="spacer",X=(H=G.style)==null?void 0:H.bg;if(!W&&!X&&o.layout.banding){const z=b%2===1?o.colors.altBg:o.colors.rowBg;z!==o.colors.background&&c.push(`<rect x="${e}" y="${x}"
            width="${s.totalWidth-e*2}" height="${w}"
            fill="${z}"/>`)}c.push(Bn(G,i,e,x,w,o,s.labelWidth,E,m,r,l,d))}if(g.type==="data"){const G=g.row,E=((P=G.style)==null?void 0:P.type)==="summary",W=((R=G.style)==null?void 0:R.type)==="spacer";E&&c.push(`<line x1="${e}" x2="${s.totalWidth-e}"
          y1="${x}" y2="${x}"
          stroke="${o.colors.border}" stroke-width="2"/>`),W||c.push(`<line x1="${e}" x2="${s.totalWidth-e}"
          y1="${x+w}" y2="${x+w}"
          stroke="${o.colors.border}" stroke-width="1"/>`)}else c.push(`<line x1="${e}" x2="${s.totalWidth-e}"
        y1="${x+w}" y2="${x+w}"
        stroke="${o.colors.border}" stroke-width="1"/>`)}),c.push(Gn(t,s,o)),c.push("</svg>"),c.join(`
`)}function jn(t,n){const o=JSON.parse(t);return On(o,n)}globalThis.generateSVG=jn})();
