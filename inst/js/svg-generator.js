(function(){"use strict";function ht(t,o){if(o){const f=[.05,.1,.15,.2,.25,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2,1.3,1.4,1.5,1.75,2,2.5,3,4,5,6,7,8,10,12,15,20,25,30,40,50,75,100];let a=f[0];for(const u of f)if(u<=t[0])a=u;else break;let l=f[f.length-1];for(let u=f.length-1;u>=0&&f[u]>=t[1];u--)l=f[u];return[a,l]}const e=t[1]-t[0];if(e===0)return t;const n=Math.pow(10,Math.floor(Math.log10(e))),i=e/n;let r;i<=1?r=n*.1:i<=2?r=n*.2:i<=5?r=n*.5:r=n;const s=Math.floor(t[0]/r)*r,g=Math.ceil(t[1]/r)*r;return[s,g]}const nt=.15,pt=.06,gt=.05,ot=.04;function $t(t){return t<=0?0:ot+t*ot}const D={DEFAULT_LABEL_WIDTH:200,DEFAULT_COLUMN_WIDTH:100,AXIS_HEIGHT:32,AXIS_LABEL_HEIGHT:20,BOTTOM_MARGIN:16,MIN_FOREST_WIDTH:200,DEFAULT_WIDTH:800,COLUMN_GAP:16},U={TITLE_HEIGHT:28,SUBTITLE_HEIGHT:20,CAPTION_HEIGHT:16,FOOTNOTE_HEIGHT:14,DEFAULT_FONT_SIZE:14,REM_BASE:16,TEXT_BASELINE_ADJUSTMENT:1/3},w={INDENT_PER_LEVEL:12,TEXT_PADDING:10,WHISKER_HALF_HEIGHT:4,DEFAULT_TICK_COUNT:5},et={GROUP_HEADER_HEIGHT_MULTIPLIER:1.5,OVERALL_ROW_HEIGHT_MULTIPLIER:1.5};function yt(t,o){var v,C,O,R;const e=t.theme,n=e.spacing.rowHeight,i=e.spacing.padding,r=Array.isArray(t.columns)?t.columns:[],s=Y(r,"left"),g=Y(r,"right"),a=Z(s)||Z(g)?e.spacing.headerHeight*et.GROUP_HEADER_HEIGHT_MULTIPLIER:e.spacing.headerHeight,l=!!((v=t.labels)!=null&&v.title),u=!!((C=t.labels)!=null&&C.subtitle),d=!!((O=t.labels)!=null&&O.caption),$=!!((R=t.labels)!=null&&R.footnote),p=l?U.TITLE_HEIGHT:0,b=u?U.SUBTITLE_HEIGHT:0,E=p+b+(l||u?i:0),N=d?U.CAPTION_HEIGHT:0,I=$?U.FOOTNOTE_HEIGHT:0,H=N+I+(d||$?i:0),M=rt(t).length,y=!!t.data.overall,c=M*n+(y?n*et.OVERALL_ROW_HEIGHT_MULTIPLIER:0),m=j(r,"left"),h=j(r,"right"),T=D.DEFAULT_LABEL_WIDTH+m.reduce((P,B)=>P+(typeof B.width=="number"?B.width:D.DEFAULT_COLUMN_WIDTH),0),x=h.reduce((P,B)=>P+(typeof B.width=="number"?B.width:D.DEFAULT_COLUMN_WIDTH),0),_=o.width??D.DEFAULT_WIDTH,L=t.data.includeForest,k=T+x;let G;if(!L)G=0;else if(typeof t.layout.plotWidth=="number")G=t.layout.plotWidth;else{const P=_-k-D.COLUMN_GAP*2-i*2;G=Math.max(P,D.MIN_FOREST_WIDTH)}const S=i*2+k+G+D.COLUMN_GAP*2,F=Math.max(o.width??_,S),X=E+i+a+c+D.AXIS_HEIGHT+D.AXIS_LABEL_HEIGHT+H+D.BOTTOM_MARGIN;return{totalWidth:F,totalHeight:o.height??X,tableWidth:T+x,forestWidth:G,headerHeight:a,rowHeight:n,plotHeight:c,axisHeight:D.AXIS_HEIGHT,nullValue:t.data.nullValue,summaryYPosition:c-n,showOverallSummary:y,headerTextHeight:E,footerTextHeight:H,titleY:i+U.TITLE_HEIGHT-8,subtitleY:i+p+U.SUBTITLE_HEIGHT-4,mainY:E+i,footerY:E+i+a+c+D.AXIS_HEIGHT+D.AXIS_LABEL_HEIGHT+i}}function rt(t){var u;const o=t.data.rows,e=Array.isArray(t.data.groups)?t.data.groups:[];if(e.length===0)return o.map(d=>({type:"data",row:d,depth:0}));const n=new Map;for(const d of e)n.set(d.id,d);const i=new Map;for(const d of o){const $=d.groupId??null;i.has($)||i.set($,[]),i.get($).push(d)}const r=new Set;for(const d of i.keys()){if(!d)continue;let $=d;for(;$;)r.add($),$=(u=n.get($))==null?void 0:u.parentId}function s(d){return e.filter($=>($.parentId??null)===d&&r.has($.id))}function g(d){if(!d)return 0;const $=n.get(d);return $?$.depth+1:0}function f(d){var p;let $=((p=i.get(d))==null?void 0:p.length)??0;for(const b of s(d))$+=f(b.id);return $}const a=[];function l(d){if(d){const p=n.get(d);if(!p)return;const b=f(d);a.push({type:"group_header",groupId:p.id,label:p.label,depth:p.depth,rowCount:b})}for(const p of s(d))l(p.id);const $=i.get(d)??[];for(const p of $)a.push({type:"data",row:p,depth:g(p.groupId)})}return l(null),a}function it(t){const o=[];for(const e of t)e.isGroup?o.push(...it(e.columns)):o.push(e);return o}function j(t,o){const e=[];for(const n of t)n.position===o&&(n.isGroup?e.push(...it(n.columns)):e.push(n));return e}function Y(t,o){return t.filter(e=>e.position===o)}function Z(t){return t.some(o=>o.isGroup)}function at(t,o){return t.isGroup?t.columns.reduce((e,n)=>e+at(n,o),0):typeof t.width=="number"?t.width:o}function V(t){return t.endsWith("rem")?parseFloat(t)*U.REM_BASE:t.endsWith("px")?parseFloat(t):U.DEFAULT_FONT_SIZE}function J(t,o,e){return e==="right"?{textX:t+o-w.TEXT_PADDING,anchor:"end"}:e==="center"?{textX:t+o/2,anchor:"middle"}:{textX:t+w.TEXT_PADDING,anchor:"start"}}function W(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function q(t,o,e,n=0){const i=e*.55,r=o-n*2,s=Math.floor(r/i);return t.length<=s?t:t.slice(0,s-1)+"…"}function K(t,o){const e=t.split(".");return e[0]=e[0].replace(/\B(?=(\d{3})+(?!\d))/g,o),e.join(".")}function Q(t,o=2){const e=Math.abs(t),n=t<0?"-":"";return e>=1e9?n+(e/1e9).toPrecision(o)+"B":e>=1e6?n+(e/1e6).toPrecision(o)+"M":e>=1e3?n+(e/1e3).toPrecision(o)+"K":t.toPrecision(o)}function st(t,o){var g,f,a,l,u;if(t==null||Number.isNaN(t))return(o==null?void 0:o.naText)??"";if(o!=null&&o.percent){const{decimals:d=1,multiply:$=!1,symbol:p=!0}=o.percent,E=($?t*100:t).toFixed(d);return p?`${E}%`:E}const e=(g=o==null?void 0:o.numeric)==null?void 0:g.abbreviate;if(e&&Math.abs(t)>=1e3)return Q(t,typeof e=="number"?e:2);const n=(f=o==null?void 0:o.numeric)==null?void 0:f.digits;if(n!=null){const d=t.toPrecision(n),$=(a=o==null?void 0:o.numeric)==null?void 0:a.thousandsSep;return $&&typeof $=="string"?K(d,$):d}const i=(l=o==null?void 0:o.numeric)==null?void 0:l.decimals,r=(u=o==null?void 0:o.numeric)==null?void 0:u.thousandsSep;let s;return i!==void 0?s=t.toFixed(i):Number.isInteger(t)||Math.abs(t-Math.round(t))<1e-4?s=Math.round(t).toString():s=t.toFixed(2),r&&typeof r=="string"&&(s=K(s,r)),s}function mt(t,o){const{eventsField:e,nField:n,separator:i="/",showPct:r=!1,thousandsSep:s,abbreviate:g}=o.events,f=t.metadata[e],a=t.metadata[n];if(f==null||a===void 0||a===null)return o.naText??"";const l=Number(f),u=Number(a);let d,$;if(g&&(l>=1e3||u>=1e3)){const b=typeof g=="number"?g:2;d=l>=1e3?Q(l,b):String(l),$=u>=1e3?Q(u,b):String(u)}else d=String(l),$=String(u),s&&typeof s=="string"&&(d=K(d,s),$=K($,s));let p=`${d}${i}${$}`;if(r&&u>0){const b=(l/u*100).toFixed(1);p+=` (${b}%)`}return p}function xt(t,o,e,n){var g,f,a;if(t==null||Number.isNaN(t))return"";const i=((g=n==null?void 0:n.interval)==null?void 0:g.decimals)??2,r=((f=n==null?void 0:n.interval)==null?void 0:f.sep)??" ",s=(a=n==null?void 0:n.interval)==null?void 0:a.impreciseThreshold;return o==null||e===void 0||e===null||Number.isNaN(o)||Number.isNaN(e)?t.toFixed(i):s!=null&&o>0&&e/o>s?"—":`${t.toFixed(i)}${r}(${o.toFixed(i)}, ${e.toFixed(i)})`}const Tt={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","-":"⁻","+":"⁺"};function Et(t){return t.split("").map(o=>Tt[o]??o).join("")}function bt(t,o){const e=o==null?void 0:o.pvalue,n=(e==null?void 0:e.digits)??2,i=(e==null?void 0:e.expThreshold)??.001,r=(e==null?void 0:e.abbrevThreshold)??null,s=(e==null?void 0:e.format)??"auto",g=(e==null?void 0:e.stars)??!1,f=(e==null?void 0:e.thresholds)??[.05,.01,.001];let a="";if(g&&(t<f[2]?a="***":t<f[1]?a="**":t<f[0]&&(a="*")),r!==null&&t<r)return`<${r}${a}`;if(s==="scientific"||s==="auto"&&t<i){const u=Math.floor(Math.log10(t));return`${(t/Math.pow(10,u)).toPrecision(n)}×10${Et(u.toString())}${a}`}let l;return t>=.1?l=t.toFixed(n):t>=.01?l=t.toFixed(n+1):l=t.toFixed(n+2),`${l}${a}`}function _t(t){return Math.abs(t)<.01?"0":Math.abs(t)>=100?t.toFixed(0):Math.abs(t)>=10?t.toFixed(1):t.toFixed(2)}function It(t,o){const[e,n]=t,[i,r]=o,s=(r-i)/(n-e),g=f=>i+(f-e)*s;return g.domain=()=>t,g.range=()=>o,g.ticks=f=>{const a=(n-e)/(f-1),l=[];for(let u=0;u<f;u++)l.push(e+a*u);return l},g}function Ht(t,o){const[e,n]=t.map(l=>Math.max(l,.001)),[i,r]=o,s=Math.log10(e),g=Math.log10(n),f=(r-i)/(g-s),a=l=>{const u=Math.log10(Math.max(l,.001));return i+(u-s)*f};return a.domain=()=>[e,n],a.range=()=>o,a.ticks=l=>{const u=[],d=Math.floor(Math.log10(e)),$=Math.ceil(Math.log10(n));for(let p=d;p<=$;p++){const b=Math.pow(10,p);for(const E of[1,2,5]){const N=b*E;N>=e&&N<=n&&u.push(N)}}return u.length>0?u:[e,n]},a}function At(t,o){const e=t.data.rows,n=t.theme.axis,i=t.data.scale==="log",r=typeof(n==null?void 0:n.rangeMin)=="number",s=typeof(n==null?void 0:n.rangeMax)=="number";let g;if(r&&s)g=[n.rangeMin,n.rangeMax];else{const a=e.flatMap(l=>[l.lower,l.upper]).filter(l=>l!=null&&!Number.isNaN(l)&&Number.isFinite(l));if(a.length===0)g=i?[.1,10]:[0,1];else{const[l,u]=[Math.min(...a),Math.max(...a)],d=u-l||1;g=[r?n.rangeMin:l-d*nt,s?n.rangeMax:u+d*nt]}}const f=ht(g,i);return i?Ht([Math.max(f[0],.01),Math.max(f[1],.02)],[0,o]):It(f,[0,o])}function Nt(t,o,e){var r,s;const n=[],i=e.spacing.padding;if((r=t.labels)!=null&&r.title){const g=V(e.typography.fontSizeLg);n.push(`<text x="${i}" y="${o.titleY}"
      font-family="${e.typography.fontFamily}"
      font-size="${g}px"
      font-weight="${e.typography.fontWeightBold}"
      fill="${e.colors.foreground}">${W(t.labels.title)}</text>`)}if((s=t.labels)!=null&&s.subtitle){const g=V(e.typography.fontSizeBase);n.push(`<text x="${i}" y="${o.subtitleY}"
      font-family="${e.typography.fontFamily}"
      font-size="${g}px"
      fill="${e.colors.secondary}">${W(t.labels.subtitle)}</text>`)}return n.join(`
`)}function Mt(t,o,e){var s,g;const n=[],i=e.spacing.padding;let r=o.footerY;if((s=t.labels)!=null&&s.caption){const f=V(e.typography.fontSizeSm);n.push(`<text x="${i}" y="${r}"
      font-family="${e.typography.fontFamily}"
      font-size="${f}px"
      fill="${e.colors.secondary}">${W(t.labels.caption)}</text>`),r+=U.CAPTION_HEIGHT}if((g=t.labels)!=null&&g.footnote){const f=V(e.typography.fontSizeSm);n.push(`<text x="${i}" y="${r}"
      font-family="${e.typography.fontFamily}"
      font-size="${f}px"
      font-style="italic"
      fill="${e.colors.muted}">${W(t.labels.footnote)}</text>`)}return n.join(`
`)}function lt(t,o,e,n,i,r,s,g){const f=[],a=V(r.typography.fontSizeSm),l=r.typography.fontWeightMedium,u=r.typography.fontWeightBold,d=Z(t),$=D.DEFAULT_COLUMN_WIDTH,p=g??D.DEFAULT_LABEL_WIDTH,b=(E,N)=>E+N/2+a*U.TEXT_BASELINE_ADJUSTMENT;if(d){const E=i/2,N=i/2;let I=e;s&&(f.push(`<text x="${I+w.TEXT_PADDING}" y="${b(n,i)}"
        font-family="${r.typography.fontFamily}"
        font-size="${a}px"
        font-weight="${l}"
        fill="${r.colors.foreground}">${W(s)}</text>`),f.push(`<line x1="${I+p}" x2="${I+p}"
        y1="${n}" y2="${n+i}"
        stroke="${r.colors.border}" stroke-width="1" opacity="0.3"/>`),I+=p);for(const H of t)if(H.isGroup){const A=at(H,$),M=I+A/2;f.push(`<text x="${M}" y="${b(n,E)}"
          font-family="${r.typography.fontFamily}"
          font-size="${a}px"
          font-weight="${u}"
          text-anchor="middle"
          fill="${r.colors.foreground}">${W(H.header)}</text>`),f.push(`<line x1="${I}" x2="${I+A}"
          y1="${n+E}" y2="${n+E}"
          stroke="${r.colors.border}" stroke-width="1" opacity="0.5"/>`),I+=A}else{const A=typeof H.width=="number"?H.width:$,M=H.headerAlign??H.align,{textX:y,anchor:c}=J(I,A,M),m=q(H.header,A,a,w.TEXT_PADDING);f.push(`<text x="${y}" y="${b(n,i)}"
          font-family="${r.typography.fontFamily}"
          font-size="${a}px"
          font-weight="${l}"
          text-anchor="${c}"
          fill="${r.colors.foreground}">${W(m)}</text>`),I+=A}I=e+(s?p:0);for(const H of t)if(H.isGroup){for(const A of H.columns)if(!A.isGroup){const M=typeof A.width=="number"?A.width:$,y=A.headerAlign??A.align,{textX:c,anchor:m}=J(I,M,y);f.push(`<text x="${c}" y="${b(n+E,N)}"
              font-family="${r.typography.fontFamily}"
              font-size="${a}px"
              font-weight="${l}"
              text-anchor="${m}"
              fill="${r.colors.foreground}">${W(A.header)}</text>`),I+=M}}else{const A=typeof H.width=="number"?H.width:$;I+=A}}else{let E=e;s&&(f.push(`<text x="${E+w.TEXT_PADDING}" y="${b(n,i)}"
        font-family="${r.typography.fontFamily}"
        font-size="${a}px"
        font-weight="${l}"
        fill="${r.colors.foreground}">${W(s)}</text>`),E+=p);for(const N of o){const I=typeof N.width=="number"?N.width:$,H=N.headerAlign??N.align,{textX:A,anchor:M}=J(E,I,H),y=q(N.header,I,a,w.TEXT_PADDING);f.push(`<text x="${A}" y="${b(n,i)}"
        font-family="${r.typography.fontFamily}"
        font-size="${a}px"
        font-weight="${l}"
        text-anchor="${M}"
        fill="${r.colors.foreground}">${W(y)}</text>`),E+=I}}return f.join(`
`)}function Dt(t,o,e,n,i,r,s){const g=[],f=V(s.typography.fontSizeBase),a=n+i/2+f*U.TEXT_BASELINE_ADJUSTMENT,l=o*w.INDENT_PER_LEVEL;return g.push(`<rect x="${e}" y="${n}"
    width="${r}" height="${i}"
    fill="${s.colors.primary}" opacity="${gt}"/>`),g.push(`<text x="${e+w.TEXT_PADDING+l}" y="${a}"
    font-family="${s.typography.fontFamily}"
    font-size="${f}px"
    font-weight="${s.typography.fontWeightBold}"
    fill="${s.colors.foreground}">${W(t)}</text>`),g.join(`
`)}function ct(t,o){const e=new Map;for(const n of o)if(n.type==="bar"){let i=0;for(const r of t){const s=r.metadata[n.field];typeof s=="number"&&s>i&&(i=s)}e.set(n.field,i>0?i:1)}return e}function ft(t,o,e,n,i,r,s,g=D.DEFAULT_LABEL_WIDTH,f=0,a){var p,b,E,N,I,H,A,M,y,c,m,h,T;const l=[],u=V(r.typography.fontSizeBase),d=n+i/2+u*U.TEXT_BASELINE_ADJUSTMENT;let $=e;if(s){const x=f*w.INDENT_PER_LEVEL+(((p=t.style)==null?void 0:p.indent)??0)*w.INDENT_PER_LEVEL,_=(b=t.style)!=null&&b.bold?r.typography.fontWeightBold:r.typography.fontWeightNormal,L=(E=t.style)!=null&&E.italic?"italic":"normal",k=g-x-w.TEXT_PADDING*2,G=q(t.label,k,u,0);if(l.push(`<text x="${$+w.TEXT_PADDING+x}" y="${d}"
      font-family="${r.typography.fontFamily}"
      font-size="${u}px"
      font-weight="${_}"
      font-style="${L}"
      fill="${((N=t.style)==null?void 0:N.color)??r.colors.foreground}">${W(G)}</text>`),(I=t.style)!=null&&I.badge){const S=String(t.style.badge),F=u*.8,X=4,v=F+X*2,C=t.label.length*u*.55,O=$+w.TEXT_PADDING+x+C+6,P=S.length*F*.6+X*2,B=n+(i-v)/2;l.push(`<rect x="${O}" y="${B}" width="${P}" height="${v}"
        rx="3" fill="${r.colors.primary}" opacity="0.15"/>`),l.push(`<text x="${O+P/2}" y="${B+v/2+F*.35}"
        text-anchor="middle"
        font-family="${r.typography.fontFamily}"
        font-size="${F}px"
        font-weight="500"
        fill="${r.colors.primary}">${W(S)}</text>`)}$+=g}for(const x of o){const _=typeof x.width=="number"?x.width:D.DEFAULT_COLUMN_WIDTH,L=Lt(t,x),{textX:k,anchor:G}=J($,_,x.align);if(x.type==="bar"&&typeof t.metadata[x.field]=="number"){const S=t.metadata[x.field],F=a==null?void 0:a.get(x.field),X=((A=(H=x.options)==null?void 0:H.bar)==null?void 0:A.maxValue)??F??100,v=((y=(M=x.options)==null?void 0:M.bar)==null?void 0:y.color)??r.colors.primary,C=r.shapes.pointSize*2,R=_-w.TEXT_PADDING*2-50,P=Math.min(S/X*R,R);l.push(`<rect x="${$+w.TEXT_PADDING}" y="${n+i/2-C/2}"
        width="${Math.max(0,P)}" height="${C}"
        fill="${v}" opacity="0.7" rx="2"/>`);const B=$+_-w.TEXT_PADDING;l.push(`<text x="${B}" y="${d}"
        font-family="${r.typography.fontFamily}"
        font-size="${u}px"
        text-anchor="end"
        fill="${r.colors.foreground}">${st(S)}</text>`)}else if(x.type==="sparkline"&&Array.isArray(t.metadata[x.field])){let S=t.metadata[x.field];Array.isArray(S[0])&&(S=S[0]);const F=((m=(c=x.options)==null?void 0:c.sparkline)==null?void 0:m.height)??16,X=((T=(h=x.options)==null?void 0:h.sparkline)==null?void 0:T.color)??r.colors.primary,v=w.TEXT_PADDING*2,C=St(S,$+w.TEXT_PADDING,n+i/2-F/2,_-v,F);l.push(`<path d="${C}" fill="none" stroke="${X}" stroke-width="1.5"/>`)}else l.push(`<text x="${k}" y="${d}"
        font-family="${r.typography.fontFamily}"
        font-size="${u}px"
        text-anchor="${G}"
        fill="${r.colors.foreground}">${W(L)}</text>`);$+=_}return l.join(`
`)}function Lt(t,o){var n,i,r,s,g,f,a,l,u,d,$,p,b,E,N,I,H,A,M;if(o.type==="interval"){const y=(i=(n=o.options)==null?void 0:n.interval)!=null&&i.point?t.metadata[o.options.interval.point]:t.point,c=(s=(r=o.options)==null?void 0:r.interval)!=null&&s.lower?t.metadata[o.options.interval.lower]:t.lower,m=(f=(g=o.options)==null?void 0:g.interval)!=null&&f.upper?t.metadata[o.options.interval.upper]:t.upper;return xt(y,c,m,o.options)}if(o.type==="numeric"){const y=t.metadata[o.field];return typeof y=="number"?st(y,o.options):((a=o.options)==null?void 0:a.naText)??""}if(o.type==="custom"&&((l=o.options)!=null&&l.events))return mt(t,o.options);if(o.type==="pvalue"){const y=t.metadata[o.field];return typeof y!="number"?((u=o.options)==null?void 0:u.naText)??"":bt(y,o.options)}if(o.type==="icon"){const y=t.metadata[o.field];if(y==null)return"";const c=String(y),m=($=(d=o.options)==null?void 0:d.icon)==null?void 0:$.mapping;return m&&c in m?m[c]:c}if(o.type==="badge"){const y=t.metadata[o.field];return y!=null?String(y):""}if(o.type==="stars"){const y=t.metadata[o.field];if(typeof y!="number")return"";const c=((b=(p=o.options)==null?void 0:p.stars)==null?void 0:b.maxStars)??5,m=Math.max(0,Math.min(c,y)),h=Math.floor(m),T=c-h;return"★".repeat(h)+"☆".repeat(T)}if(o.type==="img")return((N=(E=o.options)==null?void 0:E.img)==null?void 0:N.fallback)??"[IMG]";if(o.type==="reference"){const y=t.metadata[o.field];if(y==null)return"";const c=String(y),m=((H=(I=o.options)==null?void 0:I.reference)==null?void 0:H.maxChars)??30;return c.length<=m?c:c.substring(0,m)+"..."}if(o.type==="range"){const y=(A=o.options)==null?void 0:A.range;if(!y)return"";const c=t.metadata[y.minField],m=t.metadata[y.maxField],h=y.separator??" – ",T=y.decimals,x=_=>typeof _!="number"?"":T==null?Number.isInteger(_)?String(_):_.toFixed(1):_.toFixed(T);return c===null&&m===null?"":c===null?x(m):m===null?x(c):`${x(c)}${h}${x(m)}`}const e=t.metadata[o.field];return e!=null?String(e):((M=o.options)==null?void 0:M.naText)??""}function St(t,o,e,n,i){if(t.length===0)return"";const r=Math.min(...t),g=Math.max(...t)-r||1;return`M${t.map((a,l)=>{const u=o+l/(t.length-1)*n,d=e+i-(a-r)/g*i;return`${u.toFixed(1)},${d.toFixed(1)}`}).join("L")}`}const ut=6;function tt(t,o,e){const n=t.metadata[o];return n!=null&&typeof n=="number"&&!Number.isNaN(n)?n:e}function wt(t,o){return o<=1?0:-((o-1)*ut)/2+t*ut}function Ft(t,o,e,n,i,r=[],s,g=0,f=1/0){var y;let a;r.length===0?a=[{point:t.point,lower:t.lower,upper:t.upper,color:null,shape:null,opacity:null}]:a=r.map(c=>({point:tt(t,c.pointCol,t.point),lower:tt(t,c.lowerCol,t.lower),upper:tt(t,c.upperCol,t.upper),color:c.color??null,shape:c.shape??null,opacity:c.opacity??null}));const l=a.filter(c=>c.point!=null&&!Number.isNaN(c.point)&&c.lower!=null&&!Number.isNaN(c.lower)&&c.upper!=null&&!Number.isNaN(c.upper));if(l.length===0)return"";const u=n.shapes.pointSize,d=n.shapes.lineWidth,$=n.colors.intervalLine,p=w.WHISKER_HALF_HEIGHT,b=((y=t.style)==null?void 0:y.type)==="summary",N=n.shapes.summaryHeight/2;function I(c){var h;if(c&&((h=t.markerStyle)==null?void 0:h.size)!=null)return u*t.markerStyle.size;const m=s?t.metadata[s]:void 0;if(m){const T=.5+Math.sqrt(m/100)*1.5;return Math.min(Math.max(u*T,3),u*2.5)}return u}function H(c,m){const h=m===0,T=t.markerStyle;let x;h&&(T!=null&&T.color)?x=T.color:c.color?x=c.color:x=n.colors.interval??n.colors.primary??"#2563eb";let _;h&&(T!=null&&T.shape)?_=T.shape:c.shape?_=c.shape:_="square";let L;return h&&(T==null?void 0:T.opacity)!=null?L=T.opacity:c.opacity!=null?L=c.opacity:L=1,{color:x,shape:_,opacity:L}}function A(c,m,h,T){const{color:x,shape:_,opacity:L}=T,k=L<1?` fill-opacity="${L}"`:"";switch(_){case"circle":return`<circle cx="${c}" cy="${m}" r="${h}" fill="${x}"${k}/>`;case"diamond":return`<polygon points="${[`${c},${m-h}`,`${c+h},${m}`,`${c},${m+h}`,`${c-h},${m}`].join(" ")}" fill="${x}"${k}/>`;case"triangle":return`<polygon points="${[`${c},${m-h}`,`${c+h},${m+h}`,`${c-h},${m+h}`].join(" ")}" fill="${x}"${k}/>`;default:return`<rect x="${c-h}" y="${m-h}" width="${h*2}" height="${h*2}" fill="${x}"${k}/>`}}const M=[];return l.forEach((c,m)=>{const h=o+wt(m,l.length),T=e(c.lower),x=e(c.upper),_=e(c.point),L=H(c,m),k=I(m===0),G=$;if(b){const S=L.opacity<1?` fill-opacity="${L.opacity}"`:"",F=[`${T},${h}`,`${_},${h-N}`,`${x},${h}`,`${_},${h+N}`].join(" ");M.push(`
        <g class="interval effect-${m} summary">
          <polygon points="${F}"
            fill="${L.color}"${S} stroke="${n.colors.summaryBorder}" stroke-width="1"/>
        </g>`)}else{const S=g,F=g+f,X=T<S,v=x>F,C=Math.max(S,Math.min(F,T)),O=Math.max(S,Math.min(F,x));let R="";X?R=`<path d="M ${S+4} ${h} L ${S+10} ${h-4} L ${S+10} ${h+4} Z" fill="${G}"/>`:R=`<line x1="${C}" x2="${C}" y1="${h-p}" y2="${h+p}" stroke="${G}" stroke-width="${d}"/>`;let P="";v?P=`<path d="M ${F-4} ${h} L ${F-10} ${h-4} L ${F-10} ${h+4} Z" fill="${G}"/>`:P=`<line x1="${O}" x2="${O}" y1="${h-p}" y2="${h+p}" stroke="${G}" stroke-width="${d}"/>`,M.push(`
        <g class="interval effect-${m}">
          <line x1="${C}" x2="${O}" y1="${h}" y2="${h}"
            stroke="${G}" stroke-width="${d}"/>
          ${R}
          ${P}
          ${A(_,h,k,L)}
        </g>`)}}),M.join("")}function Gt(t,o,e,n,i,r,s,g){const a=g.shapes.summaryHeight/2,l=i(o),u=i(t),d=i(e),$=r+Math.max(0,Math.min(s,l)),p=r+Math.max(0,Math.min(s,u)),b=r+Math.max(0,Math.min(s,d));return`<polygon points="${[`${$},${n}`,`${p},${n-a}`,`${b},${n}`,`${p},${n+a}`].join(" ")}"
    fill="${g.colors.summaryFill}"
    stroke="${g.colors.summaryBorder}"
    stroke-width="1"/>`}function Wt(t,o,e,n,i){const r=[],s=typeof e.axis.tickCount=="number"?e.axis.tickCount:w.DEFAULT_TICK_COUNT,g=Array.isArray(e.axis.tickValues)?e.axis.tickValues:t.ticks(s),f=V(e.typography.fontSizeSm);r.push(`<line x1="${i}" x2="${i+o.forestWidth}"
    y1="0" y2="0" stroke="${e.colors.border}" stroke-width="1"/>`);for(const a of g){const l=i+t(a);r.push(`<line x1="${l}" x2="${l}" y1="0" y2="4"
      stroke="${e.colors.border}" stroke-width="1"/>`),r.push(`<text x="${l}" y="16" text-anchor="middle"
      font-family="${e.typography.fontFamily}"
      font-size="${f}px"
      fill="${e.colors.secondary}">${_t(a)}</text>`)}return n&&r.push(`<text x="${i+o.forestWidth/2}" y="28"
      text-anchor="middle"
      font-family="${e.typography.fontFamily}"
      font-size="${f}px"
      font-weight="500"
      fill="${e.colors.secondary}">${W(n)}</text>`),`<g transform="translate(0, ${o.mainY+o.headerHeight+o.plotHeight})">${r.join(`
`)}</g>`}function dt(t,o,e,n,i,r,s=1,g=.6){let a=`<line x1="${t}" x2="${t}" y1="${o}" y2="${e}"
    stroke="${i}" stroke-width="${s}" stroke-opacity="${g}" stroke-dasharray="${n==="dashed"?"6,4":n==="dotted"?"2,2":"none"}"/>`;return r&&(a+=`<text x="${t}" y="${o-4}" text-anchor="middle"
      font-size="10px" fill="${i}">${W(r)}</text>`),a}class z extends Error{constructor(o){super(`SVG Generator: ${o}`),this.name="SVGGeneratorError"}}function Pt(t){if(!t||typeof t!="object")throw new z("Invalid spec: expected an object");const o=t;if(!o.data||typeof o.data!="object")throw new z("Invalid spec: missing or invalid 'data' property");const e=o.data;if(!Array.isArray(e.rows))throw new z("Invalid spec: 'data.rows' must be an array");if(!o.theme||typeof o.theme!="object")throw new z("Invalid spec: missing or invalid 'theme' property");const n=o.theme;if(!n.colors||typeof n.colors!="object")throw new z("Invalid spec: missing or invalid 'theme.colors'");if(!n.typography||typeof n.typography!="object")throw new z("Invalid spec: missing or invalid 'theme.typography'");if(!n.spacing||typeof n.spacing!="object")throw new z("Invalid spec: missing or invalid 'theme.spacing'")}function kt(t,o={}){Pt(t);const e=t.theme,n=yt(t,o),i=e.spacing.padding,r=Array.isArray(t.columns)?t.columns:[],s=Y(r,"left"),g=Y(r,"right"),f=j(r,"left"),a=j(r,"right"),l=D.DEFAULT_LABEL_WIDTH+f.reduce((y,c)=>y+(typeof c.width=="number"?c.width:D.DEFAULT_COLUMN_WIDTH),0),u=i+l,d=At(t,n.forestWidth),$=u+n.forestWidth,p=[];p.push(`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg"
  width="${n.totalWidth}" height="${n.totalHeight}"
  viewBox="0 0 ${n.totalWidth} ${n.totalHeight}">`);const b=o.backgroundColor??e.colors.background;p.push(`<rect width="100%" height="100%" fill="${b}"/>`),p.push(Nt(t,n,e));const E=n.mainY;p.push(lt(s,f,i,E,n.headerHeight,e,t.data.labelHeader??"Study",D.DEFAULT_LABEL_WIDTH)),a.length>0&&p.push(lt(g,a,$,E,n.headerHeight,e)),p.push(`<line x1="${i}" x2="${n.totalWidth-i}"
    y1="${E+n.headerHeight}" y2="${E+n.headerHeight}"
    stroke="${e.colors.border}" stroke-width="1"/>`);const N=rt(t);if(t.data.includeForest&&n.forestWidth>0){const y=n.mainY+n.headerHeight,c=u+d(t.data.nullValue);p.push(dt(c,y,y+n.plotHeight,"dashed",e.colors.muted));const m=Array.isArray(t.annotations)?t.annotations:[];for(const h of m)if(h.type==="reference_line"){const T=u+d(h.x);p.push(dt(T,y,y+n.plotHeight,h.style,h.color??e.colors.accent,h.label,h.width??1,h.opacity??.6))}if(N.forEach((h,T)=>{if(h.type==="data"){const x=y+T*n.rowHeight+n.rowHeight/2;p.push(Ft(h.row,x,_=>u+d(_),e,t.data.nullValue,t.data.effects,t.data.weightCol,u,n.forestWidth))}}),t.data.overall&&n.showOverallSummary&&typeof t.data.overall.point=="number"&&!Number.isNaN(t.data.overall.point)&&typeof t.data.overall.lower=="number"&&!Number.isNaN(t.data.overall.lower)&&typeof t.data.overall.upper=="number"&&!Number.isNaN(t.data.overall.upper)){const h=y+n.summaryYPosition;p.push(Gt(t.data.overall.point,t.data.overall.lower,t.data.overall.upper,h,d,u,n.forestWidth,e))}p.push(Wt(d,n,e,t.data.axisLabel,u))}const I=n.mainY+n.headerHeight,H=t.data.rows,A=ct(H,f),M=ct(H,a);return N.forEach((y,c)=>{const m=I+c*n.rowHeight;if(y.type==="group_header")p.push(Dt(y.label,y.depth,i,m,n.rowHeight,n.totalWidth-i*2,e));else{const h=y.row,T=y.depth,x=$t(T),_=c%2===1?pt:0,L=Math.max(x,_);L>0&&p.push(`<rect x="${i}" y="${m}"
          width="${n.totalWidth-i*2}" height="${n.rowHeight}"
          fill="${e.colors.muted}" opacity="${L}"/>`),p.push(ft(h,f,i,m,n.rowHeight,e,!0,D.DEFAULT_LABEL_WIDTH,T,A)),a.length>0&&p.push(ft(h,a,$,m,n.rowHeight,e,!1,0,T,M))}p.push(`<line x1="${i}" x2="${n.totalWidth-i}"
      y1="${m+n.rowHeight}" y2="${m+n.rowHeight}"
      stroke="${e.colors.border}" stroke-width="1" opacity="0.5"/>`)}),p.push(Mt(t,n,e)),p.push("</svg>"),p.join(`
`)}function Ct(t,o){const e=JSON.parse(t);return kt(e,o)}globalThis.generateSVG=Ct})();
