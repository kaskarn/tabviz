(function(){"use strict";function _t(t,n){if(n){const d=[.05,.1,.15,.2,.25,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2,1.3,1.4,1.5,1.75,2,2.5,3,4,5,6,7,8,10,12,15,20,25,30,40,50,75,100];let a=d[0];for(const c of d)if(c<=t[0])a=c;else break;let s=d[d.length-1];for(let c=d.length-1;c>=0&&d[c]>=t[1];c--)s=d[c];return[a,s]}const o=t[1]-t[0];if(o===0)return t;const e=Math.pow(10,Math.floor(Math.log10(o))),r=o/e;let i;r<=1?i=e*.1:r<=2?i=e*.2:r<=5?i=e*.5:i=e;const l=Math.floor(t[0]/i)*i,f=Math.ceil(t[1]/i)*i;return[l,f]}const dt=.08,At=.06,Nt=.05,ut=.04;function Ht(t){return t<=0?0:ut+t*ut}const v={DEFAULT_LABEL_WIDTH:200,DEFAULT_COLUMN_WIDTH:100,AXIS_HEIGHT:32,AXIS_LABEL_HEIGHT:20,BOTTOM_MARGIN:16,MIN_FOREST_WIDTH:200,DEFAULT_WIDTH:800,COLUMN_GAP:16},X={TITLE_HEIGHT:28,SUBTITLE_HEIGHT:20,CAPTION_HEIGHT:16,FOOTNOTE_HEIGHT:14,DEFAULT_FONT_SIZE:14,REM_BASE:16,TEXT_BASELINE_ADJUSTMENT:1/3},D={INDENT_PER_LEVEL:12,TEXT_PADDING:10,WHISKER_HALF_HEIGHT:4,DEFAULT_TICK_COUNT:5},ft={GROUP_HEADER_HEIGHT_MULTIPLIER:1.5,OVERALL_ROW_HEIGHT_MULTIPLIER:1.5},Z={PADDING:28,MIN:60,MAX:600,LABEL_MAX:400};function q(t,n){const o=t.split(".");return o[0]=o[0].replace(/\B(?=(\d{3})+(?!\d))/g,n),o.join(".")}function rt(t){const n=Math.abs(t),o=t<0?"-":"";if(n>=1e12)throw new Error(`Cannot abbreviate value >= 1 trillion: ${t}`);if(n>=1e9){const e=n/1e9;return o+it(e)+"B"}if(n>=1e6){const e=n/1e6;return o+it(e)+"M"}if(n>=1e3){const e=n/1e3;return o+it(e)+"K"}return o+Math.round(n).toString()}function it(t){const n=Math.round(t*10)/10;return n===Math.floor(n)?n.toFixed(0):n.toFixed(1)}const St={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","-":"⁻","+":"⁺"};function Dt(t){return t.split("").map(n=>St[n]??n).join("")}function Q(t,n){var f,d,a,s,c;if(t==null||Number.isNaN(t))return(n==null?void 0:n.naText)??"";if(n!=null&&n.percent){const{decimals:p,digits:m,multiply:h=!0,symbol:I=!0}=n.percent,H=h?t*100:t,A=m!=null?H.toPrecision(m):H.toFixed(p??1);return I?`${A}%`:A}if(((f=n==null?void 0:n.numeric)==null?void 0:f.abbreviate)&&Math.abs(t)>=1e3)return rt(t);const e=(d=n==null?void 0:n.numeric)==null?void 0:d.digits;if(e!=null){const p=t.toPrecision(e),m=(a=n==null?void 0:n.numeric)==null?void 0:a.thousandsSep;return m&&typeof m=="string"?q(p,m):p}const r=(s=n==null?void 0:n.numeric)==null?void 0:s.decimals,i=(c=n==null?void 0:n.numeric)==null?void 0:c.thousandsSep;let l;return r!==void 0?l=t.toFixed(r):Number.isInteger(t)||Math.abs(t-Math.round(t))<1e-4?l=Math.round(t).toString():l=t.toFixed(2),i&&typeof i=="string"&&(l=q(l,i)),l}function ht(t,n){const{eventsField:o,nField:e,separator:r="/",showPct:i=!1,thousandsSep:l,abbreviate:f}=n.events,d=t.metadata[o],a=t.metadata[e];if(d==null||a===void 0||a===null)return n.naText??"";const s=Number(d),c=Number(a);let p,m;f&&(s>=1e3||c>=1e3)?(p=s>=1e3?rt(s):String(s),m=c>=1e3?rt(c):String(c)):(p=String(s),m=String(c),l&&typeof l=="string"&&(p=q(p,l),m=q(m,l)));let h=`${p}${r}${m}`;if(i&&c>0){const I=(s/c*100).toFixed(1);h+=` (${I}%)`}return h}function pt(t,n,o,e){var f,d,a;if(t==null||Number.isNaN(t))return"";const r=((f=e==null?void 0:e.interval)==null?void 0:f.decimals)??2,i=((d=e==null?void 0:e.interval)==null?void 0:d.sep)??" ",l=(a=e==null?void 0:e.interval)==null?void 0:a.impreciseThreshold;return n==null||o===void 0||o===null||Number.isNaN(n)||Number.isNaN(o)?t.toFixed(r):l!=null&&n>0&&o/n>l?"—":`${t.toFixed(r)}${i}(${n.toFixed(r)}, ${o.toFixed(r)})`}function gt(t,n){if(t==null||Number.isNaN(t))return(n==null?void 0:n.naText)??"";const o=n==null?void 0:n.pvalue,e=(o==null?void 0:o.digits)??2,r=(o==null?void 0:o.expThreshold)??.001,i=(o==null?void 0:o.abbrevThreshold)??null,l=(o==null?void 0:o.format)??"auto",f=(o==null?void 0:o.stars)??!1,d=(o==null?void 0:o.thresholds)??[.05,.01,.001];let a="";if(f&&(t<d[2]?a="***":t<d[1]?a="**":t<d[0]&&(a="*")),i!==null&&t<i)return`<${i}${a}`;if(l==="scientific"||l==="auto"&&t<r){const c=Math.floor(Math.log10(t));return`${(t/Math.pow(10,c)).toPrecision(e)}×10${Dt(c.toString())}${a}`}let s;return t>=.1?s=t.toFixed(e):t>=.01?s=t.toFixed(e+1):s=t.toFixed(e+2),`${s}${a}`}function Wt(t,n){var i,l,f,d;const{type:o,field:e,options:r}=n;switch(o){case"interval":{const a=(i=r==null?void 0:r.interval)!=null&&i.point?t.metadata[r.interval.point]:t.point,s=(l=r==null?void 0:r.interval)!=null&&l.lower?t.metadata[r.interval.lower]:t.lower,c=(f=r==null?void 0:r.interval)!=null&&f.upper?t.metadata[r.interval.upper]:t.upper;return pt(a,s,c,r)}case"custom":return r!=null&&r.events?ht(t,r):String(t.metadata[e]??"");case"pvalue":return gt(t.metadata[e],r);case"numeric":return Q(t.metadata[e],r);case"percent":return Q(t.metadata[e],r);case"sparkline":case"icon":case"stars":case"img":case"range":return"";case"badge":{const a=t.metadata[e];return a==null?"":`  ${String(a)}  `}case"bar":{if(((d=r==null?void 0:r.bar)==null?void 0:d.showLabel)===!1)return"";const a=t.metadata[e];return a==null?"":a>=100?a.toFixed(0):a>=10?a.toFixed(1):a.toFixed(2)}case"text":default:return String(t.metadata[e]??"")}}function Y(t,n){const o="⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻";let e=0;for(const r of t)o.includes(r)?e+=n*.3:"il1.,;:|!()[]{}' ".includes(r)?e+=n*.35:"×−".includes(r)?e+=n*.5:"mwMW@%".includes(r)?e+=n*.85:r>="0"&&r<="9"?e+=n*.6:e+=n*.55;return e}function wt(t,n){var i,l;const o=new Map,e=O(t.theme.typography.fontSizeBase),r=t.data.rows;for(const f of n){if(f.width!=="auto"&&f.width!==null&&f.width!==void 0)continue;let d=0;f.header&&(d=Math.max(d,Y(f.header,e)));for(const s of r){if(((i=s.style)==null?void 0:i.type)==="header"||((l=s.style)==null?void 0:l.type)==="spacer")continue;const c=Wt(s,f);c&&(d=Math.max(d,Y(c,e)))}const a=Math.ceil(d+Z.PADDING);o.set(f.id,Math.min(Z.MAX,Math.max(Z.MIN,a)))}return o}function Lt(t){var f,d;const n=O(t.theme.typography.fontSizeBase);let o=0;const e=new Map,r=Array.isArray(t.data.groups)?t.data.groups:[];for(const a of r)e.set(a.id,a.depth);const i=a=>a?(e.get(a)??0)+1:0;t.data.labelHeader&&(o=Math.max(o,Y(t.data.labelHeader,n)));for(const a of t.data.rows)if(a.label){const s=i(a.groupId),c=((f=a.style)==null?void 0:f.indent)??0,m=(s+c)*D.INDENT_PER_LEVEL;let h=Y(a.label,n)+m;if((d=a.style)!=null&&d.badge){const I=String(a.style.badge),H=n*.8,A=4,b=6,E=Y(I,H)+A*2;h+=b+E}o=Math.max(o,h)}for(const a of r)if(a.label){const s=a.depth*D.INDENT_PER_LEVEL;o=Math.max(o,Y(a.label,n)+s)}const l=Math.ceil(o+Z.PADDING);return Math.min(Z.LABEL_MAX,Math.max(Z.MIN,l))}function at(t,n){const o=n.get(t.id);return o!==void 0?o:typeof t.width=="number"?t.width:v.DEFAULT_COLUMN_WIDTH}function Ft(t,n){var C,k,z,U;const o=t.theme,e=o.spacing.rowHeight,r=o.spacing.padding,i=Array.isArray(t.columns)?t.columns:[],l=et(i,"left"),f=et(i,"right"),a=st(l)||st(f)?o.spacing.headerHeight*ft.GROUP_HEADER_HEIGHT_MULTIPLIER:o.spacing.headerHeight,s=!!((C=t.labels)!=null&&C.title),c=!!((k=t.labels)!=null&&k.subtitle),p=!!((z=t.labels)!=null&&z.caption),m=!!((U=t.labels)!=null&&U.footnote),h=s?X.TITLE_HEIGHT:0,I=c?X.SUBTITLE_HEIGHT:0,H=h+I+(s||c?r:0),A=p?X.CAPTION_HEIGHT:0,b=m?X.FOOTNOTE_HEIGHT:0,N=A+b+(p||m?r:0),S=$t(t).length,g=!!t.data.overall,u=S*e+(g?e*ft.OVERALL_ROW_HEIGHT_MULTIPLIER:0),y=tt(i,"left"),$=tt(i,"right"),x=[...y,...$],M=wt(t,x),_=Lt(t),L=_+y.reduce((J,j)=>J+at(j,M),0),F=$.reduce((J,j)=>J+at(j,M),0),W=n.width??v.DEFAULT_WIDTH,T=t.data.includeForest,w=L+F;let R;if(!T)R=0;else if(typeof t.layout.plotWidth=="number")R=t.layout.plotWidth;else{const J=W-w-v.COLUMN_GAP*2-r*2;R=Math.max(J,v.MIN_FOREST_WIDTH)}const V=r*2+w+R+v.COLUMN_GAP*2,B=Math.max(n.width??W,V),P=H+r+a+u+v.AXIS_HEIGHT+v.AXIS_LABEL_HEIGHT+N+v.BOTTOM_MARGIN;return{totalWidth:B,totalHeight:n.height??P,tableWidth:L+F,forestWidth:R,headerHeight:a,rowHeight:e,plotHeight:u,axisHeight:v.AXIS_HEIGHT,nullValue:t.data.nullValue,summaryYPosition:u-e,showOverallSummary:g,headerTextHeight:H,footerTextHeight:N,titleY:r+X.TITLE_HEIGHT-8,subtitleY:r+h+X.SUBTITLE_HEIGHT-4,mainY:H+r,footerY:H+r+a+u+v.AXIS_HEIGHT+v.AXIS_LABEL_HEIGHT+r,autoWidths:M,labelWidth:_}}function $t(t){var c;const n=t.data.rows,o=Array.isArray(t.data.groups)?t.data.groups:[];if(o.length===0)return n.map(p=>({type:"data",row:p,depth:0}));const e=new Map;for(const p of o)e.set(p.id,p);const r=new Map;for(const p of n){const m=p.groupId??null;r.has(m)||r.set(m,[]),r.get(m).push(p)}const i=new Set;for(const p of r.keys()){if(!p)continue;let m=p;for(;m;)i.add(m),m=(c=e.get(m))==null?void 0:c.parentId}function l(p){return o.filter(m=>(m.parentId??null)===p&&i.has(m.id))}function f(p){if(!p)return 0;const m=e.get(p);return m?m.depth+1:0}function d(p){var h;let m=((h=r.get(p))==null?void 0:h.length)??0;for(const I of l(p))m+=d(I.id);return m}const a=[];function s(p){if(p){const h=e.get(p);if(!h)return;const I=d(p);a.push({type:"group_header",groupId:h.id,label:h.label,depth:h.depth,rowCount:I})}for(const h of l(p))s(h.id);const m=r.get(p)??[];for(const h of m)a.push({type:"data",row:h,depth:f(h.groupId)})}return s(null),a}function yt(t){const n=[];for(const o of t)o.isGroup?n.push(...yt(o.columns)):n.push(o);return n}function tt(t,n){const o=[];for(const e of t)e.position===n&&(e.isGroup?o.push(...yt(e.columns)):o.push(e));return o}function et(t,n){return t.filter(o=>o.position===n)}function st(t){return t.some(n=>n.isGroup)}function O(t){return t.endsWith("rem")?parseFloat(t)*X.REM_BASE:t.endsWith("px")?parseFloat(t):X.DEFAULT_FONT_SIZE}function nt(t,n,o){return o==="right"?{textX:t+n-D.TEXT_PADDING,anchor:"end"}:o==="center"?{textX:t+n/2,anchor:"middle"}:{textX:t+D.TEXT_PADDING,anchor:"start"}}function G(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function lt(t,n,o,e=0){const r=n-e*2;if(Y(t,o)<=r)return t;const l="…",f=o*.55;let d=0,a=t.length;for(;d<a;){const s=Math.ceil((d+a)/2),c=t.slice(0,s);Y(c,o)+f<=r?d=s:a=s-1}return d===0?l:t.slice(0,d)+l}function Gt(t){return Math.abs(t)<.01?"0":Math.abs(t)>=100?t.toFixed(0):Math.abs(t)>=10?t.toFixed(1):t.toFixed(2)}function vt(t,n){const[o,e]=t,[r,i]=n,l=(i-r)/(e-o),f=d=>r+(d-o)*l;return f.domain=()=>t,f.range=()=>n,f.ticks=d=>{const a=(e-o)/(d-1),s=[];for(let c=0;c<d;c++)s.push(o+a*c);return s},f}function Pt(t,n){const[o,e]=t.map(s=>Math.max(s,.001)),[r,i]=n,l=Math.log10(o),f=Math.log10(e),d=(i-r)/(f-l),a=s=>{const c=Math.log10(Math.max(s,.001));return r+(c-l)*d};return a.domain=()=>[o,e],a.range=()=>n,a.ticks=s=>{const c=[],p=Math.floor(Math.log10(o)),m=Math.ceil(Math.log10(e));for(let h=p;h<=m;h++){const I=Math.pow(10,h);for(const H of[1,2,5]){const A=I*H;A>=o&&A<=e&&c.push(A)}}return c.length>0?c:[o,e]},a}function kt(t,n){const o=t.data.rows,e=t.theme.axis,r=t.data.scale==="log",i=typeof(e==null?void 0:e.rangeMin)=="number",l=typeof(e==null?void 0:e.rangeMax)=="number";let f;if(i&&l)f=[e.rangeMin,e.rangeMax];else{const a=o.flatMap(s=>[s.lower,s.upper]).filter(s=>s!=null&&!Number.isNaN(s)&&Number.isFinite(s));if(a.length===0)f=r?[.1,10]:[0,1];else{const[s,c]=[Math.min(...a),Math.max(...a)],p=c-s||1;f=[i?e.rangeMin:s-p*dt,l?e.rangeMax:c+p*dt]}}const d=_t(f,r);return r?Pt([Math.max(d[0],.01),Math.max(d[1],.02)],[0,n]):vt(d,[0,n])}function Ct(t,n,o){var i,l;const e=[],r=o.spacing.padding;if((i=t.labels)!=null&&i.title){const f=O(o.typography.fontSizeLg);e.push(`<text x="${r}" y="${n.titleY}"
      font-family="${o.typography.fontFamily}"
      font-size="${f}px"
      font-weight="${o.typography.fontWeightBold}"
      fill="${o.colors.foreground}">${G(t.labels.title)}</text>`)}if((l=t.labels)!=null&&l.subtitle){const f=O(o.typography.fontSizeBase);e.push(`<text x="${r}" y="${n.subtitleY}"
      font-family="${o.typography.fontFamily}"
      font-size="${f}px"
      fill="${o.colors.secondary}">${G(t.labels.subtitle)}</text>`)}return e.join(`
`)}function Xt(t,n,o){var l,f;const e=[],r=o.spacing.padding;let i=n.footerY;if((l=t.labels)!=null&&l.caption){const d=O(o.typography.fontSizeSm);e.push(`<text x="${r}" y="${i}"
      font-family="${o.typography.fontFamily}"
      font-size="${d}px"
      fill="${o.colors.secondary}">${G(t.labels.caption)}</text>`),i+=X.CAPTION_HEIGHT}if((f=t.labels)!=null&&f.footnote){const d=O(o.typography.fontSizeSm);e.push(`<text x="${r}" y="${i}"
      font-family="${o.typography.fontFamily}"
      font-size="${d}px"
      font-style="italic"
      fill="${o.colors.muted}">${G(t.labels.footnote)}</text>`)}return e.join(`
`)}function mt(t,n,o,e,r,i,l,f,d){const a=[],s=O(i.typography.fontSizeSm),c=i.typography.fontWeightMedium,p=i.typography.fontWeightBold,m=st(t),h=f??v.DEFAULT_LABEL_WIDTH,I=b=>{if(d){const N=d.get(b.id);if(N!==void 0)return N}return typeof b.width=="number"?b.width:v.DEFAULT_COLUMN_WIDTH},H=b=>b.isGroup?b.columns.reduce((N,E)=>N+H(E),0):I(b),A=(b,N)=>b+N/2+s*X.TEXT_BASELINE_ADJUSTMENT;if(m){const b=r/2,N=r/2;let E=o;l&&(a.push(`<text x="${E+D.TEXT_PADDING}" y="${A(e,r)}"
        font-family="${i.typography.fontFamily}"
        font-size="${s}px"
        font-weight="${c}"
        fill="${i.colors.foreground}">${G(l)}</text>`),a.push(`<line x1="${E+h}" x2="${E+h}"
        y1="${e}" y2="${e+r}"
        stroke="${i.colors.border}" stroke-width="1" opacity="0.3"/>`),E+=h);for(const S of t)if(S.isGroup){const g=H(S),u=E+g/2;a.push(`<text x="${u}" y="${A(e,b)}"
          font-family="${i.typography.fontFamily}"
          font-size="${s}px"
          font-weight="${p}"
          text-anchor="middle"
          fill="${i.colors.foreground}">${G(S.header)}</text>`),a.push(`<line x1="${E}" x2="${E+g}"
          y1="${e+b}" y2="${e+b}"
          stroke="${i.colors.border}" stroke-width="1" opacity="0.5"/>`),E+=g}else{const g=I(S),u=S.headerAlign??S.align,{textX:y,anchor:$}=nt(E,g,u),x=lt(S.header,g,s,D.TEXT_PADDING);a.push(`<text x="${y}" y="${A(e,r)}"
          font-family="${i.typography.fontFamily}"
          font-size="${s}px"
          font-weight="${c}"
          text-anchor="${$}"
          fill="${i.colors.foreground}">${G(x)}</text>`),E+=g}E=o+(l?h:0);for(const S of t)if(S.isGroup){for(const g of S.columns)if(!g.isGroup){const u=I(g),y=g.headerAlign??g.align,{textX:$,anchor:x}=nt(E,u,y);a.push(`<text x="${$}" y="${A(e+b,N)}"
              font-family="${i.typography.fontFamily}"
              font-size="${s}px"
              font-weight="${c}"
              text-anchor="${x}"
              fill="${i.colors.foreground}">${G(g.header)}</text>`),E+=u}}else{const g=I(S);E+=g}}else{let b=o;l&&(a.push(`<text x="${b+D.TEXT_PADDING}" y="${A(e,r)}"
        font-family="${i.typography.fontFamily}"
        font-size="${s}px"
        font-weight="${c}"
        fill="${i.colors.foreground}">${G(l)}</text>`),b+=h);for(const N of n){const E=I(N),S=N.headerAlign??N.align,{textX:g,anchor:u}=nt(b,E,S),y=lt(N.header,E,s,D.TEXT_PADDING);a.push(`<text x="${g}" y="${A(e,r)}"
        font-family="${i.typography.fontFamily}"
        font-size="${s}px"
        font-weight="${c}"
        text-anchor="${u}"
        fill="${i.colors.foreground}">${G(y)}</text>`),b+=E}}return a.join(`
`)}function Rt(t,n,o,e,r,i,l){const f=[],d=O(l.typography.fontSizeBase),a=e+r/2+d*X.TEXT_BASELINE_ADJUSTMENT,s=n*D.INDENT_PER_LEVEL;return f.push(`<rect x="${o}" y="${e}"
    width="${i}" height="${r}"
    fill="${l.colors.primary}" opacity="${Nt}"/>`),f.push(`<text x="${o+D.TEXT_PADDING+s}" y="${a}"
    font-family="${l.typography.fontFamily}"
    font-size="${d}px"
    font-weight="${l.typography.fontWeightBold}"
    fill="${l.colors.foreground}">${G(t)}</text>`),f.join(`
`)}function xt(t,n){const o=new Map;for(const e of n)if(e.type==="bar"){let r=0;for(const i of t){const l=i.metadata[e.field];typeof l=="number"&&l>r&&(r=l)}o.set(e.field,r>0?r:1)}return o}function Tt(t,n,o,e,r,i,l,f=v.DEFAULT_LABEL_WIDTH,d=0,a,s){var H,A,b,N,E,S,g,u,y,$,x,M,_,L,F,W;const c=[],p=O(i.typography.fontSizeBase),m=e+r/2+p*X.TEXT_BASELINE_ADJUSTMENT;let h=o;const I=T=>{if(s){const w=s.get(T.id);if(w!==void 0)return w}return typeof T.width=="number"?T.width:v.DEFAULT_COLUMN_WIDTH};if(l){const T=d*D.INDENT_PER_LEVEL+(((H=t.style)==null?void 0:H.indent)??0)*D.INDENT_PER_LEVEL,w=(A=t.style)!=null&&A.bold||(b=t.style)!=null&&b.emphasis?i.typography.fontWeightBold:i.typography.fontWeightNormal,R=(N=t.style)!=null&&N.italic?"italic":"normal";let V=i.colors.foreground;(E=t.style)!=null&&E.color?V=t.style.color:(S=t.style)!=null&&S.muted?V=i.colors.muted:(g=t.style)!=null&&g.accent&&(V=i.colors.accent);const B=f-T-D.TEXT_PADDING*2,P=lt(t.label,B,p,0);if(c.push(`<text x="${h+D.TEXT_PADDING+T}" y="${m}"
      font-family="${i.typography.fontFamily}"
      font-size="${p}px"
      font-weight="${w}"
      font-style="${R}"
      fill="${V}">${G(P)}</text>`),(u=t.style)!=null&&u.badge){const C=String(t.style.badge),k=p*.8,z=4,U=k+z*2,J=t.label.length*p*.55,j=h+D.TEXT_PADDING+T+J+6,ot=C.length*k*.6+z*2,It=e+(r-U)/2;c.push(`<rect x="${j}" y="${It}" width="${ot}" height="${U}"
        rx="3" fill="${i.colors.primary}" opacity="0.15"/>`),c.push(`<text x="${j+ot/2}" y="${It+U/2+k*.35}"
        text-anchor="middle"
        font-family="${i.typography.fontFamily}"
        font-size="${k}px"
        font-weight="500"
        fill="${i.colors.primary}">${G(C)}</text>`)}h+=f}for(const T of n){const w=I(T),R=Ut(t,T),{textX:V,anchor:B}=nt(h,w,T.align);if(T.type==="bar"&&typeof t.metadata[T.field]=="number"){const P=t.metadata[T.field],C=a==null?void 0:a.get(T.field),k=(($=(y=T.options)==null?void 0:y.bar)==null?void 0:$.maxValue)??C??100,z=((M=(x=T.options)==null?void 0:x.bar)==null?void 0:M.color)??i.colors.primary,U=i.shapes.pointSize*2,j=w-D.TEXT_PADDING*2-50,Mt=Math.min(P/k*j,j);c.push(`<rect x="${h+D.TEXT_PADDING}" y="${e+r/2-U/2}"
        width="${Math.max(0,Mt)}" height="${U}"
        fill="${z}" opacity="0.7" rx="2"/>`);const ot=h+w-D.TEXT_PADDING;c.push(`<text x="${ot}" y="${m}"
        font-family="${i.typography.fontFamily}"
        font-size="${p}px"
        text-anchor="end"
        fill="${i.colors.foreground}">${Q(P)}</text>`)}else if(T.type==="sparkline"&&Array.isArray(t.metadata[T.field])){let P=t.metadata[T.field];Array.isArray(P[0])&&(P=P[0]);const C=((L=(_=T.options)==null?void 0:_.sparkline)==null?void 0:L.height)??16,k=((W=(F=T.options)==null?void 0:F.sparkline)==null?void 0:W.color)??i.colors.primary,z=D.TEXT_PADDING*2,U=Ot(P,h+D.TEXT_PADDING,e+r/2-C/2,w-z,C);c.push(`<path d="${U}" fill="none" stroke="${k}" stroke-width="1.5"/>`)}else c.push(`<text x="${V}" y="${m}"
        font-family="${i.typography.fontFamily}"
        font-size="${p}px"
        text-anchor="${B}"
        fill="${i.colors.foreground}">${G(R)}</text>`);h+=w}return c.join(`
`)}function Ut(t,n){var e,r,i,l,f,d,a,s,c,p,m,h,I,H,A,b,N,E,S;if(n.type==="interval"){const g=(r=(e=n.options)==null?void 0:e.interval)!=null&&r.point?t.metadata[n.options.interval.point]:t.point,u=(l=(i=n.options)==null?void 0:i.interval)!=null&&l.lower?t.metadata[n.options.interval.lower]:t.lower,y=(d=(f=n.options)==null?void 0:f.interval)!=null&&d.upper?t.metadata[n.options.interval.upper]:t.upper;return pt(g,u,y,n.options)}if(n.type==="numeric"){const g=t.metadata[n.field];return typeof g=="number"?Q(g,n.options):((a=n.options)==null?void 0:a.naText)??""}if(n.type==="custom"&&((s=n.options)!=null&&s.events))return ht(t,n.options);if(n.type==="pvalue"){const g=t.metadata[n.field];return typeof g!="number"?((c=n.options)==null?void 0:c.naText)??"":gt(g,n.options)}if(n.type==="icon"){const g=t.metadata[n.field];if(g==null)return"";const u=String(g),y=(m=(p=n.options)==null?void 0:p.icon)==null?void 0:m.mapping;return y&&u in y?y[u]:u}if(n.type==="badge"){const g=t.metadata[n.field];return g!=null?String(g):""}if(n.type==="stars"){const g=t.metadata[n.field];if(typeof g!="number")return"";const u=((I=(h=n.options)==null?void 0:h.stars)==null?void 0:I.maxStars)??5,y=Math.max(0,Math.min(u,g)),$=Math.floor(y),x=u-$;return"★".repeat($)+"☆".repeat(x)}if(n.type==="img")return((A=(H=n.options)==null?void 0:H.img)==null?void 0:A.fallback)??"[IMG]";if(n.type==="reference"){const g=t.metadata[n.field];if(g==null)return"";const u=String(g),y=((N=(b=n.options)==null?void 0:b.reference)==null?void 0:N.maxChars)??30;return u.length<=y?u:u.substring(0,y)+"..."}if(n.type==="range"){const g=(E=n.options)==null?void 0:E.range;if(!g)return"";const u=t.metadata[g.minField],y=t.metadata[g.maxField],$=g.separator??" – ",x=g.decimals,M=_=>typeof _!="number"?"":x==null?Number.isInteger(_)?String(_):_.toFixed(1):_.toFixed(x);return u===null&&y===null?"":u===null?M(y):y===null?M(u):`${M(u)}${$}${M(y)}`}const o=t.metadata[n.field];return o!=null?String(o):((S=n.options)==null?void 0:S.naText)??""}function Ot(t,n,o,e,r){const i=t.filter(s=>Number.isFinite(s));if(i.length===0)return"";if(i.length===1){const s=n+e/2,c=o+r/2;return`M${s.toFixed(1)},${c.toFixed(1)}`}const l=Math.min(...i),d=Math.max(...i)-l||1;return`M${i.map((s,c)=>{const p=n+c/(i.length-1)*e,m=o+r-(s-l)/d*r;return`${p.toFixed(1)},${m.toFixed(1)}`}).join("L")}`}const bt=6;function ct(t,n,o){const e=t.metadata[n];return e!=null&&typeof e=="number"&&!Number.isNaN(e)?e:o}function Vt(t,n){return n<=1?0:-((n-1)*bt)/2+t*bt}function Bt(t,n,o,e,r,i=[],l,f=0,d=1/0){var g;let a;i.length===0?a=[{point:t.point,lower:t.lower,upper:t.upper,color:null,shape:null,opacity:null}]:a=i.map(u=>({point:ct(t,u.pointCol,t.point),lower:ct(t,u.lowerCol,t.lower),upper:ct(t,u.upperCol,t.upper),color:u.color??null,shape:u.shape??null,opacity:u.opacity??null}));const s=a.filter(u=>u.point!=null&&!Number.isNaN(u.point)&&u.lower!=null&&!Number.isNaN(u.lower)&&u.upper!=null&&!Number.isNaN(u.upper));if(s.length===0)return"";const c=e.shapes.pointSize,p=e.shapes.lineWidth,m=e.colors.intervalLine,h=D.WHISKER_HALF_HEIGHT,I=((g=t.style)==null?void 0:g.type)==="summary",A=e.shapes.summaryHeight/2;function b(u){var $;if(u&&(($=t.markerStyle)==null?void 0:$.size)!=null)return c*t.markerStyle.size;const y=l?t.metadata[l]:void 0;if(y){const x=.5+Math.sqrt(y/100)*1.5;return Math.min(Math.max(c*x,3),c*2.5)}return c}function N(u,y){const $=y===0,x=t.markerStyle,M=e.shapes.markerColors,_=e.shapes.markerShapes,L=["square","circle","diamond","triangle"];let F;$&&(x!=null&&x.color)?F=x.color:u.color?F=u.color:M&&M.length>0?F=M[y%M.length]:F=e.colors.interval??e.colors.primary??"#2563eb";let W;$&&(x!=null&&x.shape)?W=x.shape:u.shape?W=u.shape:_&&_.length>0?W=_[y%_.length]:W=L[y%L.length];let T;return $&&(x==null?void 0:x.opacity)!=null?T=x.opacity:u.opacity!=null?T=u.opacity:T=1,{color:F,shape:W,opacity:T}}function E(u,y,$,x){const{color:M,shape:_,opacity:L}=x,F=L<1?` fill-opacity="${L}"`:"";switch(_){case"circle":return`<circle cx="${u}" cy="${y}" r="${$}" fill="${M}"${F}/>`;case"diamond":return`<polygon points="${[`${u},${y-$}`,`${u+$},${y}`,`${u},${y+$}`,`${u-$},${y}`].join(" ")}" fill="${M}"${F}/>`;case"triangle":return`<polygon points="${[`${u},${y-$}`,`${u+$},${y+$}`,`${u-$},${y+$}`].join(" ")}" fill="${M}"${F}/>`;default:return`<rect x="${u-$}" y="${y-$}" width="${$*2}" height="${$*2}" fill="${M}"${F}/>`}}const S=[];return s.forEach((u,y)=>{const $=n+Vt(y,s.length),x=o(u.lower),M=o(u.upper),_=o(u.point),L=N(u,y),F=b(y===0),W=m;if(I){const T=L.opacity<1?` fill-opacity="${L.opacity}"`:"",w=[`${x},${$}`,`${_},${$-A}`,`${M},${$}`,`${_},${$+A}`].join(" ");S.push(`
        <g class="interval effect-${y} summary">
          <polygon points="${w}"
            fill="${L.color}"${T} stroke="${e.colors.summaryBorder}" stroke-width="1"/>
        </g>`)}else{const T=f,w=f+d,R=x<T,V=M>w,B=Math.max(T,Math.min(w,x)),P=Math.max(T,Math.min(w,M));let C="";R?C=`<path d="M ${T+4} ${$} L ${T+10} ${$-4} L ${T+10} ${$+4} Z" fill="${W}"/>`:C=`<line x1="${B}" x2="${B}" y1="${$-h}" y2="${$+h}" stroke="${W}" stroke-width="${p}"/>`;let k="";V?k=`<path d="M ${w-4} ${$} L ${w-10} ${$-4} L ${w-10} ${$+4} Z" fill="${W}"/>`:k=`<line x1="${P}" x2="${P}" y1="${$-h}" y2="${$+h}" stroke="${W}" stroke-width="${p}"/>`,S.push(`
        <g class="interval effect-${y}">
          <line x1="${B}" x2="${P}" y1="${$}" y2="${$}"
            stroke="${W}" stroke-width="${p}"/>
          ${C}
          ${k}
          ${E(_,$,F,L)}
        </g>`)}}),S.join("")}function zt(t,n,o,e,r,i,l,f){const a=f.shapes.summaryHeight/2,s=r(n),c=r(t),p=r(o),m=i+Math.max(0,Math.min(l,s)),h=i+Math.max(0,Math.min(l,c)),I=i+Math.max(0,Math.min(l,p));return`<polygon points="${[`${m},${e}`,`${h},${e-a}`,`${I},${e}`,`${h},${e+a}`].join(" ")}"
    fill="${f.colors.summaryFill}"
    stroke="${f.colors.summaryBorder}"
    stroke-width="1"/>`}function jt(t,n,o,e,r){const i=[],l=typeof o.axis.tickCount=="number"?o.axis.tickCount:D.DEFAULT_TICK_COUNT,f=Array.isArray(o.axis.tickValues)?o.axis.tickValues:t.ticks(l),d=O(o.typography.fontSizeSm);i.push(`<line x1="${r}" x2="${r+n.forestWidth}"
    y1="0" y2="0" stroke="${o.colors.border}" stroke-width="1"/>`);for(const a of f){const s=r+t(a);i.push(`<line x1="${s}" x2="${s}" y1="0" y2="4"
      stroke="${o.colors.border}" stroke-width="1"/>`),i.push(`<text x="${s}" y="16" text-anchor="middle"
      font-family="${o.typography.fontFamily}"
      font-size="${d}px"
      fill="${o.colors.secondary}">${Gt(a)}</text>`)}return e&&i.push(`<text x="${r+n.forestWidth/2}" y="28"
      text-anchor="middle"
      font-family="${o.typography.fontFamily}"
      font-size="${d}px"
      font-weight="500"
      fill="${o.colors.secondary}">${G(e)}</text>`),`<g transform="translate(0, ${n.mainY+n.headerHeight+n.plotHeight})">${i.join(`
`)}</g>`}function Et(t,n,o,e,r,i,l=1,f=.6){let a=`<line x1="${t}" x2="${t}" y1="${n}" y2="${o}"
    stroke="${r}" stroke-width="${l}" stroke-opacity="${f}" stroke-dasharray="${e==="dashed"?"6,4":e==="dotted"?"2,2":"none"}"/>`;return i&&(a+=`<text x="${t}" y="${n-4}" text-anchor="middle"
      font-size="10px" fill="${r}">${G(i)}</text>`),a}class K extends Error{constructor(n){super(`SVG Generator: ${n}`),this.name="SVGGeneratorError"}}function Yt(t){if(!t||typeof t!="object")throw new K("Invalid spec: expected an object");const n=t;if(!n.data||typeof n.data!="object")throw new K("Invalid spec: missing or invalid 'data' property");const o=n.data;if(!Array.isArray(o.rows))throw new K("Invalid spec: 'data.rows' must be an array");if(!n.theme||typeof n.theme!="object")throw new K("Invalid spec: missing or invalid 'theme' property");const e=n.theme;if(!e.colors||typeof e.colors!="object")throw new K("Invalid spec: missing or invalid 'theme.colors'");if(!e.typography||typeof e.typography!="object")throw new K("Invalid spec: missing or invalid 'theme.typography'");if(!e.spacing||typeof e.spacing!="object")throw new K("Invalid spec: missing or invalid 'theme.spacing'")}function Jt(t,n={}){Yt(t);const o=t.theme,e=Ft(t,n),r=o.spacing.padding,i=Array.isArray(t.columns)?t.columns:[],l=et(i,"left"),f=et(i,"right"),d=tt(i,"left"),a=tt(i,"right"),s=e.labelWidth+d.reduce((g,u)=>g+at(u,e.autoWidths),0),c=r+s,p=kt(t,e.forestWidth),m=c+e.forestWidth,h=[];h.push(`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg"
  width="${e.totalWidth}" height="${e.totalHeight}"
  viewBox="0 0 ${e.totalWidth} ${e.totalHeight}">`);const I=n.backgroundColor??o.colors.background;h.push(`<rect width="100%" height="100%" fill="${I}"/>`),h.push(Ct(t,e,o));const H=e.mainY;h.push(mt(l,d,r,H,e.headerHeight,o,t.data.labelHeader??"Study",e.labelWidth,e.autoWidths)),a.length>0&&h.push(mt(f,a,m,H,e.headerHeight,o,void 0,void 0,e.autoWidths)),h.push(`<line x1="${r}" x2="${e.totalWidth-r}"
    y1="${H+e.headerHeight}" y2="${H+e.headerHeight}"
    stroke="${o.colors.border}" stroke-width="1"/>`);const A=$t(t);if(t.data.includeForest&&e.forestWidth>0){const g=e.mainY+e.headerHeight,u=c+p(t.data.nullValue);h.push(Et(u,g,g+e.plotHeight,"dashed",o.colors.muted));const y=Array.isArray(t.annotations)?t.annotations:[];for(const $ of y)if($.type==="reference_line"){const x=c+p($.x);h.push(Et(x,g,g+e.plotHeight,$.style,$.color??o.colors.accent,$.label,$.width??1,$.opacity??.6))}if(A.forEach(($,x)=>{if($.type==="data"){const M=g+x*e.rowHeight+e.rowHeight/2;h.push(Bt($.row,M,_=>c+p(_),o,t.data.nullValue,t.data.effects,t.data.weightCol,c,e.forestWidth))}}),t.data.overall&&e.showOverallSummary&&typeof t.data.overall.point=="number"&&!Number.isNaN(t.data.overall.point)&&typeof t.data.overall.lower=="number"&&!Number.isNaN(t.data.overall.lower)&&typeof t.data.overall.upper=="number"&&!Number.isNaN(t.data.overall.upper)){const $=g+e.summaryYPosition;h.push(zt(t.data.overall.point,t.data.overall.lower,t.data.overall.upper,$,p,c,e.forestWidth,o))}h.push(jt(p,e,o,t.data.axisLabel,c))}const b=e.mainY+e.headerHeight,N=t.data.rows,E=xt(N,d),S=xt(N,a);return A.forEach((g,u)=>{var $,x;const y=b+u*e.rowHeight;if(g.type==="group_header")h.push(Rt(g.label,g.depth,r,y,e.rowHeight,e.totalWidth-r*2,o));else{const M=g.row,_=g.depth,L=Ht(_),F=u%2===1?At:0,W=Math.max(L,F);W>0&&h.push(`<rect x="${r}" y="${y}"
          width="${e.totalWidth-r*2}" height="${e.rowHeight}"
          fill="${o.colors.muted}" opacity="${W}"/>`),h.push(Tt(M,d,r,y,e.rowHeight,o,!0,e.labelWidth,_,E,e.autoWidths)),a.length>0&&h.push(Tt(M,a,m,y,e.rowHeight,o,!1,0,_,S,e.autoWidths))}if(g.type==="data"){const M=g.row,_=(($=M.style)==null?void 0:$.type)==="summary",L=((x=M.style)==null?void 0:x.type)==="spacer";_&&h.push(`<line x1="${r}" x2="${e.totalWidth-r}"
          y1="${y}" y2="${y}"
          stroke="${o.colors.border}" stroke-width="2"/>`),L||h.push(`<line x1="${r}" x2="${e.totalWidth-r}"
          y1="${y+e.rowHeight}" y2="${y+e.rowHeight}"
          stroke="${o.colors.border}" stroke-width="1" opacity="0.5"/>`)}else h.push(`<line x1="${r}" x2="${e.totalWidth-r}"
        y1="${y+e.rowHeight}" y2="${y+e.rowHeight}"
        stroke="${o.colors.border}" stroke-width="1" opacity="0.5"/>`)}),h.push(Xt(t,e,o)),h.push("</svg>"),h.join(`
`)}function Kt(t,n){const o=JSON.parse(t);return Jt(o,n)}globalThis.generateSVG=Kt})();
