(function(){"use strict";function Nt(t,n){if(n){const f=[.05,.1,.15,.2,.25,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2,1.3,1.4,1.5,1.75,2,2.5,3,4,5,6,7,8,10,12,15,20,25,30,40,50,75,100];let a=f[0];for(const l of f)if(l<=t[0])a=l;else break;let u=f[f.length-1];for(let l=f.length-1;l>=0&&f[l]>=t[1];l--)u=f[l];return[a,u]}const o=t[1]-t[0];if(o===0)return t;const e=Math.pow(10,Math.floor(Math.log10(o))),r=o/e;let i;r<=1?i=e*.1:r<=2?i=e*.2:r<=5?i=e*.5:i=e;const s=Math.floor(t[0]/i)*i,g=Math.ceil(t[1]/i)*i;return[s,g]}const St=.06,Ht=.05,dt=.04;function Dt(t){return t<=0?0:dt+t*dt}const k={DEFAULT_LABEL_WIDTH:200,DEFAULT_COLUMN_WIDTH:100,AXIS_HEIGHT:32,AXIS_LABEL_HEIGHT:20,BOTTOM_MARGIN:16,MIN_FOREST_WIDTH:200,DEFAULT_WIDTH:800,COLUMN_GAP:16},B={TITLE_HEIGHT:28,SUBTITLE_HEIGHT:20,CAPTION_HEIGHT:16,FOOTNOTE_HEIGHT:14,DEFAULT_FONT_SIZE:14,REM_BASE:16,TEXT_BASELINE_ADJUSTMENT:1/3},G={INDENT_PER_LEVEL:12,TEXT_PADDING:10,WHISKER_HALF_HEIGHT:4,DEFAULT_TICK_COUNT:5},ut={GROUP_HEADER_HEIGHT_MULTIPLIER:1.3,OVERALL_ROW_HEIGHT_MULTIPLIER:1.5},Z={PADDING:28,MIN:60,MAX:600,LABEL_MAX:400};function q(t,n){const o=t.split(".");return o[0]=o[0].replace(/\B(?=(\d{3})+(?!\d))/g,n),o.join(".")}function rt(t){const n=Math.abs(t),o=t<0?"-":"";if(n>=1e12)throw new Error(`Cannot abbreviate value >= 1 trillion: ${t}`);if(n>=1e9){const e=n/1e9;return o+it(e)+"B"}if(n>=1e6){const e=n/1e6;return o+it(e)+"M"}if(n>=1e3){const e=n/1e3;return o+it(e)+"K"}return o+Math.round(n).toString()}function it(t){const n=Math.round(t*10)/10;return n===Math.floor(n)?n.toFixed(0):n.toFixed(1)}const Wt={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","-":"⁻","+":"⁺"};function wt(t){return t.split("").map(n=>Wt[n]??n).join("")}function Q(t,n){var g,f,a,u,l;if(t==null||Number.isNaN(t))return(n==null?void 0:n.naText)??"";if(n!=null&&n.percent){const{decimals:p,digits:m,multiply:d=!0,symbol:A=!0}=n.percent,_=d?t*100:t,x=m!=null?_.toPrecision(m):_.toFixed(p??1);return A?`${x}%`:x}if(((g=n==null?void 0:n.numeric)==null?void 0:g.abbreviate)&&Math.abs(t)>=1e3)return rt(t);const e=(f=n==null?void 0:n.numeric)==null?void 0:f.digits;if(e!=null){const p=t.toPrecision(e),m=(a=n==null?void 0:n.numeric)==null?void 0:a.thousandsSep;return m&&typeof m=="string"?q(p,m):p}const r=(u=n==null?void 0:n.numeric)==null?void 0:u.decimals,i=(l=n==null?void 0:n.numeric)==null?void 0:l.thousandsSep;let s;return r!==void 0?s=t.toFixed(r):Number.isInteger(t)||Math.abs(t-Math.round(t))<1e-4?s=Math.round(t).toString():s=t.toFixed(2),i&&typeof i=="string"&&(s=q(s,i)),s}function ft(t,n){const{eventsField:o,nField:e,separator:r="/",showPct:i=!1,thousandsSep:s,abbreviate:g}=n.events,f=t.metadata[o],a=t.metadata[e];if(f==null||a===void 0||a===null)return n.naText??"";const u=Number(f),l=Number(a);let p,m;g&&(u>=1e3||l>=1e3)?(p=u>=1e3?rt(u):String(u),m=l>=1e3?rt(l):String(l)):(p=String(u),m=String(l),s&&typeof s=="string"&&(p=q(p,s),m=q(m,s)));let d=`${p}${r}${m}`;if(i&&l>0){const A=(u/l*100).toFixed(1);d+=` (${A}%)`}return d}function ht(t,n,o,e){var g,f,a;if(t==null||Number.isNaN(t))return"";const r=((g=e==null?void 0:e.interval)==null?void 0:g.decimals)??2,i=((f=e==null?void 0:e.interval)==null?void 0:f.sep)??" ",s=(a=e==null?void 0:e.interval)==null?void 0:a.impreciseThreshold;return n==null||o===void 0||o===null||Number.isNaN(n)||Number.isNaN(o)?t.toFixed(r):s!=null&&n>0&&o/n>s?"—":`${t.toFixed(r)}${i}(${n.toFixed(r)}, ${o.toFixed(r)})`}function pt(t,n){if(t==null||Number.isNaN(t))return(n==null?void 0:n.naText)??"";const o=n==null?void 0:n.pvalue,e=(o==null?void 0:o.digits)??2,r=(o==null?void 0:o.expThreshold)??.001,i=(o==null?void 0:o.abbrevThreshold)??null,s=(o==null?void 0:o.format)??"auto",g=(o==null?void 0:o.stars)??!1,f=(o==null?void 0:o.thresholds)??[.05,.01,.001];let a="";if(g&&(t<f[2]?a="***":t<f[1]?a="**":t<f[0]&&(a="*")),i!==null&&t<i)return`<${i}${a}`;if(s==="scientific"||s==="auto"&&t<r){const l=Math.floor(Math.log10(t));return`${(t/Math.pow(10,l)).toPrecision(e)}×10${wt(l.toString())}${a}`}let u;return t>=.1?u=t.toFixed(e):t>=.01?u=t.toFixed(e+1):u=t.toFixed(e+2),`${u}${a}`}function Lt(t,n){var i,s,g,f;const{type:o,field:e,options:r}=n;switch(o){case"interval":{const a=(i=r==null?void 0:r.interval)!=null&&i.point?t.metadata[r.interval.point]:t.point,u=(s=r==null?void 0:r.interval)!=null&&s.lower?t.metadata[r.interval.lower]:t.lower,l=(g=r==null?void 0:r.interval)!=null&&g.upper?t.metadata[r.interval.upper]:t.upper;return ht(a,u,l,r)}case"custom":return r!=null&&r.events?ft(t,r):String(t.metadata[e]??"");case"pvalue":return pt(t.metadata[e],r);case"numeric":return Q(t.metadata[e],r);case"percent":return Q(t.metadata[e],r);case"sparkline":case"icon":case"stars":case"img":case"range":return"";case"badge":{const a=t.metadata[e];return a==null?"":`  ${String(a)}  `}case"bar":{if(((f=r==null?void 0:r.bar)==null?void 0:f.showLabel)===!1)return"";const a=t.metadata[e];return a==null?"":a>=100?a.toFixed(0):a>=10?a.toFixed(1):a.toFixed(2)}case"text":default:return String(t.metadata[e]??"")}}function J(t,n){const o="⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻";let e=0;for(const r of t)o.includes(r)?e+=n*.3:"il1.,;:|!()[]{}' ".includes(r)?e+=n*.35:"×−".includes(r)?e+=n*.5:"mwMW@%".includes(r)?e+=n*.85:r>="0"&&r<="9"?e+=n*.6:e+=n*.55;return e}function Gt(t,n){var i,s;const o=new Map,e=j(t.theme.typography.fontSizeBase),r=t.data.rows;for(const g of n){if(g.width!=="auto"&&g.width!==null&&g.width!==void 0)continue;let f=0;g.header&&(f=Math.max(f,J(g.header,e)));for(const u of r){if(((i=u.style)==null?void 0:i.type)==="header"||((s=u.style)==null?void 0:s.type)==="spacer")continue;const l=Lt(u,g);l&&(f=Math.max(f,J(l,e)))}const a=Math.ceil(f+Z.PADDING);o.set(g.id,Math.min(Z.MAX,Math.max(Z.MIN,a)))}return o}function gt(t){var g,f;const n=j(t.theme.typography.fontSizeBase);let o=0;const e=new Map,r=Array.isArray(t.data.groups)?t.data.groups:[];for(const a of r)e.set(a.id,a.depth);const i=a=>a?(e.get(a)??0)+1:0;t.data.labelHeader&&(o=Math.max(o,J(t.data.labelHeader,n)));for(const a of t.data.rows)if(a.label){const u=i(a.groupId),l=((g=a.style)==null?void 0:g.indent)??0,m=(u+l)*G.INDENT_PER_LEVEL;let d=J(a.label,n)+m;if((f=a.style)!=null&&f.badge){const A=String(a.style.badge),_=n*.8,x=4,b=6,I=J(A,_)+x*2;d+=b+I}o=Math.max(o,d)}for(const a of r)if(a.label){const u=a.depth*G.INDENT_PER_LEVEL;o=Math.max(o,J(a.label,n)+u)}const s=Math.ceil(o+Z.PADDING);return Math.min(Z.LABEL_MAX,Math.max(Z.MIN,s))}function at(t,n){const o=n.get(t.id);return o!==void 0?o:typeof t.width=="number"?t.width:k.DEFAULT_COLUMN_WIDTH}function Ft(t,n){var F,C,P,z,Y;const o=t.theme,e=o.spacing.rowHeight,r=o.spacing.padding,i=Array.isArray(t.columns)?t.columns:[],s=et(i,"left"),g=et(i,"right"),a=st(s)||st(g)?o.spacing.headerHeight*ut.GROUP_HEADER_HEIGHT_MULTIPLIER:o.spacing.headerHeight,u=!!((F=t.labels)!=null&&F.title),l=!!((C=t.labels)!=null&&C.subtitle),p=!!((P=t.labels)!=null&&P.caption),m=!!((z=t.labels)!=null&&z.footnote),d=u?B.TITLE_HEIGHT:0,A=l?B.SUBTITLE_HEIGHT:0,_=d+A+(u||l?r:0),x=p?B.CAPTION_HEIGHT:0,b=m?B.FOOTNOTE_HEIGHT:0,H=x+b+(p||m?r:0),I=mt(t),D=!!t.data.overall;let h=0;for(const O of I){const U=O.type==="data"&&((Y=O.row.style)==null?void 0:Y.type)==="spacer";h+=U?e/2:e}D&&(h+=e*ut.OVERALL_ROW_HEIGHT_MULTIPLIER);const c=tt(i,"left"),$=tt(i,"right"),y=[...c,...$];let E,S;if(n.columnWidths){E=new Map;for(const[O,U]of Object.entries(n.columnWidths))O!=="__label__"&&E.set(O,U);S=n.columnWidths.__label__??gt(t)}else E=Gt(t,y),S=gt(t);const M=S+c.reduce((O,U)=>O+at(U,E),0),L=$.reduce((O,U)=>O+at(U,E),0),W=n.width??k.DEFAULT_WIDTH,N=t.data.includeForest,T=M+L;let w;if(!N)w=0;else if(typeof n.forestWidth=="number")w=n.forestWidth;else if(typeof t.layout.plotWidth=="number")w=t.layout.plotWidth;else{const O=W-T-k.COLUMN_GAP*2-r*2;w=Math.max(O,k.MIN_FOREST_WIDTH)}const V=r*2+T+w+k.COLUMN_GAP*2,v=Math.max(n.width??W,V),X=_+r+a+h+k.AXIS_HEIGHT+k.AXIS_LABEL_HEIGHT+H+k.BOTTOM_MARGIN;return{totalWidth:v,totalHeight:n.height??X,tableWidth:M+L,forestWidth:w,headerHeight:a,rowHeight:e,plotHeight:h,axisHeight:k.AXIS_HEIGHT,nullValue:t.data.nullValue,summaryYPosition:h-e,showOverallSummary:D,headerTextHeight:_,footerTextHeight:H,titleY:r+B.TITLE_HEIGHT-8,subtitleY:r+d+B.SUBTITLE_HEIGHT-4,mainY:_+r,footerY:_+r+a+h+k.AXIS_HEIGHT+k.AXIS_LABEL_HEIGHT+r,autoWidths:E,labelWidth:S}}function mt(t){var l;const n=t.data.rows,o=Array.isArray(t.data.groups)?t.data.groups:[];if(o.length===0)return n.map(p=>({type:"data",row:p,depth:0}));const e=new Map;for(const p of o)e.set(p.id,p);const r=new Map;for(const p of n){const m=p.groupId??null;r.has(m)||r.set(m,[]),r.get(m).push(p)}const i=new Set;for(const p of r.keys()){if(!p)continue;let m=p;for(;m;)i.add(m),m=(l=e.get(m))==null?void 0:l.parentId}function s(p){return o.filter(m=>(m.parentId??null)===p&&i.has(m.id))}function g(p){if(!p)return 0;const m=e.get(p);return m?m.depth+1:0}function f(p){var d;let m=((d=r.get(p))==null?void 0:d.length)??0;for(const A of s(p))m+=f(A.id);return m}const a=[];function u(p){if(p){const d=e.get(p);if(!d)return;const A=f(p);a.push({type:"group_header",groupId:d.id,label:d.label,depth:d.depth,rowCount:A})}for(const d of s(p))u(d.id);const m=r.get(p)??[];for(const d of m)a.push({type:"data",row:d,depth:g(d.groupId)})}return u(null),a}function $t(t){const n=[];for(const o of t)o.isGroup?n.push(...$t(o.columns)):n.push(o);return n}function tt(t,n){const o=[];for(const e of t)e.position===n&&(e.isGroup?o.push(...$t(e.columns)):o.push(e));return o}function et(t,n){return t.filter(o=>o.position===n)}function st(t){return t.some(n=>n.isGroup)}function j(t){return t.endsWith("rem")?parseFloat(t)*B.REM_BASE:t.endsWith("px")?parseFloat(t):B.DEFAULT_FONT_SIZE}function nt(t,n,o){return o==="right"?{textX:t+n-G.TEXT_PADDING,anchor:"end"}:o==="center"?{textX:t+n/2,anchor:"middle"}:{textX:t+G.TEXT_PADDING,anchor:"start"}}function R(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function lt(t,n,o,e=0){const r=n-e*2;if(J(t,o)<=r)return t;const s="…",g=o*.55;let f=0,a=t.length;for(;f<a;){const u=Math.ceil((f+a)/2),l=t.slice(0,u);J(l,o)+g<=r?f=u:a=u-1}return f===0?s:t.slice(0,f)+s}function kt(t){return Math.abs(t)<.01?"0":Math.abs(t)>=100?t.toFixed(0):Math.abs(t)>=10?t.toFixed(1):t.toFixed(2)}function yt(t,n){const[o,e]=t,[r,i]=n,s=(i-r)/(e-o),g=f=>r+(f-o)*s;return g.domain=()=>t,g.range=()=>n,g.ticks=f=>{const a=(e-o)/(f-1),u=[];for(let l=0;l<f;l++)u.push(o+a*l);return u},g}function xt(t,n){const[o,e]=t.map(u=>Math.max(u,.001)),[r,i]=n,s=Math.log10(o),g=Math.log10(e),f=(i-r)/(g-s),a=u=>{const l=Math.log10(Math.max(u,.001));return r+(l-s)*f};return a.domain=()=>[o,e],a.range=()=>n,a.ticks=u=>{const l=[],p=Math.floor(Math.log10(o)),m=Math.ceil(Math.log10(e));for(let d=p;d<=m;d++){const A=Math.pow(10,d);for(const _ of[1,2,5]){const x=A*_;x>=o&&x<=e&&l.push(x)}}return l.length>0?l:[o,e]},a}function vt(t,n,o){const e=t.data.scale==="log";if(o!=null&&o.xDomain){const _=o.xDomain;return e?xt([Math.max(_[0],.01),Math.max(_[1],.02)],[0,n]):yt(_,[0,n])}const r=t.data.rows,i=t.theme.axis,s=t.data.nullValue,g=(i==null?void 0:i.padding)??.1,f=(i==null?void 0:i.includeNull)??!0,a=i==null?void 0:i.symmetric,u=(i==null?void 0:i.markerMargin)??!0,l=typeof(i==null?void 0:i.rangeMin)=="number",p=typeof(i==null?void 0:i.rangeMax)=="number";let m;if(l&&p)m=[i.rangeMin,i.rangeMax];else{const _=r.map(x=>x.point).filter(x=>x!=null&&!Number.isNaN(x)&&Number.isFinite(x));if(_.length===0)m=e?[.1,10]:[0,1];else{let x=Math.min(..._),b=Math.max(..._);f&&(x=Math.min(x,s),b=Math.max(b,s));const H=b-x||1;let I=l?i.rangeMin:x-H*g,D=p?i.rangeMax:b+H*g;const h=_.some($=>$<s)&&_.some($=>$>s);if((a===!0||a===null&&h)&&!l&&!p)if(e){const $=Math.log(s),y=Math.max(Math.abs(Math.log(Math.max(I,.001))-$),Math.abs(Math.log(D)-$));I=Math.exp($-y),D=Math.exp($+y)}else{const $=Math.max(Math.abs(I-s),Math.abs(D-s));I=s-$,D=s+$}m=[I,D]}}const d=Nt(m,e);let A=d;if(u&&n>0){const _=t.theme.shapes.pointSize,x=d[1]-d[0],b=_/2*(x/n);if(e){const H=b/d[0];A=[d[0]/(1+H),d[1]*(1+H)]}else A=[d[0]-b,d[1]+b]}return e?xt([Math.max(A[0],.01),Math.max(A[1],.02)],[0,n]):yt(A,[0,n])}function Pt(t,n,o){var i,s;const e=[],r=o.spacing.padding;if((i=t.labels)!=null&&i.title){const g=j(o.typography.fontSizeLg);e.push(`<text x="${r}" y="${n.titleY}"
      font-family="${o.typography.fontFamily}"
      font-size="${g}px"
      font-weight="${o.typography.fontWeightBold}"
      fill="${o.colors.foreground}">${R(t.labels.title)}</text>`)}if((s=t.labels)!=null&&s.subtitle){const g=j(o.typography.fontSizeBase);e.push(`<text x="${r}" y="${n.subtitleY}"
      font-family="${o.typography.fontFamily}"
      font-size="${g}px"
      fill="${o.colors.secondary}">${R(t.labels.subtitle)}</text>`)}return e.join(`
`)}function Rt(t,n,o){var s,g;const e=[],r=o.spacing.padding;let i=n.footerY;if((s=t.labels)!=null&&s.caption){const f=j(o.typography.fontSizeSm);e.push(`<text x="${r}" y="${i}"
      font-family="${o.typography.fontFamily}"
      font-size="${f}px"
      fill="${o.colors.secondary}">${R(t.labels.caption)}</text>`),i+=B.CAPTION_HEIGHT}if((g=t.labels)!=null&&g.footnote){const f=j(o.typography.fontSizeSm);e.push(`<text x="${r}" y="${i}"
      font-family="${o.typography.fontFamily}"
      font-size="${f}px"
      font-style="italic"
      fill="${o.colors.muted}">${R(t.labels.footnote)}</text>`)}return e.join(`
`)}function Tt(t,n,o,e,r,i,s,g,f){const a=[],u=j(i.typography.fontSizeBase),l=i.typography.fontWeightMedium,p=i.typography.fontWeightBold,m=st(t),d=g??k.DEFAULT_LABEL_WIDTH,A=b=>{if(f){const H=f.get(b.id);if(H!==void 0)return H}return typeof b.width=="number"?b.width:k.DEFAULT_COLUMN_WIDTH},_=b=>b.isGroup?b.columns.reduce((H,I)=>H+_(I),0):A(b),x=(b,H)=>b+H/2+u*B.TEXT_BASELINE_ADJUSTMENT;if(m){const b=r/2,H=r/2;let I=o;s&&(a.push(`<text x="${I+G.TEXT_PADDING}" y="${x(e,r)}"
        font-family="${i.typography.fontFamily}"
        font-size="${u}px"
        font-weight="${l}"
        fill="${i.colors.foreground}">${R(s)}</text>`),I+=d);const D=[];for(const h of t)if(h.isGroup){const c=_(h),$=I+c/2;a.push(`<text x="${$}" y="${x(e,b)}"
          font-family="${i.typography.fontFamily}"
          font-size="${u}px"
          font-weight="${p}"
          text-anchor="middle"
          fill="${i.colors.foreground}">${R(h.header)}</text>`),D.push({x1:I,x2:I+c}),I+=c}else{const c=A(h),$=h.headerAlign??h.align,{textX:y,anchor:E}=nt(I,c,$),S=lt(h.header,c,u,G.TEXT_PADDING);a.push(`<text x="${y}" y="${x(e,r)}"
          font-family="${i.typography.fontFamily}"
          font-size="${u}px"
          font-weight="${l}"
          text-anchor="${E}"
          fill="${i.colors.foreground}">${R(S)}</text>`),I+=c}for(const h of D)a.push(`<line x1="${h.x1}" x2="${h.x2}"
        y1="${e+b}" y2="${e+b}"
        stroke="${i.colors.border}" stroke-width="1" opacity="0.5"/>`);I=o+(s?d:0);for(const h of t)if(h.isGroup){for(const c of h.columns)if(!c.isGroup){const $=A(c),y=c.headerAlign??c.align,{textX:E,anchor:S}=nt(I,$,y);a.push(`<text x="${E}" y="${x(e+b,H)}"
              font-family="${i.typography.fontFamily}"
              font-size="${u}px"
              font-weight="${l}"
              text-anchor="${S}"
              fill="${i.colors.foreground}">${R(c.header)}</text>`),I+=$}}else{const c=A(h);I+=c}}else{let b=o;s&&(a.push(`<text x="${b+G.TEXT_PADDING}" y="${x(e,r)}"
        font-family="${i.typography.fontFamily}"
        font-size="${u}px"
        font-weight="${l}"
        fill="${i.colors.foreground}">${R(s)}</text>`),b+=d);for(const H of n){const I=A(H),D=H.headerAlign??H.align,{textX:h,anchor:c}=nt(b,I,D),$=lt(H.header,I,u,G.TEXT_PADDING);a.push(`<text x="${h}" y="${x(e,r)}"
        font-family="${i.typography.fontFamily}"
        font-size="${u}px"
        font-weight="${l}"
        text-anchor="${c}"
        fill="${i.colors.foreground}">${R($)}</text>`),b+=I}}return a.join(`
`)}function Ct(t,n,o,e,r,i,s){const g=[],f=j(s.typography.fontSizeBase),a=e+r/2+f*B.TEXT_BASELINE_ADJUSTMENT,u=n*G.INDENT_PER_LEVEL;return g.push(`<rect x="${o}" y="${e}"
    width="${i}" height="${r}"
    fill="${s.colors.primary}" opacity="${Ht}"/>`),g.push(`<text x="${o+G.TEXT_PADDING+u}" y="${a}"
    font-family="${s.typography.fontFamily}"
    font-size="${f}px"
    font-weight="${s.typography.fontWeightBold}"
    fill="${s.colors.foreground}">${R(t)}</text>`),g.join(`
`)}function bt(t,n){const o=new Map;for(const e of n)if(e.type==="bar"){let r=0;for(const i of t){const s=i.metadata[e.field];typeof s=="number"&&s>r&&(r=s)}o.set(e.field,r>0?r:1)}return o}function Et(t,n,o,e,r,i,s,g=k.DEFAULT_LABEL_WIDTH,f=0,a,u){var _,x,b,H,I,D,h,c,$,y,E,S,M,L,W,N;const l=[],p=j(i.typography.fontSizeBase),m=e+r/2+p*B.TEXT_BASELINE_ADJUSTMENT;let d=o;const A=T=>{if(u){const w=u.get(T.id);if(w!==void 0)return w}return typeof T.width=="number"?T.width:k.DEFAULT_COLUMN_WIDTH};if(s){const T=f*G.INDENT_PER_LEVEL+(((_=t.style)==null?void 0:_.indent)??0)*G.INDENT_PER_LEVEL,w=(x=t.style)!=null&&x.bold||(b=t.style)!=null&&b.emphasis?i.typography.fontWeightBold:i.typography.fontWeightNormal,V=(H=t.style)!=null&&H.italic?"italic":"normal";let v=i.colors.foreground;(I=t.style)!=null&&I.color?v=t.style.color:(D=t.style)!=null&&D.muted?v=i.colors.muted:(h=t.style)!=null&&h.accent&&(v=i.colors.accent);const X=g-T-G.TEXT_PADDING*2,F=lt(t.label,X,p,0);if(l.push(`<text x="${d+G.TEXT_PADDING+T}" y="${m}"
      font-family="${i.typography.fontFamily}"
      font-size="${p}px"
      font-weight="${w}"
      font-style="${V}"
      fill="${v}">${R(F)}</text>`),(c=t.style)!=null&&c.badge){const C=String(t.style.badge),P=p*.8,z=4,Y=P+z*2,O=t.label.length*p*.55,U=d+G.TEXT_PADDING+T+O+6,ot=C.length*P*.6+z*2,At=e+(r-Y)/2;l.push(`<rect x="${U}" y="${At}" width="${ot}" height="${Y}"
        rx="3" fill="${i.colors.primary}" opacity="0.15"/>`),l.push(`<text x="${U+ot/2}" y="${At+Y/2+P*.35}"
        text-anchor="middle"
        font-family="${i.typography.fontFamily}"
        font-size="${P}px"
        font-weight="500"
        fill="${i.colors.primary}">${R(C)}</text>`)}d+=g}for(const T of n){const w=A(T),V=Xt(t,T),{textX:v,anchor:X}=nt(d,w,T.align);if(T.type==="bar"&&typeof t.metadata[T.field]=="number"){const F=t.metadata[T.field],C=a==null?void 0:a.get(T.field),P=((y=($=T.options)==null?void 0:$.bar)==null?void 0:y.maxValue)??C??100,z=((S=(E=T.options)==null?void 0:E.bar)==null?void 0:S.color)??i.colors.primary,Y=i.shapes.pointSize*2,U=w-G.TEXT_PADDING*2-50,It=Math.min(F/P*U,U);l.push(`<rect x="${d+G.TEXT_PADDING}" y="${e+r/2-Y/2}"
        width="${Math.max(0,It)}" height="${Y}"
        fill="${z}" opacity="0.7" rx="2"/>`);const ot=d+w-G.TEXT_PADDING;l.push(`<text x="${ot}" y="${m}"
        font-family="${i.typography.fontFamily}"
        font-size="${p}px"
        text-anchor="end"
        fill="${i.colors.foreground}">${Q(F)}</text>`)}else if(T.type==="sparkline"&&Array.isArray(t.metadata[T.field])){let F=t.metadata[T.field];Array.isArray(F[0])&&(F=F[0]);const C=((L=(M=T.options)==null?void 0:M.sparkline)==null?void 0:L.height)??16,P=((N=(W=T.options)==null?void 0:W.sparkline)==null?void 0:N.color)??i.colors.primary,z=G.TEXT_PADDING*2,Y=Ot(F,d+G.TEXT_PADDING,e+r/2-C/2,w-z,C);l.push(`<path d="${Y}" fill="none" stroke="${P}" stroke-width="1.5"/>`)}else l.push(`<text x="${v}" y="${m}"
        font-family="${i.typography.fontFamily}"
        font-size="${p}px"
        text-anchor="${X}"
        fill="${i.colors.foreground}">${R(V)}</text>`);d+=w}return l.join(`
`)}function Xt(t,n){var e,r,i,s,g,f,a,u,l,p,m,d,A,_,x,b,H,I,D;if(n.type==="interval"){const h=(r=(e=n.options)==null?void 0:e.interval)!=null&&r.point?t.metadata[n.options.interval.point]:t.point,c=(s=(i=n.options)==null?void 0:i.interval)!=null&&s.lower?t.metadata[n.options.interval.lower]:t.lower,$=(f=(g=n.options)==null?void 0:g.interval)!=null&&f.upper?t.metadata[n.options.interval.upper]:t.upper;return ht(h,c,$,n.options)}if(n.type==="numeric"){const h=t.metadata[n.field];return typeof h=="number"?Q(h,n.options):((a=n.options)==null?void 0:a.naText)??""}if(n.type==="custom"&&((u=n.options)!=null&&u.events))return ft(t,n.options);if(n.type==="pvalue"){const h=t.metadata[n.field];return typeof h!="number"?((l=n.options)==null?void 0:l.naText)??"":pt(h,n.options)}if(n.type==="icon"){const h=t.metadata[n.field];if(h==null)return"";const c=String(h),$=(m=(p=n.options)==null?void 0:p.icon)==null?void 0:m.mapping;return $&&c in $?$[c]:c}if(n.type==="badge"){const h=t.metadata[n.field];return h!=null?String(h):""}if(n.type==="stars"){const h=t.metadata[n.field];if(typeof h!="number")return"";const c=((A=(d=n.options)==null?void 0:d.stars)==null?void 0:A.maxStars)??5,$=Math.max(0,Math.min(c,h)),y=Math.floor($),E=c-y;return"★".repeat(y)+"☆".repeat(E)}if(n.type==="img")return((x=(_=n.options)==null?void 0:_.img)==null?void 0:x.fallback)??"[IMG]";if(n.type==="reference"){const h=t.metadata[n.field];if(h==null)return"";const c=String(h),$=((H=(b=n.options)==null?void 0:b.reference)==null?void 0:H.maxChars)??30;return c.length<=$?c:c.substring(0,$)+"..."}if(n.type==="range"){const h=(I=n.options)==null?void 0:I.range;if(!h)return"";const c=t.metadata[h.minField],$=t.metadata[h.maxField],y=h.separator??" – ",E=h.decimals,S=M=>typeof M!="number"?"":E==null?Number.isInteger(M)?String(M):M.toFixed(1):M.toFixed(E);return c===null&&$===null?"":c===null?S($):$===null?S(c):`${S(c)}${y}${S($)}`}const o=t.metadata[n.field];return o!=null?String(o):((D=n.options)==null?void 0:D.naText)??""}function Ot(t,n,o,e,r){const i=t.filter(u=>Number.isFinite(u));if(i.length===0)return"";if(i.length===1){const u=n+e/2,l=o+r/2;return`M${u.toFixed(1)},${l.toFixed(1)}`}const s=Math.min(...i),f=Math.max(...i)-s||1;return`M${i.map((u,l)=>{const p=n+l/(i.length-1)*e,m=o+r-(u-s)/f*r;return`${p.toFixed(1)},${m.toFixed(1)}`}).join("L")}`}const Mt=6;function ct(t,n,o){const e=t.metadata[n];return e!=null&&typeof e=="number"&&!Number.isNaN(e)?e:o}function Ut(t,n){return n<=1?0:-((n-1)*Mt)/2+t*Mt}function Bt(t,n,o,e,r,i=[],s,g=0,f=1/0){var h;let a;i.length===0?a=[{point:t.point,lower:t.lower,upper:t.upper,color:null,shape:null,opacity:null}]:a=i.map(c=>({point:ct(t,c.pointCol,t.point),lower:ct(t,c.lowerCol,t.lower),upper:ct(t,c.upperCol,t.upper),color:c.color??null,shape:c.shape??null,opacity:c.opacity??null}));const u=a.filter(c=>c.point!=null&&!Number.isNaN(c.point)&&c.lower!=null&&!Number.isNaN(c.lower)&&c.upper!=null&&!Number.isNaN(c.upper));if(u.length===0)return"";const l=e.shapes.pointSize,p=e.shapes.lineWidth,m=e.colors.intervalLine,d=G.WHISKER_HALF_HEIGHT,A=((h=t.style)==null?void 0:h.type)==="summary",x=e.shapes.summaryHeight/2;function b(c){var y;if(c&&((y=t.markerStyle)==null?void 0:y.size)!=null)return l*t.markerStyle.size;const $=s?t.metadata[s]:void 0;if($){const E=.5+Math.sqrt($/100)*1.5;return Math.min(Math.max(l*E,3),l*2.5)}return l}function H(c,$){const y=$===0,E=t.markerStyle,S=e.shapes.markerColors,M=e.shapes.markerShapes,L=["square","circle","diamond","triangle"];let W;y&&(E!=null&&E.color)?W=E.color:c.color?W=c.color:S&&S.length>0?W=S[$%S.length]:W=e.colors.interval??e.colors.primary??"#2563eb";let N;y&&(E!=null&&E.shape)?N=E.shape:c.shape?N=c.shape:M&&M.length>0?N=M[$%M.length]:N=L[$%L.length];let T;return y&&(E==null?void 0:E.opacity)!=null?T=E.opacity:c.opacity!=null?T=c.opacity:T=1,{color:W,shape:N,opacity:T}}function I(c,$,y,E){const{color:S,shape:M,opacity:L}=E,W=L<1?` fill-opacity="${L}"`:"";switch(M){case"circle":return`<circle cx="${c}" cy="${$}" r="${y}" fill="${S}"${W}/>`;case"diamond":return`<polygon points="${[`${c},${$-y}`,`${c+y},${$}`,`${c},${$+y}`,`${c-y},${$}`].join(" ")}" fill="${S}"${W}/>`;case"triangle":return`<polygon points="${[`${c},${$-y}`,`${c+y},${$+y}`,`${c-y},${$+y}`].join(" ")}" fill="${S}"${W}/>`;default:return`<rect x="${c-y}" y="${$-y}" width="${y*2}" height="${y*2}" fill="${S}"${W}/>`}}const D=[];return u.forEach((c,$)=>{const y=n+Ut($,u.length),E=o(c.lower),S=o(c.upper),M=o(c.point),L=H(c,$),W=b($===0),N=m;if(A){const T=L.opacity<1?` fill-opacity="${L.opacity}"`:"",w=[`${E},${y}`,`${M},${y-x}`,`${S},${y}`,`${M},${y+x}`].join(" ");D.push(`
        <g class="interval effect-${$} summary">
          <polygon points="${w}"
            fill="${L.color}"${T} stroke="${e.colors.summaryBorder}" stroke-width="1"/>
        </g>`)}else{const T=g,w=g+f,V=E<T,v=S>w,X=Math.max(T,Math.min(w,E)),F=Math.max(T,Math.min(w,S));let C="";V?C=`<path d="M ${T+4} ${y} L ${T+10} ${y-4} L ${T+10} ${y+4} Z" fill="${N}"/>`:C=`<line x1="${X}" x2="${X}" y1="${y-d}" y2="${y+d}" stroke="${N}" stroke-width="${p}"/>`;let P="";v?P=`<path d="M ${w-4} ${y} L ${w-10} ${y-4} L ${w-10} ${y+4} Z" fill="${N}"/>`:P=`<line x1="${F}" x2="${F}" y1="${y-d}" y2="${y+d}" stroke="${N}" stroke-width="${p}"/>`,D.push(`
        <g class="interval effect-${$}">
          <line x1="${X}" x2="${F}" y1="${y}" y2="${y}"
            stroke="${N}" stroke-width="${p}"/>
          ${C}
          ${P}
          ${I(M,y,W,L)}
        </g>`)}}),D.join("")}function Vt(t,n,o,e,r,i,s,g){const a=g.shapes.summaryHeight/2,u=r(n),l=r(t),p=r(o),m=i+Math.max(0,Math.min(s,u)),d=i+Math.max(0,Math.min(s,l)),A=i+Math.max(0,Math.min(s,p));return`<polygon points="${[`${m},${e}`,`${d},${e-a}`,`${A},${e}`,`${d},${e+a}`].join(" ")}"
    fill="${g.colors.summaryFill}"
    stroke="${g.colors.summaryBorder}"
    stroke-width="1"/>`}function zt(t,n,o,e,r,i=1){const s=[],g=typeof o.axis.tickCount=="number"?o.axis.tickCount:G.DEFAULT_TICK_COUNT,f=Yt(t,g,o,i,n.forestWidth),a=j(o.typography.fontSizeSm),u=35,l=m=>m<u?"start":m>n.forestWidth-u?"end":"middle",p=m=>m<u?2:m>n.forestWidth-u?-2:0;s.push(`<line x1="${r}" x2="${r+n.forestWidth}"
    y1="0" y2="0" stroke="${o.colors.border}" stroke-width="1"/>`);for(const m of f){const d=t(m),A=r+d,_=l(d),x=p(d);s.push(`<line x1="${A}" x2="${A}" y1="0" y2="4"
      stroke="${o.colors.border}" stroke-width="1"/>`),s.push(`<text x="${A+x}" y="16" text-anchor="${_}"
      font-family="${o.typography.fontFamily}"
      font-size="${a}px"
      fill="${o.colors.secondary}">${kt(m)}</text>`)}return e&&s.push(`<text x="${r+n.forestWidth/2}" y="28"
      text-anchor="middle"
      font-family="${o.typography.fontFamily}"
      font-size="${a}px"
      font-weight="500"
      fill="${o.colors.secondary}">${R(e)}</text>`),`<g transform="translate(0, ${n.mainY+n.headerHeight+n.plotHeight})">${s.join(`
`)}</g>`}function Yt(t,n,o,e,r){if(Array.isArray(o.axis.tickValues)&&o.axis.tickValues.length>0){const[h,c]=t.domain();let $=o.axis.tickValues.filter(S=>S>=h&&S<=c);const y=o.axis.nullTick!==!1,E=e>=h&&e<=c;return y&&E&&!$.includes(e)&&($=[...$,e].sort((S,M)=>S-M)),$}const[i,s]=t.domain(),g=o.axis.nullTick!==!1,f=e>=i&&e<=s,a=50,u=Math.max(2,Math.floor(r/a)),l=Math.min(n,Math.min(7,u)),p=t.ticks(l);if(p.length===0)return g&&f?[e]:[];const m=t(e),d=p.filter(h=>h<e).reverse(),A=p.filter(h=>h>e),_=p.some(h=>h===e),x=[];let b=m;for(const h of d){const c=t(h);b-c>=a&&(x.unshift(h),b=c)}const H=[];let I=m;for(const h of A){const c=t(h);c-I>=a&&(H.push(h),I=c)}const D=[...x];if((_||g&&f)&&D.push(e),D.push(...H),D.length<2){const h=new Set(D);h.has(i)||D.unshift(i),D.length<2&&!h.has(s)&&D.push(s)}return D}function _t(t,n,o,e,r,i,s=1,g=.6){let a=`<line x1="${t}" x2="${t}" y1="${n}" y2="${o}"
    stroke="${r}" stroke-width="${s}" stroke-opacity="${g}" stroke-dasharray="${e==="dashed"?"6,4":e==="dotted"?"2,2":"none"}"/>`;return i&&(a+=`<text x="${t}" y="${n-4}" text-anchor="middle"
      font-size="10px" fill="${r}">${R(i)}</text>`),a}class K extends Error{constructor(n){super(`SVG Generator: ${n}`),this.name="SVGGeneratorError"}}function jt(t){if(!t||typeof t!="object")throw new K("Invalid spec: expected an object");const n=t;if(!n.data||typeof n.data!="object")throw new K("Invalid spec: missing or invalid 'data' property");const o=n.data;if(!Array.isArray(o.rows))throw new K("Invalid spec: 'data.rows' must be an array");if(!n.theme||typeof n.theme!="object")throw new K("Invalid spec: missing or invalid 'theme' property");const e=n.theme;if(!e.colors||typeof e.colors!="object")throw new K("Invalid spec: missing or invalid 'theme.colors'");if(!e.typography||typeof e.typography!="object")throw new K("Invalid spec: missing or invalid 'theme.typography'");if(!e.spacing||typeof e.spacing!="object")throw new K("Invalid spec: missing or invalid 'theme.spacing'")}function Jt(t,n={}){var S;jt(t);const o=t.theme,e=Ft(t,n),r=o.spacing.padding,i=Array.isArray(t.columns)?t.columns:[],s=et(i,"left"),g=et(i,"right"),f=tt(i,"left"),a=tt(i,"right"),u=e.labelWidth+f.reduce((M,L)=>M+at(L,e.autoWidths),0),l=r+u+k.COLUMN_GAP,p=vt(t,e.forestWidth,n),m=l+e.forestWidth+k.COLUMN_GAP,d=[];d.push(`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg"
  width="${e.totalWidth}" height="${e.totalHeight}"
  viewBox="0 0 ${e.totalWidth} ${e.totalHeight}">`);const A=n.backgroundColor??o.colors.background;d.push(`<rect width="100%" height="100%" fill="${A}"/>`),d.push(Pt(t,e,o)),d.push(`<line x1="${r}" x2="${e.totalWidth-r}"
    y1="${e.mainY}" y2="${e.mainY}"
    stroke="${o.colors.border}" stroke-width="2"/>`);const _=e.mainY;d.push(Tt(s,f,r,_,e.headerHeight,o,t.data.labelHeader??"Study",e.labelWidth,e.autoWidths)),a.length>0&&d.push(Tt(g,a,m,_,e.headerHeight,o,void 0,void 0,e.autoWidths)),d.push(`<line x1="${r}" x2="${e.totalWidth-r}"
    y1="${_+e.headerHeight}" y2="${_+e.headerHeight}"
    stroke="${o.colors.border}" stroke-width="2"/>`);const x=mt(t),H=(Array.isArray(t.data.groups)?t.data.groups:[]).length>0,I=[],D=[];let h=0;for(const M of x){const W=M.type==="data"&&((S=M.row.style)==null?void 0:S.type)==="spacer"?e.rowHeight/2:e.rowHeight;I.push(h),D.push(W),h+=W}if(t.data.includeForest&&e.forestWidth>0){const M=e.mainY+e.headerHeight,L=l+p(t.data.nullValue);d.push(_t(L,M,M+e.plotHeight,"dashed",o.colors.muted));const W=Array.isArray(t.annotations)?t.annotations:[];for(const N of W)if(N.type==="reference_line"){const T=l+p(N.x);d.push(_t(T,M,M+e.plotHeight,N.style,N.color??o.colors.accent,N.label,N.width??1,N.opacity??.6))}if(x.forEach((N,T)=>{if(N.type==="data"){const w=M+I[T]+D[T]/2;d.push(Bt(N.row,w,V=>l+p(V),o,t.data.nullValue,t.data.effects,t.data.weightCol,l,e.forestWidth))}}),t.data.overall&&e.showOverallSummary&&typeof t.data.overall.point=="number"&&!Number.isNaN(t.data.overall.point)&&typeof t.data.overall.lower=="number"&&!Number.isNaN(t.data.overall.lower)&&typeof t.data.overall.upper=="number"&&!Number.isNaN(t.data.overall.upper)){const N=M+e.summaryYPosition;d.push(Vt(t.data.overall.point,t.data.overall.lower,t.data.overall.upper,N,p,l,e.forestWidth,o))}d.push(zt(p,e,o,t.data.axisLabel,l,t.data.nullValue))}const c=e.mainY+e.headerHeight,$=t.data.rows,y=bt($,f),E=bt($,a);return x.forEach((M,L)=>{var T,w,V;const W=c+I[L],N=D[L];if(M.type==="group_header")d.push(Ct(M.label,M.depth,r,W,N,e.totalWidth-r*2,o));else{const v=M.row,X=M.depth;if(!(((T=v.style)==null?void 0:T.type)==="spacer")){const C=Dt(X),P=!H&&L%2===1?St:0,z=Math.max(C,P);z>0&&d.push(`<rect x="${r}" y="${W}"
            width="${e.totalWidth-r*2}" height="${N}"
            fill="${o.colors.muted}" opacity="${z}"/>`)}d.push(Et(v,f,r,W,N,o,!0,e.labelWidth,X,y,e.autoWidths)),a.length>0&&d.push(Et(v,a,m,W,N,o,!1,0,X,E,e.autoWidths))}if(M.type==="data"){const v=M.row,X=((w=v.style)==null?void 0:w.type)==="summary",F=((V=v.style)==null?void 0:V.type)==="spacer";X&&d.push(`<line x1="${r}" x2="${e.totalWidth-r}"
          y1="${W}" y2="${W}"
          stroke="${o.colors.border}" stroke-width="2"/>`),F||d.push(`<line x1="${r}" x2="${e.totalWidth-r}"
          y1="${W+N}" y2="${W+N}"
          stroke="${o.colors.border}" stroke-width="1"/>`)}else d.push(`<line x1="${r}" x2="${e.totalWidth-r}"
        y1="${W+N}" y2="${W+N}"
        stroke="${o.colors.border}" stroke-width="1"/>`)}),d.push(Rt(t,e,o)),d.push("</svg>"),d.join(`
`)}function Kt(t,n){const o=JSON.parse(t);return Jt(o,n)}globalThis.generateSVG=Kt})();
